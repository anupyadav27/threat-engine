version: '1.0'
provider: alicloud
service: dts
discovery:
- discovery_id: alicloud.dts.accelerator_cluster_encryption_at_rest_enabled
  calls:
  - product: DTS
    version: '2014-05-26'
    action: DescribeAcceleratorClusterEncryptionAtRestEnableds
    params: {}
    save_as: accelerator_cluster_encryption_at_rest_enabled_list
  emit:
    items_for: '{ accelerator_cluster_encryption_at_rest_enabled_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: accelerator_cluster_encryption_at_rest_enabled
- discovery_id: alicloud.dts.autoscaling_properly_configured
  calls:
  - product: DTS
    version: '2014-05-26'
    action: DescribeAutoscalingProperlyConfigureds
    params: {}
    save_as: autoscaling_properly_configured_list
  emit:
    items_for: '{ autoscaling_properly_configured_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: autoscaling_properly_configured
- discovery_id: alicloud.dts.backup
  calls:
  - product: DTS
    version: '2014-05-26'
    action: DescribeBackups
    params: {}
    save_as: backup_list
  emit:
    items_for: '{ backup_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: backup
- discovery_id: alicloud.dts.dr
  calls:
  - product: DTS
    version: '2014-05-26'
    action: DescribeDrs
    params: {}
    save_as: dr_list
  emit:
    items_for: '{ dr_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: dr
- discovery_id: alicloud.dts.instance
  calls:
  - product: DTS
    version: '2014-05-26'
    action: DescribeInstances
    params: {}
    save_as: instance_list
  emit:
    items_for: '{ instance_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: instance
- discovery_id: alicloud.dts.pitr_properly_configured
  calls:
  - product: DTS
    version: '2014-05-26'
    action: DescribePitrProperlyConfigureds
    params: {}
    save_as: pitr_properly_configured_list
  emit:
    items_for: '{ pitr_properly_configured_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: pitr_properly_configured
- discovery_id: alicloud.dts.server
  calls:
  - product: DTS
    version: '2014-05-26'
    action: DescribeServers
    params: {}
    save_as: server_list
  emit:
    items_for: '{ server_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: server
- discovery_id: alicloud.dts.table
  calls:
  - product: DTS
    version: '2014-05-26'
    action: DescribeTables
    params: {}
    save_as: table_list
  emit:
    items_for: '{ table_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: table
- discovery_id: alicloud.dts.tables_kms_cmk_encryption_at_rest_enabled
  calls:
  - product: DTS
    version: '2014-05-26'
    action: DescribeTablesKmsCmkEncryptionAtRestEnableds
    params: {}
    save_as: tables_kms_cmk_encryption_at_rest_enabled_list
  emit:
    items_for: '{ tables_kms_cmk_encryption_at_rest_enabled_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: tables_kms_cmk_encryption_at_rest_enabled
- discovery_id: alicloud.dts.tables_point_in_time_recovery_enabled
  calls:
  - product: DTS
    version: '2014-05-26'
    action: DescribeTablesPointInTimeRecoveryEnableds
    params: {}
    save_as: tables_point_in_time_recovery_enabled_list
  emit:
    items_for: '{ tables_point_in_time_recovery_enabled_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: tables_point_in_time_recovery_enabled
- discovery_id: alicloud.dts.task
  calls:
  - product: DTS
    version: '2014-05-26'
    action: DescribeTasks
    params: {}
    save_as: task_list
  emit:
    items_for: '{ task_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: task
checks:
- rule_id: alicloud.dts.accelerator_cluster_encryption_at_rest_enabled.configured
  title: Ensure Data Transmission Service (DTS) accelerator clusters have encryption
    at rest enabled
  severity: medium
  assertion_id: ''
  for_each: alicloud.dts.accelerator_cluster_encryption_at_rest_enabled
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.dts.autoscaling_properly_configured.configured
  title: Data Transmission Service Auto Scaling Should Be Properly Configured
  severity: low
  assertion_id: ''
  for_each: alicloud.dts.autoscaling_properly_configured
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.dts.backup.continuous_enabled
  title: Data Transmission Service (DTS) backup continuous replication should be enabled
  severity: low
  assertion_id: ''
  for_each: alicloud.dts.backup
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.dts.dr.replication_auth_roles_least_privilege
  title: Data Transmission Service Disaster Recovery Replication Authentication Roles
    Should Follow Least Privilege Principle
  severity: high
  assertion_id: ''
  for_each: alicloud.dts.dr
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.dts.dr.replication_cross_region_replication_encrypted
  title: Data Transmission Service Cross-Region Disaster Recovery Replication Must
    Be Encrypted
  severity: low
  assertion_id: ''
  for_each: alicloud.dts.dr
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.dts.dr.replication_encryption_in_transit_tls_required
  title: Data Transmission Service Disaster Recovery Replication Must Use TLS Encryption
    in Transit
  severity: high
  assertion_id: ''
  for_each: alicloud.dts.dr
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.dts.instance.private_access_only
  title: Ensure Data Transmission Service instances are configured for private access
    only
  severity: medium
  assertion_id: canada_pbmm_moderate_multi_cloud_CCCS_AC-17_0013
  for_each: alicloud.dts.instance
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.dts.pitr_properly_configured.configured
  title: Data Transmission Service Point-in-Time Recovery should be properly configured
  severity: low
  assertion_id: ''
  for_each: alicloud.dts.pitr_properly_configured
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.dts.server.in_transit_encryption_enabled
  title: Data Transmission Service (DTS) Server In-Transit Encryption Should Be Enabled
  severity: high
  assertion_id: ''
  for_each: alicloud.dts.server
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.dts.table.backup_plan_enforced
  title: Data Transmission Service (DTS) Migration Tables Must Have Backup Plan Enforced
  severity: medium
  assertion_id: ''
  for_each: alicloud.dts.table
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.dts.tables_kms_cmk_encryption_at_rest_enabled.configured
  title: Ensure Data Transmission Service tables have KMS Customer Master Key encryption
    at rest enabled
  severity: medium
  assertion_id: ''
  for_each: alicloud.dts.tables_kms_cmk_encryption_at_rest_enabled
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.dts.tables_point_in_time_recovery_enabled.configured
  title: Ensure Data Transmission Service (DTS) tables have point-in-time recovery
    enabled
  severity: low
  assertion_id: ''
  for_each: alicloud.dts.tables_point_in_time_recovery_enabled
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.dts.task.logging_enabled
  title: Data Transmission Service (DTS) Task Logging Should Be Enabled
  severity: medium
  assertion_id: ''
  for_each: alicloud.dts.task
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
