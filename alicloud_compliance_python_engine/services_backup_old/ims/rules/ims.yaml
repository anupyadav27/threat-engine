version: '1.0'
provider: alicloud
service: ims
discovery:
- discovery_id: alicloud.ims.account
  calls:
  - product: IMS
    version: '2014-05-26'
    action: DescribeAccounts
    params: {}
    save_as: account_list
  emit:
    items_for: '{ account_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: account
- discovery_id: alicloud.ims.audit
  calls:
  - product: IMS
    version: '2014-05-26'
    action: DescribeAudits
    params: {}
    save_as: audit_list
  emit:
    items_for: '{ audit_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: audit
- discovery_id: alicloud.ims.cloud
  calls:
  - product: IMS
    version: '2014-05-26'
    action: DescribeClouds
    params: {}
    save_as: cloud_list
  emit:
    items_for: '{ cloud_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: cloud
- discovery_id: alicloud.ims.custom
  calls:
  - product: IMS
    version: '2014-05-26'
    action: DescribeCustoms
    params: {}
    save_as: custom_list
  emit:
    items_for: '{ custom_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: custom
- discovery_id: alicloud.ims.no
  calls:
  - product: IMS
    version: '2014-05-26'
    action: DescribeNos
    params: {}
    save_as: no_list
  emit:
    items_for: '{ no_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: 'no'
- discovery_id: alicloud.ims.organization
  calls:
  - product: IMS
    version: '2014-05-26'
    action: DescribeOrganizations
    params: {}
    save_as: organization_list
  emit:
    items_for: '{ organization_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: organization
- discovery_id: alicloud.ims.role
  calls:
  - product: IMS
    version: '2014-05-26'
    action: DescribeRoles
    params: {}
    save_as: role_list
  emit:
    items_for: '{ role_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: role
checks:
- rule_id: alicloud.ims.account.access_approval_enabled
  title: Ensure AliCloud Identity Management Service Account Has Access Approval Enabled
  severity: medium
  assertion_id: ''
  for_each: alicloud.ims.account
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.ims.audit.logs_enabled
  title: Identity Management Service (IMS) Audit Logging Must Be Enabled
  severity: low
  assertion_id: ''
  for_each: alicloud.ims.audit
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.ims.cloud.asset_inventory_enabled
  title: Ensure AliCloud Identity Management Service Asset Inventory is Enabled
  severity: low
  assertion_id: ''
  for_each: alicloud.ims.cloud
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.ims.custom.role_has_permissions_to_administer_resource_locks
  title: Identity and Access Management Custom Role Has Permissions To Administer
    Resource Locks
  severity: high
  assertion_id: ''
  for_each: alicloud.ims.custom
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.ims.no.service_roles_at_project_level
  title: Ensure Identity Management Service (IMS) Service Roles Are Not Assigned at
    Project Level
  severity: medium
  assertion_id: ''
  for_each: alicloud.ims.no
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.ims.organization.essential_contacts_configured
  title: AliCloud Identity Management Service Organization Must Have Essential Contacts
    Configured
  severity: low
  assertion_id: ''
  for_each: alicloud.ims.organization
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.ims.role.kms_enforce_separation_of_duties
  title: Identity and Access Management (IMS) roles should enforce separation of duties
    for Key Management Service (KMS) operations
  severity: medium
  assertion_id: ''
  for_each: alicloud.ims.role
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
