version: '1.0'
provider: alicloud
service: gtm
discovery:
- discovery_id: alicloud.gtm.traffic_manager_policy
  calls:
  - product: GTM
    version: '2014-05-26'
    action: DescribeTrafficManagerPolicys
    params: {}
    save_as: traffic_manager_policy_list
  emit:
    items_for: '{ traffic_manager_policy_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: traffic_manager_policy
checks:
- rule_id: alicloud.gtm.traffic_manager_policy.traffic_policy_health_checks_required_for_failover
  title: Global Traffic Manager Traffic Policy Health Checks Required For Failover
  severity: medium
  assertion_id: ''
  for_each: alicloud.gtm.traffic_manager_policy
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.gtm.traffic_manager_policy.traffic_policy_policy_documents_encrypted_and_private
  title: Ensure Global Traffic Manager Traffic Policy Documents Are Encrypted and
    Private
  severity: medium
  assertion_id: ''
  for_each: alicloud.gtm.traffic_manager_policy
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.gtm.traffic_manager_policy.traffic_policy_targets_approved_domains_only
  title: Ensure Global Traffic Manager Traffic Policy Targets Only Approved Domains
  severity: medium
  assertion_id: ''
  for_each: alicloud.gtm.traffic_manager_policy
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
