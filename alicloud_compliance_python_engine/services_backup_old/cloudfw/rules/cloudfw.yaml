version: '1.0'
provider: alicloud
service: cloudfw
discovery:
- discovery_id: alicloud.cloudfw.deployed_across_all_vpcs
  calls:
  - product: CLOUDFW
    version: '2014-05-26'
    action: DescribeDeployedAcrossAllVpcss
    params: {}
    save_as: deployed_across_all_vpcs_list
  emit:
    items_for: '{ deployed_across_all_vpcs_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: deployed_across_all_vpcs
- discovery_id: alicloud.cloudfw.in
  calls:
  - product: CLOUDFW
    version: '2014-05-26'
    action: DescribeIns
    params: {}
    save_as: in_list
  emit:
    items_for: '{ in_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: in
- discovery_id: alicloud.cloudfw.instance
  calls:
  - product: CLOUDFW
    version: '2014-05-26'
    action: DescribeInstances
    params: {}
    save_as: instance_list
  emit:
    items_for: '{ instance_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: instance
- discovery_id: alicloud.cloudfw.log
  calls:
  - product: CLOUDFW
    version: '2014-05-26'
    action: DescribeLogs
    params: {}
    save_as: log_list
  emit:
    items_for: '{ log_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: log
- discovery_id: alicloud.cloudfw.logging
  calls:
  - product: CLOUDFW
    version: '2014-05-26'
    action: DescribeLoggings
    params: {}
    save_as: logging_list
  emit:
    items_for: '{ logging_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: logging
- discovery_id: alicloud.cloudfw.logging_enabled
  calls:
  - product: CLOUDFW
    version: '2014-05-26'
    action: DescribeLoggingEnableds
    params: {}
    save_as: logging_enabled_list
  emit:
    items_for: '{ logging_enabled_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: logging_enabled
- discovery_id: alicloud.cloudfw.logging_enabled_for_all_traffic
  calls:
  - product: CLOUDFW
    version: '2014-05-26'
    action: DescribeLoggingEnabledForAllTraffics
    params: {}
    save_as: logging_enabled_for_all_traffic_list
  emit:
    items_for: '{ logging_enabled_for_all_traffic_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: logging_enabled_for_all_traffic
- discovery_id: alicloud.cloudfw.multi
  calls:
  - product: CLOUDFW
    version: '2014-05-26'
    action: DescribeMultis
    params: {}
    save_as: multi_list
  emit:
    items_for: '{ multi_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: multi
- discovery_id: alicloud.cloudfw.multi_az_with_auto_scaling
  calls:
  - product: CLOUDFW
    version: '2014-05-26'
    action: DescribeMultiAzWithAutoScalings
    params: {}
    save_as: multi_az_with_auto_scaling_list
  emit:
    items_for: '{ multi_az_with_auto_scaling_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: multi_az_with_auto_scaling
checks:
- rule_id: alicloud.cloudfw.deployed_across_all_vpcs.configured
  title: Ensure AliCloud Cloud Firewall is deployed across all VPCs for comprehensive
    network protection
  severity: medium
  assertion_id: ''
  for_each: alicloud.cloudfw.deployed_across_all_vpcs
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.cloudfw.in.all_vpc
  title: Ensure Cloud Firewall Protection is Enabled for All VPC Networks
  severity: medium
  assertion_id: ''
  for_each: alicloud.cloudfw.in
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.cloudfw.instance.automated_backups
  title: AliCloud Cloud Firewall instances should have automated backups enabled
  severity: medium
  assertion_id: ''
  for_each: alicloud.cloudfw.instance
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.cloudfw.instance.postgres_log_connections_flag
  title: AliCloud Cloud Firewall Instance Should Have PostgreSQL Log Connections Flag
    Enabled
  severity: low
  assertion_id: ''
  for_each: alicloud.cloudfw.instance
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.cloudfw.instance.postgres_log_disconnections_flag
  title: AliCloud Cloud Firewall Instance Should Have PostgreSQL Log Disconnections
    Flag Enabled
  severity: low
  assertion_id: ''
  for_each: alicloud.cloudfw.instance
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.cloudfw.instance.postgres_log_error_verbosity_flag
  title: AliCloud Cloud Firewall Instance PostgreSQL Log Error Verbosity Flag Configuration
  severity: low
  assertion_id: ''
  for_each: alicloud.cloudfw.instance
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.cloudfw.instance.postgres_log_min_duration_statement_flag
  title: AliCloud Cloud Firewall PostgreSQL Database Should Have Log Min Duration
    Statement Flag Configured
  severity: low
  assertion_id: ''
  for_each: alicloud.cloudfw.instance
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.cloudfw.instance.postgres_log_min_error_statement_flag
  title: AliCloud Cloud Firewall Instance PostgreSQL Log Min Error Statement Flag
    Configuration
  severity: low
  assertion_id: ''
  for_each: alicloud.cloudfw.instance
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.cloudfw.instance.postgres_log_min_messages_flag
  title: AliCloud Cloud Firewall Instance PostgreSQL Log Min Messages Flag Configuration
  severity: low
  assertion_id: ''
  for_each: alicloud.cloudfw.instance
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.cloudfw.instance.postgres_log_statement_flag
  title: AliCloud Cloud Firewall Instance PostgreSQL Log Statement Flag Configuration
  severity: low
  assertion_id: ''
  for_each: alicloud.cloudfw.instance
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.cloudfw.instance.public_access
  title: AliCloud Cloud Firewall Instance Should Not Allow Unrestricted Public Access
  severity: high
  assertion_id: ''
  for_each: alicloud.cloudfw.instance
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.cloudfw.instance.public_ip
  title: Cloud Firewall instance should have public IP address configured
  severity: high
  assertion_id: ''
  for_each: alicloud.cloudfw.instance
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.cloudfw.instance.ssl_connections
  title: Ensure AliCloud Cloud Firewall instances have SSL connections enabled
  severity: medium
  assertion_id: ''
  for_each: alicloud.cloudfw.instance
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.cloudfw.log.analysis_status_check
  title: AliCloud Cloud Firewall Log Analysis Status Should Be Enabled
  severity: low
  assertion_id: ''
  for_each: alicloud.cloudfw.log
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.cloudfw.logging.enabled
  title: Ensure AliCloud Cloud Firewall logging is enabled
  severity: low
  assertion_id: ''
  for_each: alicloud.cloudfw.logging
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.cloudfw.logging_enabled.configured
  title: Ensure AliCloud Cloud Firewall logging is properly configured
  severity: low
  assertion_id: ''
  for_each: alicloud.cloudfw.logging_enabled
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.cloudfw.logging_enabled_for_all_traffic.configured
  title: Ensure AliCloud Cloud Firewall logging is enabled for all traffic
  severity: low
  assertion_id: ''
  for_each: alicloud.cloudfw.logging_enabled_for_all_traffic
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.cloudfw.multi.az
  title: Cloud Firewall should be deployed across multiple availability zones
  severity: low
  assertion_id: ''
  for_each: alicloud.cloudfw.multi
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.cloudfw.multi_az_with_auto_scaling.configured
  title: AliCloud Cloud Firewall Multi-AZ Deployment with Auto Scaling Should Be Configured
  severity: low
  assertion_id: ''
  for_each: alicloud.cloudfw.multi_az_with_auto_scaling
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
