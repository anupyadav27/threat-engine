version: '1.0'
provider: alicloud
service: apsaramq
discovery:
- discovery_id: alicloud.apsaramq.broker
  calls:
  - product: APSARAMQ
    version: '2014-05-26'
    action: DescribeBrokers
    params: {}
    save_as: broker_list
  emit:
    items_for: '{ broker_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: broker
- discovery_id: alicloud.apsaramq.cluster
  calls:
  - product: APSARAMQ
    version: '2014-05-26'
    action: DescribeClusters
    params: {}
    save_as: cluster_list
  emit:
    items_for: '{ cluster_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: cluster
- discovery_id: alicloud.apsaramq.connector
  calls:
  - product: APSARAMQ
    version: '2014-05-26'
    action: DescribeConnectors
    params: {}
    save_as: connector_list
  emit:
    items_for: '{ connector_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: connector
- discovery_id: alicloud.apsaramq.fleet
  calls:
  - product: APSARAMQ
    version: '2014-05-26'
    action: DescribeFleets
    params: {}
    save_as: fleet_list
  emit:
    items_for: '{ fleet_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: fleet
- discovery_id: alicloud.apsaramq.kafka_topic
  calls:
  - product: APSARAMQ
    version: '2014-05-26'
    action: DescribeKafkaTopics
    params: {}
    save_as: kafka_topic_list
  emit:
    items_for: '{ kafka_topic_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: kafka_topic
- discovery_id: alicloud.apsaramq.queue
  calls:
  - product: APSARAMQ
    version: '2014-05-26'
    action: DescribeQueues
    params: {}
    save_as: queue_list
  emit:
    items_for: '{ queue_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: queue
checks:
- rule_id: alicloud.apsaramq.broker.active_deployment_mode
  title: ApsaraMQ for RocketMQ Broker Should Use Active Deployment Mode
  severity: medium
  assertion_id: ''
  for_each: alicloud.apsaramq.broker
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.apsaramq.broker.cluster_deployment_mode
  title: ApsaraMQ for RocketMQ Broker Should Use Cluster Deployment Mode
  severity: medium
  assertion_id: ''
  for_each: alicloud.apsaramq.broker
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.apsaramq.broker.logging_enabled
  title: ApsaraMQ for Apache RocketMQ Broker Logging Should Be Enabled
  severity: medium
  assertion_id: ''
  for_each: alicloud.apsaramq.broker
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.apsaramq.cluster.encryption_at_rest_uses_cmk
  title: ApsaraMQ for RocketMQ cluster encryption at rest should use Customer Managed
    Keys (CMK)
  severity: high
  assertion_id: ''
  for_each: alicloud.apsaramq.cluster
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.apsaramq.cluster.in_transit_encryption_enabled
  title: ApsaraMQ for Apache Kafka Cluster Should Have In-Transit Encryption Enabled
  severity: high
  assertion_id: ''
  for_each: alicloud.apsaramq.cluster
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.apsaramq.connector.in_transit_encryption_enabled
  title: ApsaraMQ for Kafka Connector Should Have In-Transit Encryption Enabled
  severity: high
  assertion_id: ''
  for_each: alicloud.apsaramq.connector
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.apsaramq.fleet.default_internet_access_disabled
  title: ApsaraMQ for RocketMQ Fleet Should Have Default Internet Access Disabled
  severity: medium
  assertion_id: ''
  for_each: alicloud.apsaramq.fleet
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.apsaramq.kafka_topic.stream_consumer_auth_required
  title: ApsaraMQ for Kafka Topic Stream Consumer Authentication Required
  severity: medium
  assertion_id: ''
  for_each: alicloud.apsaramq.kafka_topic
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.apsaramq.kafka_topic.stream_encryption_at_rest_enabled
  title: ApsaraMQ for Apache Kafka Topic Stream Encryption At Rest Should Be Enabled
  severity: high
  assertion_id: ''
  for_each: alicloud.apsaramq.kafka_topic
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.apsaramq.kafka_topic.stream_private_network_only_where_supported
  title: ApsaraMQ for Apache Kafka Topics Should Use Private Network Access Only Where
    Supported
  severity: medium
  assertion_id: ''
  for_each: alicloud.apsaramq.kafka_topic
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.apsaramq.queue.auth_required
  title: ApsaraMQ for RocketMQ Queue Authentication Should Be Required
  severity: medium
  assertion_id: ''
  for_each: alicloud.apsaramq.queue
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.apsaramq.queue.cross_account_send_receive_restricted
  title: ApsaraMQ for RocketMQ Queue Cross-Account Send and Receive Access Should
    Be Restricted
  severity: medium
  assertion_id: ''
  for_each: alicloud.apsaramq.queue
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.apsaramq.queue.encryption_at_rest_enabled
  title: ApsaraMQ for RocketMQ Queue Encryption at Rest Should Be Enabled
  severity: high
  assertion_id: ''
  for_each: alicloud.apsaramq.queue
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.apsaramq.queue.private_network_only_where_supported
  title: ApsaraMQ for RocketMQ queues should be configured for private network access
    only where supported
  severity: medium
  assertion_id: ''
  for_each: alicloud.apsaramq.queue
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
