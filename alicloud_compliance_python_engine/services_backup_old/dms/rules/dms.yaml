version: '1.0'
provider: alicloud
service: dms
discovery:
- discovery_id: alicloud.dms.classification
  calls:
  - product: DMS
    version: '2014-05-26'
    action: DescribeClassifications
    params: {}
    save_as: classification_list
  emit:
    items_for: '{ classification_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: classification
- discovery_id: alicloud.dms.classification_data
  calls:
  - product: DMS
    version: '2014-05-26'
    action: DescribeClassificationDatas
    params: {}
    save_as: classification_data_list
  emit:
    items_for: '{ classification_data_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: classification_data
- discovery_id: alicloud.dms.compliance_pack_data
  calls:
  - product: DMS
    version: '2014-05-26'
    action: DescribeCompliancePackDatas
    params: {}
    save_as: compliance_pack_data_list
  emit:
    items_for: '{ compliance_pack_data_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: compliance_pack_data
- discovery_id: alicloud.dms.data_masking
  calls:
  - product: DMS
    version: '2014-05-26'
    action: DescribeDataMaskings
    params: {}
    save_as: data_masking_list
  emit:
    items_for: '{ data_masking_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: data_masking
- discovery_id: alicloud.dms.desensitization
  calls:
  - product: DMS
    version: '2014-05-26'
    action: DescribeDesensitizations
    params: {}
    save_as: desensitization_list
  emit:
    items_for: '{ desensitization_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: desensitization
- discovery_id: alicloud.dms.endpoint
  calls:
  - product: DMS
    version: '2014-05-26'
    action: DescribeEndpoints
    params: {}
    save_as: endpoint_list
  emit:
    items_for: '{ endpoint_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: endpoint
- discovery_id: alicloud.dms.instance
  calls:
  - product: DMS
    version: '2014-05-26'
    action: DescribeInstances
    params: {}
    save_as: instance_list
  emit:
    items_for: '{ instance_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: instance
- discovery_id: alicloud.dms.replication_instance
  calls:
  - product: DMS
    version: '2014-05-26'
    action: DescribeReplicationInstances
    params: {}
    save_as: replication_instance_list
  emit:
    items_for: '{ replication_instance_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: replication_instance
checks:
- rule_id: alicloud.dms.classification.auto_discovery_enabled
  title: Data Management Service (DMS) Classification Auto Discovery Should Be Enabled
  severity: medium
  assertion_id: ''
  for_each: alicloud.dms.classification
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.dms.classification.classifier_rbac_least_privilege
  title: Data Management Service Classification Classifier RBAC Least Privilege Access
    Control
  severity: high
  assertion_id: ''
  for_each: alicloud.dms.classification
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.dms.classification.classifier_source_trusted
  title: Data Management Service Classification Classifier Source Must Be From Trusted
    Sources
  severity: medium
  assertion_id: ''
  for_each: alicloud.dms.classification
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.dms.classification.sensitive_data_alerts_configured
  title: Ensure Data Management Service (DMS) has sensitive data classification alerts
    properly configured
  severity: medium
  assertion_id: ''
  for_each: alicloud.dms.classification
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.dms.classification_data.classification_policy_blocks_public_for_sensitive
  title: Data Management Service Classification Policy Should Block Public Access
    for Sensitive Data
  severity: high
  assertion_id: ''
  for_each: alicloud.dms.classification_data
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.dms.compliance_pack_data.compliance_access_rbac_least_privilege
  title: Data Management Service (DMS) Compliance Pack Should Enforce RBAC Least Privilege
    Access Controls
  severity: high
  assertion_id: ''
  for_each: alicloud.dms.compliance_pack_data
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.dms.compliance_pack_data.compliance_export_destinations_private
  title: Data Management Service Compliance Export Destinations Must Use Private Networks
  severity: medium
  assertion_id: ''
  for_each: alicloud.dms.compliance_pack_data
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.dms.compliance_pack_data.compliance_reports_storage_encrypted
  title: Data Management Service (DMS) Compliance Pack Data Reports Must Use Encrypted
    Storage
  severity: medium
  assertion_id: ''
  for_each: alicloud.dms.compliance_pack_data
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.dms.data_masking.masking_execution_roles_least_privilege
  title: Data Management Service (DMS) Data Masking Execution Roles Should Follow
    Least Privilege Principle
  severity: high
  assertion_id: ''
  for_each: alicloud.dms.data_masking
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.dms.data_masking.masking_policies_present_for_sensitive_fields
  title: Ensure Data Management Service (DMS) Has Masking Policies Configured for
    Sensitive Data Fields
  severity: medium
  assertion_id: ''
  for_each: alicloud.dms.data_masking
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.dms.desensitization.anonymization_jobs_private_networking
  title: Ensure Data Management Service Anonymization Jobs Use Private Networking
  severity: medium
  assertion_id: ''
  for_each: alicloud.dms.desensitization
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.dms.desensitization.anonymization_outputs_encrypted
  title: Data Management Service Desensitization Anonymization Outputs Must Be Encrypted
  severity: low
  assertion_id: ''
  for_each: alicloud.dms.desensitization
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.dms.endpoint.redis_in_transit_encryption_enforced
  title: Database Management Service Redis Endpoint In-Transit Encryption Must Be
    Enforced
  severity: high
  assertion_id: iso27001_2022_multi_cloud_A.8.11_0066
  for_each: alicloud.dms.endpoint
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.dms.instance.multi_az_deployment
  title: Data Management Service instances should be deployed across multiple availability
    zones
  severity: low
  assertion_id: iso27001_2022_multi_cloud_A.8.14_0069
  for_each: alicloud.dms.instance
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.dms.replication_instance.source_logging_enabled_90_day_retention
  title: Data Management Service replication instance should have source logging enabled
    with 90-day retention
  severity: medium
  assertion_id: ''
  for_each: alicloud.dms.replication_instance
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.dms.replication_instance.target_logging_enabled_90_day_retention
  title: Data Management Service Replication Instance Target Logging Must Be Enabled
    with 90-Day Retention
  severity: medium
  assertion_id: ''
  for_each: alicloud.dms.replication_instance
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
