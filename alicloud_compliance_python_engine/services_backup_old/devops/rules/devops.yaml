version: '1.0'
provider: alicloud
service: devops
discovery:
- discovery_id: alicloud.devops.project
  calls:
  - product: DEVOPS
    version: '2014-05-26'
    action: DescribeProjects
    params: {}
    save_as: project_list
  emit:
    items_for: '{ project_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: project
- discovery_id: alicloud.devops.report
  calls:
  - product: DEVOPS
    version: '2014-05-26'
    action: DescribeReports
    params: {}
    save_as: report_list
  emit:
    items_for: '{ report_list }'
    as: r
    item:
      id: '{{ r.id }}'
      name: '{{ r.name }}'
      resource_type: report
checks:
- rule_id: alicloud.devops.project.artifact_encryption
  title: Ensure AliCloud DevOps Project Artifacts Are Encrypted
  severity: high
  assertion_id: ''
  for_each: alicloud.devops.project
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.devops.project.envvar_awscred_check
  title: AliCloud DevOps Project Environment Variables Should Not Contain AWS Credentials
  severity: low
  assertion_id: ''
  for_each: alicloud.devops.project
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.devops.project.logging_enabled
  title: AliCloud DevOps Project Should Have Logging Enabled
  severity: medium
  assertion_id: ''
  for_each: alicloud.devops.project
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.devops.project.no_secrets_in_variables
  title: AliCloud DevOps Project Variables Should Not Contain Hardcoded Secrets
  severity: high
  assertion_id: pci_dss_v4_multi_cloud_6.3.2_0080
  for_each: alicloud.devops.project
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.devops.project.no_secrets_in_variables_alicloud_devops_project_source_repo_url_no_sensitive_credentials_alicloud_oss_bucket_enforces_ssl_alicloud_alb_ssl_listeners_alicloud_elasticsearch_service_domains_node_to_node_encryption_enabled_alicloud_slb_ssl_listeners_alicloud_ecs_ebs_default_encryption_alicloud_rds_instance_storage_encrypted_alicloud_pai_notebook_instance_encryption_enabled_alicloud_oss_bucket_default_encryption_alicloud_nas_encryption_at_rest_enabled_alicloud_elasticsearch_service_domains_encryption_at_rest_enabled_alicloud_ecs_ebs_volume_encryption_alicloud_oss_bucket_kms_encryption_alicloud_ack_cluster_kms_cmk_encryption_in_secrets_enabled_alicloud_rds_snapshots_encrypted_alicloud_tablestore_accelerator_cluster_encryption_enabled_alicloud_tablestore_table_encryption_enabled_alicloud_actiontrail_kms_encryption_enabled_alicloud_cms_log_group_kms_encryption_enabled_alicloud_mns_topics_kms_encryption_at_rest_enabled_alicloud_tablestore_tables_kms_cmk_encryption_enabled_alicloud_analyticdb_cluster_audit_logging
  title: AliCloud DevOps Project Variables Must Not Contain Secrets and Multiple Services
    Must Enforce Encryption
  severity: high
  assertion_id: pci_dss_v4_multi_cloud_8.2.1_0101
  for_each: alicloud.devops.project
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.devops.project.older_90_days
  title: AliCloud DevOps Projects Should Not Remain Active Beyond 90 Days Without
    Review
  severity: low
  assertion_id: ''
  for_each: alicloud.devops.project
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.devops.project.oss_logs_encrypted
  title: Ensure AliCloud DevOps Project Object Storage Service Logs Are Encrypted
  severity: low
  assertion_id: ''
  for_each: alicloud.devops.project
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.devops.project.source_repo_url_check
  title: AliCloud DevOps Projects Must Use Secure and Validated Source Repository
    URLs
  severity: low
  assertion_id: ''
  for_each: alicloud.devops.project
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.devops.project.source_repo_url_no_sensitive_credentials
  title: AliCloud DevOps Project Source Repository URLs Must Not Contain Sensitive
    Credentials
  severity: high
  assertion_id: pci_dss_v4_multi_cloud_6.3.2_0080
  for_each: alicloud.devops.project
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.devops.project.source_repo_url_no_sensitive_credentials_alicloud_devops_project_no_secrets_in_variables
  title: AliCloud DevOps Project Source Repository URLs and Variables Must Not Contain
    Sensitive Credentials
  severity: high
  assertion_id: pci_dss_v4_multi_cloud_6.3.2_0080
  for_each: alicloud.devops.project
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.devops.project.user_controlled_buildspec
  title: AliCloud DevOps Project Should Not Allow User-Controlled Buildspec Files
  severity: medium
  assertion_id: ''
  for_each: alicloud.devops.project
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
- rule_id: alicloud.devops.report.group_export_encrypted
  title: Ensure AliCloud DevOps Report Group Exports Are Encrypted
  severity: low
  assertion_id: ''
  for_each: alicloud.devops.report
  params: {}
  conditions:
    all:
    - var: item.id
      op: exists
      value: null
