version: '1.0'
provider: alicloud
service: cloudfw
discovery:
- discovery_id: alicloud.cloudfw.deployed_across_all_vpcs
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeDeployedAcrossAllVpcss
    params: {}
    save_as: deployed_across_all_vpcs_response
  emit:
    items_for: '{ deployed_across_all_vpcs_response.DeployedAcrossAllVpcss.DeployedAcrossAllVpcs }'
    as: r
    item:
      id: '{{ r.DeployedAcrossAllVpcsId }}'
      name: '{{ r.DeployedAcrossAllVpcsId }}'
      resource_type: deployed_across_all_vpcs
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.cloudfw.in
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeIns
    params: {}
    save_as: in_response
  emit:
    items_for: '{ in_response.Ins.In }'
    as: r
    item:
      id: '{{ r.InId }}'
      name: '{{ r.InId }}'
      resource_type: in
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.cloudfw.instance
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeInstances
    params: {}
    save_as: instance_response
  emit:
    items_for: '{ instance_response.Instances.Instance }'
    as: r
    item:
      id: '{{ r.InstanceId }}'
      name: '{{ r.InstanceId }}'
      resource_type: instance
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.cloudfw.log
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeLogs
    params: {}
    save_as: log_response
  emit:
    items_for: '{ log_response.Logs.Log }'
    as: r
    item:
      id: '{{ r.LogId }}'
      name: '{{ r.LogId }}'
      resource_type: log
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.cloudfw.logging
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeLoggings
    params: {}
    save_as: logging_response
  emit:
    items_for: '{ logging_response.Loggings.Logging }'
    as: r
    item:
      id: '{{ r.LoggingId }}'
      name: '{{ r.LoggingId }}'
      resource_type: logging
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.cloudfw.logging_enabled
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeLoggingEnableds
    params: {}
    save_as: logging_enabled_response
  emit:
    items_for: '{ logging_enabled_response.LoggingEnableds.LoggingEnabled }'
    as: r
    item:
      id: '{{ r.LoggingEnabledId }}'
      name: '{{ r.LoggingEnabledId }}'
      resource_type: logging_enabled
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.cloudfw.logging_enabled_for_all_traffic
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeLoggingEnabledForAllTraffics
    params: {}
    save_as: logging_enabled_for_all_traffic_response
  emit:
    items_for: '{ logging_enabled_for_all_traffic_response.LoggingEnabledForAllTraffics.LoggingEnabledForAllTraffic }'
    as: r
    item:
      id: '{{ r.LoggingEnabledForAllTrafficId }}'
      name: '{{ r.LoggingEnabledForAllTrafficId }}'
      resource_type: logging_enabled_for_all_traffic
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.cloudfw.multi
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeMultis
    params: {}
    save_as: multi_response
  emit:
    items_for: '{ multi_response.Multis.Multi }'
    as: r
    item:
      id: '{{ r.MultiId }}'
      name: '{{ r.MultiId }}'
      resource_type: multi
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.cloudfw.multi_az_with_auto_scaling
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeMultiAzWithAutoScalings
    params: {}
    save_as: multi_az_with_auto_scaling_response
  emit:
    items_for: '{ multi_az_with_auto_scaling_response.MultiAzWithAutoScalings.MultiAzWithAutoScaling }'
    as: r
    item:
      id: '{{ r.MultiAzWithAutoScalingId }}'
      name: '{{ r.MultiAzWithAutoScalingId }}'
      resource_type: multi_az_with_auto_scaling
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
checks:
- rule_id: alicloud.cloudfw.deployed_across_all_vpcs.configured
  title: Ensure AliCloud Cloud Firewall is deployed across all VPCs for comprehensive network protection
  severity: medium
  assertion_id: ''
  for_each: alicloud.cloudfw.deployed_across_all_vpcs
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.cloudfw.in.all_vpc
  title: Ensure Cloud Firewall Protection is Enabled for All VPC Networks
  severity: medium
  assertion_id: ''
  for_each: alicloud.cloudfw.in
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.cloudfw.instance.automated_backups
  title: AliCloud Cloud Firewall instances should have automated backups enabled
  severity: medium
  assertion_id: ''
  for_each: alicloud.cloudfw.instance
  params: {}
  conditions:
    var: item.backup_enabled
    op: equals
    value: true
- rule_id: alicloud.cloudfw.instance.postgres_log_connections_flag
  title: AliCloud Cloud Firewall Instance Should Have PostgreSQL Log Connections Flag Enabled
  severity: low
  assertion_id: ''
  for_each: alicloud.cloudfw.instance
  params: {}
  conditions:
    var: item.logging_enabled
    op: equals
    value: true
- rule_id: alicloud.cloudfw.instance.postgres_log_disconnections_flag
  title: AliCloud Cloud Firewall Instance Should Have PostgreSQL Log Disconnections Flag Enabled
  severity: low
  assertion_id: ''
  for_each: alicloud.cloudfw.instance
  params: {}
  conditions:
    var: item.logging_enabled
    op: equals
    value: true
- rule_id: alicloud.cloudfw.instance.postgres_log_error_verbosity_flag
  title: AliCloud Cloud Firewall Instance PostgreSQL Log Error Verbosity Flag Configuration
  severity: low
  assertion_id: ''
  for_each: alicloud.cloudfw.instance
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.cloudfw.instance.postgres_log_min_duration_statement_flag
  title: AliCloud Cloud Firewall PostgreSQL Database Should Have Log Min Duration Statement Flag Configured
  severity: low
  assertion_id: ''
  for_each: alicloud.cloudfw.instance
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.cloudfw.instance.postgres_log_min_error_statement_flag
  title: AliCloud Cloud Firewall Instance PostgreSQL Log Min Error Statement Flag Configuration
  severity: low
  assertion_id: ''
  for_each: alicloud.cloudfw.instance
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.cloudfw.instance.postgres_log_min_messages_flag
  title: AliCloud Cloud Firewall Instance PostgreSQL Log Min Messages Flag Configuration
  severity: low
  assertion_id: ''
  for_each: alicloud.cloudfw.instance
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.cloudfw.instance.postgres_log_statement_flag
  title: AliCloud Cloud Firewall Instance PostgreSQL Log Statement Flag Configuration
  severity: low
  assertion_id: ''
  for_each: alicloud.cloudfw.instance
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.cloudfw.instance.public_access
  title: AliCloud Cloud Firewall Instance Should Not Allow Unrestricted Public Access
  severity: high
  assertion_id: ''
  for_each: alicloud.cloudfw.instance
  params: {}
  conditions:
    var: item.permissions
    op: not_contains
    value: '*'
- rule_id: alicloud.cloudfw.instance.public_ip
  title: Cloud Firewall instance should have public IP address configured
  severity: high
  assertion_id: ''
  for_each: alicloud.cloudfw.instance
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.cloudfw.instance.ssl_connections
  title: Ensure AliCloud Cloud Firewall instances have SSL connections enabled
  severity: medium
  assertion_id: ''
  for_each: alicloud.cloudfw.instance
  params: {}
  conditions:
    var: item.encrypted
    op: equals
    value: true
- rule_id: alicloud.cloudfw.log.analysis_status_check
  title: AliCloud Cloud Firewall Log Analysis Status Should Be Enabled
  severity: low
  assertion_id: ''
  for_each: alicloud.cloudfw.log
  params: {}
  conditions:
    var: item.logging_enabled
    op: equals
    value: true
- rule_id: alicloud.cloudfw.logging.enabled
  title: Ensure AliCloud Cloud Firewall logging is enabled
  severity: low
  assertion_id: ''
  for_each: alicloud.cloudfw.logging
  params: {}
  conditions:
    var: item.logging_enabled
    op: equals
    value: true
- rule_id: alicloud.cloudfw.logging_enabled.configured
  title: Ensure AliCloud Cloud Firewall logging is properly configured
  severity: low
  assertion_id: ''
  for_each: alicloud.cloudfw.logging_enabled
  params: {}
  conditions:
    var: item.logging_enabled
    op: equals
    value: true
- rule_id: alicloud.cloudfw.logging_enabled_for_all_traffic.configured
  title: Ensure AliCloud Cloud Firewall logging is enabled for all traffic
  severity: low
  assertion_id: ''
  for_each: alicloud.cloudfw.logging_enabled_for_all_traffic
  params: {}
  conditions:
    var: item.logging_enabled
    op: equals
    value: true
- rule_id: alicloud.cloudfw.multi.az
  title: Cloud Firewall should be deployed across multiple availability zones
  severity: low
  assertion_id: ''
  for_each: alicloud.cloudfw.multi
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.cloudfw.multi_az_with_auto_scaling.configured
  title: AliCloud Cloud Firewall Multi-AZ Deployment with Auto Scaling Should Be Configured
  severity: low
  assertion_id: ''
  for_each: alicloud.cloudfw.multi_az_with_auto_scaling
  params: {}
  conditions:
    var: item.id
    op: exists
