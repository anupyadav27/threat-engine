version: '1.0'
provider: alicloud
service: expressconnect
discovery:
- discovery_id: alicloud.expressconnect.connect
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeConnects
    params: {}
    save_as: connect_response
  emit:
    items_for: '{ connect_response.Connects.Connect }'
    as: r
    item:
      id: '{{ r.ConnectId }}'
      name: '{{ r.ConnectId }}'
      resource_type: connect
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.expressconnect.connection
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeConnections
    params: {}
    save_as: connection_response
  emit:
    items_for: '{ connection_response.Connections.Connection }'
    as: r
    item:
      id: '{{ r.ConnectionId }}'
      name: '{{ r.ConnectionId }}'
      resource_type: connection
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.expressconnect.virtual
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeVirtuals
    params: {}
    save_as: virtual_response
  emit:
    items_for: '{ virtual_response.Virtuals.Virtual }'
    as: r
    item:
      id: '{{ r.VirtualId }}'
      name: '{{ r.VirtualId }}'
      resource_type: virtual
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
checks:
- rule_id: alicloud.expressconnect.connect.vpn_ike_phase_encryption_strong
  title: Express Connect VPN IKE Phase 1 Should Use Strong Encryption Algorithms
  severity: high
  assertion_id: ''
  for_each: alicloud.expressconnect.connect
  params: {}
  conditions:
    var: item.encrypted
    op: equals
    value: true
- rule_id: alicloud.expressconnect.connect.vpn_pre_shared_keys_rotation_policy_defined
  title: Express Connect VPN Pre-Shared Keys Rotation Policy Should Be Defined
  severity: high
  assertion_id: ''
  for_each: alicloud.expressconnect.connect
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.expressconnect.connection.redundancy
  title: Express Connect physical connections should have redundancy configured
  severity: low
  assertion_id: ''
  for_each: alicloud.expressconnect.connection
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.expressconnect.virtual.interface_redundancy
  title: Ensure Express Connect Virtual Border Router Interfaces Have Redundancy Configuration
  severity: low
  assertion_id: ''
  for_each: alicloud.expressconnect.virtual
  params: {}
  conditions:
    var: item.id
    op: exists
