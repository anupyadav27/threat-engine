version: '1.0'
provider: alicloud
service: fc
discovery:
- discovery_id: alicloud.fc.compute
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeComputes
    params: {}
    save_as: compute_response
  emit:
    items_for: '{ compute_response.Computes.Compute }'
    as: r
    item:
      id: '{{ r.ComputeId }}'
      name: '{{ r.ComputeId }}'
      resource_type: compute
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.fc.function
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeFunctions
    params: {}
    save_as: function_response
  emit:
    items_for: '{ function_response.Functions.Function }'
    as: r
    item:
      id: '{{ r.FunctionId }}'
      name: '{{ r.FunctionId }}'
      resource_type: function
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.fc.function_public_access_blocked
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeFunctionPublicAccessBlockeds
    params: {}
    save_as: function_public_access_blocked_response
  emit:
    items_for: '{ function_public_access_blocked_response.FunctionPublicAccessBlockeds.FunctionPublicAccessBlocked }'
    as: r
    item:
      id: '{{ r.FunctionPublicAccessBlockedId }}'
      name: '{{ r.FunctionPublicAccessBlockedId }}'
      resource_type: function_public_access_blocked
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.fc.function_url_public_access_blocked
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeFunctionUrlPublicAccessBlockeds
    params: {}
    save_as: function_url_public_access_blocked_response
  emit:
    items_for: '{ function_url_public_access_blocked_response.FunctionUrlPublicAccessBlockeds.FunctionUrlPublicAccessBlocked
      }'
    as: r
    item:
      id: '{{ r.FunctionUrlPublicAccessBlockedId }}'
      name: '{{ r.FunctionUrlPublicAccessBlockedId }}'
      resource_type: function_url_public_access_blocked
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.fc.http
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeHttps
    params: {}
    save_as: http_response
  emit:
    items_for: '{ http_response.Https.Http }'
    as: r
    item:
      id: '{{ r.HttpId }}'
      name: '{{ r.HttpId }}'
      resource_type: http
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.fc.minimum_tls_version_1_2_enforced
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeMinimumTlsVersion12Enforceds
    params: {}
    save_as: minimum_tls_version_1_2_enforced_response
  emit:
    items_for: '{ minimum_tls_version_1_2_enforced_response.MinimumTlsVersion12Enforceds.MinimumTlsVersion12Enforced }'
    as: r
    item:
      id: '{{ r.MinimumTlsVersion12EnforcedId }}'
      name: '{{ r.MinimumTlsVersion12EnforcedId }}'
      resource_type: minimum_tls_version_1_2_enforced
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.fc.provisioned_concurrency
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeProvisionedConcurrencys
    params: {}
    save_as: provisioned_concurrency_response
  emit:
    items_for: '{ provisioned_concurrency_response.ProvisionedConcurrencys.ProvisionedConcurrency }'
    as: r
    item:
      id: '{{ r.ProvisionedConcurrencyId }}'
      name: '{{ r.ProvisionedConcurrencyId }}'
      resource_type: provisioned_concurrency
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.fc.trigger
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeTriggers
    params: {}
    save_as: trigger_response
  emit:
    items_for: '{ trigger_response.Triggers.Trigger }'
    as: r
    item:
      id: '{{ r.TriggerId }}'
      name: '{{ r.TriggerId }}'
      resource_type: trigger
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
checks:
- rule_id: alicloud.fc.compute.function_not_publicly_accessible
  title: Ensure Function Compute functions are not publicly accessible
  severity: high
  assertion_id: ''
  for_each: alicloud.fc.compute
  params: {}
  conditions:
    all:
    - var: item.public_ip_address
      op: not_exists
    - var: item.internet_facing
      op: not_equals
      value: true
- rule_id: alicloud.fc.compute.function_restrict_public_access
  title: Ensure Function Compute functions restrict public access
  severity: high
  assertion_id: ''
  for_each: alicloud.fc.compute
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.fc.compute.function_url_authentication
  title: Ensure Function Compute Function URL Authentication is Enabled
  severity: high
  assertion_id: ''
  for_each: alicloud.fc.compute
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.fc.compute.function_url_public
  title: AliCloud Function Compute Function URL Should Not Be Publicly Accessible
  severity: high
  assertion_id: ''
  for_each: alicloud.fc.compute
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.fc.function.dependency_scan_passed
  title: Function Compute functions should pass dependency vulnerability scans
  severity: low
  assertion_id: ''
  for_each: alicloud.fc.function
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.fc.function.inside_vpc
  title: Function Compute functions should be deployed inside VPC for network isolation
  severity: medium
  assertion_id: ''
  for_each: alicloud.fc.function
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.fc.function.invoke_api_operations_actiontrail_logging_enabled_with_90_day_retention
  title: Function Compute Function Invoke API Operations Should Have ActionTrail Logging Enabled With 90 Day Retention
  severity: medium
  assertion_id: ''
  for_each: alicloud.fc.function
  params: {}
  conditions:
    var: item.logging_enabled
    op: equals
    value: true
- rule_id: alicloud.fc.function.least_privilege_identity_enforced
  title: Function Compute Functions Should Enforce Least Privilege Identity Access
  severity: high
  assertion_id: ''
  for_each: alicloud.fc.function
  params: {}
  conditions:
    var: item.permissions
    op: not_contains
    value: '*'
- rule_id: alicloud.fc.function.public_access_blocked
  title: Function Compute Functions Should Block Public Access
  severity: high
  assertion_id: ''
  for_each: alicloud.fc.function
  params: {}
  conditions:
    all:
    - var: item.public_ip_address
      op: not_exists
    - var: item.internet_facing
      op: not_equals
      value: true
- rule_id: alicloud.fc.function.reserved_concurrency_set
  title: Function Compute Functions Should Have Reserved Concurrency Configured
  severity: low
  assertion_id: ''
  for_each: alicloud.fc.function
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.fc.function.url_cors_policy_enforced
  title: Function Compute Function URL CORS Policy Must Be Enforced
  severity: medium
  assertion_id: ''
  for_each: alicloud.fc.function
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.fc.function.url_public
  title: Function Compute function should not have publicly accessible URL endpoints
  severity: high
  assertion_id: hipaa_multi_cloud_164_308_a_1_ii_b_0002
  for_each: alicloud.fc.function
  params: {}
  conditions:
    var: item.permissions
    op: not_contains
    value: '*'
- rule_id: alicloud.fc.function.url_public_access_blocked
  title: Function Compute Function URL Public Access Should Be Blocked
  severity: high
  assertion_id: hipaa_multi_cloud_164_308_a_1_ii_b_0002
  for_each: alicloud.fc.function
  params: {}
  conditions:
    all:
    - var: item.public_ip_address
      op: not_exists
    - var: item.internet_facing
      op: not_equals
      value: true
- rule_id: alicloud.fc.function.vpc_isolation_enabled
  title: Alibaba Cloud Function Compute functions should have VPC isolation enabled
  severity: medium
  assertion_id: ''
  for_each: alicloud.fc.function
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.fc.function.vpc_multi_az_deployment
  title: Function Compute functions should be deployed across multiple availability zones in VPC
  severity: medium
  assertion_id: ''
  for_each: alicloud.fc.function
  params: {}
  conditions:
    var: item.vpc_id
    op: exists
- rule_id: alicloud.fc.function_public_access_blocked.configured
  title: Ensure Function Compute functions have public access blocked
  severity: medium
  assertion_id: ''
  for_each: alicloud.fc.function_public_access_blocked
  params: {}
  conditions:
    all:
    - var: item.public_ip_address
      op: not_exists
    - var: item.internet_facing
      op: not_equals
      value: true
- rule_id: alicloud.fc.function_url_public_access_blocked.configured
  title: Function Compute function URL public access should be blocked
  severity: medium
  assertion_id: ''
  for_each: alicloud.fc.function_url_public_access_blocked
  params: {}
  conditions:
    all:
    - var: item.public_ip_address
      op: not_exists
    - var: item.internet_facing
      op: not_equals
      value: true
- rule_id: alicloud.fc.http.logs_enabled_with_no_secrets_in_logs
  title: Function Compute HTTP triggers must have logging enabled without secrets exposed in log entries
  severity: high
  assertion_id: ''
  for_each: alicloud.fc.http
  params: {}
  conditions:
    var: item.logging_enabled
    op: equals
    value: true
- rule_id: alicloud.fc.minimum_tls_version_1_2_enforced.configured
  title: Function Compute minimum TLS version 1.2 should be enforced
  severity: medium
  assertion_id: ''
  for_each: alicloud.fc.minimum_tls_version_1_2_enforced
  params: {}
  conditions:
    all:
    - var: item.ssl_enabled
      op: equals
      value: true
    - var: item.min_tls_version
      op: gte
      value: '1.2'
- rule_id: alicloud.fc.provisioned_concurrency.prov_conc_execution_role_least_privilege
  title: Function Compute Provisioned Concurrency Execution Role Should Follow Least Privilege Principle
  severity: high
  assertion_id: ''
  for_each: alicloud.fc.provisioned_concurrency
  params: {}
  conditions:
    var: item.permissions
    op: not_contains
    value: '*'
- rule_id: alicloud.fc.trigger.event_source_permissions_least_privilege
  title: Function Compute Trigger Event Source Permissions Should Follow Least Privilege Principle
  severity: high
  assertion_id: ''
  for_each: alicloud.fc.trigger
  params: {}
  conditions:
    var: item.permissions
    op: not_contains
    value: '*'
- rule_id: alicloud.fc.trigger.event_source_source_authenticated
  title: Function Compute trigger event source should be authenticated
  severity: low
  assertion_id: ''
  for_each: alicloud.fc.trigger
  params: {}
  conditions:
    var: item.id
    op: exists
