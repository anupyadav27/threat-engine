version: '1.0'
provider: alicloud
service: dts
discovery:
- discovery_id: alicloud.dts.accelerator_cluster_encryption_at_rest_enabled
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeAcceleratorClusterEncryptionAtRestEnableds
    params: {}
    save_as: accelerator_cluster_encryption_at_rest_enabled_response
  emit:
    items_for: '{ accelerator_cluster_encryption_at_rest_enabled_response.AcceleratorClusterEncryptionAtRestEnableds.AcceleratorClusterEncryptionAtRestEnabled
      }'
    as: r
    item:
      id: '{{ r.AcceleratorClusterEncryptionAtRestEnabledId }}'
      name: '{{ r.AcceleratorClusterEncryptionAtRestEnabledId }}'
      resource_type: accelerator_cluster_encryption_at_rest_enabled
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.dts.autoscaling_properly_configured
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeAutoscalingProperlyConfigureds
    params: {}
    save_as: autoscaling_properly_configured_response
  emit:
    items_for: '{ autoscaling_properly_configured_response.AutoscalingProperlyConfigureds.AutoscalingProperlyConfigured }'
    as: r
    item:
      id: '{{ r.AutoscalingProperlyConfiguredId }}'
      name: '{{ r.AutoscalingProperlyConfiguredId }}'
      resource_type: autoscaling_properly_configured
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.dts.backup
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeBackups
    params: {}
    save_as: backup_response
  emit:
    items_for: '{ backup_response.Backups.Backup }'
    as: r
    item:
      id: '{{ r.BackupId }}'
      name: '{{ r.BackupId }}'
      resource_type: backup
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.dts.dr
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeDrs
    params: {}
    save_as: dr_response
  emit:
    items_for: '{ dr_response.Drs.Dr }'
    as: r
    item:
      id: '{{ r.DrId }}'
      name: '{{ r.DrId }}'
      resource_type: dr
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.dts.instance
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeInstances
    params: {}
    save_as: instance_response
  emit:
    items_for: '{ instance_response.Instances.Instance }'
    as: r
    item:
      id: '{{ r.InstanceId }}'
      name: '{{ r.InstanceId }}'
      resource_type: instance
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.dts.pitr_properly_configured
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribePitrProperlyConfigureds
    params: {}
    save_as: pitr_properly_configured_response
  emit:
    items_for: '{ pitr_properly_configured_response.PitrProperlyConfigureds.PitrProperlyConfigured }'
    as: r
    item:
      id: '{{ r.PitrProperlyConfiguredId }}'
      name: '{{ r.PitrProperlyConfiguredId }}'
      resource_type: pitr_properly_configured
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.dts.server
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeServers
    params: {}
    save_as: server_response
  emit:
    items_for: '{ server_response.Servers.Server }'
    as: r
    item:
      id: '{{ r.ServerId }}'
      name: '{{ r.ServerId }}'
      resource_type: server
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.dts.table
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeTables
    params: {}
    save_as: table_response
  emit:
    items_for: '{ table_response.Tables.Table }'
    as: r
    item:
      id: '{{ r.TableId }}'
      name: '{{ r.TableId }}'
      resource_type: table
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.dts.tables_kms_cmk_encryption_at_rest_enabled
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeTablesKmsCmkEncryptionAtRestEnableds
    params: {}
    save_as: tables_kms_cmk_encryption_at_rest_enabled_response
  emit:
    items_for: '{ tables_kms_cmk_encryption_at_rest_enabled_response.TablesKmsCmkEncryptionAtRestEnableds.TablesKmsCmkEncryptionAtRestEnabled
      }'
    as: r
    item:
      id: '{{ r.TablesKmsCmkEncryptionAtRestEnabledId }}'
      name: '{{ r.TablesKmsCmkEncryptionAtRestEnabledId }}'
      resource_type: tables_kms_cmk_encryption_at_rest_enabled
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.dts.tables_point_in_time_recovery_enabled
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeTablesPointInTimeRecoveryEnableds
    params: {}
    save_as: tables_point_in_time_recovery_enabled_response
  emit:
    items_for: '{ tables_point_in_time_recovery_enabled_response.TablesPointInTimeRecoveryEnableds.TablesPointInTimeRecoveryEnabled
      }'
    as: r
    item:
      id: '{{ r.TablesPointInTimeRecoveryEnabledId }}'
      name: '{{ r.TablesPointInTimeRecoveryEnabledId }}'
      resource_type: tables_point_in_time_recovery_enabled
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.dts.task
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeTasks
    params: {}
    save_as: task_response
  emit:
    items_for: '{ task_response.Tasks.Task }'
    as: r
    item:
      id: '{{ r.TaskId }}'
      name: '{{ r.TaskId }}'
      resource_type: task
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
checks:
- rule_id: alicloud.dts.accelerator_cluster_encryption_at_rest_enabled.configured
  title: Ensure Data Transmission Service (DTS) accelerator clusters have encryption at rest enabled
  severity: medium
  assertion_id: ''
  for_each: alicloud.dts.accelerator_cluster_encryption_at_rest_enabled
  params: {}
  conditions:
    var: item.encrypted
    op: equals
    value: true
- rule_id: alicloud.dts.autoscaling_properly_configured.configured
  title: Data Transmission Service Auto Scaling Should Be Properly Configured
  severity: low
  assertion_id: ''
  for_each: alicloud.dts.autoscaling_properly_configured
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.dts.backup.continuous_enabled
  title: Data Transmission Service (DTS) backup continuous replication should be enabled
  severity: low
  assertion_id: ''
  for_each: alicloud.dts.backup
  params: {}
  conditions:
    var: item.backup_enabled
    op: equals
    value: true
- rule_id: alicloud.dts.dr.replication_auth_roles_least_privilege
  title: Data Transmission Service Disaster Recovery Replication Authentication Roles Should Follow Least Privilege Principle
  severity: high
  assertion_id: ''
  for_each: alicloud.dts.dr
  params: {}
  conditions:
    var: item.permissions
    op: not_contains
    value: '*'
- rule_id: alicloud.dts.dr.replication_cross_region_replication_encrypted
  title: Data Transmission Service Cross-Region Disaster Recovery Replication Must Be Encrypted
  severity: low
  assertion_id: ''
  for_each: alicloud.dts.dr
  params: {}
  conditions:
    var: item.encrypted
    op: equals
    value: true
- rule_id: alicloud.dts.dr.replication_encryption_in_transit_tls_required
  title: Data Transmission Service Disaster Recovery Replication Must Use TLS Encryption in Transit
  severity: high
  assertion_id: ''
  for_each: alicloud.dts.dr
  params: {}
  conditions:
    all:
    - var: item.encrypted
      op: equals
      value: true
    - var: item.ssl_enabled
      op: equals
      value: true
- rule_id: alicloud.dts.instance.private_access_only
  title: Ensure Data Transmission Service instances are configured for private access only
  severity: medium
  assertion_id: canada_pbmm_moderate_multi_cloud_CCCS_AC-17_0013
  for_each: alicloud.dts.instance
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.dts.pitr_properly_configured.configured
  title: Data Transmission Service Point-in-Time Recovery should be properly configured
  severity: low
  assertion_id: ''
  for_each: alicloud.dts.pitr_properly_configured
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.dts.server.in_transit_encryption_enabled
  title: Data Transmission Service (DTS) Server In-Transit Encryption Should Be Enabled
  severity: high
  assertion_id: ''
  for_each: alicloud.dts.server
  params: {}
  conditions:
    var: item.encrypted
    op: equals
    value: true
- rule_id: alicloud.dts.table.backup_plan_enforced
  title: Data Transmission Service (DTS) Migration Tables Must Have Backup Plan Enforced
  severity: medium
  assertion_id: ''
  for_each: alicloud.dts.table
  params: {}
  conditions:
    var: item.backup_enabled
    op: equals
    value: true
- rule_id: alicloud.dts.tables_kms_cmk_encryption_at_rest_enabled.configured
  title: Ensure Data Transmission Service tables have KMS Customer Master Key encryption at rest enabled
  severity: medium
  assertion_id: ''
  for_each: alicloud.dts.tables_kms_cmk_encryption_at_rest_enabled
  params: {}
  conditions:
    all:
    - var: item.encrypted
      op: equals
      value: true
    - var: item.kms_key_id
      op: exists
- rule_id: alicloud.dts.tables_point_in_time_recovery_enabled.configured
  title: Ensure Data Transmission Service (DTS) tables have point-in-time recovery enabled
  severity: low
  assertion_id: ''
  for_each: alicloud.dts.tables_point_in_time_recovery_enabled
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.dts.task.logging_enabled
  title: Data Transmission Service (DTS) Task Logging Should Be Enabled
  severity: medium
  assertion_id: ''
  for_each: alicloud.dts.task
  params: {}
  conditions:
    var: item.logging_enabled
    op: equals
    value: true
