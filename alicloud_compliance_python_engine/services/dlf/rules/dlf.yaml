version: '1.0'
provider: alicloud
service: dlf
discovery:
- discovery_id: alicloud.dlf.classifiers
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeClassifierss
    params: {}
    save_as: classifiers_response
  emit:
    items_for: '{ classifiers_response.Classifierss.Classifiers }'
    as: r
    item:
      id: '{{ r.ClassifiersId }}'
      name: '{{ r.ClassifiersId }}'
      resource_type: classifiers
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.dlf.connections
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeConnectionss
    params: {}
    save_as: connections_response
  emit:
    items_for: '{ connections_response.Connectionss.Connections }'
    as: r
    item:
      id: '{{ r.ConnectionsId }}'
      name: '{{ r.ConnectionsId }}'
      resource_type: connections
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.dlf.crawlers
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeCrawlerss
    params: {}
    save_as: crawlers_response
  emit:
    items_for: '{ crawlers_response.Crawlerss.Crawlers }'
    as: r
    item:
      id: '{{ r.CrawlersId }}'
      name: '{{ r.CrawlersId }}'
      resource_type: crawlers
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.dlf.database
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeDatabases
    params: {}
    save_as: database_response
  emit:
    items_for: '{ database_response.Databases.Database }'
    as: r
    item:
      id: '{{ r.DatabaseId }}'
      name: '{{ r.DatabaseId }}'
      resource_type: database
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.dlf.dataworks_crawlers
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeDataworksCrawlerss
    params: {}
    save_as: dataworks_crawlers_response
  emit:
    items_for: '{ dataworks_crawlers_response.DataworksCrawlerss.DataworksCrawlers }'
    as: r
    item:
      id: '{{ r.DataworksCrawlersId }}'
      name: '{{ r.DataworksCrawlersId }}'
      resource_type: dataworks_crawlers
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.dlf.endpoint
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeEndpoints
    params: {}
    save_as: endpoint_response
  emit:
    items_for: '{ endpoint_response.Endpoints.Endpoint }'
    as: r
    item:
      id: '{{ r.EndpointId }}'
      name: '{{ r.EndpointId }}'
      resource_type: endpoint
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.dlf.job
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeJobs
    params: {}
    save_as: job_response
  emit:
    items_for: '{ job_response.Jobs.Job }'
    as: r
    item:
      id: '{{ r.JobId }}'
      name: '{{ r.JobId }}'
      resource_type: job
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.dlf.job_script
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeJobScripts
    params: {}
    save_as: job_script_response
  emit:
    items_for: '{ job_script_response.JobScripts.JobScript }'
    as: r
    item:
      id: '{{ r.JobScriptId }}'
      name: '{{ r.JobScriptId }}'
      resource_type: job_script
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.dlf.maxcompute_partition
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeMaxcomputePartitions
    params: {}
    save_as: maxcompute_partition_response
  emit:
    items_for: '{ maxcompute_partition_response.MaxcomputePartitions.MaxcomputePartition }'
    as: r
    item:
      id: '{{ r.MaxcomputePartitionId }}'
      name: '{{ r.MaxcomputePartitionId }}'
      resource_type: maxcompute_partition
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.dlf.registry
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeRegistrys
    params: {}
    save_as: registry_response
  emit:
    items_for: '{ registry_response.Registrys.Registry }'
    as: r
    item:
      id: '{{ r.RegistryId }}'
      name: '{{ r.RegistryId }}'
      resource_type: registry
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.dlf.schema
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeSchemas
    params: {}
    save_as: schema_response
  emit:
    items_for: '{ schema_response.Schemas.Schema }'
    as: r
    item:
      id: '{{ r.SchemaId }}'
      name: '{{ r.SchemaId }}'
      resource_type: schema
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.dlf.table
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeTables
    params: {}
    save_as: table_response
  emit:
    items_for: '{ table_response.Tables.Table }'
    as: r
    item:
      id: '{{ r.TableId }}'
      name: '{{ r.TableId }}'
      resource_type: table
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
checks:
- rule_id: alicloud.dlf.classifiers.classifier_rbac_least_privilege
  title: Data Lake Formation Classifier RBAC Least Privilege Access Control
  severity: high
  assertion_id: ''
  for_each: alicloud.dlf.classifiers
  params: {}
  conditions:
    var: item.permissions
    op: not_contains
    value: '*'
- rule_id: alicloud.dlf.classifiers.classifier_source_trusted
  title: Ensure Data Lake Formation Classifier Sources Are From Trusted Origins
  severity: low
  assertion_id: ''
  for_each: alicloud.dlf.classifiers
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.dlf.connections.connection_credentials_in_secrets_manager
  title: Data Lake Formation connections should store credentials in Secrets Manager
  severity: high
  assertion_id: ''
  for_each: alicloud.dlf.connections
  params: {}
  conditions:
    var: item.encrypted
    op: equals
    value: true
- rule_id: alicloud.dlf.connections.connection_private_networking_enforced
  title: Data Lake Formation Connection Private Networking Enforced
  severity: medium
  assertion_id: ''
  for_each: alicloud.dlf.connections
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.dlf.connections.connection_role_least_privilege
  title: Data Lake Formation Connection Roles Should Follow Least Privilege Principle
  severity: high
  assertion_id: ''
  for_each: alicloud.dlf.connections
  params: {}
  conditions:
    var: item.permissions
    op: not_contains
    value: '*'
- rule_id: alicloud.dlf.connections.connection_tls_required
  title: Data Lake Formation connections must require TLS encryption
  severity: medium
  assertion_id: ''
  for_each: alicloud.dlf.connections
  params: {}
  conditions:
    all:
    - var: item.encrypted
      op: equals
      value: true
    - var: item.ssl_enabled
      op: equals
      value: true
- rule_id: alicloud.dlf.crawlers.crawler_logs_enabled
  title: Data Lake Formation Crawler Logs Should Be Enabled
  severity: low
  assertion_id: ''
  for_each: alicloud.dlf.crawlers
  params: {}
  conditions:
    var: item.logging_enabled
    op: equals
    value: true
- rule_id: alicloud.dlf.crawlers.crawler_network_private_only
  title: Ensure Data Lake Formation Crawlers Use Private Network Access Only
  severity: medium
  assertion_id: ''
  for_each: alicloud.dlf.crawlers
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.dlf.crawlers.crawler_role_least_privilege
  title: Data Lake Formation Crawler Roles Should Follow Least Privilege Principle
  severity: high
  assertion_id: ''
  for_each: alicloud.dlf.crawlers
  params: {}
  conditions:
    var: item.permissions
    op: not_contains
    value: '*'
- rule_id: alicloud.dlf.crawlers.crawler_scope_restricted_to_allowlist
  title: Data Lake Formation Crawler Scope Should Be Restricted to Approved Data Sources
  severity: low
  assertion_id: ''
  for_each: alicloud.dlf.crawlers
  params: {}
  conditions:
    var: item.permissions
    op: not_contains
    value: '*'
- rule_id: alicloud.dlf.database.cross_account_sharing_restricted
  title: Ensure Data Lake Formation Database Cross Account Sharing is Restricted
  severity: low
  assertion_id: ''
  for_each: alicloud.dlf.database
  params: {}
  conditions:
    var: item.permissions
    op: not_contains
    value: '*'
- rule_id: alicloud.dlf.database.encrypted
  title: Data Lake Formation Database Encryption Should Be Enabled
  severity: medium
  assertion_id: ''
  for_each: alicloud.dlf.database
  params: {}
  conditions:
    var: item.encrypted
    op: equals
    value: true
- rule_id: alicloud.dlf.database.policy_least_privilege
  title: Data Lake Formation database policies should follow least privilege principle
  severity: high
  assertion_id: ''
  for_each: alicloud.dlf.database
  params: {}
  conditions:
    var: item.permissions
    op: not_contains
    value: '*'
- rule_id: alicloud.dlf.dataworks_crawlers.crawler_logs_enabled
  title: Ensure Data Lake Formation DataWorks Crawlers Have Logging Enabled
  severity: medium
  assertion_id: ''
  for_each: alicloud.dlf.dataworks_crawlers
  params: {}
  conditions:
    var: item.logging_enabled
    op: equals
    value: true
- rule_id: alicloud.dlf.dataworks_crawlers.crawler_network_private_only
  title: Ensure Data Lake Formation DataWorks Crawlers Use Private Network Access Only
  severity: medium
  assertion_id: ''
  for_each: alicloud.dlf.dataworks_crawlers
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.dlf.dataworks_crawlers.crawler_role_least_privilege
  title: Ensure Data Lake Formation DataWorks Crawlers Use Least Privilege IAM Roles
  severity: high
  assertion_id: ''
  for_each: alicloud.dlf.dataworks_crawlers
  params: {}
  conditions:
    var: item.permissions
    op: not_contains
    value: '*'
- rule_id: alicloud.dlf.dataworks_crawlers.crawler_scope_restricted_to_allowlist
  title: Data Lake Formation DataWorks Crawler Scope Should Be Restricted to Allowlist
  severity: medium
  assertion_id: ''
  for_each: alicloud.dlf.dataworks_crawlers
  params: {}
  conditions:
    var: item.permissions
    op: not_contains
    value: '*'
- rule_id: alicloud.dlf.endpoint.encrypted
  title: Data Lake Formation endpoints should be encrypted in transit
  severity: medium
  assertion_id: ''
  for_each: alicloud.dlf.endpoint
  params: {}
  conditions:
    var: item.encrypted
    op: equals
    value: true
- rule_id: alicloud.dlf.endpoint.least_privilege
  title: Data Lake Formation endpoint should implement least privilege access controls
  severity: high
  assertion_id: ''
  for_each: alicloud.dlf.endpoint
  params: {}
  conditions:
    var: item.permissions
    op: not_contains
    value: '*'
- rule_id: alicloud.dlf.endpoint.no_public_access
  title: Data Lake Formation endpoints should not allow public access
  severity: high
  assertion_id: ''
  for_each: alicloud.dlf.endpoint
  params: {}
  conditions:
    all:
    - var: item.public_ip_address
      op: not_exists
    - var: item.internet_facing
      op: not_equals
      value: true
- rule_id: alicloud.dlf.job.least_privilege
  title: Data Lake Formation job should follow least privilege access principles
  severity: high
  assertion_id: ''
  for_each: alicloud.dlf.job
  params: {}
  conditions:
    var: item.permissions
    op: not_contains
    value: '*'
- rule_id: alicloud.dlf.job.private_only
  title: Ensure Data Lake Formation jobs are configured for private network access only
  severity: medium
  assertion_id: ''
  for_each: alicloud.dlf.job
  params: {}
  conditions:
    var: item.permissions
    op: not_contains
    value: '*'
- rule_id: alicloud.dlf.job_script.and_encrypted
  title: Data Lake Formation job scripts should be encrypted to protect sensitive data processing logic
  severity: low
  assertion_id: ''
  for_each: alicloud.dlf.job_script
  params: {}
  conditions:
    var: item.encrypted
    op: equals
    value: true
- rule_id: alicloud.dlf.maxcompute_partition.partition_access_policies_least_privilege
  title: Ensure Data Lake Formation MaxCompute Partition Access Policies Follow Least Privilege Principle
  severity: high
  assertion_id: ''
  for_each: alicloud.dlf.maxcompute_partition
  params: {}
  conditions:
    var: item.permissions
    op: not_contains
    value: '*'
- rule_id: alicloud.dlf.maxcompute_partition.partition_catalog_encrypted
  title: Data Lake Formation MaxCompute partition catalog should be encrypted
  severity: low
  assertion_id: ''
  for_each: alicloud.dlf.maxcompute_partition
  params: {}
  conditions:
    var: item.encrypted
    op: equals
    value: true
- rule_id: alicloud.dlf.registry.cross_account_sharing_restricted
  title: Data Lake Formation Registry Cross Account Sharing Should Be Restricted
  severity: low
  assertion_id: ''
  for_each: alicloud.dlf.registry
  params: {}
  conditions:
    var: item.permissions
    op: not_contains
    value: '*'
- rule_id: alicloud.dlf.registry.metadata_encryption_enabled
  title: Ensure Data Lake Formation Registry Has Metadata Encryption Enabled
  severity: high
  assertion_id: ''
  for_each: alicloud.dlf.registry
  params: {}
  conditions:
    var: item.encrypted
    op: equals
    value: true
- rule_id: alicloud.dlf.registry.rbac_least_privilege
  title: Data Lake Formation Registry Should Implement RBAC Least Privilege Access Controls
  severity: high
  assertion_id: ''
  for_each: alicloud.dlf.registry
  params: {}
  conditions:
    var: item.permissions
    op: not_contains
    value: '*'
- rule_id: alicloud.dlf.schema.encrypted
  title: Data Lake Formation Schema Encryption Should Be Enabled
  severity: low
  assertion_id: ''
  for_each: alicloud.dlf.schema
  params: {}
  conditions:
    var: item.encrypted
    op: equals
    value: true
- rule_id: alicloud.dlf.schema.rbac_least_privilege
  title: Data Lake Formation Schema Should Implement RBAC Least Privilege Access Controls
  severity: high
  assertion_id: ''
  for_each: alicloud.dlf.schema
  params: {}
  conditions:
    var: item.permissions
    op: not_contains
    value: '*'
- rule_id: alicloud.dlf.table.access_policies_least_privilege
  title: Data Lake Formation Table Access Policies Should Follow Least Privilege Principle
  severity: high
  assertion_id: ''
  for_each: alicloud.dlf.table
  params: {}
  conditions:
    var: item.permissions
    op: not_contains
    value: '*'
- rule_id: alicloud.dlf.table.column_level_access_controls_enabled
  title: Ensure Data Lake Formation Tables Have Column Level Access Controls Enabled
  severity: medium
  assertion_id: ''
  for_each: alicloud.dlf.table
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.dlf.table.encrypted
  title: Ensure Data Lake Formation tables are encrypted
  severity: low
  assertion_id: ''
  for_each: alicloud.dlf.table
  params: {}
  conditions:
    var: item.encrypted
    op: equals
    value: true
- rule_id: alicloud.dlf.table.public_sharing_disabled
  title: Ensure Data Lake Formation tables have public sharing disabled
  severity: high
  assertion_id: ''
  for_each: alicloud.dlf.table
  params: {}
  conditions:
    var: item.id
    op: exists
