version: '1.0'
provider: alicloud
service: alb
discovery:
- discovery_id: alicloud.alb.deletion
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeDeletions
    params: {}
    save_as: deletion_response
  emit:
    items_for: '{ deletion_response.Deletions.Deletion }'
    as: r
    item:
      id: '{{ r.DeletionId }}'
      name: '{{ r.DeletionId }}'
      resource_type: deletion
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.alb.hologres_access_control
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeHologresAccessControls
    params: {}
    save_as: hologres_access_control_response
  emit:
    items_for: '{ hologres_access_control_response.HologresAccessControls.HologresAccessControl }'
    as: r
    item:
      id: '{{ r.HologresAccessControlId }}'
      name: '{{ r.HologresAccessControlId }}'
      resource_type: hologres_access_control
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.alb.hologres_endpoint
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeHologresEndpoints
    params: {}
    save_as: hologres_endpoint_response
  emit:
    items_for: '{ hologres_endpoint_response.HologresEndpoints.HologresEndpoint }'
    as: r
    item:
      id: '{{ r.HologresEndpointId }}'
      name: '{{ r.HologresEndpointId }}'
      resource_type: hologres_endpoint
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.alb.hologres_parameter_group
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeHologresParameterGroups
    params: {}
    save_as: hologres_parameter_group_response
  emit:
    items_for: '{ hologres_parameter_group_response.HologresParameterGroups.HologresParameterGroup }'
    as: r
    item:
      id: '{{ r.HologresParameterGroupId }}'
      name: '{{ r.HologresParameterGroupId }}'
      resource_type: hologres_parameter_group
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.alb.hologres_snapshots
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeHologresSnapshotss
    params: {}
    save_as: hologres_snapshots_response
  emit:
    items_for: '{ hologres_snapshots_response.HologresSnapshotss.HologresSnapshots }'
    as: r
    item:
      id: '{{ r.HologresSnapshotsId }}'
      name: '{{ r.HologresSnapshotsId }}'
      resource_type: hologres_snapshots
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.alb.insecure
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeInsecures
    params: {}
    save_as: insecure_response
  emit:
    items_for: '{ insecure_response.Insecures.Insecure }'
    as: r
    item:
      id: '{{ r.InsecureId }}'
      name: '{{ r.InsecureId }}'
      resource_type: insecure
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.alb.internet
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeInternets
    params: {}
    save_as: internet_response
  emit:
    items_for: '{ internet_response.Internets.Internet }'
    as: r
    item:
      id: '{{ r.InternetId }}'
      name: '{{ r.InternetId }}'
      resource_type: internet
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.alb.is
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeIss
    params: {}
    save_as: is_response
  emit:
    items_for: '{ is_response.Iss.Is }'
    as: r
    item:
      id: '{{ r.IsId }}'
      name: '{{ r.IsId }}'
      resource_type: is
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.alb.listener
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeListeners
    params: {}
    save_as: listener_response
  emit:
    items_for: '{ listener_response.Listeners.Listener }'
    as: r
    item:
      id: '{{ r.ListenerId }}'
      name: '{{ r.ListenerId }}'
      resource_type: listener
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.alb.logging
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeLoggings
    params: {}
    save_as: logging_response
  emit:
    items_for: '{ logging_response.Loggings.Logging }'
    as: r
    item:
      id: '{{ r.LoggingId }}'
      name: '{{ r.LoggingId }}'
      resource_type: logging
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.alb.network
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeNetworks
    params: {}
    save_as: network_response
  emit:
    items_for: '{ network_response.Networks.Network }'
    as: r
    item:
      id: '{{ r.NetworkId }}'
      name: '{{ r.NetworkId }}'
      resource_type: network
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.alb.ssl
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeSsls
    params: {}
    save_as: ssl_response
  emit:
    items_for: '{ ssl_response.Ssls.Ssl }'
    as: r
    item:
      id: '{{ r.SslId }}'
      name: '{{ r.SslId }}'
      resource_type: ssl
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.alb.target
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeTargets
    params: {}
    save_as: target_response
  emit:
    items_for: '{ target_response.Targets.Target }'
    as: r
    item:
      id: '{{ r.TargetId }}'
      name: '{{ r.TargetId }}'
      resource_type: target
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.alb.target_group
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeTargetGroups
    params: {}
    save_as: target_group_response
  emit:
    items_for: '{ target_group_response.TargetGroups.TargetGroup }'
    as: r
    item:
      id: '{{ r.TargetGroupId }}'
      name: '{{ r.TargetGroupId }}'
      resource_type: target_group
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
- discovery_id: alicloud.alb.waf
  calls:
  - product: Unknown
    version: '2014-05-26'
    action: DescribeWafs
    params: {}
    save_as: waf_response
  emit:
    items_for: '{ waf_response.Wafs.Waf }'
    as: r
    item:
      id: '{{ r.WafId }}'
      name: '{{ r.WafId }}'
      resource_type: waf
      region: '{{ region }}'
      encrypted: '{{ r.Encrypted }}'
      kms_key_id: '{{ r.KMSKeyId }}'
      public_ip_address: '{{ r.PublicIpAddress }}'
      vpc_id: '{{ r.VpcId }}'
      status: '{{ r.Status }}'
      tags: '{{ r.Tags }}'
checks:
- rule_id: alicloud.alb.deletion.protection
  title: Application Load Balancer Deletion Protection Should Be Enabled
  severity: low
  assertion_id: canada_pbmm_moderate_multi_cloud_CCCS_CM-2_0042
  for_each: alicloud.alb.deletion
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.alb.hologres_access_control.endpoint_authz_no_anonymous_access
  title: Application Load Balancer Hologres Access Control Should Not Allow Anonymous Access to Endpoints
  severity: medium
  assertion_id: ''
  for_each: alicloud.alb.hologres_access_control
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.alb.hologres_access_control.endpoint_authz_rbac_least_privilege
  title: Application Load Balancer Hologres Access Control Should Implement Endpoint Authorization RBAC with Least Privilege
    Principles
  severity: high
  assertion_id: ''
  for_each: alicloud.alb.hologres_access_control
  params: {}
  conditions:
    var: item.permissions
    op: not_contains
    value: '*'
- rule_id: alicloud.alb.hologres_endpoint.endpoint_access_allowed_cidrs_minimized
  title: Application Load Balancer Hologres Endpoint Access CIDR Ranges Should Be Minimized
  severity: medium
  assertion_id: ''
  for_each: alicloud.alb.hologres_endpoint
  params: {}
  conditions:
    var: item.permissions
    op: not_contains
    value: '*'
- rule_id: alicloud.alb.hologres_endpoint.endpoint_access_private_only
  title: Application Load Balancer Hologres endpoints should be configured for private access only
  severity: medium
  assertion_id: ''
  for_each: alicloud.alb.hologres_endpoint
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.alb.hologres_endpoint.endpoint_access_tls_required
  title: Application Load Balancer Hologres Endpoint Must Require TLS Encryption
  severity: medium
  assertion_id: ''
  for_each: alicloud.alb.hologres_endpoint
  params: {}
  conditions:
    all:
    - var: item.encrypted
      op: equals
      value: true
    - var: item.ssl_enabled
      op: equals
      value: true
- rule_id: alicloud.alb.hologres_parameter_group.parameter_group_require_ssl
  title: Application Load Balancer Hologres Parameter Group Should Require SSL Encryption
  severity: medium
  assertion_id: ''
  for_each: alicloud.alb.hologres_parameter_group
  params: {}
  conditions:
    all:
    - var: item.encrypted
      op: equals
      value: true
    - var: item.ssl_enabled
      op: equals
      value: true
- rule_id: alicloud.alb.hologres_snapshots.snapshot_cross_region_copy_encrypted
  title: Ensure Application Load Balancer Hologres Snapshots Enable Cross-Region Copy Encryption
  severity: low
  assertion_id: ''
  for_each: alicloud.alb.hologres_snapshots
  params: {}
  conditions:
    all:
    - var: item.encrypted
      op: equals
      value: true
    - var: item.backup_enabled
      op: equals
      value: true
- rule_id: alicloud.alb.hologres_snapshots.snapshot_encrypted_at_rest_cmek
  title: Ensure Application Load Balancer Hologres Snapshots Are Encrypted at Rest with Customer-Managed Encryption Keys
  severity: low
  assertion_id: ''
  for_each: alicloud.alb.hologres_snapshots
  params: {}
  conditions:
    all:
    - var: item.encrypted
      op: equals
      value: true
    - var: item.kms_key_id
      op: exists
- rule_id: alicloud.alb.hologres_snapshots.snapshot_not_publicly_shared
  title: Ensure Hologres Snapshots Are Not Publicly Shared
  severity: high
  assertion_id: ''
  for_each: alicloud.alb.hologres_snapshots
  params: {}
  conditions:
    all:
    - var: item.public_ip_address
      op: not_exists
    - var: item.internet_facing
      op: not_equals
      value: true
    - var: item.backup_enabled
      op: equals
      value: true
- rule_id: alicloud.alb.insecure.ssl_ciphers
  title: Application Load Balancer uses insecure SSL cipher suites
  severity: medium
  assertion_id: nist_800_53_rev5_multi_cloud_SC-8_1_1227
  for_each: alicloud.alb.insecure
  params: {}
  conditions:
    var: item.encrypted
    op: equals
    value: true
- rule_id: alicloud.alb.internet.facing
  title: Application Load Balancer Should Not Be Internet-Facing Unless Required
  severity: low
  assertion_id: ''
  for_each: alicloud.alb.internet
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.alb.is.in_multiple_az
  title: Application Load Balancer should be deployed across multiple availability zones
  severity: low
  assertion_id: ''
  for_each: alicloud.alb.is
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.alb.listener.cipher_policy_secure
  title: Application Load Balancer listener must use secure cipher policy
  severity: medium
  assertion_id: ''
  for_each: alicloud.alb.listener
  params: {}
  conditions:
    var: item.encrypted
    op: equals
    value: true
- rule_id: alicloud.alb.listener.facing
  title: Application Load Balancer listener should not be internet-facing when handling sensitive traffic
  severity: low
  assertion_id: ''
  for_each: alicloud.alb.listener
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.alb.listener.tls_min_1_2
  title: Application Load Balancer listeners should enforce TLS version 1.2 or higher
  severity: medium
  assertion_id: ''
  for_each: alicloud.alb.listener
  params: {}
  conditions:
    var: item.ssl_enabled
    op: equals
    value: true
- rule_id: alicloud.alb.logging.enabled
  title: Application Load Balancer Access Logging Should Be Enabled
  severity: low
  assertion_id: canada_pbmm_moderate_multi_cloud_CCCS_AU-2_0024
  for_each: alicloud.alb.logging
  params: {}
  conditions:
    var: item.logging_enabled
    op: equals
    value: true
- rule_id: alicloud.alb.network.lb_access_logs_enabled
  title: Application Load Balancer Access Logs Should Be Enabled
  severity: medium
  assertion_id: ''
  for_each: alicloud.alb.network
  params: {}
  conditions:
    var: item.logging_enabled
    op: equals
    value: true
- rule_id: alicloud.alb.network.lb_listener_tls_min_1_2
  title: Application Load Balancer listener should enforce minimum TLS version 1.2
  severity: medium
  assertion_id: ''
  for_each: alicloud.alb.network
  params: {}
  conditions:
    all:
    - var: item.encrypted
      op: equals
      value: true
    - var: item.ssl_enabled
      op: equals
      value: true
    - var: item.min_tls_version
      op: gte
      value: '1.2'
- rule_id: alicloud.alb.network.lb_valid_certificate_attached
  title: Application Load Balancer Must Have Valid SSL/TLS Certificate Attached
  severity: medium
  assertion_id: ''
  for_each: alicloud.alb.network
  params: {}
  conditions:
    var: item.encrypted
    op: equals
    value: true
- rule_id: alicloud.alb.ssl.listeners
  title: Application Load Balancer SSL listeners should be properly configured with secure protocols
  severity: medium
  assertion_id: gdpr_multi_cloud_Article_32_Security_of_processing_0003
  for_each: alicloud.alb.ssl
  params: {}
  conditions:
    var: item.encrypted
    op: equals
    value: true
- rule_id: alicloud.alb.target.group_health_check_enabled
  title: Application Load Balancer Target Group Health Check Must Be Enabled
  severity: low
  assertion_id: ''
  for_each: alicloud.alb.target
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.alb.target_group.tg_targets_in_private_subnets
  title: Application Load Balancer Target Group Targets Should Be Deployed in Private Subnets
  severity: medium
  assertion_id: ''
  for_each: alicloud.alb.target_group
  params: {}
  conditions:
    var: item.id
    op: exists
- rule_id: alicloud.alb.waf.acl_attached
  title: Application Load Balancer Web Application Firewall ACL Attachment
  severity: low
  assertion_id: iso27001_2022_multi_cloud_A.8.20_0076
  for_each: alicloud.alb.waf
  params: {}
  conditions:
    var: item.id
    op: exists
