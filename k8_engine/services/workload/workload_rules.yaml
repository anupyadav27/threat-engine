component: workload
component_type: workload
discovery:
- discovery_id: list_workload_resources
  calls:
  - action: list_pods
    fields:
    - path: name
      var: name
    - path: namespace
      var: namespace
    - path: labels
      var: labels
checks:
- check_id: k8s.workload.cronjob.execution_constraints_enforced
  name: Execution Constraints Enforced
  severity: LOW
  for_each: list_workload_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.name
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.workload.daemonset.daemonset_host_access_controlled_enforced
  name: Daemonset Host Access Controlled Enforced
  severity: HIGH
  for_each: list_workload_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.name
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.workload.daemonset.host_pid_restricted
  name: Host Pid Restricted
  severity: LOW
  for_each: list_workload_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.name
      operator: not_equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.workload.deployment.resource_limits_enforced
  name: Resource Limits Enforced
  severity: LOW
  for_each: list_workload_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.name
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.workload.job.completion_policies_enforced_enabled
  name: Completion Policies Enforced Enabled
  severity: LOW
  for_each: list_workload_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.name
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.workload.serviceaccount.service_mesh_cert_auth_enforced
  name: Service Mesh Cert Auth Enforced
  severity: HIGH
  for_each: list_workload_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.name
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.workload.statefulset.persistence_secured_enforced
  name: Persistence Secured Enforced
  severity: LOW
  for_each: list_workload_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.name
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
