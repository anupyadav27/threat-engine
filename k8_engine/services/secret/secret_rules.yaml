component: secret
component_type: workload
discovery:
- discovery_id: list_secret_resources
  calls:
  - action: list_secrets
    fields:
    - path: name
      var: name
    - path: namespace
      var: namespace
    - path: labels
      var: labels
checks:
- check_id: k8s.secret.access.control_configured
  name: Control Configured
  severity: LOW
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations.rbac
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.backup.and_recovery_enabled
  name: And Recovery Enabled
  severity: LOW
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations.backup
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.backup.policy_configured
  name: Policy Configured
  severity: MEDIUM
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations.backup
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.certificate.expiration_monitoring_enabled
  name: Expiration Monitoring Enabled
  severity: MEDIUM
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.certificate.renewal_process_defined
  name: Renewal Process Defined
  severity: LOW
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.certificate.revocation_list_configured
  name: Revocation List Configured
  severity: LOW
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.configmap.sensitive_data_prohibited_enforced
  name: Sensitive Data Prohibited Enforced
  severity: LOW
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.database.credentials_encrypted
  name: Credentials Encrypted
  severity: HIGH
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.encryption.at_rest_enabled
  name: At Rest Enabled
  severity: LOW
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.type
      operator: not_equals
      expected: Opaque
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.external.manager_configured
  name: Manager Configured
  severity: LOW
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.git.repo_url_no_sensitive_credentials
  name: Repo Url No Sensitive Credentials
  severity: LOW
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.key.rotation_policy_defined
  name: Rotation Policy Defined
  severity: MEDIUM
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations.rotation
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.management.policies_documented
  name: Policies Documented
  severity: LOW
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.minimize.key_storage_locations
  name: Key Storage Locations
  severity: LOW
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.networkpolicy.dlp_policies_enforced
  name: Dlp Policies Enforced
  severity: LOW
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.networkpolicy.gdpr_compliance_enabled
  name: Gdpr Compliance Enabled
  severity: LOW
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.networkpolicy.transfer_controls_enabled
  name: Transfer Controls Enabled
  severity: LOW
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.no.sensitive_data_in_env
  name: Sensitive Data In Env
  severity: LOW
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.not.in_env_variables
  name: In Env Variables
  severity: LOW
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.pod.labels_enforced_enabled
  name: Labels Enforced Enabled
  severity: LOW
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.labels
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.rotation.policy_configured
  name: Policy Configured
  severity: MEDIUM
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations.rotation
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.secret.access_monitoring_enabled
  name: Access Monitoring Enabled
  severity: MEDIUM
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations.rbac
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.secret.auto_rotation_configured
  name: Auto Rotation Configured
  severity: LOW
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations.rotation
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.secret.certificate_revocation_list_configured
  name: Certificate Revocation List Configured
  severity: HIGH
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.secret.encryption_at_rest_enabled_enforced
  name: Encryption At Rest Enabled Enforced
  severity: HIGH
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.type
      operator: not_equals
      expected: Opaque
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.secret.etcd_encryption_enabled_enforced
  name: Etcd Encryption Enabled Enforced
  severity: HIGH
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.etcd-encryption-enabled-enforced
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.secret.external_secret_operator_enabled
  name: External Secret Operator Enabled
  severity: HIGH
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.secret.git_repo_url_no_sensitive_credentials_configured
  name: Git Repo Url No Sensitive Credentials Configured
  severity: LOW
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.secret.hardcoded_secrets_scanned_enforced
  name: Hardcoded Secrets Scanned Enforced
  severity: HIGH
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.secret.minimize_key_storage_locations_configured
  name: Minimize Key Storage Locations Configured
  severity: LOW
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.secret.no_sensitive_data_in_env_configured
  name: No Sensitive Data In Env Configured
  severity: LOW
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.secret.secret_rbac_configured_enforced
  name: Secret Rbac Configured Enforced
  severity: HIGH
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.rules
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.secret.secure_injection_enabled
  name: Secure Injection Enabled
  severity: LOW
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.secret.tls_certificates_expiration_configured
  name: Tls Certificates Expiration Configured
  severity: HIGH
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.secret.transmission_tls_enabled
  name: Transmission Tls Enabled
  severity: HIGH
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.secret.unused_secrets_cleaned_enabled
  name: Unused Secrets Cleaned Enabled
  severity: HIGH
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.tls.certificates_expiration_check
  name: Certificates Expiration Check
  severity: HIGH
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.secret.transmission.tls_enabled
  name: Tls Enabled
  severity: HIGH
  for_each: list_secret_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
