component: controlplane
component_type: workload
discovery:
- discovery_id: list_controlplane_resources
  calls:
  - action: list_pods
    fields:
    - path: name
      var: name
    - path: namespace
      var: namespace
    - path: labels
      var: labels
checks:
- check_id: k8s.controlplane.controller.manager_args_profiling_disabled
  name: Manager Args Profiling Disabled
  severity: LOW
  for_each: list_controlplane_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.arguments.profiling
      operator: equals
      expected: 'false'
  logic: AND
  errors_as_fail: []
- check_id: k8s.controlplane.controller.manager_bind_address_localhost_check
  name: Manager Bind Address Localhost Check
  severity: LOW
  for_each: list_controlplane_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.controlplane.controller.manager_root_ca_file_verification
  name: Manager Root Ca File Verification
  severity: CRITICAL
  for_each: list_controlplane_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.controlplane.controller.manager_rotate_kubelet_server_certificate_enabled
  name: Manager Rotate Kubelet Server Certificate Enabled
  severity: HIGH
  for_each: list_controlplane_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.arguments.rotate-kubelet-server-certificate
      operator: equals
      expected: 'true'
  logic: AND
  errors_as_fail: []
- check_id: k8s.controlplane.controller.manager_service_account_private_key_file_check
  name: Manager Service Account Private Key File Check
  severity: LOW
  for_each: list_controlplane_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.controlplane.controller.manager_terminated_pod_gc_threshold_check
  name: Manager Terminated Pod Gc Threshold Check
  severity: LOW
  for_each: list_controlplane_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.controlplane.plane.auto_upgrade_enabled
  name: Auto Upgrade Enabled
  severity: LOW
  for_each: list_controlplane_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations.auto-upgrade
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.controlplane.plane.patch_compliance
  name: Patch Compliance
  severity: LOW
  for_each: list_controlplane_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.controlplane.proxy.metrics_bind_address_localhost
  name: Metrics Bind Address Localhost
  severity: LOW
  for_each: list_controlplane_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.controlplane.scheduler.profiling_disabled
  name: Profiling Disabled
  severity: LOW
  for_each: list_controlplane_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.profiling-disabled
      operator: not_equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.controlplane.server.audit_log_maxage_check
  name: Audit Log Maxage Check
  severity: HIGH
  for_each: list_controlplane_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.controlplane.server.service_account_key_file_set
  name: Service Account Key File Set
  severity: LOW
  for_each: list_controlplane_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
