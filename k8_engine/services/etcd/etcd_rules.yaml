component: etcd
component_type: control_plane
discovery:
- discovery_id: list_etcd_resources
  calls:
  - action: list_pods
    fields:
    - path: name
      var: name
    - path: namespace
      var: namespace
    - path: labels
      var: labels
checks:
- check_id: k8s.etcd.auto.tls_check
  name: Tls Check
  severity: HIGH
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.tls-check
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.backup.and_restore_tested
  name: And Restore Tested
  severity: LOW
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.and-restore-tested
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.backup.configured
  name: Configured
  severity: LOW
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.configured
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.backup.encryption_enabled
  name: Encryption Enabled
  severity: HIGH
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.encryption-enabled
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.backup.retention_policy_set
  name: Retention Policy Set
  severity: MEDIUM
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.retention-policy-set
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.backup.scheduled
  name: Scheduled
  severity: LOW
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.scheduled
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.ca.uniqueness_check
  name: Uniqueness Check
  severity: LOW
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.uniqueness-check
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.cluster.state_backup_scheduled
  name: State Backup Scheduled
  severity: MEDIUM
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.state-backup-scheduled
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.encryption.at_rest_enabled
  name: At Rest Enabled
  severity: LOW
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.at-rest-enabled
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.encryption.enabled
  name: Enabled
  severity: LOW
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.enabled
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.etcd.apiserver_ca_configured
  name: Apiserver Ca Configured
  severity: LOW
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.apiserver-ca-configured
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.etcd.auto_tls_configured
  name: Auto Tls Configured
  severity: HIGH
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.auto-tls-configured
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.etcd.ca_uniqueness_configured
  name: Ca Uniqueness Configured
  severity: LOW
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.ca-uniqueness-configured
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.etcd.encryption_at_rest_enabled
  name: Encryption At Rest Enabled
  severity: HIGH
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.encryption-at-rest-enabled
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.etcd.patch_enforced
  name: Patch Enforced
  severity: LOW
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.patch-enforced
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.etcd.peer_client_cert_auth_in_transit_enabled
  name: Peer Client Cert Auth In Transit Enabled
  severity: HIGH
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.peer-client-cert-auth-in-transit-enabled
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.etcd.pod_tls_encryption_configuration_configured
  name: Pod Tls Encryption Configuration Configured
  severity: HIGH
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.pod-tls-encryption-configuration-configured
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.patch.compliance
  name: Compliance
  severity: LOW
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.compliance
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.peer.client_cert_auth_in_transit_enabled
  name: Client Cert Auth In Transit Enabled
  severity: HIGH
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.client-cert-auth-in-transit-enabled
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.peer.tls_configuration_check
  name: Tls Configuration Check
  severity: HIGH
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.tls-configuration-check
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.peer.tls_in_transit_configuration
  name: Tls In Transit Configuration
  severity: HIGH
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.tls-in-transit-configuration
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.pod.auto_tls_check
  name: Auto Tls Check
  severity: HIGH
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.auto-tls-check
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.pod.client_cert_auth_enabled
  name: Client Cert Auth Enabled
  severity: HIGH
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.client-cert-auth-enabled
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.pod.peer_auto_tls_disabled
  name: Peer Auto Tls Disabled
  severity: HIGH
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.peer-auto-tls-disabled
      operator: not_equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.pod.tls_encryption_configuration_check
  name: Tls Encryption Configuration Check
  severity: HIGH
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.tls-encryption-configuration-check
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.secret.certificate_configured
  name: Certificate Configured
  severity: HIGH
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.certificate-configured
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.server.ca_check
  name: Ca Check
  severity: LOW
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.ca-check
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.snapshot.retention_policy_configured
  name: Retention Policy Configured
  severity: MEDIUM
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.retention-policy-configured
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.snapshot.schedule_defined
  name: Schedule Defined
  severity: LOW
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.schedule-defined
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.tls.enabled
  name: Enabled
  severity: LOW
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.enabled
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.tls.encryption_in_transit_check
  name: Encryption In Transit Check
  severity: HIGH
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.encryption-in-transit-check
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.etcd.unique.ca_certificate_check
  name: Ca Certificate Check
  severity: HIGH
  for_each: list_etcd_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.ca-certificate-check
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
