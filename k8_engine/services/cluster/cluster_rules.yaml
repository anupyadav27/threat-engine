component: cluster
component_type: cluster
discovery:
- discovery_id: list_cluster_resources
  calls:
  - action: list_pods
    fields:
    - path: name
      var: name
    - path: namespace
      var: namespace
    - path: labels
      var: labels
checks:
- check_id: k8s.cluster.autoscaler.enabled
  name: Enabled
  severity: LOW
  for_each: list_cluster_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.name
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.cluster.backup.and_restore_procedures_documented
  name: And Restore Procedures Documented
  severity: LOW
  for_each: list_cluster_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.name
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.cluster.backup.and_restore_tested
  name: And Restore Tested
  severity: LOW
  for_each: list_cluster_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.name
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.cluster.cluster.autoscaler_enabled
  name: Autoscaler Enabled
  severity: LOW
  for_each: list_cluster_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.name
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.cluster.cluster.component_network_isolation_enforced
  name: Component Network Isolation Enforced
  severity: MEDIUM
  for_each: list_cluster_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.policy_types
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.cluster.daemonset.proxy_configuration_secured_enabled
  name: Proxy Configuration Secured Enabled
  severity: LOW
  for_each: list_cluster_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.name
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.cluster.disaster.recovery_plan_documented
  name: Recovery Plan Documented
  severity: LOW
  for_each: list_cluster_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.name
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.cluster.etcd.backup_encryption_enabled_enforced
  name: Backup Encryption Enabled Enforced
  severity: HIGH
  for_each: list_cluster_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.backup-encryption-enabled-enforced
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.cluster.etcd.etcd_peer_tls_enabled_enforced
  name: Etcd Peer Tls Enabled Enforced
  severity: HIGH
  for_each: list_cluster_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.etcd-peer-tls-enabled-enforced
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.cluster.high.availability_configured
  name: Availability Configured
  severity: LOW
  for_each: list_cluster_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.name
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.cluster.kubelet.kubelet_authentication_enabled_enforced
  name: Kubelet Authentication Enabled Enforced
  severity: HIGH
  for_each: list_cluster_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.name
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.cluster.namespace.high_availability_enabled
  name: High Availability Enabled
  severity: LOW
  for_each: list_cluster_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.name
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.cluster.namespace.plane_patch_enforced
  name: Plane Patch Enforced
  severity: LOW
  for_each: list_cluster_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.name
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.cluster.namespace.review_scheduled
  name: Review Scheduled
  severity: LOW
  for_each: list_cluster_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.name
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.cluster.namespace.supported_version_configured
  name: Supported Version Configured
  severity: LOW
  for_each: list_cluster_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.name
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.cluster.namespace.version_supported_configured
  name: Version Supported Configured
  severity: LOW
  for_each: list_cluster_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.name
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.cluster.node.tpm_verification_enabled_enforced
  name: Tpm Verification Enabled Enforced
  severity: LOW
  for_each: list_cluster_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.name
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.cluster.pod.apiserver_insecure_bind_address_configured
  name: Apiserver Insecure Bind Address Configured
  severity: LOW
  for_each: list_cluster_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.apiserver-insecure-bind-address-configured
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.cluster.pod.apiserver_profiling_disabled
  name: Apiserver Profiling Disabled
  severity: LOW
  for_each: list_cluster_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.apiserver-profiling-disabled
      operator: not_equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.cluster.pod.plane_auto_upgrade_enabled
  name: Plane Auto Upgrade Enabled
  severity: LOW
  for_each: list_cluster_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.name
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.cluster.pod.scheduler_profiling_disabled
  name: Scheduler Profiling Disabled
  severity: LOW
  for_each: list_cluster_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: arguments.scheduler-profiling-disabled
      operator: not_equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.cluster.resource.monitoring_enabled
  name: Monitoring Enabled
  severity: MEDIUM
  for_each: list_cluster_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.name
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.cluster.secret.enabled
  name: Enabled
  severity: LOW
  for_each: list_cluster_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.name
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.cluster.server.anonymous_access_disabled_enforced
  name: Anonymous Access Disabled Enforced
  severity: CRITICAL
  for_each: list_cluster_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.name
      operator: not_equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.cluster.server.audit_logging_enabled_enforced
  name: Audit Logging Enabled Enforced
  severity: HIGH
  for_each: list_cluster_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.name
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.cluster.service.account_credentials_enabled
  name: Account Credentials Enabled
  severity: LOW
  for_each: list_cluster_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.name
      operator: equals
      expected: true
  logic: AND
  errors_as_fail: []
- check_id: k8s.cluster.supported.version
  name: Version
  severity: LOW
  for_each: list_cluster_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.name
      operator: gte
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.cluster.version.supported
  name: Supported
  severity: LOW
  for_each: list_cluster_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.name
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.cluster.version.up_to_date
  name: Up To Date
  severity: LOW
  for_each: list_cluster_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.name
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
