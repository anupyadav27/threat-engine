component: policy
component_type: policy
discovery:
- discovery_id: list_policy_resources
  calls:
  - action: list_pods
    fields:
    - path: name
      var: name
    - path: namespace
      var: namespace
    - path: labels
      var: labels
checks:
- check_id: k8s.policy.capabilities.restriction_check
  name: Restriction Check
  severity: LOW
  for_each: list_policy_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations.capabilities
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.policy.control.mechanisms_check
  name: Mechanisms Check
  severity: LOW
  for_each: list_policy_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.policy.namespace.resource_quotas_enforced
  name: Resource Quotas Enforced
  severity: LOW
  for_each: list_policy_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.policy.net.raw_capability_restricted
  name: Raw Capability Restricted
  severity: LOW
  for_each: list_policy_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations.net-raw
      operator: not_equals
      expected: allowed
  logic: AND
  errors_as_fail: []
- check_id: k8s.policy.podsecuritypolicy.automated_compliance_reporting_enabled
  name: Automated Compliance Reporting Enabled
  severity: LOW
  for_each: list_policy_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.policy.podsecuritypolicy.cis_benchmark_compliance_enabled
  name: Cis Benchmark Compliance Enabled
  severity: LOW
  for_each: list_policy_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.policy.podsecuritypolicy.compliance_reporting_automated
  name: Compliance Reporting Automated
  severity: LOW
  for_each: list_policy_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.policy.podsecuritypolicy.gitops_integration_enabled
  name: Gitops Integration Enabled
  severity: LOW
  for_each: list_policy_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.policy.podsecuritypolicy.identity_verification_enabled
  name: Identity Verification Enabled
  severity: HIGH
  for_each: list_policy_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
- check_id: k8s.policy.podsecuritypolicy.risk_assessment_integrated_enabled
  name: Risk Assessment Integrated Enabled
  severity: LOW
  for_each: list_policy_resources
  param: item
  calls:
  - action: identity
    params: {}
    fields:
    - path: item.annotations
      operator: exists
      expected: null
  logic: AND
  errors_as_fail: []
