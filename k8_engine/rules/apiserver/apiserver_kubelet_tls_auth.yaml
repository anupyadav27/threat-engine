component: apiserver
component_type: control_plane
discovery:
- discovery_id: get_apiserver_config
  calls:
  - action: get_component_config
    params:
      component: kube-apiserver
    fields:
    - path: arguments.authorization-mode
      var: authorization_mode
    - path: arguments.audit-log-path
      var: audit_log_path
    - path: arguments.audit-log-maxage
      var: audit_log_max_age
    - path: arguments.audit-log-maxbackup
      var: audit_log_max_backup
    - path: arguments.audit-log-maxsize
      var: audit_log_max_size
    - path: arguments.encryption-provider-config
      var: encryption_provider_config
    - path: arguments.tls-cert-file
      var: tls_cert_file
    - path: arguments.tls-private-key-file
      var: tls_private_key_file
    - path: arguments.client-ca-file
      var: client_ca_file
    - path: arguments.enable-admission-plugins
      var: enable_admission_plugins
    - path: pod_name
      var: pod_name
checks:
- check_id: apiserver_kubelet_tls_auth
  name: Apiserver Kubelet Tls Auth
  severity: MEDIUM
  for_each: get_apiserver_config
  param: config
  calls:
  - action: get_component_config
    params:
      component: kube-apiserver
    fields:
    - path: pod_name
      operator: exists
      expected: true
  logic: AND
  errors_as_fail: []
