component: apiserver
component_type: control_plane

discovery:
  - discovery_id: get_apiserver_config
    calls:
      - action: get_component_config
        params:
          component: kube-apiserver
        fields:
          - path: arguments.enable-admission-plugins
            var: enable_admission_plugins
          - path: pod_name
            var: pod_name

checks:
  - check_id: apiserver_always_pull_images_plugin
    name: Ensure that the AlwaysPullImages admission plugin is enabled
    severity: MEDIUM
    for_each: get_apiserver_config
    param: config
    calls:
      - action: get_component_config
        params:
          component: kube-apiserver
        fields:
          - path: enable_admission_plugins
            operator: contains
            expected: "AlwaysPullImages"
    logic: AND
    errors_as_fail: [] 