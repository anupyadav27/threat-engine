elastic:
  version: '1.0'
  provider: azure
  service: elastic
  package: azure-mgmt-elastic
  client_class: ElasticManagementClient
  scope: subscription
  discovery:
  - discovery_id: azure.elastic.sans
    calls:
    - client: elastic
      action: elastic_sans.list_by_subscription
      save_as: sans
  checks:
  - check_id: azure.elastic.san.public.network.access.disabled
    title: 'AZURE ELASTIC SAN: Public Network Access Disabled'
    severity: critical
    for_each: azure.elastic.sans
    calls:
    - action: self
      fields:
      - path: properties.public_network_access
        operator: equals
        expected: Disabled
  - check_id: azure.elastic.san.volume.group.encryption.at.rest.with.cmk
    title: 'AZURE ELASTIC SAN: Volume Group Encryption At Rest With CMK'
    severity: high
    for_each: azure.elastic.sans
    calls:
    - action: volume_groups.list_by_elastic_san
      params:
        resource_group_name: '{{resource_group}}'
        elastic_san_name: '{{name}}'
      fields:
      - path: value[*].properties.encryption.key_vault_properties.key_name
        operator: exists
