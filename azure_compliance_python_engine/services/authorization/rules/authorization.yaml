version: '1.0'
provider: azure
service: authorization
discovery:
- discovery_id: azure.aad.list
  calls:
  - action: list
    save_as: list_response
  emit:
    items_for: '{{ list_response.value }}'
    as: item
    item:
      id: '{{ item.id }}'
      name: '{{ item.name }}'
      type: '{{ item.type }}'
      deny_assignment_name: '{{ item.deny_assignment_name }}'
      description: '{{ item.description }}'
      permissions: '{{ item.permissions }}'
      scope: '{{ item.scope }}'
      do_not_apply_to_child_scopes: '{{ item.do_not_apply_to_child_scopes }}'
      principals: '{{ item.principals }}'
      exclude_principals: '{{ item.exclude_principals }}'
      is_system_protected: '{{ item.is_system_protected }}'
      condition: '{{ item.condition }}'
      condition_version: '{{ item.condition_version }}'
      created_on: '{{ item.created_on }}'
      updated_on: '{{ item.updated_on }}'
      created_by: '{{ item.created_by }}'
      updated_by: '{{ item.updated_by }}'
- discovery_id: azure.aad.list_for_resource_group
  calls:
  - action: list_for_resource_group
    save_as: list_for_resource_group_response
  emit:
    items_for: '{{ list_for_resource_group_response.value }}'
    as: item
    item:
      actions: '{{ item.actions }}'
      not_actions: '{{ item.not_actions }}'
      data_actions: '{{ item.data_actions }}'
      not_data_actions: '{{ item.not_data_actions }}'
- discovery_id: azure.config.list
  calls:
  - action: list
    save_as: list_response
  emit:
    items_for: '{{ list_response.value }}'
    as: item
    item:
      id: '{{ item.id }}'
      name: '{{ item.name }}'
      type: '{{ item.type }}'
      deny_assignment_name: '{{ item.deny_assignment_name }}'
      description: '{{ item.description }}'
      permissions: '{{ item.permissions }}'
      scope: '{{ item.scope }}'
      do_not_apply_to_child_scopes: '{{ item.do_not_apply_to_child_scopes }}'
      principals: '{{ item.principals }}'
      exclude_principals: '{{ item.exclude_principals }}'
      is_system_protected: '{{ item.is_system_protected }}'
      condition: '{{ item.condition }}'
      condition_version: '{{ item.condition_version }}'
      created_on: '{{ item.created_on }}'
      updated_on: '{{ item.updated_on }}'
      created_by: '{{ item.created_by }}'
      updated_by: '{{ item.updated_by }}'
- discovery_id: azure.iam.list
  calls:
  - action: list
    save_as: list_response
  emit:
    items_for: '{{ list_response.value }}'
    as: item
    item:
      id: '{{ item.id }}'
      name: '{{ item.name }}'
      type: '{{ item.type }}'
      deny_assignment_name: '{{ item.deny_assignment_name }}'
      description: '{{ item.description }}'
      permissions: '{{ item.permissions }}'
      scope: '{{ item.scope }}'
      do_not_apply_to_child_scopes: '{{ item.do_not_apply_to_child_scopes }}'
      principals: '{{ item.principals }}'
      exclude_principals: '{{ item.exclude_principals }}'
      is_system_protected: '{{ item.is_system_protected }}'
      condition: '{{ item.condition }}'
      condition_version: '{{ item.condition_version }}'
      created_on: '{{ item.created_on }}'
      updated_on: '{{ item.updated_on }}'
      created_by: '{{ item.created_by }}'
      updated_by: '{{ item.updated_by }}'
- discovery_id: azure.policy.list
  calls:
  - action: list
    save_as: list_response
  emit:
    items_for: '{{ list_response.value }}'
    as: item
    item:
      id: '{{ item.id }}'
      name: '{{ item.name }}'
      type: '{{ item.type }}'
      display_name: '{{ item.display_name }}'
      resource_types: '{{ item.resource_types }}'
      operations: '{{ item.operations }}'
- discovery_id: azure.policy.list_for_resource_group
  calls:
  - action: list_for_resource_group
    save_as: list_for_resource_group_response
  emit:
    items_for: '{{ list_for_resource_group_response.value }}'
    as: item
    item:
      actions: '{{ item.actions }}'
      not_actions: '{{ item.not_actions }}'
      data_actions: '{{ item.data_actions }}'
      not_data_actions: '{{ item.not_data_actions }}'
- discovery_id: azure.rbac.list
  calls:
  - action: list
    save_as: list_response
  emit:
    items_for: '{{ list_response.value }}'
    as: item
    item:
      id: '{{ item.id }}'
      name: '{{ item.name }}'
      type: '{{ item.type }}'
      deny_assignment_name: '{{ item.deny_assignment_name }}'
      description: '{{ item.description }}'
      permissions: '{{ item.permissions }}'
      scope: '{{ item.scope }}'
      do_not_apply_to_child_scopes: '{{ item.do_not_apply_to_child_scopes }}'
      principals: '{{ item.principals }}'
      exclude_principals: '{{ item.exclude_principals }}'
      is_system_protected: '{{ item.is_system_protected }}'
      condition: '{{ item.condition }}'
      condition_version: '{{ item.condition_version }}'
      created_on: '{{ item.created_on }}'
      updated_on: '{{ item.updated_on }}'
      created_by: '{{ item.created_by }}'
      updated_by: '{{ item.updated_by }}'
- discovery_id: azure.rbac.list_for_resource_group
  calls:
  - action: list_for_resource_group
    save_as: list_for_resource_group_response
  emit:
    items_for: '{{ list_for_resource_group_response.value }}'
    as: item
    item:
      actions: '{{ item.actions }}'
      not_actions: '{{ item.not_actions }}'
      data_actions: '{{ item.data_actions }}'
      not_data_actions: '{{ item.not_data_actions }}'
- discovery_id: azure.security.list
  calls:
  - action: list
    save_as: list_response
  emit:
    items_for: '{{ list_response.value }}'
    as: item
    item:
      id: '{{ item.id }}'
      name: '{{ item.name }}'
      type: '{{ item.type }}'
      deny_assignment_name: '{{ item.deny_assignment_name }}'
      description: '{{ item.description }}'
      permissions: '{{ item.permissions }}'
      scope: '{{ item.scope }}'
      do_not_apply_to_child_scopes: '{{ item.do_not_apply_to_child_scopes }}'
      principals: '{{ item.principals }}'
      exclude_principals: '{{ item.exclude_principals }}'
      is_system_protected: '{{ item.is_system_protected }}'
      condition: '{{ item.condition }}'
      condition_version: '{{ item.condition_version }}'
      created_on: '{{ item.created_on }}'
      updated_on: '{{ item.updated_on }}'
      created_by: '{{ item.created_by }}'
      updated_by: '{{ item.updated_by }}'
checks:
- rule_id: azure.aad.identity_service_principal.access_service_account_no_user_long_lived_keys
  for_each: azure.aad.list
  conditions:
    var: item.permissions
    op: not_empty
- rule_id: azure.graph.api.365.group.creation.restriction.check
  for_each: azure.aad.list
  conditions:
    var: item.permissions
    op: contains
    value: Group.Create
- rule_id: azure.aad.user.access_user_console_password_present_only_if_required
  for_each: azure.aad.list
  conditions:
    var: item.description
    op: contains
    value: identity access user console password present only if required
- rule_id: azure.aad.directory_tenant.access_password_policy_max_age_90_days_or_less
  for_each: azure.aad.list
  conditions:
    var: item.description
    op: contains
    value: 90 Days Or Less
- rule_id: azure.aad.app_registration.access_oidc_allowed_client_ids_audiences_restricted
  for_each: azure.aad.list
  conditions:
    var: item.permissions
    op: not_empty
- rule_id: azure.aad.directory_tenant.access_password_policy_lockout_threshold_defined
  for_each: azure.aad.list
  conditions:
    var: item.description
    op: not_empty
- rule_id: azure.aad.identity_user_assigned_identity.access_instance_profile_role_attached
  for_each: azure.aad.list
  conditions:
    var: item.permissions
    op: not_empty
- rule_id: azure.entra.id.user.app.registration.disabled
  for_each: azure.aad.list
  conditions:
    var: item.operations
    op: contains
    value: DisableUserAppRegistration
- rule_id: azure.aad.directory_tenant.access_tenant_break_glass_accounts_mfa_enforced
  for_each: azure.aad.list
  conditions:
    var: item.permissions
    op: contains
    value: MFA
- rule_id: azure.entra.id.user.consent.disabled.check
  for_each: azure.aad.list
  conditions:
    var: item.permissions
    op: contains
    value: UserConsentDisabled
- rule_id: azure.aad.enterprise_application.access_saml_idp_metadata_signed
  for_each: azure.aad.list
  conditions:
    var: item.description
    op: contains
    value: saml idp metadata signed
- rule_id: azure.aad.user.access_user_access_keys_rotated_90_days_or_less_when_present
  for_each: azure.aad.list
  conditions:
    var: item.updated_on
    op: lte
    value: 90
- rule_id: azure.aad.directory_tenant.access_tenant_password_policy_compliant
  for_each: azure.aad.list
  conditions:
    var: item.description
    op: contains
    value: password policy
- rule_id: azure.aad.enterprise_application.access_saml_audience_restriction
  for_each: azure.aad.list
  conditions:
    var: item.description
    op: contains
    value: saml audience restriction
- rule_id: azure.entra.user.no_guest_accounts_with_permissions
  for_each: azure.aad.list
  conditions:
    var: item.principals
    op: not_contains
    value: Guest
- rule_id: azure.ad.group.creation.restriction.check
  for_each: azure.aad.list
  conditions:
    var: item.condition
    op: not_empty
- rule_id: azure.aad.directory_tenant.access_tenant_api_access_keys_root_or_owner_disallowed
  for_each: azure.aad.list
  conditions:
    var: item.permissions
    op: not_contains
    value:
    - Owner
    - Root
- rule_id: azure.entra.authentication.passwordless.policy.check
  for_each: azure.aad.list
  conditions:
    var: item.description
    op: contains
    value: passwordless
- rule_id: azure.entrad.group.membership.management.check
  for_each: azure.aad.list
  conditions:
    var: item.permissions
    op: not_empty
- rule_id: azure.aad.group.access_group_membership_review_enabled_where_supported
  for_each: azure.aad.list
  conditions:
    var: item.operations
    op: contains
    value: IdentityAccessGroupMembershipReview
- rule_id: azure.aad.app_registration.access_oidc_issuer_https_and_matches_discovery
  for_each: azure.aad.list
  conditions:
    var: item.description
    op: contains
    value: https
- rule_id: azure.entra.user.with_vm_access_has_mfa:az.active_directory_user.identity_access_security_user_mfa_required
  for_each: azure.aad.list
  conditions:
    var: item.permissions
    op: contains
    value: MFA
- rule_id: azure.aad.directory_tenant.access_tenant_sso_federation_where_supported
  for_each: azure.aad.list
  conditions:
    var: item.description
    op: contains
    value: sso federation
- rule_id: azure.aad.group.access_rbac_group_no_inline_policies
  for_each: azure.aad.list
  conditions:
    var: item.permissions
    op: not_empty
- rule_id: azure.aad.user.authentication.reconfirmation.period.check
  for_each: azure.aad.list
  conditions:
    var: item.description
    op: contains
    value: authentication reconfirmation period
- rule_id: azure.ad.conditionalaccess.token.protection.check
  for_each: azure.aad.list
  conditions:
    var: item.condition
    op: not_empty
- rule_id: azure.aad.privacy_consent.access_rbac_least_privilege
  for_each: azure.aad.list
  conditions:
    var: item.permissions
    op: not_empty
- rule_id: azure.entra.user.group_membership:az.active_directory_group.identity_access_security_group_membership_review_enabled_where_supported
  for_each: azure.aad.list
  conditions:
    var: item.description
    op: contains
    value: membership review
- rule_id: azure.entra.id.policy.restrict.non.admin.tenant.creation
  for_each: azure.aad.list
  conditions:
    var: item.permissions
    op: contains
    value: RestrictNonAdminTenantCreation
- rule_id: azure.aad.identity_service_principal.access_service_account_scopes_or_roles_least_privilege
  for_each: azure.aad.list
  conditions:
    var: item.permissions
    op: not_empty
- rule_id: azure.entra.diagnostic.microsoft.graph.logs.destination.check
  for_each: azure.aad.list
  conditions:
    var: item.description
    op: contains
    value: Microsoft Graph Logs Destination Check
- rule_id: azure.aad.user.access_user_mfa_required
  for_each: azure.aad.list
  conditions:
    var: item.condition
    op: contains
    value: mfa
- rule_id: azure.entra.policy.user_consent_for_verified_apps storage_blob_public_access_level_is_disabled
    storage_ensure_azure_services_are_trusted_to_access_is_enabled:az.active_directory_user.identity_access_security_user_inactive_90_days_disabled
  for_each: azure.aad.list
  conditions:
    var: item.permissions
    op: equals
    value: Disabled
- rule_id: azure.ad.authentication.methods.policy.check
  for_each: azure.aad.list
  conditions:
    var: item.description
    op: not_empty
- rule_id: azure.entra.id.diagnostic.setting.activity.logs.configured
  for_each: azure.aad.list
  conditions:
    var: item.operations
    op: not_empty
- rule_id: azure.ad.password.reset.notification.check
  for_each: azure.aad.list
  conditions:
    var: item.description
    op: contains
    value: reset notification
- rule_id: azure.aad.group.access_group_no_inline_policies
  for_each: azure.aad.list
  conditions:
    var: item.description
    op: not_contains
    value: inline policy
- rule_id: azure.ad.security.lockout.duration.check
  for_each: azure.aad.list
  conditions:
    var: item.description
    op: contains
    value: lockout duration
- rule_id: azure.aad.group.access_rbac_group_external_sharing_restricted_where_supported
  for_each: azure.aad.list
  conditions:
    var: item.permissions
    op: contains
    value: restricted
- rule_id: azure.aad.group.access_rbac_group_attached_policies_not_admin_star
  for_each: azure.aad.list_for_resource_group
  conditions:
    var: item.not_actions
    op: not_contains
    value: '*/admin/*'
- rule_id: azure.aad.enterprise_application.access_saml_assertion_lifetime_reasonable
  for_each: azure.aad.list
  conditions:
    var: item.description
    op: contains
    value: saml assertion lifetime
- rule_id: azure.aad.identity_user_assigned_identity.access_instance_profile_role_policies_least_privilege
  for_each: azure.aad.list
  conditions:
    var: item.permissions
    op: not_empty
- rule_id: azure.aad.directory_tenant.access_password_policy_prevent_reuse_last_24
  for_each: azure.aad.list
  conditions:
    var: item.description
    op: contains
    value: prevent reuse last 24
- rule_id: azure.aad.identity_service_principal.access_service_account_keys_not_used_or_rotated_90_days_or_less
  for_each: azure.aad.list
  conditions:
    var: item.updated_on
    op: lte
    value: 90
- rule_id: azure.entra.policy.trusted_named_locations_exists
  for_each: azure.aad.list
  conditions:
    var: item.name
    op: not_empty
- rule_id: azure.ad.user.role.check.disabled
  for_each: azure.aad.list
  conditions:
    var: item.deny_assignment_name
    op: equals
    value: Disabled
- rule_id: azure.entra.id.user.consent.settings.verified.publishers
  for_each: azure.aad.list
  conditions:
    var: item.description
    op: contains
    value: verified publishers
- rule_id: azure.ad.role.least_privilege
  for_each: azure.aad.list
  conditions:
    var: item.permissions
    op: not_empty
- rule_id: azure.aad.user.access_user_in90_days_disabled
  for_each: azure.aad.list
  conditions:
    var: item.updated_on
    op: lte
    value: 90
- rule_id: azure.entrad.global.admin.role.check
  for_each: azure.aad.list
  conditions:
    var: item.permissions
    op: not_empty
- rule_id: azure.entra.id.custom.role.admin.privileges.check
  for_each: azure.aad.list
  conditions:
    var: item.permissions
    op: not_empty
- rule_id: azure.entra.id.mfa.enabled.for.privileged.vm.access
  for_each: azure.aad.list
  conditions:
    var: item.permissions
    op: contains
    value: MFA
- rule_id: azure.aad.enterprise_application.access_saml_certificates_not_expired
  for_each: azure.aad.list
  conditions:
    var: item.updated_on
    op: lte
    value: current_date
- rule_id: azure.aad.directory_tenant.access_tenant_console_mfa_required_org_wide
  for_each: azure.aad.list
  conditions:
    var: item.permissions
    op: contains
    value: MFA
- rule_id: azure.entra.policy.require_mfa_for_management_api:az.active_directory_tenant.identity_access_security_password_policy_require_upper_lower_number_special
  for_each: azure.aad.list
  conditions:
    var: item.permissions
    op: contains
    value: mfa
- rule_id: azure.entra.id.authentication.lockout.threshold.check
  for_each: azure.aad.list
  conditions:
    var: item.condition
    op: not_empty
- rule_id: azure.entra.id.guest.invite.restrictions.check
  for_each: azure.aad.list
  conditions:
    var: item.description
    op: contains
    value: guest invite restrictions
- rule_id: azure.aad.app_registration.access_oidc_token_lifetime_reasonable
  for_each: azure.aad.list
  conditions:
    var: item.description
    op: contains
    value: oidc token lifetime
- rule_id: azure.aad.directory_tenant.access_password_policy_require_upper_lower_number_special
  for_each: azure.aad.list
  conditions:
    var: item.description
    op: contains
    value: identity access password policy require upper lower number special
- rule_id: azure.aad.directory.password_policy_reuse_24,_azure_devops_project_no_secrets_in_variables_c87043e4
  for_each: azure.aad.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.aad.identity_user_assigned_identity.access_instance_profile_no_instance_profile_with_admin_star
  for_each: azure.aad.list
  conditions:
    var: item.permissions
    op: not_contains
    value: admin:*
- rule_id: azure.entrad.device.mfa.check
  for_each: azure.aad.list
  conditions:
    var: item.description
    op: contains
    value: MFA
- rule_id: azure.aad.directory_tenant.access_tenant_inuser_disable_threshold
  for_each: azure.aad.list
  conditions:
    var: item.condition
    op: not_empty
- rule_id: azure.aad.serverless_event_source.permissions_least_privilege
  for_each: azure.aad.list
  conditions:
    var: item.permissions
    op: not_empty
- rule_id: azure.aad.identity_service_principal.access_service_account_workload_identity_federation_used_where_supported
  for_each: azure.aad.list
  conditions:
    var: item.description
    op: contains
    value: workload identity federation
- rule_id: azure.aad.group.access_group_attached_policies_not_admin_star
  for_each: azure.aad.list
  conditions:
    var: item.permissions
    op: not_contains
    value: admin:*
- rule_id: azure.entrad.password.policy.custom.banned.list.enforced
  for_each: azure.aad.list
  conditions:
    var: item.description
    op: contains
    value: custom banned list
- rule_id: azure.ad.guest.user.access.restriction.check
  for_each: azure.aad.list
  conditions:
    var: item.permissions
    op: not_empty
- rule_id: azure.aad.directory_tenant.access_password_policy_min_length_14
  for_each: azure.aad.list
  conditions:
    var: item.description
    op: contains
    value: min length 14
- rule_id: azure.ad.tenant.creator.role.review
  for_each: azure.aad.list
  conditions:
    var: item.description
    op: contains
    value: creator role review
- rule_id: azure.aad.user.access_user_no_inline_policies_attached
  for_each: azure.aad.list
  conditions:
    var: item.permissions
    op: not_contains
    value: inline
- rule_id: azure.aad.app_registration.access_oidc_thumbprints_or_jwks_pinning
  for_each: azure.aad.list
  conditions:
    var: item.description
    op: not_empty
- rule_id: azure.config.policy.cis_7_16_needs_development
  for_each: azure.config.list
  conditions:
    var: item.description
    op: contains
    value: cis 7 16 needs development
- rule_id: azure.iam.role.assignment.privileged.review
  for_each: azure.iam.list
  conditions:
    var: item.permissions
    op: not_empty
- rule_id: azure.iam.policy.cis_2_4_needs_development
  for_each: azure.iam.list
  conditions:
    var: item.description
    op: contains
    value: cis 2 4 needs development
- rule_id: azure.iam.role.has_permissions_to_administer_resource_locks
  for_each: azure.iam.list
  conditions:
    var: item.operations
    op: contains
    value: Microsoft.Authorization/locks/*
- rule_id: azure.iam.policy.cis_5_18_needs_development
  for_each: azure.iam.list
  conditions:
    var: item.description
    op: contains
    value: cis 5 18 needs development
- rule_id: azure.iam.policy.cis_5_25_needs_development
  for_each: azure.iam.list
  conditions:
    var: item.description
    op: contains
    value: cis 5 25 needs development
- rule_id: azure.iam.policy.cis_5_3_7_needs_development
  for_each: azure.iam.list
  conditions:
    var: item.description
    op: contains
    value: cis 5 3 7
- rule_id: azure.iam.user.access.admin.check
  for_each: azure.iam.list
  conditions:
    var: item.permissions
    op: not_empty
- rule_id: azure.policy.assignment.governance_config_recorder_global_resource_types_tracked
  for_each: azure.policy.list
  conditions:
    var: item.resource_types
    op: not_empty
- rule_id: azure.policy.definition.identity_access_rbac_conditions_used_where_applicable
  for_each: azure.policy.list
  conditions:
    var: item.condition
    op: not_empty
- rule_id: azure.policy.remediation_task.configuration_management_config_remediation_auto_remediation_enabled_for_high
  for_each: azure.policy.list
  conditions:
    var: item.description
    op: contains
    value: auto remediation enabled for high
- rule_id: azure.policy.definition.identity_access_rbac_resource_constraints_present
  for_each: azure.policy.list
  conditions:
    var: item.permissions
    op: not_empty
- rule_id: azure.policy.registry_lifecycle_policy.supply_chain_lifecycle_policy_policy_storage_encrypted
  for_each: azure.policy.list
  conditions:
    var: item.description
    op: contains
    value: encrypted
- rule_id: azure.policy.definition.governance_editors_rbac_least_privilege
  for_each: azure.policy.list
  conditions:
    var: item.permissions
    op: not_empty
- rule_id: azure.policy.compliance.configuration_management_config_drift_alerts_configured
  for_each: azure.policy.list
  conditions:
    var: item.description
    op: contains
    value: config drift alerts configured
- rule_id: azure.policy.set_definition.governance_aggregator_org_aggregator_enabled
  for_each: azure.policy.list
  conditions:
    var: item.description
    op: contains
    value: governance aggregator org aggregator enabled
- rule_id: azure.policy.definition.governance_scp_mandatory_deny_iam_star_admin
  for_each: azure.policy.list
  conditions:
    var: item.deny_assignment_name
    op: equals
    value: Governance Scp Mandatory Deny IAM Star Admin
- rule_id: azure.policy.assignment.configuration_management_config_recorder_enabled
  for_each: azure.policy.list
  conditions:
    var: item.description
    op: contains
    value: Configuration Management Config Recorder Enabled
- rule_id: azure.policy.registry_policy.supply_chain_no_wildcard_admin
  for_each: azure.policy.list
  conditions:
    var: item.permissions
    op: not_contains
    value: '*'
- rule_id: azure.policy.rule.governance_config_remediation_targets_bound
  for_each: azure.policy.list
  conditions:
    var: item.condition
    op: not_empty
- rule_id: azure.policy.assignment.enabled
  for_each: azure.policy.list
  conditions:
    var: item.type
    op: equals
    value: Enabled
- rule_id: azure.policy.definition.governance_scp_no_allow_star_on_star_resources
  for_each: azure.policy.list_for_resource_group
  conditions:
    var: item.not_actions
    op: not_empty
- rule_id: azure.policy.rule.configuration_management_config_required_rules_present
  for_each: azure.policy.list
  conditions:
    var: item.condition
    op: not_empty
- rule_id: azure.policy.rule.configuration_management_config_remediation_targets_bound
  for_each: azure.policy.list
  conditions:
    var: item.condition
    op: not_empty
- rule_id: azure.policy.definition.identity_access_rbac_no_action_star_on_resource_star
  for_each: azure.policy.list_for_resource_group
  conditions:
    var: item.not_actions
    op: not_empty
- rule_id: azure.policy.registry_policy.supply_chain_no_public_pull_push
  for_each: azure.policy.list
  conditions:
    var: item.description
    op: contains
    value: supply chain no public pull push
- rule_id: azure.policy.assignment.check.disabled.effect
  for_each: azure.policy.list
  conditions:
    var: item.condition
    op: contains
    value: disabled
- rule_id: azure.policy.assignment.governance_config_recorder_enabled
  for_each: azure.policy.list
  conditions:
    var: item.description
    op: contains
    value: Governance Config Recorder Enabled
- rule_id: azure.policy.definition.governance_scp_mandatory_block_disabling_guardrail_services
  for_each: azure.policy.list
  conditions:
    var: item.deny_assignment_name
    op: not_empty
- rule_id: azure.policy.assignment.governance_aggregation_authorization_not_expired_or_revoked
  for_each: azure.policy.list
  conditions:
    var: item.permissions
    op: not_empty
- rule_id: azure.policy.definition.governance_no_wildcard_admin_actions
  for_each: azure.policy.list_for_resource_group
  conditions:
    var: item.not_actions
    op: not_empty
- rule_id: azure.policy.definition.governance_versioning_and_change_audit_enabled
  for_each: azure.policy.list
  conditions:
    var: item.description
    op: contains
    value: governance versioning and change audit enabled
- rule_id: azure.policy.set_definition.configuration_management_config_baseline_parameters_set
  for_each: azure.policy.list
  conditions:
    var: item.description
    op: contains
    value: configuration management config baseline parameters set
- rule_id: azure.policy.rule.governance_config_required_rules_present
  for_each: azure.policy.list
  conditions:
    var: item.condition
    op: not_empty
- rule_id: azure.policy.assignment.configuration_management_config_aggregation_org_aggregator_enabled
  for_each: azure.policy.list
  conditions:
    var: item.description
    op: contains
    value: config aggregation org aggregator enabled
- rule_id: azure.policy.compliance_assessment.configuration_management_config_compliance_evidence_export_configured
  for_each: azure.policy.list
  conditions:
    var: item.description
    op: contains
    value: configuration management config compliance evidence export configured
- rule_id: azure.policy.set_definition.governance_aggregator_auto_enroll_new_accounts
  for_each: azure.policy.list
  conditions:
    var: item.description
    op: contains
    value: Governance Aggregator Auto Enroll New Accounts
- rule_id: azure.policy.assignment.governance_aggregation_authorization_trusts_least_privilege
  for_each: azure.policy.list
  conditions:
    var: item.permissions
    op: equals
    value: least_privilege
- rule_id: azure.policy.assignment.configuration_management_config_aggregation_auto_enroll_new_accounts
  for_each: azure.policy.list
  conditions:
    var: item.description
    op: contains
    value: auto enroll new accounts
- rule_id: azure.policy.rule.configuration_management_config_rules_enabled
  for_each: azure.policy.list
  conditions:
    var: item.condition
    op: not_empty
- rule_id: azure.policy.definition.identity_access_rbac_no_policy_allows_without_constraints
  for_each: azure.policy.list
  conditions:
    var: item.permissions
    op: not_empty
- rule_id: azure.policy.assignment.configuration_management_config_delivery_secure_destination_configured
  for_each: azure.policy.list
  conditions:
    var: item.condition
    op: not_empty
- rule_id: azure.policy.definition.configuration_management_config_delivery_destination_access_least_privilege
  for_each: azure.policy.list
  conditions:
    var: item.permissions
    op: not_empty
- rule_id: azure.policy.remediation_task.configuration_management_config_remediation_manual_runbooks_attached
  for_each: azure.policy.list
  conditions:
    var: item.description
    op: not_empty
- rule_id: azure.policy.definition.governance_scp_mandatory_require_mfa_for_console_where_supported
  for_each: azure.policy.list
  conditions:
    var: item.condition
    op: contains
    value: MFA
- rule_id: azure.policy.assignment.configuration_management_config_recorder_global_resource_types_tracked
  for_each: azure.policy.list
  conditions:
    var: item.resource_types
    op: not_empty
- rule_id: azure.policy.assignment.governance_aggregation_authorization_target_accounts_correct
  for_each: azure.policy.list
  conditions:
    var: item.permissions
    op: not_empty
- rule_id: azure.policy.assignment.governance_delivery_channel_secure_destination_configured
  for_each: azure.policy.list
  conditions:
    var: item.condition
    op: not_empty
- rule_id: azure.policy.rule.governance_config_rules_enabled
  for_each: azure.policy.list
  conditions:
    var: item.condition
    op: not_empty
- rule_id: azure.policy.compliance_assessment.configuration_management_config_compliance_reporting_dashboards_enabled
  for_each: azure.policy.list
  conditions:
    var: item.description
    op: contains
    value: configuration management config compliance reporting dashboards enabled
- rule_id: azure.policy.compliance.configuration_management_config_drift_critical_resources_drift_detection_enabled
  for_each: azure.policy.list
  conditions:
    var: item.condition
    op: equals
    value: Enabled
- rule_id: azure.policy.assignment.governance_delivery_channel_destination_access_least_privilege
  for_each: azure.policy.list
  conditions:
    var: item.permissions
    op: not_empty
- rule_id: azure.policy.registry_lifecycle_policy.supply_chain_lifecycle_policy_unused_or_old_tags_expire
  for_each: azure.policy.list
  conditions:
    var: item.description
    op: contains
    value: supply chain lifecycle policy unused or old tags expire
- rule_id: azure.policy.assignment.asc_enforcement_enabled
  for_each: azure.policy.list
  conditions:
    var: item.description
    op: contains
    value: asc enforcement enabled
- rule_id: azure.policy.assignment.recorder_all_regions_enabled
  for_each: azure.policy.list
  conditions:
    var: item.description
    op: contains
    value: recorder all regions enabled
- rule_id: azure.policy.set_definition.governance_aggregation_authorization_present_and_valid
  for_each: azure.policy.list
  conditions:
    var: item.permissions
    op: not_empty
- rule_id: azure.policy.set_definition.configuration_management_config_baseline_conformance_pack_deployed
  for_each: azure.policy.list
  conditions:
    var: item.description
    op: contains
    value: Configuration Management Config Baseline Conformance Pack Deployed
- rule_id: azure.policy.definition.configuration_management_config_delivery_kms_encryption_enabled
  for_each: azure.policy.list
  conditions:
    var: item.description
    op: contains
    value: KMS Encryption Enabled
- rule_id: azure.policy.assignment.governance_delivery_channel_kms_encryption_enabled
  for_each: azure.policy.list
  conditions:
    var: item.condition
    op: contains
    value: kms_encryption
- rule_id: azure.rbac.role_definition.identity_access_role_trust_principals_allowlist_only
  for_each: azure.rbac.list
  conditions:
    var: item.principals
    op: not_empty
- rule_id: azure.rbac.vulnerability_automation.vuln_automation_execution_roles_least_privilege
  for_each: azure.rbac.list
  conditions:
    var: item.permissions
    op: not_empty
- rule_id: azure.rbac.role.resource.lock.check
  for_each: azure.rbac.list
  conditions:
    var: item.deny_assignment_name
    op: not_empty
- rule_id: azure.rbac.vulnerability_maintenance.vuln_maintenance_execution_roles_least_privilege
  for_each: azure.rbac.list
  conditions:
    var: item.permissions
    op: not_empty
- rule_id: azure.rbac.role_definition.identity_access_role_trust_requires_external_id_or_audience_condition_where_supported
  for_each: azure.rbac.list
  conditions:
    var: item.condition
    op: not_empty
- rule_id: azure.rbac.serverless_provisioned_concurrency.serverless_prov_conc_execution_role_least_privilege
  for_each: azure.rbac.list
  conditions:
    var: item.permissions
    op: not_empty
- rule_id: azure.rbac.role_definition.identity_access_role_attached_policies_not_admin_star
  for_each: azure.rbac.list_for_resource_group
  conditions:
    var: item.not_actions
    op: not_contains
    value: '*'
- rule_id: azure.rbac.role_definition.identity_access_role_session_duration_reasonable_where_applicable
  for_each: azure.rbac.list
  conditions:
    var: item.description
    op: contains
    value: session duration
- rule_id: azure.rbac.role_definition.identity_access_role_no_inline_policies
  for_each: azure.rbac.list
  conditions:
    var: item.permissions
    op: not_empty
- rule_id: azure.rbac.role_definition.identity_access_role_max_session_duration_reasonable
  for_each: azure.rbac.list
  conditions:
    var: item.description
    op: contains
    value: max session duration
- rule_id: azure.security.defender.dns_protection_enabled
  for_each: azure.security.list
  conditions:
    var: item.name
    op: equals
    value: DefenderForDns
- rule_id: azure.security.center_vulnerability_assessment.vuln_assessment_policy_store_encrypted
  for_each: azure.security.list
  conditions:
    var: item.description
    op: contains
    value: encrypted
- rule_id: azure.defender.fim.status.check
  for_each: azure.security.list
  conditions:
    var: item.description
    op: contains
    value: status check
- rule_id: azure.security.threat_ip_set.used_by_detectors
  for_each: azure.security.list
  conditions:
    var: item.description
    op: not_empty
- rule_id: azure.security.paas_app.tls_min_1_2_enforced
  for_each: azure.security.list
  conditions:
    var: item.description
    op: contains
    value: TLS Min 1 2 Enforced
- rule_id: azure.security.center_alert.incident_response_versioning_and_immutability_enabled
  for_each: azure.security.list
  conditions:
    var: item.description
    op: contains
    value: versioning and immutability
- rule_id: azure.security.defender.cosmos_protection_enabled
  for_each: azure.security.list
  conditions:
    var: item.name
    op: equals
    value: DefenderForCosmosDB
- rule_id: azure.defender.for.containers.pricing.tier.and.extensions.enabled
  for_each: azure.security.list
  conditions:
    var: item.type
    op: equals
    value: Enabled
- rule_id: azure.security.defender.sql_databases_protection_enabled
  for_each: azure.security.list
  conditions:
    var: item.type
    op: equals
    value: Microsoft.Security/sqlVulnerabilityAssessments
- rule_id: azure.security.center.vulnerability_assessment_enabled
  for_each: azure.security.list
  conditions:
    var: item.type
    op: equals
    value: Enabled
- rule_id: azure.security.defender.system_updates_applied
  for_each: azure.security.list
  conditions:
    var: item.operations
    op: contains
    value: Ensure System Updates Are Applied
- rule_id: azure.security.serverless_layer.source_trusted
  for_each: azure.security.list
  conditions:
    var: item.description
    op: contains
    value: source trusted
- rule_id: azure.defender.email.notifications.attack.paths.enabled
  for_each: azure.security.list
  conditions:
    var: item.description
    op: contains
    value: notifications attack paths enabled
- rule_id: azure.defender.app.services_is_on
  for_each: azure.security.list
  conditions:
    var: item.operations
    op: not_empty
- rule_id: azure.security.paas_application_version.paas_app_version_immutable
  for_each: azure.security.list
  conditions:
    var: item.description
    op: contains
    value: immutable
- rule_id: azure.security.threat_custom_identifier.source_trusted
  for_each: azure.security.list
  conditions:
    var: item.condition
    op: not_empty
- rule_id: azure.security.defender.for.apis.pricing.tier.standard
  for_each: azure.security.list
  conditions:
    var: item.name
    op: equals
    value: Standard
- rule_id: azure.security.defender.mcas_enabled
  for_each: azure.security.list
  conditions:
    var: item.name
    op: contains
    value: mcas
- rule_id: azure.security.center_alert.incident_response_storage_encrypted_and_private
  for_each: azure.security.list
  conditions:
    var: item.type
    op: equals
    value: Encrypted
- rule_id: azure.security.center_detector.threat_detector_enabled_in_all_regions
  for_each: azure.security.list
  conditions:
    var: item.operations
    op: contains
    value: ThreatDetectorEnabled
- rule_id: azure.security.center_alert.incident_response_access_rbac_least_privilege
  for_each: azure.security.list
  conditions:
    var: item.permissions
    op: not_empty
- rule_id: azure.aad.lustre.filesystem_customer_managed_key_enabled
  for_each: azure.security.list
  conditions:
    var: item.description
    op: contains
    value: customer managed key
- rule_id: azure.security.defender.databases_protection_enabled
  for_each: azure.security.list
  conditions:
    var: item.name
    op: equals
    value: DefenderForDatabases
- rule_id: azure.defender.vulnerability.assessment.status.check
  for_each: azure.security.list
  conditions:
    var: item.description
    op: contains
    value: assessment status check
- rule_id: azure.security.defender.high_severity_alerts_enabled
  for_each: azure.security.list
  conditions:
    var: item.description
    op: contains
    value: high
- rule_id: azure.security.center_patch_management.vuln_patch_baseline_defined_for_os_families
  for_each: azure.security.list
  conditions:
    var: item.description
    op: contains
    value: vuln patch baseline defined for os families
- rule_id: azure.defender.vm.os.updates.configured
  for_each: azure.security.list
  conditions:
    var: item.operations
    op: contains
    value: Update
- rule_id: azure.security.defender.iot_hub_protection_enabled
  for_each: azure.security.list
  conditions:
    var: item.type
    op: equals
    value: Microsoft.Security/iotSecuritySolutions
- rule_id: azure.security.defender.arm_protection_enabled
  for_each: azure.security.list
  conditions:
    var: item.name
    op: equals
    value: DefenderForArm
- rule_id: azure.security.center_patch_management.vuln_patch_approval_rules_defined
  for_each: azure.security.list
  conditions:
    var: item.operations
    op: not_empty
- rule_id: azure.security.center_baseline.vuln_baseline_exemptions_have_expiry_and_owner
  for_each: azure.security.list
  conditions:
    var: item.updated_on
    op: not_empty
- rule_id: azure.security.defender.container_vulnerabilities_resolved
  for_each: azure.security.list
  conditions:
    var: item.description
    op: contains
    value: container images resolved vulnerabilities
- rule_id: azure.defender.cspm.pricing.tier.standard.check
  for_each: azure.security.list
  conditions:
    var: item.type
    op: equals
    value: Standard
- rule_id: azure.defender.email.notifications.owner.check
  for_each: azure.security.list
  conditions:
    var: item.description
    op: not_empty
- rule_id: azure.security.threat_ip_set.sources_trusted
  for_each: azure.security.list
  conditions:
    var: item.description
    op: contains
    value: sources trusted
- rule_id: azure.security.center_finding.threat_finding_archival_export_encrypted
  for_each: azure.security.list
  conditions:
    var: item.description
    op: contains
    value: encrypted
- rule_id: azure.security.defender.servers_protection_enabled
  for_each: azure.security.list
  conditions:
    var: item.type
    op: equals
    value: Enabled
- rule_id: azure.security.defender.additional_email_configured
  for_each: azure.security.list
  conditions:
    var: item.description
    op: not_empty
- rule_id: azure.security.privacy_encryption.at_rest_cmek_enabled
  for_each: azure.security.list
  conditions:
    var: item.description
    op: contains
    value: at rest cmek enabled
- rule_id: azure.defender.app.services.status.check
  for_each: azure.security.list
  conditions:
    var: item.operations
    op: not_empty
- rule_id: azure.security.defender.notify_owners_enabled
  for_each: azure.security.list
  conditions:
    var: item.description
    op: contains
    value: Notify Emails To Owners
- rule_id: azure.security.center_finding.threat_finding_suppression_rules_documented_and_scoped
  for_each: azure.security.list
  conditions:
    var: item.description
    op: not_empty
- rule_id: azure.defender.resource.manager.pricing.standard.check
  for_each: azure.security.list
  conditions:
    var: item.description
    op: contains
    value: manager pricing standard check
- rule_id: azure.security.center.no_high_severity_findings
  for_each: azure.security.list
  conditions:
    var: item.description
    op: contains
    value: no high severity findings
- rule_id: azure.security.center_detector.threat_detector_finding_export_encrypted_destination
  for_each: azure.security.list
  conditions:
    var: item.description
    op: contains
    value: encrypted
- rule_id: azure.security.center_baseline.vuln_baseline_required_controls_present
  for_each: azure.security.list
  conditions:
    var: item.operations
    op: not_empty
- rule_id: azure.security.defender.log_analytics_agent_auto_provisioning
  for_each: azure.security.list
  conditions:
    var: item.name
    op: equals
    value: AutoProvisioningLogAnalyticsAgentVMsOn
- rule_id: azure.security.privacy_encryption.in_transit_tls_min_1_2
  for_each: azure.security.list
  conditions:
    var: item.description
    op: contains
    value: TLS Min 1 2
- rule_id: azure.defender.open.source.relational.databases.enabled
  for_each: azure.security.list
  conditions:
    var: item.name
    op: equals
    value: azure.defender.open.source.relational.databases.enabled
- rule_id: azure.security.vulnerability_maintenance.vuln_maintenance_window_defined
  for_each: azure.security.list
  conditions:
    var: item.description
    op: not_empty
- rule_id: azure.security.defender.vulnerability_assessment_auto_provisioning
  for_each: azure.security.list
  conditions:
    var: item.operations
    op: contains
    value: AutoProvisioning
- rule_id: azure.defender.email.notifications.severity.check
  for_each: azure.security.list
  conditions:
    var: item.description
    op: contains
    value: severity
- rule_id: azure.security.defender.containers_protection_enabled
  for_each: azure.security.list
  conditions:
    var: item.name
    op: equals
    value: DefenderForContainers
- rule_id: azure.defender.sql.server.pricing.tier.check
  for_each: azure.security.list
  conditions:
    var: item.type
    op: equals
    value: Microsoft.Sql/servers
- rule_id: azure.security.platform_usage_plan.rate_limits
  for_each: azure.security.list
  conditions:
    var: item.operations
    op: not_empty
- rule_id: azure.security.defender.wdatp_enabled
  for_each: azure.security.list
  conditions:
    var: item.name
    op: equals
    value: WdatpEnabled
- rule_id: azure.security.defender.keyvault_protection_enabled
  for_each: azure.security.list
  conditions:
    var: item.name
    op: equals
    value: DefenderForKeyVault
- rule_id: azure.security.defender.sql_servers_protection_enabled
  for_each: azure.security.list
  conditions:
    var: item.type
    op: equals
    value: Microsoft.Security/sqlServers
- rule_id: azure.security.storage.defender.pricing.check
  for_each: azure.security.list
  conditions:
    var: item.name
    op: equals
    value: Defender Pricing Check
- rule_id: azure.security.defender.relational_db_protection_enabled
  for_each: azure.security.list
  conditions:
    var: item.name
    op: equals
    value: azure.security.defender.relational_db_protection_enabled
- rule_id: azure.security.center_vulnerability_scan.vuln_scan_agents_or_scanners_deployed
  for_each: azure.security.list
  conditions:
    var: item.operations
    op: not_empty
- rule_id: azure.defender.vm.endpoint_protection_installed
  for_each: azure.security.list
  conditions:
    var: item.operations
    op: contains
    value: EndpointProtection
- rule_id: azure.security.threat_hub.master_member
  for_each: azure.security.list
  conditions:
    var: item.description
    op: not_empty
- rule_id: azure.defender.for.cloud.endpoint.protection.status.check
  for_each: azure.security.list
  conditions:
    var: item.description
    op: contains
    value: endpoint protection
- rule_id: azure.defender.agentless.scanning.status.check
  for_each: azure.security.list
  conditions:
    var: item.description
    op: contains
    value: scanning status check
- rule_id: azure.security.serverless_layer.version_immutable
  for_each: azure.security.list
  conditions:
    var: item.name
    op: exists
- rule_id: azure.defender.storage.alerts.export.enabled
  for_each: azure.security.list
  conditions:
    var: item.operations
    op: contains
    value: export
- rule_id: azure.security.center.guardduty_enabled
  for_each: azure.security.list
  conditions:
    var: item.type
    op: equals
    value: Enabled
- rule_id: azure.security.center_vulnerability_assessment.vuln_assessment_roles_least_privilege
  for_each: azure.security.list
  conditions:
    var: item.permissions
    op: not_empty
- rule_id: azure.security.center_vulnerability_scan.vuln_scan_scope_includes_all_asset_groups
  for_each: azure.security.list
  conditions:
    var: item.scope
    op: not_empty
- rule_id: azure.security.center.enabled
  for_each: azure.security.list
  conditions:
    var: item.type
    op: equals
    value: Enabled
- rule_id: azure.security.serverless_event_source.source_authenticated
  for_each: azure.security.list
  conditions:
    var: item.permissions
    op: not_empty
- rule_id: azure.security.center.exploit_guard_enabled
  for_each: azure.security.list
  conditions:
    var: item.description
    op: contains
    value: exploit guard enabled
- rule_id: azure.security.defender.no_high_severity_findings
  for_each: azure.security.list
  conditions:
    var: item.description
    op: not_contains
    value: High Severity
- rule_id: azure.security.platform_usage_plan.quota_limits
  for_each: azure.security.list
  conditions:
    var: item.operations
    op: not_empty
- rule_id: azure.security.center_vulnerability_scan.vuln_scan_results_export_destination_encrypted
  for_each: azure.security.list
  conditions:
    var: item.description
    op: contains
    value: encrypted
- rule_id: azure.security.threat_hub.auto_enroll_new_accounts
  for_each: azure.security.list
  conditions:
    var: item.operations
    op: contains
    value: auto_enroll
- rule_id: azure.security.defender.enabled
  for_each: azure.security.list
  conditions:
    var: item.type
    op: equals
    value: Enabled
- rule_id: azure.security.center_patch_management.vuln_patch_maintenance_windows_configured
  for_each: azure.security.list
  conditions:
    var: item.description
    op: contains
    value: vuln patch maintenance windows configured
- rule_id: azure.security.defender.container_scan_enabled
  for_each: azure.security.list
  conditions:
    var: item.operations
    op: contains
    value: ContainerScan
- rule_id: azure.security.defender.server_protection_enabled
  for_each: azure.security.list
  conditions:
    var: item.type
    op: equals
    value: Microsoft.Security/defenderForServers
- rule_id: azure.security.center_finding.threat_finding_alert_destinations_configured
  for_each: azure.security.list
  conditions:
    var: item.operations
    op: not_empty
- rule_id: azure.defender.for.servers.pricing.tier.standard.check
  for_each: azure.security.list
  conditions:
    var: item.name
    op: equals
    value: azure.defender.for.servers.pricing.tier.standard.check
- rule_id: azure.defender.for.cloud.security.contact.email.check
  for_each: azure.security.list
  conditions:
    var: item.description
    op: not_empty
