version: '1.0'
provider: azure
service: mysql
discovery:
- discovery_id: azure.mysql.list
  calls:
  - action: list
    save_as: list_response
  emit:
    items_for: '{{ list_response.value }}'
    as: item
    item:
      name: '{{ item.name }}'
      display: '{{ item.display }}'
      origin: '{{ item.origin }}'
      properties: '{{ item.properties }}'
checks:
- rule_id: azure.mysql.flexibleserver.minimum_tls_version_12
  for_each: azure.mysql.list
  conditions:
    var: item.properties
    op: contains
    value: TLS1_2
- rule_id: azure.mysql.server.audit.log.connection.check
  for_each: azure.mysql.list
  conditions:
    var: item.id
    op: not_empty
- rule_id: azure.mysql.server.audit.log.enabled
  for_each: azure.mysql.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.mysql.flexibleserver.audit_log_enabled
  for_each: azure.mysql.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.mysql.flexibleserver.ssl_connection_enabled
  for_each: azure.mysql.list
  conditions:
    var: item.properties
    op: contains
    value: SSL
- rule_id: azure.mysql.flexibleserver.audit_log_connection_enabled
  for_each: azure.mysql.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.mysql.standard.database.ssl.enforcement.check
  for_each: azure.mysql.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.mysql.server.geo_redundant_backup
  for_each: azure.mysql.list
  conditions:
    var: item.properties
    op: gt
    value: 0
