# ============================================================================
# ü§ñ CURSOR AI: SERVICE VALIDATION INSTRUCTIONS
# ============================================================================
# 
# SERVICE: mysql
# STATUS: ‚è≥ NOT_VALIDATED
#
# üéØ YOUR TASK:
# 1. Run engine: export AZURE_ENGINE_FILTER_SERVICES="mysql" && python engine/azure_generic_engine.py > /tmp/test_mysql.json 2>&1
# 2. Analyze: tail -100 /tmp/test_mysql.json
# 3. Fix issues below in discovery/checks sections
# 4. Re-run until: inventory has resources (if exist), checks = PASS/FAIL (not ERROR)
# 5. Mark complete at bottom
#
# ‚ùå COMMON ISSUES & FIXES:
#
# "Failed to create client" ‚Üí 
#   Fix sdk_package: azure.mgmt.mysql (use DOTS not dashes)
#   Install: pip install azure-mgmt-mysql
#
# "Action not found: X.list" ‚Üí
#   Test in Python:
#     from azure.mgmt.mysql import *
#     client = <Client>(cred, sub_id)
#     print(dir(client.<resource>))  # Find correct method
#   Common: list_by_subscription, list_all, list_by_resource_group
#
# "ERROR" in checks ‚Üí
#   Check resource structure in output
#   Fix field paths: properties.encryption.keySource
#   Fix params: add resource_group_name, account_name, etc.
#
# Empty inventory ‚Üí
#   Create test resource: az <service> <resource> create ...
#   OR verify action name is correct
#
# ‚úÖ SUCCESS WHEN:
# - No warnings
# - Inventory populated (if resources exist)  
# - Checks = PASS/FAIL (not ERROR)
# - JSON is clean objects (not strings)
#
# üìù AFTER FIXING:
# Mark status below as VALIDATED and add notes at bottom
#
# ============================================================================

mysql:
  version: '1.0'
  provider: azure
  service: mysql
  package: azure-mgmt-rdbms
  client_class: MySQLManagementClient
  scope: subscription
  discovery:
  - discovery_id: azure.mysql.servers
    calls:
    - client: mysql
      action: servers.list
      save_as: servers
  - discovery_id: azure.mysql.flexible_servers
    calls:
    - client: mysql
      action: flexible_servers.list
      save_as: flexible_servers
  - discovery_id: azure.mysql.configurations
    calls:
    - client: mysql
      action: configurations.list_by_server
      save_as: configurations
  checks:
  - check_id: azure.mysql.flexibleserver.minimum_tls_version_12
    title: 'AZURE MYSQL Flexibleserver: Minimum TLS Version 12'
    severity: medium
    for_each: azure.mysql.flexible_servers
    calls:
    - action: flexible_servers.get
      params:
        resource_group_name: '{{resource_group}}'
        server_name: '{{name}}'
      fields:
      - path: version
        operator: gte
        expected: '8.0'
      - path: network.require_ssl
        operator: equals
        expected: Enabled
  - check_id: azure.mysql.server.audit.log.connection.check
    title: 'AZURE MYSQL Server: Audit Log Connection Check'
    severity: medium
    for_each: azure.mysql.servers
    calls:
    - action: configurations.get
      params:
        resource_group_name: '{{resource_group}}'
        server_name: '{{name}}'
        configuration_name: audit_log_connection_policy_actions
      fields:
      - path: value
        operator: exists
  - check_id: azure.mysql.server.audit.log.enabled
    title: 'AZURE MYSQL Server: Audit Log Enabled'
    severity: medium
    for_each: azure.mysql.servers
    calls:
    - action: configurations.get
      params:
        resource_group_name: '{{resource_group}}'
        server_name: '{{name}}'
        configuration_name: audit_log_enabled
      fields:
      - path: value
        operator: equals
        expected: 'ON'
  - check_id: azure.mysql.flexibleserver.audit_log_enabled
    title: 'AZURE MYSQL Flexibleserver: Audit Log Enabled'
    severity: medium
    for_each: azure.mysql.flexible_servers
    calls:
    - action: flexible_server_configurations.get
      params:
        resource_group_name: '{{resource_group}}'
        server_name: '{{name}}'
        configuration_name: audit_log_enabled
      fields:
      - path: value
        operator: equals
        expected: 'ON'
  - check_id: azure.mysql.flexibleserver.ssl_connection_enabled
    title: 'AZURE MYSQL Flexibleserver: SSL Connection Enabled'
    severity: medium
    for_each: azure.mysql.flexible_servers
    calls:
    - action: flexible_servers.get
      params:
        resource_group_name: '{{resource_group}}'
        server_name: '{{name}}'
      fields:
      - path: network.require_ssl
        operator: equals
        expected: Enabled
  - check_id: azure.mysql.server.geo_redundant_backup
    title: 'AZURE MYSQL Resource: Geo Redundant Backup'
    severity: medium
    for_each: azure.mysql.resource
    calls:
    - action: self
      fields:
      - path: properties.storage_profile.geo_redundant_backup
        operator: equals
        expected: Enabled
  - check_id: azure.mysql.flexibleserver.audit_log_connection_enabled
    title: 'AZURE MYSQL Resource: Flexible Server Audit Log Connection Activated'
    severity: medium
    for_each: azure.mysql.resource
    calls:
    - action: self
      fields:
      - path: properties.configurations.audit_log_connection
        operator: equals
        expected: 'ON'
  - check_id: azure.mysql.standard.database.ssl.enforcement.check
    title: 'AZURE MYSQL Standard: Database SSL Enforcement Check'
    severity: medium
    for_each: azure.mysql.standard
    calls:
    - action: self
      fields:
      - path: ssl_enforcement
        operator: equals
        expected: Enabled


# ============================================================================
# VALIDATION TRACKING
# ============================================================================
# STATUS: ‚è≥ NOT_VALIDATED
# VALIDATED_BY: 
# VALIDATED_DATE: 
# 
# FIXES APPLIED:
# # - (Add fixes here after validation)
#
# TEST RESULTS:
# - Resources Discovered: 0
# - Checks Executed: 0
# - PASS: 0
# - FAIL: 0
# - ERROR: 0
#
# NOTES:
# # - (Add notes here)
# ============================================================================
