netappfiles:
  version: '1.0'
  provider: azure
  service: netappfiles
  package: azure-mgmt-netapp
  client_class: NetAppManagementClient
  scope: subscription
  discovery:
  - discovery_id: azure.netappfiles.accounts
    calls:
    - client: netappfiles
      action: accounts.list
      save_as: accounts
  - discovery_id: azure.netappfiles.pools
    calls:
    - client: netappfiles
      action: pools.list
      save_as: pools
  - discovery_id: azure.netappfiles.volumes
    calls:
    - client: netappfiles
      action: volumes.list
      save_as: volumes
  - discovery_id: azure.netappfiles.snapshots
    calls:
    - client: netappfiles
      action: snapshots.list
      save_as: snapshots
  - discovery_id: azure.netappfiles.backups
    calls:
    - client: netappfiles
      action: backups.list
      save_as: backups
  checks:
  - check_id: azure.netappfiles.encryption.key.source.cmk.check
    title: 'AZURE NETAPPFILES Encryption: Key Source CMK Check'
    severity: high
    for_each: azure.netappfiles.volumes
    calls:
    - action: self
      fields:
      - path: encryption_key_source
        operator: equals
        expected: Microsoft.KeyVault
