devops:
  version: '1.0'
  provider: azure
  service: devops
  package: azure-devops
  client_class: DevOpsClient
  scope: subscription
  discovery:
  - discovery_id: azure.devops.projects
    calls:
    - client: devops
      action: projects.list_all
      save_as: projects
  checks:
  - check_id: azure.devops.project.source.repo.url.no.sensitive.credentials,.azure.devops.project.no.secrets.in.variables
    title: 'AZURE DEVOPS Project: Source Repo Url No Sensitive Credentials, Azure Devops Project No Secrets In Variables'
    severity: high
    for_each: azure.devops.project
    calls:
    - action: git_client.get_repositories
      fields:
      - path: value[*].remoteUrl
        operator: not_regex
        expected: ://[^@/]*:[^@/]*@
    - action: task_agent_client.get_variable_groups
      fields:
      - path: value[*].variables[*].isSecret
        operator: equals
        expected: false
    - action: build_client.get_definitions
      fields:
      - path: value[*].variables[*].isSecret
        operator: equals
        expected: false
    - action: release_client.get_release_definitions
      fields:
      - path: value[*].variables[*].isSecret
        operator: equals
        expected: false
