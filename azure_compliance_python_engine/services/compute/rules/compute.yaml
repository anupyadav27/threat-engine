version: '1.0'
provider: azure
service: compute
discovery:
- discovery_id: azure.compute.list
  calls:
  - action: list
    save_as: list_response
  emit:
    items_for: '{{ list_response.value }}'
    as: item
    item:
      id: '{{ item.id }}'
      name: '{{ item.name }}'
      type: '{{ item.type }}'
      system_data: '{{ item.system_data }}'
      tags: '{{ item.tags }}'
      location: '{{ item.location }}'
      sku: '{{ item.sku }}'
      platform_update_domain_count: '{{ item.platform_update_domain_count }}'
      platform_fault_domain_count: '{{ item.platform_fault_domain_count }}'
      virtual_machines: '{{ item.virtual_machines }}'
      proximity_placement_group: '{{ item.proximity_placement_group }}'
      statuses: '{{ item.statuses }}'
      scheduled_events_policy: '{{ item.scheduled_events_policy }}'
      virtual_machine_scale_set_migration_info: '{{ item.virtual_machine_scale_set_migration_info
        }}'
- discovery_id: azure.compute.list_by_resource_group
  calls:
  - action: list_by_resource_group
    save_as: list_by_resource_group_response
  emit:
    items_for: '{{ list_by_resource_group_response.value }}'
    as: item
    item:
      id: '{{ item.id }}'
      name: '{{ item.name }}'
      type: '{{ item.type }}'
      system_data: '{{ item.system_data }}'
      tags: '{{ item.tags }}'
      location: '{{ item.location }}'
      zones: '{{ item.zones }}'
      capacity_reservations: '{{ item.capacity_reservations }}'
      virtual_machines_associated: '{{ item.virtual_machines_associated }}'
      instance_view: '{{ item.instance_view }}'
      sharing_profile: '{{ item.sharing_profile }}'
      reservation_type: '{{ item.reservation_type }}'
- discovery_id: azure.databricks.list
  calls:
  - action: list
    save_as: list_response
  emit:
    items_for: '{{ list_response.value }}'
    as: item
    item:
      id: '{{ item.id }}'
      name: '{{ item.name }}'
      type: '{{ item.type }}'
      system_data: '{{ item.system_data }}'
      tags: '{{ item.tags }}'
      location: '{{ item.location }}'
      sku: '{{ item.sku }}'
      platform_update_domain_count: '{{ item.platform_update_domain_count }}'
      platform_fault_domain_count: '{{ item.platform_fault_domain_count }}'
      virtual_machines: '{{ item.virtual_machines }}'
      proximity_placement_group: '{{ item.proximity_placement_group }}'
      statuses: '{{ item.statuses }}'
      scheduled_events_policy: '{{ item.scheduled_events_policy }}'
      virtual_machine_scale_set_migration_info: '{{ item.virtual_machine_scale_set_migration_info
        }}'
- discovery_id: azure.hdinsight.list
  calls:
  - action: list
    save_as: list_response
  emit:
    items_for: '{{ list_response.value }}'
    as: item
    item:
      id: '{{ item.id }}'
      name: '{{ item.name }}'
      type: '{{ item.type }}'
      system_data: '{{ item.system_data }}'
      tags: '{{ item.tags }}'
      location: '{{ item.location }}'
      sku: '{{ item.sku }}'
      platform_update_domain_count: '{{ item.platform_update_domain_count }}'
      platform_fault_domain_count: '{{ item.platform_fault_domain_count }}'
      virtual_machines: '{{ item.virtual_machines }}'
      proximity_placement_group: '{{ item.proximity_placement_group }}'
      statuses: '{{ item.statuses }}'
      scheduled_events_policy: '{{ item.scheduled_events_policy }}'
      virtual_machine_scale_set_migration_info: '{{ item.virtual_machine_scale_set_migration_info
        }}'
- discovery_id: azure.machine.list
  calls:
  - action: list
    save_as: list_response
  emit:
    items_for: '{{ list_response.value }}'
    as: item
    item:
      id: '{{ item.id }}'
      name: '{{ item.name }}'
      type: '{{ item.type }}'
      system_data: '{{ item.system_data }}'
      tags: '{{ item.tags }}'
      location: '{{ item.location }}'
      sku: '{{ item.sku }}'
      platform_update_domain_count: '{{ item.platform_update_domain_count }}'
      platform_fault_domain_count: '{{ item.platform_fault_domain_count }}'
      virtual_machines: '{{ item.virtual_machines }}'
      proximity_placement_group: '{{ item.proximity_placement_group }}'
      statuses: '{{ item.statuses }}'
      scheduled_events_policy: '{{ item.scheduled_events_policy }}'
      virtual_machine_scale_set_migration_info: '{{ item.virtual_machine_scale_set_migration_info
        }}'
- discovery_id: azure.machine.list_by_resource_group
  calls:
  - action: list_by_resource_group
    save_as: list_by_resource_group_response
  emit:
    items_for: '{{ list_by_resource_group_response.value }}'
    as: item
    item:
      id: '{{ item.id }}'
      name: '{{ item.name }}'
      type: '{{ item.type }}'
      system_data: '{{ item.system_data }}'
      tags: '{{ item.tags }}'
      location: '{{ item.location }}'
      zones: '{{ item.zones }}'
      capacity_reservations: '{{ item.capacity_reservations }}'
      virtual_machines_associated: '{{ item.virtual_machines_associated }}'
      instance_view: '{{ item.instance_view }}'
      sharing_profile: '{{ item.sharing_profile }}'
      reservation_type: '{{ item.reservation_type }}'
checks:
- rule_id: azure.compute.ebs.public.snapshot,.azure.sql.instance.no.public.access,.azure.aks.endpoints.not.publicly.accessible,.azure.virtual.network.endpoint.for.ec2.enabled,.azure.storage.account.level.public.access.blocks,.azure.awslambda.function.not.publicly.accessible,.azure.hdinsight.cluster.master.nodes.no.public.ip,.azure.compute.instance.public.ip,.azure.sql.snapshots.public.access,.azure.search.service.domains.not.publicly.accessible,.azure.synapse.cluster.public.access,.azure.awslambda.function.inside.vpc,.azure.compute.securitygroup.allow.ingress.from.internet.to.tcp.port.22,.azure.database.migration.instance.no.public.access,.azure.machine.learning.notebook.instance.without.direct.internet.access.configured
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.compute.virtual_machine.vm_imds_hardened
  for_each: azure.compute.list_by_resource_group
  conditions:
    var: item.instance_view
    op: exists
- rule_id: azure.compute.dedicated_host.instance_auto_placement_controlled
  for_each: azure.compute.list
  conditions:
    var: item.virtual_machines
    op: not_empty
- rule_id: azure.compute.spot_virtual_machine.spot_instance_instance_profile_least_privilege
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.compute.virtual_machine.vm_ssh_key_based_auth_required
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: contains
    value: ssh_key_based_auth
- rule_id: azure.compute.virtual_machine.vm_vtpm_enabled
  for_each: azure.compute.list
  conditions:
    var: item.virtual_machines
    op: exists
- rule_id: azure.compute.disk.encryption_at_rest_enabled
  for_each: azure.compute.list
  conditions:
    var: item.statuses
    op: contains
    value: EncryptionAtRestEnabled
- rule_id: azure.compute.securitygroup.allow.ingress.from.internet.to.all.ports,.azure.api.management.restapi.waf.acl.attached,.azure.load.balancer.waf.acl.attached
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.compute.virtual_machine.vm_data_volumes_encrypted_cmek
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.compute.disk.cmk_cmek_configured
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.vm.security.extensions.check
  for_each: azure.compute.list
  conditions:
    var: item.virtual_machines
    op: not_empty
- rule_id: azure.compute.image.encrypted_cmek
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.compute.virtual_machine.vm_root_volume_encrypted_cmek
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: contains
    value: CMEK
- rule_id: azure.vm.extensions.approved.check
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.compute.virtual_machine.vm_ssh_password_auth_disabled
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: contains
    value: ssh_password_auth_disabled:true
- rule_id: azure.compute.virtual_machine.vm_secure_boot_enabled
  for_each: azure.compute.list
  conditions:
    var: item.statuses
    op: contains
    value: SecureBootEnabled
- rule_id: azure.compute.virtual_machine_template.launch_template_user_data_no_secrets
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.virtualmachines.managed.by.automation
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: contains
    value: managed_by_automation
- rule_id: azure.compute.ebs.public.snapshot,.azure.sql.instance.no.public.access,.azure.compute.securitygroup.default.restrict.traffic,.azure.compute.securitygroup.allow.ingress.from.internet.to.all.ports,.azure.compute.networkacl.allow.ingress.tcp.port.22,.azure.awslambda.function.not.publicly.accessible,.azure.sql.snapshots.public.access,.azure.search.service.domains.not.publicly.accessible,.azure.synapse.cluster.public.access,.azure.storage.bucket.policy.public.write.access,.azure.awslambda.function.inside.vpc,.azure.compute.securitygroup.allow.ingress.from.internet.to.tcp.port.22,.azure.storage.bucket.public.write.acl,.azure.database.migration.instance.no.public.access,.azure.machine.learning.notebook.instance.without.direct.internet.access.configured,.azure.compute.networkacl.allow.ingress.tcp.port.3389
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.vm.managed.by.ssm
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: contains
    value: ssm
- rule_id: azure.compute.image.vuln_scanned_no_critical
  for_each: azure.compute.list
  conditions:
    var: item.statuses
    op: not_contains
    value: Critical
- rule_id: azure.compute.paas_lightsail_instance.paas_instance_disk_encrypted
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.compute.paas_lightsail_instance.paas_instance_no_public_ip_unless_required
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.compute.virtual_machine.vm_no_public_ip_assigned
  for_each: azure.compute.list_by_resource_group
  conditions:
    var: item.virtual_machines_associated
    op: not_empty
- rule_id: azure.compute.ssh_public_key.key_pair_max_age_days
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.vm.disk.encrypted:az.compute_disk.compute_security_disk_snapshots_encrypted
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.compute.networkacl.allow.ingress.tcp.port.22,.azure.compute.securitygroup.allow.ingress.from.internet.to.all.ports,.azure.compute.networkacl.allow.ingress.tcp.port.3389,.azure.machine.learning.notebook.instance.without.direct.internet.access.configured
  for_each: azure.compute.list
  conditions:
    var: item.virtual_machines
    op: not_empty
- rule_id: azure.compute.instance.older_than_specific_days
  for_each: azure.compute.list
  conditions:
    var: item.system_data
    op: exists
- rule_id: azure.compute.disk.encryption.cmk.check
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.compute.virtual_machine_template.launch_template_security_groups_restrictive
  for_each: azure.compute.list
  conditions:
    var: item.virtual_machines
    op: not_empty
- rule_id: azure.compute.virtual_machine_template.launch_template_root_volume_encrypted_by_default
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.vm.instance.managed.by.ssm
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: contains
    value: ManagedBySSM
- rule_id: azure.compute.virtual_machine_template.launch_template_imds_hardened
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.compute.ebs.public.snapshot,.azure.sql.instance.no.public.access,.azure.awslambda.function.not.publicly.accessible,.azure.sql.snapshots.public.access,.azure.search.service.domains.not.publicly.accessible,.azure.synapse.cluster.public.access,.azure.storage.bucket.policy.public.write.access,.azure.awslambda.function.inside.vpc,.azure.compute.securitygroup.allow.ingress.from.internet.to.tcp.port.22,.azure.storage.bucket.public.write.acl,.azure.database.migration.instance.no.public.access,.azure.machine.learning.notebook.instance.without.direct.internet.access.configured
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.compute.image.approved_image_allowlist_enforced
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.compute.image.image_signed_and_verified
  for_each: azure.compute.list
  conditions:
    var: item.statuses
    op: contains
    value: SignedAndVerified
- rule_id: azure.compute.disk.encryption_enabled:az.compute_disk.compute_security_disk_encryption_at_rest_enabled
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.compute.ebs.public.snapshot,.azure.sql.instance.no.public.access,.azure.aks.endpoints.not.publicly.accessible,.azure.virtual.network.endpoint.for.ec2.enabled,.azure.storage.account.level.public.access.blocks,.azure.awslambda.function.not.publicly.accessible,.azure.hdinsight.cluster.master.nodes.no.public.ip,.azure.compute.instance.public.ip,.azure.sql.snapshots.public.access,.azure.search.service.domains.not.publicly.accessible,.azure.synapse.cluster.public.access,.azure.awslambda.function.inside.vpc,.azure.database.migration.instance.no.public.access,.azure.machine.learning.notebook.instance.without.direct.internet.access.configured,.azure.storage.bucket.policy.public.write.access,.azure.compute.securitygroup.allow.ingress.from.internet.to.tcp.port.22,.azure.storage.bucket.public.write.acl,.azure.compute.securitygroup.allow.ingress.from.internet.to.all.ports,.azure.compute.networkacl.allow.ingress.tcp.port.22,.azure.compute.networkacl.allow.ingress.tcp.port.3389,.azure.compute.securitygroup.default.restrict.traffic
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.compute.disk.snapshots_encrypted
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.compute.vm.aslr_enabled
  for_each: azure.compute.list
  conditions:
    var: item.statuses
    op: contains
    value: Enabled
- rule_id: azure.compute.vm.backup_enabled
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.compute.vmss.configured
  for_each: azure.compute.list
  conditions:
    var: item.virtual_machine_scale_set_migration_info
    op: not_empty
- rule_id: azure.vm.encryption.at.host.enabled
  for_each: azure.compute.list
  conditions:
    var: item.statuses
    op: contains
    value: Enabled
- rule_id: azure.compute.instance.profile_attached
  for_each: azure.compute.list_by_resource_group
  conditions:
    var: item.sharing_profile
    op: not_empty
- rule_id: azure.vm.ssm.managed
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.vm.managed.by.automation
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: contains
    value: managed_by_automation
- rule_id: azure.compute.ebs.public.snapshot,.azure.sql.instance.no.public.access,.azure.aks.endpoints.not.publicly.accessible,.azure.storage.account.level.public.access.blocks,.azure.awslambda.function.not.publicly.accessible,.azure.hdinsight.cluster.master.nodes.no.public.ip,.azure.compute.instance.public.ip,.azure.monitor.log.metric.filter.root.usage,.azure.sql.snapshots.public.access,.azure.search.service.domains.not.publicly.accessible,.azure.synapse.cluster.public.access,.azure.storage.bucket.policy.public.write.access,.azure.storage.bucket.public.write.acl,.azure.database.migration.instance.no.public.access,.azure.machine.learning.notebook.instance.without.direct.internet.access.configured
  for_each: azure.compute.list
  conditions:
    var: item.virtual_machines
    op: not_empty
- rule_id: azure.compute.vm.unrestricted_ingress
  for_each: azure.compute.list
  conditions:
    var: item.virtual_machines
    op: not_empty
- rule_id: azure.compute.disk.in_use
  for_each: azure.compute.list
  conditions:
    var: item.virtual_machines
    op: not_empty
- rule_id: azure.vm.managed.disks.compliance.check
  for_each: azure.compute.list
  conditions:
    var: item.virtual_machines
    op: not_empty
- rule_id: azure.compute.virtual_machine_scale_set.instance_group_instance_profile_least_privilege
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.compute.ssh_public_key.key_pair_disable_unused_keys
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.compute.disk.snapshots_not_public
  for_each: azure.compute.list_by_resource_group
  conditions:
    var: item.sharing_profile
    op: equals
    value: Private
- rule_id: azure.vm.disk.data.access.auth.mode.check
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.compute.virtual_machine_scale_set.instance_group_no_public_ip_assigned
  for_each: azure.compute.list
  conditions:
    var: item.virtual_machines
    op: not_empty
- rule_id: azure.disk.unattached.cmk.encryption.check
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.vm.disk.network.access.policy.check
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.compute.vm.unrestricted_network_ingress
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.compute.virtual_machine.vm_serial_console_access_restricted
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: contains
    value: vm_serial_console_access_restricted
- rule_id: azure.compute.spot_virtual_machine.spot_instance_uses_approved_launch_template
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: contains
    value: approved_launch_template
- rule_id: azure.compute.paas_lightsail_instance.paas_instance_ssh_password_auth_disabled
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: contains
    value: ssh_password_auth_disabled
- rule_id: azure.compute.image.not_publicly_shared
  for_each: azure.compute.list_by_resource_group
  conditions:
    var: item.sharing_profile
    op: equals
    value: Private
- rule_id: azure.compute.vm.managed_disks_enabled
  for_each: azure.compute.list
  conditions:
    var: item.virtual_machines
    op: not_empty
- rule_id: azure.compute.vm.automation_compliance
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.compute.dedicated_host.host_sharing_restricted
  for_each: azure.compute.list_by_resource_group
  conditions:
    var: item.sharing_profile
    op: equals
    value: Restricted
- rule_id: azure.compute.vm.trusted_launch_enabled
  for_each: azure.compute.list
  conditions:
    var: item.statuses
    op: contains
    value: TrustedLaunchEnabled
- rule_id: azure.compute.vm.dep_enabled
  for_each: azure.compute.list
  conditions:
    var: item.statuses
    op: contains
    value: Enabled
- rule_id: azure.compute.virtual_machine_template.launch_template_instance_profile_least_privilege
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.compute.virtual_machine_scale_set.instance_group_volumes_encrypted
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.compute.virtual_machine.vm_security_group_inbound_restricted
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.vm.instance.detailed_monitoring_enabled
  for_each: azure.compute.list
  conditions:
    var: item.statuses
    op: contains
    value: Enabled
- rule_id: azure.vm.elastic.ip.unassigned
  for_each: azure.compute.list_by_resource_group
  conditions:
    var: item.virtual_machines_associated
    op: equals
    value: []
- rule_id: azure.compute.spot_virtual_machine.spot_instance_no_public_ip_assigned
  for_each: azure.compute.list
  conditions:
    var: item.virtual_machines
    op: not_empty
- rule_id: azure.vm.trusted.launch.secure.boot.vtpm.check
  for_each: azure.compute.list
  conditions:
    var: item.virtual_machines
    op: not_empty
- rule_id: azure.compute.vm.stopped_instance
  for_each: azure.compute.list
  conditions:
    var: item.statuses
    op: contains
    value: Stopped
- rule_id: azure.compute.vm.patch_compliance
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.vm.mfa.enabled.check
  for_each: azure.compute.list
  conditions:
    var: item.statuses
    op: contains
    value: Enabled
- rule_id: azure.compute.virtual_machine_scale_set.instance_group_uses_approved_launch_template
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.compute.virtual_machine.vm_user_data_no_secrets
  for_each: azure.compute.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.compute.vmss.autoscale_enabled
  for_each: azure.compute.list
  conditions:
    var: item.virtual_machine_scale_set_migration_info
    op: not_empty
- rule_id: azure.compute.virtual_machine_template.launch_template_no_public_ip_default
  for_each: azure.compute.list
  conditions:
    var: item.virtual_machines
    op: not_empty
- rule_id: azure.databricks.workspace.public.network.access.check
  for_each: azure.databricks.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.databricks.workspace.diagnostic.logging.configured
  for_each: azure.databricks.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.databricks.workspace.vnet.configuration.check
  for_each: azure.databricks.list
  conditions:
    var: item.virtual_machines
    op: not_empty
- rule_id: azure.databricks.workspace.encryption.cmk.enabled
  for_each: azure.databricks.list
  conditions:
    var: item.tags
    op: contains
    value: encryption_cmk_enabled
- rule_id: azure.databricks.scim.sync.verification
  for_each: azure.databricks.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.databricks.workspace.check.no.public.ip.enabled
  for_each: azure.databricks.list
  conditions:
    var: item.tags
    op: contains
    value: NoPublicIP
- rule_id: azure.databricks.workspace.private.endpoint.status.check
  for_each: azure.databricks.list
  conditions:
    var: item.statuses
    op: not_empty
- rule_id: azure.databricks.pat.compliance.check
  for_each: azure.databricks.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.hdinsight.cluster.data_analytics_admin_access_least_privilege
  for_each: azure.hdinsight.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.hdinsight.cluster.data_analytics_encryption_at_rest_cmek
  for_each: azure.hdinsight.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.hdinsight.cluster.data_analytics_private_networking_enforced
  for_each: azure.hdinsight.list
  conditions:
    var: item.tags
    op: contains
    value: private_networking
- rule_id: azure.hdinsight.cluster.master_nodes_no_public_ip
  for_each: azure.hdinsight.list
  conditions:
    var: item.virtual_machines
    op: not_empty
- rule_id: azure.hdinsight.cluster.data_analytics_tls_min_1_2_enforced
  for_each: azure.hdinsight.list
  conditions:
    var: item.tags
    op: contains
    value: tls_min_1_2
- rule_id: azure.hdinsight.cluster.data_analytics_audit_logging_enabled
  for_each: azure.hdinsight.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_model.data_governance_ai_model_registry_rbac_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_feature_store.ai_services_feature_store_offline_store_s3_encrypted
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_job.ai_services_training_job_volume_encryption_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: contains
    value: encryption_enabled
- rule_id: azure.machine.learning_online_endpoint.data_privacy_ai_endpoint_private_networking_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: contains
    value: private_networking
- rule_id: azure.machine.learning_model.data_privacy_ai_model_registry_rbac_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_endpoint.ai_services_prompt_gateway_token_scopes_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_model.data_governance_ai_model_registry_artifact_encryption_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_workspace.ai_services_workspace_iam_role_least_privileged
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_model_package.data_governance_ai_model_package_artifact_signed_and_verified
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_model.data_privacy_ai_model_registry_artifact_encryption_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: contains
    value: encryption_enabled
- rule_id: azure.machine.learning_online_endpoint.data_governance_ai_endpoint_private_networking_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: contains
    value: private_networking
- rule_id: azure.machine.learning_feature_store.ai_services_vector_index_rbac_tenant_isolation_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: contains
    value: tenant_isolation_enforced
- rule_id: azure.machine.learning_pipeline.logging_enabled
  for_each: azure.machine.list
  conditions:
    var: item.statuses
    op: contains
    value: Enabled
- rule_id: azure.machine.learning_feature_store.ai_services_vector_index_authn_required
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_pipeline.data_privacy_ai_pipeline_logging_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_hyperdrive_run.learning_hpo_roles_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_dataset.ai_services_ai_dataset_encrypted_at_rest_cmek
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_pipeline.ai_services_pipeline_kms_encryption_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: contains
    value: kms_encryption_enabled
- rule_id: azure.machine.learning_job.learning_training_job_input_output_encrypted
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_online_endpoint.data_governance_ai_endpoint_logging_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_hyperdrive_run.learning_hpo_logs_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_model_package.artifact_signed_and_verified
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_batch_endpoint.data_privacy_ai_transform_job_private_networking_enforced
  for_each: azure.machine.list
  conditions:
    var: item.virtual_machines
    op: not_empty
- rule_id: azure.machine.learning_job.data_governance_ai_training_job_roles_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_deployment.data_privacy_ai_endpoint_config_content_type_whitelist_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_model_package.not_publicly_shared
  for_each: azure.machine.list_by_resource_group
  conditions:
    var: item.sharing_profile
    op: equals
    value: Private
- rule_id: azure.machine.learning_model.registry_artifact_encryption_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_pipeline.ai_services_agent_orchestrator_data_exfiltration_policies_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_auto_ml_job.learning_automl_logs_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_deployment.learning_endpoint_config_data_capture_bucket_encrypted_private
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_endpoint.ai_services_prompt_gateway_private_networking_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_model_version.ai_services_model_artifact_encrypted_at_rest_cmek
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_compute_instance.data_privacy_ai_notebook_encrypted
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: contains
    value: encrypted
- rule_id: azure.machine.learning_endpoint.ai_services_ai_endpoint_waf_attached
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_hyperdrive_run.learning_hpo_private_networking_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_endpoint.ai_services_model_deployment_endpoint_in_vpc
  for_each: azure.machine.list
  conditions:
    var: item.virtual_machines
    op: not_empty
- rule_id: azure.machine.learning_model_version.ai_services_supply_chain_model_artifact_sbom_present
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_pipeline.data_governance_ai_pipeline_roles_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_pipeline.data_governance_ai_pipeline_artifacts_private_and_encrypted
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_auto_ml_job.learning_automl_roles_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_pipeline.ai_services_agent_orchestrator_tool_use_allowlist_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_online_endpoint.learning_endpoint_authz_policies_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_job.ai_services_training_job_output_encryption_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_batch_endpoint.learning_transform_job_logs_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_job.ai_services_training_job_inter_container_traffic_encryption_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: contains
    value: inter_container_traffic_encryption_enabled
- rule_id: azure.machine.learning_experiment.metadata_store_encrypted
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: contains
    value: encrypted
- rule_id: azure.machine.learning_workspace.ai_services_workspace_encryption_at_rest_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_pipeline.ai_services_data_pipeline_private_networking_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: contains
    value: private_networking
- rule_id: azure.machine.learning_experiment.logs_enabled
  for_each: azure.machine.list
  conditions:
    var: item.statuses
    op: not_empty
- rule_id: azure.machine.learning_hyperdrive_run.data_governance_ai_hpo_roles_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_endpoint.ai_services_prompt_gateway_authn_required
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_feature_store.ai_services_vector_index_private_networking_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: contains
    value: private_networking
- rule_id: azure.machine.learning_online_endpoint.data_privacy_ai_endpoint_authn_required
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_pipeline.data_privacy_ai_pipeline_artifacts_private_and_encrypted
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_endpoint.ai_services_inference_endpoint_kms_encryption_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_experiment.data_privacy_ai_experiment_rbac_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_batch_endpoint.learning_transform_job_input_output_encrypted
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_model_package.data_privacy_ai_model_package_encrypted
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_job.data_governance_ai_training_job_private_networking_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: contains
    value: private_networking
- rule_id: azure.machine.learning_deployment.data_governance_ai_endpoint_config_content_type_whitelist_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_auto_ml_job.data_privacy_ai_automl_roles_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_online_endpoint.data_privacy_ai_endpoint_authz_policies_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_endpoint.ai_services_ai_endpoint_authn_required
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_batch_endpoint.data_governance_ai_transform_job_private_networking_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_workspace.ai_services_secrets_vault_no_plaintext_secrets_in_config
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_experiment.data_governance_ai_experiment_logs_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_deployment.data_governance_ai_endpoint_config_data_capture_bucket_encrypted_private
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_online_endpoint.learning_endpoint_private_networking_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_batch_endpoint.data_governance_ai_transform_job_roles_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_pipeline.learning_human_review_ui_private_networking_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_feature_store.ai_services_feature_store_rbac_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_dataset.ai_services_dataset_lifecycle_policy_configured
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_job.data_governance_ai_training_job_logs_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.ml_workspace.ml_ops_monitoring_logs_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_pipeline.artifacts_private_and_encrypted
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_hyperdrive_run.data_governance_ai_hpo_logs_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_endpoint.ai_services_model_deployment_logging_enabled
  for_each: azure.machine.list
  conditions:
    var: item.statuses
    op: contains
    value: Enabled
- rule_id: azure.machine.learning_compute_instance.data_privacy_ai_notebook_execution_role_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_pipeline.ai_services_pipeline_logging_enabled
  for_each: azure.machine.list
  conditions:
    var: item.statuses
    op: contains
    value: Enabled
- rule_id: azure.machine.learning_auto_ml_job.learning_automl_private_networking_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_experiment.rbac_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_auto_ml_job.data_privacy_ai_automl_private_networking_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_model.registry_cross_account_sharing_restricted
  for_each: azure.machine.list_by_resource_group
  conditions:
    var: item.sharing_profile
    op: equals
    value: Restricted
- rule_id: azure.machine.learning_batch_endpoint.data_privacy_ai_transform_job_input_output_encrypted
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_pipeline.data_governance_ai_human_review_artifacts_encrypted
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_pipeline.data_governance_ai_pipeline_kms_encryption_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_batch_endpoint.learning_transform_job_roles_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_compute_instance.data_governance_ai_notebook_execution_role_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_experiment.data_privacy_ai_experiment_logs_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_auto_ml_job.data_privacy_ai_automl_logs_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_model_package.data_governance_ai_model_package_encrypted
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_online_endpoint.learning_endpoint_authn_required
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_job.data_privacy_ai_training_job_roles_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_model_package.data_governance_ai_model_package_not_publicly_shared
  for_each: azure.machine.list_by_resource_group
  conditions:
    var: item.sharing_profile
    op: equals
    value: Private
- rule_id: azure.machine.learning_pipeline.kms_encryption_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_experiment.data_governance_ai_experiment_metadata_store_encrypted
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_model_version.ai_services_supply_chain_model_artifact_signed_and_verified
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_endpoint.ai_services_inference_endpoint_private_networking_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_batch_endpoint.data_governance_ai_transform_job_input_output_encrypted
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_job.data_privacy_ai_training_job_input_output_encrypted
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_feature_store.ai_services_feature_store_online_store_kms_encryption_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_online_endpoint.learning_endpoint_logging_enabled
  for_each: azure.machine.list
  conditions:
    var: item.statuses
    op: contains
    value: Enabled
- rule_id: azure.machine.learning_endpoint.ai_services_model_deployment_kms_encryption_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: contains
    value: kms_encryption_enabled
- rule_id: azure.machine.learning_endpoint.ai_services_ai_endpoint_rate_limiting_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_model.ai_services_model_image_scan_passed
  for_each: azure.machine.list
  conditions:
    var: item.statuses
    op: contains
    value: Succeeded
- rule_id: azure.machine.learning_dataset.ai_services_dataset_s3_encrypted_at_rest
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_job.learning_training_job_roles_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_batch_endpoint.learning_transform_job_private_networking_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_workspace.ai_services_secrets_vault_access_rbac_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_compute_instance.data_privacy_ai_notebook_idle_shutdown_configured
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_feature_store.ai_services_vector_index_encrypted_at_rest_cmek
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_deployment.learning_endpoint_config_content_type_whitelist_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_model_version.ai_services_model_version_kms_encryption_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: contains
    value: kms_encryption_enabled
- rule_id: azure.machine.learning_experiment.data_governance_ai_experiment_rbac_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_online_endpoint.data_privacy_ai_endpoint_logging_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_model.data_governance_ai_model_registry_cross_account_sharing_restricted
  for_each: azure.machine.list_by_resource_group
  conditions:
    var: item.sharing_profile
    op: equals
    value: Restricted
- rule_id: azure.machine.learning_model.ai_services_model_kms_cmk_used
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_model.data_privacy_ai_model_registry_cross_account_sharing_restricted
  for_each: azure.machine.list_by_resource_group
  conditions:
    var: item.sharing_profile
    op: equals
    value: Restricted
- rule_id: azure.machine.learning_compute_instance.data_governance_ai_notebook_encrypted
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: contains
    value: encrypted
- rule_id: azure.machine.learning_job.ai_services_training_job_network_isolation_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: contains
    value: network_isolation_enabled
- rule_id: azure.machine.learning_online_endpoint.data_governance_ai_endpoint_kms_encryption_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: contains
    value: kms_encryption_enabled
- rule_id: azure.machine.learning_pipeline.ai_services_pipeline_iam_role_least_privileged
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_pipeline.learning_human_review_workteam_access_rbac_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_endpoint.ai_services_inference_endpoint_group_restrictive
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_online_endpoint.data_governance_ai_endpoint_authn_required
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_pipeline.ai_services_agent_orchestrator_secrets_isolation_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_pipeline.ai_services_data_pipeline_access_controls_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_dataset.ai_services_dataset_s3_block_public_access
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_model_version.ai_services_model_version_package_approved
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_pipeline.data_governance_ai_pipeline_logging_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_model_version.ai_services_model_version_image_scan_passed
  for_each: azure.machine.list
  conditions:
    var: item.statuses
    op: contains
    value: Succeeded
- rule_id: azure.machine.learning_model_package.data_privacy_ai_model_package_not_publicly_shared
  for_each: azure.machine.list_by_resource_group
  conditions:
    var: item.sharing_profile
    op: equals
    value: Private
- rule_id: azure.machine.learning_model_package.encrypted
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_hyperdrive_run.data_privacy_ai_hpo_logs_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.ml_workspace.ml_ops_monitoring_private_networking_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_deployment.learning_endpoint_config_kms_keys_restricted
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_deployment.data_governance_ai_endpoint_config_kms_keys_restricted
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_pipeline.data_privacy_ai_human_review_artifacts_encrypted
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_model.registry_rbac_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_experiment.data_privacy_ai_experiment_metadata_store_encrypted
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_auto_ml_job.data_governance_ai_automl_private_networking_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: contains
    value: private_networking
- rule_id: azure.machine.learning_hyperdrive_run.data_privacy_ai_hpo_roles_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_job.data_privacy_ai_training_job_logs_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_compute_instance.learning_notebook_execution_role_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_feature_store.ai_services_feature_store_offline_store_block_public_access
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_compute_instance.data_governance_ai_notebook_no_public_access
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_pipeline.data_privacy_ai_pipeline_roles_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_compute_instance.data_privacy_ai_notebook_no_public_access
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: contains
    value: NoPublicAccess
- rule_id: azure.machine.learning_auto_ml_job.data_governance_ai_automl_logs_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_pipeline.learning_human_review_artifacts_encrypted
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_job.learning_training_job_logs_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_online_endpoint.learning_endpoint_kms_encryption_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: contains
    value: kms_encryption_enabled
- rule_id: azure.machine.learning_compute_instance.learning_notebook_encrypted
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: contains
    value: encrypted
- rule_id: azure.machine.learning_pipeline.data_governance_ai_human_review_ui_private_networking_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_batch_endpoint.data_privacy_ai_transform_job_logs_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_dataset.ai_services_ai_dataset_public_access_blocked
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_hyperdrive_run.data_governance_ai_hpo_private_networking_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_workspace.ai_services_secrets_vault_kms_encryption_and_rotation_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_pipeline.data_privacy_ai_pipeline_kms_encryption_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_model.ai_services_model_artifact_encrypted_at_rest
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_job.ai_services_training_pipeline_secrets_from_vault_only
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_batch_endpoint.data_governance_ai_transform_job_logs_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_pipeline.roles_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_pipeline.data_privacy_ai_human_review_workteam_access_rbac_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_auto_ml_job.data_governance_ai_automl_roles_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_dataset.ai_services_dataset_access_logging_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_model.ai_services_model_execution_role_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_job.learning_training_job_private_networking_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: contains
    value: private_networking
- rule_id: azure.machine.learning_workspace.ai_services_workspace_idle_shutdown_configured
  for_each: azure.machine.list
  conditions:
    var: item.scheduled_events_policy
    op: not_empty
- rule_id: azure.machine.learning_hyperdrive_run.data_privacy_ai_hpo_private_networking_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_pipeline.data_governance_ai_human_review_workteam_access_rbac_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.ml_workspace.ml_ops_monitoring_roles_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_job.data_governance_ai_training_job_input_output_encrypted
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_compute_instance.learning_notebook_no_public_access
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: contains
    value: NoPublicAccess
- rule_id: azure.machine.learning_online_endpoint.data_governance_ai_endpoint_authz_policies_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_endpoint.ai_services_ai_endpoint_private_networking_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: contains
    value: private_networking_enforced
- rule_id: azure.machine.learning_job.data_privacy_ai_training_job_private_networking_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: contains
    value: private_networking
- rule_id: azure.machine.learning_endpoint.ai_services_inference_endpoint_data_capture_s3_encrypted
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_compute_instance.learning_notebook_idle_shutdown_configured
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_compute_instance.data_governance_ai_notebook_idle_shutdown_configured
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_online_endpoint.data_privacy_ai_endpoint_kms_encryption_enabled
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_deployment.data_privacy_ai_endpoint_config_kms_keys_restricted
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.ml_workspace.ml_ops_monitoring_outputs_encrypted_and_private
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_endpoint.ai_services_ai_endpoint_authz_policies_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_model_version.ai_services_supply_chain_model_artifact_image_scanned_no_critical
  for_each: azure.machine.list
  conditions:
    var: item.statuses
    op: not_contains
    value: Critical
- rule_id: azure.machine.learning_model_package.data_privacy_ai_model_package_artifact_signed_and_verified
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_job.ai_services_training_pipeline_private_networking_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: contains
    value: private_networking
- rule_id: azure.machine.learning_batch_endpoint.data_privacy_ai_transform_job_roles_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_pipeline.data_privacy_ai_human_review_ui_private_networking_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_workspace.ai_services_workspace_private_networking_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: contains
    value: private_networking
- rule_id: azure.machine.learning_deployment.data_privacy_ai_endpoint_config_capture_store_encrypted_and_private
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_job.ai_services_training_job_vpc_configured
  for_each: azure.machine.list
  conditions:
    var: item.virtual_machines
    op: not_empty
- rule_id: azure.machine.learning_model.ai_services_model_registry_access_rbac_least_privilege
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
- rule_id: azure.machine.learning_feature_store.ai_services_feature_store_private_networking_enforced
  for_each: azure.machine.list
  conditions:
    var: item.tags
    op: not_empty
