version: '1.0'
provider: azure
service: monitor
discovery:
- discovery_id: azure.monitor.list_by_resource_group
  calls:
  - action: list_by_resource_group
    save_as: list_by_resource_group_response
  emit:
    items_for: '{{ list_by_resource_group_response.value }}'
    as: item
    item:
      id: '{{ item.id }}'
      name: '{{ item.name }}'
      type: '{{ item.type }}'
      identity: '{{ item.identity }}'
      tags: '{{ item.tags }}'
      location: '{{ item.location }}'
      kind: '{{ item.kind }}'
      etag: '{{ item.etag }}'
      system_data: '{{ item.system_data }}'
      created_with_api_version: '{{ item.created_with_api_version }}'
      is_legacy_log_analytics_rule: '{{ item.is_legacy_log_analytics_rule }}'
      description: '{{ item.description }}'
      display_name: '{{ item.display_name }}'
      severity: '{{ item.severity }}'
      enabled: '{{ item.enabled }}'
      scopes: '{{ item.scopes }}'
      evaluation_frequency: '{{ item.evaluation_frequency }}'
      window_size: '{{ item.window_size }}'
      override_query_time_range: '{{ item.override_query_time_range }}'
      target_resource_types: '{{ item.target_resource_types }}'
checks:
- rule_id: azure.monitor.activity.log.alert.create.or.update.public.ip.address
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.activity.log.alert.delete.policy.assignment.exists
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert.delete_public_ip
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.action_group.incident_notification_endpoints_authenticated
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.admin.account.usage.check
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert_rule.dr_monitoring_alert_destinations_configured
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert.create_update_public_ip
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.dashboard.public_embeds_disabled
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.action_group.incident_notification_destinations_configured
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.vm.cpu_alerts
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.network.route_tables_alarm_configured
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.action_group.incident_notification_no_public_webhooks
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.action_group.incident_escalation_policy_exists_for_critical_severity
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert.create_update_sqlserver_fr
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert.delete_sqlserver_fr
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert.vnet_changes_configured
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert.capacity_alerts_configured
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert.alarm_configured
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.vm.memory_alerts
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.log.metric_filter_alarm_configured
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.dashboard.sso_required
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.activity.log.alert.service.health.exists
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert.create_update_nsg
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.network.acls_alarm_configured
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert.delete_security_solution
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.activity.log.alert.delete.nsg.exists
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert.destinations_authenticated
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.anomaly_detector.anomaly_alerts
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.activity.log.alert.exists.delete.security.solution
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert.create_update_security_solution
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.metric.filter.root.usage
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.network.gateways_alarm_configured
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.dashboard.sharing_restricted_to_org
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert_rule.dr_monitoring_alerts_for_rpo_rto_breach_configured
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.policy.assignment
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.activity.log.alert.public.ip.delete.check
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.activity.log.alert.nsg.operation.condition.check
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.trace.retention_days_minimum
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.log.retention_configured
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert_rule.dr_monitoring_alerts_for_backup_failures_configured
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert.alarm_actions
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.sampling_rule.rules_present
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.activity.log.alert.policy.assignment.check
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.action_group.incident_escalation_oncall_contacts_verified
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.metrics.data_analytics_monitoring_logs_retention_days_minimum
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.activity.log.alert.security.solution.update.check
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.storage.account_with_activity_logs_is_private
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert.delete_nsg
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.application.insights.configuration.check
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.anomaly_detector.anomaly_training_data_sources_approved
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert_rule.dr_monitoring_alerts_for_replication_lag_configured
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
