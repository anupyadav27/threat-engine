subscription:
  version: '1.0'
  provider: azure
  service: subscription
  package: azure-mgmt-subscription
  client_class: SubscriptionClient
  scope: subscription
  discovery:
  - discovery_id: azure.subscription.subscriptions
    calls:
    - client: subscription
      action: subscriptions.list
      save_as: subscriptions
  - discovery_id: azure.subscription.tenants
    calls:
    - client: subscription
      action: tenants.list
      save_as: tenants
  - discovery_id: azure.subscription.operations
    calls:
    - client: subscription
      action: operations.list
      save_as: operations
  - discovery_id: azure.subscription.locations
    calls:
    - client: subscription
      action: subscriptions.list_locations
      save_as: locations
  checks:
  - check_id: azure.subscription.owner.count.check
    title: 'AZURE SUBSCRIPTION Owner: Count Check'
    severity: low
    for_each: azure.subscription.subscriptions
    calls:
    - action: role_assignments.list_for_subscription
      params: {}
      fields:
      - path: value[?(@.properties.role_definition_id =~ /.*8e3af657-a8ff-443c-a75c-2fe8c4bcb635$/)].properties.principal_id
        operator: exists
