version: '1.0'
provider: azure
service: batch
discovery:
- discovery_id: azure.batch.list
  calls:
  - action: list
    save_as: list_response
  emit:
    items_for: '{{ list_response.value }}'
    as: item
    item:
      id: '{{ item.id }}'
      name: '{{ item.name }}'
      type: '{{ item.type }}'
      etag: '{{ item.etag }}'
      tags: '{{ item.tags }}'
      state: '{{ item.state }}'
      format: '{{ item.format }}'
      storage_url: '{{ item.storage_url }}'
      storage_url_expiry: '{{ item.storage_url_expiry }}'
      last_activation_time: '{{ item.last_activation_time }}'
checks:
- rule_id: azure.batch.account.private.endpoint.approved
  for_each: azure.batch.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.batch.account.authentication.modes.check
  for_each: azure.batch.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.batch.private.endpoint.dns.zone.validation
  for_each: azure.batch.list
  conditions:
    var: item.id
    op: exists
