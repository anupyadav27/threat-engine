version: '1.0'
provider: azure
service: machine
discovery: []
checks:
- check_id: machine_learning_auto_ml_job_data_governance_ai_automl_logs_enabled
  name: 'AZURE MACHINE Learning_auto_ml_job: Data Governance Ai Automl Logs Enabled'
  severity: LOW
  for_each: learning_auto_ml_jobs
  param: learning_auto_ml_job
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.logging.enable_data_governance_logs
      operator: equals
      expected: true
    - path: properties.logging.automl_logs_enabled
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_auto_ml_job_data_governance_ai_automl_private_networking_enforced
  name: 'AZURE MACHINE Learning_auto_ml_job: Data Governance Ai Automl Private Networking'
  severity: MEDIUM
  for_each: learning_auto_ml_jobs
  param: learning_auto_ml_job
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.compute.is_local
      operator: equals
      expected: false
    - path: properties.networking.public_network_access
      operator: equals
      expected: Disabled
    - path: properties.networking.private_endpoint_connections
      operator: exists
      expected: true
    - path: properties.compute.compute_type
      operator: equals
      expected: ComputeInstance
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_auto_ml_job_data_governance_ai_automl_roles_least_privilege
  name: 'AZURE MACHINE Learning_auto_ml_job: Data Governance Ai Automl Roles Least
    Privil'
  severity: HIGH
  for_each: learning_auto_ml_jobs
  param: learning_auto_ml_job
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.identity.type
      operator: equals
      expected: UserAssigned
    - path: properties.identity.userAssignedIdentities
      operator: exists
      expected: true
    - path: properties.compute.target
      operator: exists
      expected: true
    - path: properties.dataSettings.enableDataIsolation
      operator: equals
      expected: true
    - path: properties.mlAssistConfiguration.enableMlAssist
      operator: equals
      expected: false
    - path: properties.autoLoggerSettings.enableAutoLogger
      operator: equals
      expected: true
    - path: properties.roleAssignments
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_auto_ml_job_data_privacy_ai_automl_logs_enabled
  name: 'AZURE MACHINE Learning_auto_ml_job: Data Privacy Ai Automl Logs Enabled'
  severity: MEDIUM
  for_each: learning_auto_ml_jobs
  param: learning_auto_ml_job
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.settings.enableDataPrivacy
      operator: equals
      expected: true
    - path: properties.settings.enableAutomlLogs
      operator: equals
      expected: true
    - path: properties.dataPrivacyConfiguration.enabled
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_auto_ml_job_data_privacy_ai_automl_private_networking_enforced
  name: 'AZURE MACHINE Learning_auto_ml_job: Data Privacy Ai Automl Private Networking
    En'
  severity: MEDIUM
  for_each: learning_auto_ml_jobs
  param: learning_auto_ml_job
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.compute.computeType
      operator: equals
      expected: AmlCompute
    - path: properties.compute.properties.subnet
      operator: exists
      expected: true
    - path: properties.compute.properties.enableNodePublicIp
      operator: equals
      expected: false
    - path: properties.environmentVariables.AZUREML_PRIVATE_ENDPOINT_ENABLED
      operator: equals
      expected: 'true'
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_auto_ml_job_data_privacy_ai_automl_roles_least_privilege
  name: 'AZURE MACHINE Learning_auto_ml_job: Data Privacy Ai Automl Roles Least Privilege'
  severity: HIGH
  for_each: learning_auto_ml_jobs
  param: learning_auto_ml_job
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.identity.type
      operator: equals
      expected: SystemAssigned
    - path: properties.services.jobService.jobServiceType
      operator: exists
      expected: true
    - path: properties.experimentName
      operator: exists
      expected: true
    - path: properties.compute.target
      operator: exists
      expected: true
    - path: properties.dataPrivacy.enableDataIsolation
      operator: equals
      expected: true
    - path: properties.roleAssignments
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_auto_ml_job_learning_automl_logs_enabled
  name: 'AZURE MACHINE Learning_auto_ml_job: Learning Automl Logs Enabled'
  severity: LOW
  for_each: learning_auto_ml_jobs
  param: learning_auto_ml_job
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.settings.enable_logging
      operator: equals
      expected: true
    - path: properties.settings.log_verbosity
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_auto_ml_job_learning_automl_private_networking_enforced
  name: 'AZURE MACHINE Learning_auto_ml_job: Learning Automl Private Networking Enforced'
  severity: MEDIUM
  for_each: learning_auto_ml_jobs
  param: learning_auto_ml_job
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.networking.isolation_mode
      operator: equals
      expected: private
    - path: properties.networking.outbound_rules
      operator: exists
      expected: true
    - path: properties.compute.target
      operator: exists
      expected: true
    - path: properties.networking.enable_node_public_ip
      operator: equals
      expected: false
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_auto_ml_job_learning_automl_roles_least_privilege
  name: 'AZURE MACHINE Learning_auto_ml_job: Learning Automl Roles Least Privilege'
  severity: HIGH
  for_each: learning_auto_ml_jobs
  param: learning_auto_ml_job
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.identity.type
      operator: exists
      expected: true
    - path: properties.identity.userAssignedIdentities
      operator: exists
      expected: true
    - path: properties.compute.target
      operator: exists
      expected: true
    - path: properties.services
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_batch_endpoint_data_governance_ai_transform_job_input_output_encrypted
  name: 'AZURE MACHINE Learning_batch_endpoint: Data Governance Ai Transform Job Input
    Ou'
  severity: MEDIUM
  for_each: learning_batch_endpoints
  param: learning_batch_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.compute.properties.dataGovernance.aiTransformJobInputOutputEncrypted
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_batch_endpoint_data_governance_ai_transform_job_logs_enabled
  name: 'AZURE MACHINE Learning_batch_endpoint: Data Governance Ai Transform Job Logs
    Ena'
  severity: LOW
  for_each: learning_batch_endpoints
  param: learning_batch_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.logging.enabled
      operator: equals
      expected: true
    - path: properties.logging.configuration.aiTransformJobLogs
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_batch_endpoint_data_governance_ai_transform_job_private_networking_enforced
  name: 'AZURE MACHINE Learning_batch_endpoint: Data Governance Ai Transform Job Private'
  severity: MEDIUM
  for_each: learning_batch_endpoints
  param: learning_batch_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.compute.computeType
      operator: equals
      expected: AmlCompute
    - path: properties.compute.properties.subnet
      operator: exists
      expected: true
    - path: properties.compute.properties.enableNodePublicIp
      operator: equals
      expected: false
    - path: properties.compute.properties.remoteLoginPortPublicAccess
      operator: equals
      expected: Disabled
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_batch_endpoint_data_governance_ai_transform_job_roles_least_privilege
  name: 'AZURE MACHINE Learning_batch_endpoint: Data Governance Ai Transform Job Roles
    Le'
  severity: HIGH
  for_each: learning_batch_endpoints
  param: learning_batch_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.auth_mode
      operator: equals
      expected: aad_token
    - path: properties.keys.primary_key
      operator: exists
      expected: false
    - path: properties.keys.secondary_key
      operator: exists
      expected: false
    - path: properties.traffic
      operator: exists
      expected: true
    - path: properties.mirror_traffic
      operator: exists
      expected: false
    - path: properties.provisioning_state
      operator: equals
      expected: Succeeded
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_batch_endpoint_data_privacy_ai_transform_job_input_output_encrypted
  name: 'AZURE MACHINE Learning_batch_endpoint: Data Privacy Ai Transform Job Input
    Outpu'
  severity: MEDIUM
  for_each: learning_batch_endpoints
  param: learning_batch_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.defaults.deployment_configuration.compute_configuration.environment.inference_config.entry_script.encryption_config.enabled
      operator: equals
      expected: true
    - path: properties.defaults.deployment_configuration.compute_configuration.environment.inference_config.source_directory.encryption.key_source
      operator: equals
      expected: Microsoft.KeyVault
    - path: properties.defaults.deployment_configuration.output_configuration.encryption.enabled
      operator: equals
      expected: true
    - path: properties.defaults.deployment_configuration.input_configuration.encryption.enabled
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_batch_endpoint_data_privacy_ai_transform_job_logs_enabled
  name: 'AZURE MACHINE Learning_batch_endpoint: Data Privacy Ai Transform Job Logs
    Enable'
  severity: MEDIUM
  for_each: learning_batch_endpoints
  param: learning_batch_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.logging.aiTransformJobLogs.enabled
      operator: equals
      expected: true
    - path: properties.logging.dataPrivacy.enabled
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_batch_endpoint_data_privacy_ai_transform_job_private_networking_enforced
  name: 'AZURE MACHINE Learning_batch_endpoint: Data Privacy Ai Transform Job Private
    Net'
  severity: MEDIUM
  for_each: learning_batch_endpoints
  param: learning_batch_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.compute.properties.privateEndpointConnections
      operator: exists
      expected: true
    - path: properties.compute.properties.publicNetworkAccess
      operator: equals
      expected: Disabled
    - path: properties.compute.properties.subnet.id
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_batch_endpoint_data_privacy_ai_transform_job_roles_least_privilege
  name: 'AZURE MACHINE Learning_batch_endpoint: Data Privacy Ai Transform Job Roles
    Least'
  severity: HIGH
  for_each: learning_batch_endpoints
  param: learning_batch_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.authMode
      operator: equals
      expected: AMLToken
    - path: properties.keys
      operator: exists
      expected: false
    - path: identity.type
      operator: equals
      expected: SystemAssigned
    - path: properties.traffic
      operator: exists
      expected: true
    - path: properties.provisioningState
      operator: equals
      expected: Succeeded
    - path: properties.scoringUri
      operator: exists
      expected: true
    - path: properties.swaggerUri
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_batch_endpoint_learning_transform_job_input_output_encrypted
  name: 'AZURE MACHINE Learning_batch_endpoint: Learning Transform Job Input Output
    Encry'
  severity: MEDIUM
  for_each: learning_batch_endpoints
  param: learning_batch_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.compute.properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.compute.properties.encryption.keyVaultProperties.keyIdentifier
      operator: exists
      expected: true
    - path: properties.defaults.properties.input_data.encryption.mode
      operator: equals
      expected: key
    - path: properties.defaults.properties.output_data.encryption.mode
      operator: equals
      expected: key
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_batch_endpoint_learning_transform_job_logs_enabled
  name: 'AZURE MACHINE Learning_batch_endpoint: Learning Transform Job Logs Enabled'
  severity: LOW
  for_each: learning_batch_endpoints
  param: learning_batch_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.logging.enabled
      operator: equals
      expected: true
    - path: properties.logging.logLevel
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_batch_endpoint_learning_transform_job_private_networking_enforced
  name: 'AZURE MACHINE Learning_batch_endpoint: Learning Transform Job Private Networking'
  severity: MEDIUM
  for_each: learning_batch_endpoints
  param: learning_batch_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.compute.properties.subnet.id
      operator: exists
      expected: true
    - path: properties.compute.properties.enableNodePublicIp
      operator: equals
      expected: false
    - path: properties.defaults.invokeRequestSettings.requestTimeout
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_batch_endpoint_learning_transform_job_roles_least_privilege
  name: 'AZURE MACHINE Learning_batch_endpoint: Learning Transform Job Roles Least
    Privil'
  severity: HIGH
  for_each: learning_batch_endpoints
  param: learning_batch_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.auth_mode
      operator: equals
      expected: AADToken
    - path: properties.identity.type
      operator: equals
      expected: UserAssigned
    - path: properties.identity.user_assigned_identities
      operator: exists
      expected: true
    - path: properties.compute.type
      operator: equals
      expected: Managed
    - path: properties.compute.resource_id
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_compute_instance_data_governance_ai_notebook_encrypted
  name: 'AZURE MACHINE Learning_compute_instance: Data Governance Ai Notebook Encrypted'
  severity: MEDIUM
  for_each: learning_compute_instances
  param: learning_compute_instance
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.computeInstanceProperties.enableNodePublicIp
      operator: equals
      expected: false
    - path: properties.computeInstanceProperties.sshSettings.adminUserName
      operator: exists
      expected: true
    - path: properties.disableLocalAuth
      operator: equals
      expected: true
    - path: properties.computeInstanceProperties.personalComputeInstanceSettings.assignedUser.userObjectId
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_compute_instance_data_governance_ai_notebook_execution_role_least_privilege
  name: 'AZURE MACHINE Learning_compute_instance: Data Governance Ai Notebook Execution
    R'
  severity: HIGH
  for_each: learning_compute_instances
  param: learning_compute_instance
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.computeInstanceProperties.personalComputeInstanceSettings.assignedUser.objectId
      operator: exists
      expected: true
    - path: properties.computeInstanceProperties.personalComputeInstanceSettings.assignedUser.tenantId
      operator: exists
      expected: true
    - path: properties.computeInstanceProperties.sshSettings.adminUserName
      operator: exists
      expected: true
    - path: properties.computeInstanceProperties.setupScripts.scripts
      operator: exists
      expected: true
    - path: properties.computeInstanceProperties.personalComputeInstanceSettings.assignedUser
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_compute_instance_data_governance_ai_notebook_idle_shutdown_configured
  name: 'AZURE MACHINE Learning_compute_instance: Data Governance Ai Notebook Idle
    Shutdo'
  severity: LOW
  for_each: learning_compute_instances
  param: learning_compute_instance
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.computeInstanceProperties.idleTimeBeforeShutdown
      operator: exists
      expected: true
    - path: properties.computeInstanceProperties.idleTimeBeforeShutdown
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_compute_instance_data_governance_ai_notebook_no_public_access
  name: 'AZURE MACHINE Learning_compute_instance: Data Governance Ai Notebook No Public
    A'
  severity: CRITICAL
  for_each: learning_compute_instances
  param: learning_compute_instance
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.computeInstanceProperties.enableNodePublicIp
      operator: equals
      expected: false
    - path: properties.computeInstanceProperties.subnet.id
      operator: exists
      expected: true
    - path: properties.disableLocalAuth
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_compute_instance_data_privacy_ai_notebook_encrypted
  name: 'AZURE MACHINE Learning_compute_instance: Data Privacy Ai Notebook Encrypted'
  severity: MEDIUM
  for_each: learning_compute_instances
  param: learning_compute_instance
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.properties.sshSettings.sshPublicAccess
      operator: equals
      expected: Disabled
    - path: properties.properties.applicationSharingPolicy
      operator: equals
      expected: Personal
    - path: properties.properties.personalComputeInstanceSettings.assignedUser.userType
      operator: exists
      expected: true
    - path: properties.properties.computeInstanceAuthorizationType
      operator: equals
      expected: personal
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_compute_instance_data_privacy_ai_notebook_execution_role_least_privilege
  name: 'AZURE MACHINE Learning_compute_instance: Data Privacy Ai Notebook Execution
    Role'
  severity: HIGH
  for_each: learning_compute_instances
  param: learning_compute_instance
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.computeInstanceProperties.personalComputeInstanceSettings.assignedUser.userPrincipalId
      operator: exists
      expected: true
    - path: properties.computeInstanceProperties.personalComputeInstanceSettings.assignedUser.tenantId
      operator: exists
      expected: true
    - path: properties.computeInstanceProperties.setupScripts.scripts.creationScript.scriptData
      operator: contains
      expected: least-privilege
    - path: properties.computeInstanceProperties.computeInstanceAuthorizationType
      operator: equals
      expected: personal
    - path: properties.computeInstanceProperties.personalComputeInstanceSettings.assignedUser.objectId
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_compute_instance_data_privacy_ai_notebook_idle_shutdown_configured
  name: 'AZURE MACHINE Learning_compute_instance: Data Privacy Ai Notebook Idle Shutdown'
  severity: MEDIUM
  for_each: learning_compute_instances
  param: learning_compute_instance
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.computeInstanceProperties.idleTimeBeforeShutdown
      operator: exists
      expected: true
    - path: properties.computeInstanceProperties.idleTimeBeforeShutdown
      operator: equals
      expected: PT30M
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_compute_instance_data_privacy_ai_notebook_no_public_access
  name: 'AZURE MACHINE Learning_compute_instance: Data Privacy Ai Notebook No Public
    Access'
  severity: CRITICAL
  for_each: learning_compute_instances
  param: learning_compute_instance
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.computeInstanceProperties.setupScripts.scripts.creationScript.scriptSource
      operator: exists
      expected: false
    - path: properties.computeInstanceProperties.connectivityEndpoints.publicIpAddress
      operator: exists
      expected: false
    - path: properties.computeInstanceProperties.subnet.id
      operator: exists
      expected: true
    - path: properties.disableLocalAuth
      operator: equals
      expected: true
    - path: properties.computeInstanceProperties.personalComputeInstanceSettings.assignedUser.objectId
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_compute_instance_learning_notebook_encrypted
  name: 'AZURE MACHINE Learning_compute_instance: Learning Notebook Encrypted'
  severity: MEDIUM
  for_each: learning_compute_instances
  param: learning_compute_instance
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.computeInstanceProperties.setupScripts.scripts.creationScript.scriptData
      operator: exists
      expected: true
    - path: properties.computeInstanceProperties.personalComputeInstanceSettings.assignedUser.userPrincipalName
      operator: exists
      expected: true
    - path: properties.disableLocalAuth
      operator: equals
      expected: false
    - path: properties.computeInstanceProperties.enableNodePublicIp
      operator: equals
      expected: false
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_compute_instance_learning_notebook_execution_role_least_privilege
  name: 'AZURE MACHINE Learning_compute_instance: Learning Notebook Execution Role
    Least'
  severity: HIGH
  for_each: learning_compute_instances
  param: learning_compute_instance
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.computeInstanceProperties.personalComputeInstanceSettings.assignedUser.objectId
      operator: exists
      expected: true
    - path: properties.computeInstanceProperties.personalComputeInstanceSettings.assignedUser.tenantId
      operator: exists
      expected: true
    - path: properties.computeInstanceProperties.applications
      operator: exists
      expected: true
    - path: properties.computeInstanceProperties.connectivityEndpoints.privateIpAddress
      operator: exists
      expected: true
    - path: properties.disableLocalAuth
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_compute_instance_learning_notebook_idle_shutdown_configured
  name: 'AZURE MACHINE Learning_compute_instance: Learning Notebook Idle Shutdown
    Configu'
  severity: LOW
  for_each: learning_compute_instances
  param: learning_compute_instance
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.computeInstanceProperties.idleTimeBeforeShutdown
      operator: exists
      expected: true
    - path: properties.computeInstanceProperties.idleTimeBeforeShutdown
      operator: equals
      expected: null
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_compute_instance_learning_notebook_no_public_access
  name: 'AZURE MACHINE Learning_compute_instance: Learning Notebook No Public Access'
  severity: CRITICAL
  for_each: learning_compute_instances
  param: learning_compute_instance
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.applicationSharingPolicy
      operator: equals
      expected: Personal
    - path: properties.computeInstanceAuthorizationType
      operator: equals
      expected: personal
    - path: properties.sshSettings.sshPublicAccess
      operator: equals
      expected: Disabled
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_dataset_ai_services_ai_dataset_encrypted_at_rest_cmek
  name: 'AZURE MACHINE Learning_dataset: Ai Services Ai Dataset Encrypted At Rest
    Cmek'
  severity: MEDIUM
  for_each: learning_datasets
  param: learning_dataset
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.encryption.keyVaultProperties.keyVaultArmId
      operator: exists
      expected: true
    - path: properties.encryption.keyVaultProperties.keyName
      operator: exists
      expected: true
    - path: properties.encryption.keySource
      operator: equals
      expected: Microsoft.Keyvault
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_dataset_ai_services_ai_dataset_public_access_blocked
  name: 'AZURE MACHINE Learning_dataset: Ai Services Ai Dataset Public Access Blocked'
  severity: CRITICAL
  for_each: learning_datasets
  param: learning_dataset
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.publicNetworkAccess
      operator: equals
      expected: Disabled
    - path: properties.datasetAccess.publicAccess
      operator: equals
      expected: false
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_dataset_ai_services_dataset_access_logging_enabled
  name: 'AZURE MACHINE Learning_dataset: Ai Services Dataset Access Logging Enabled'
  severity: MEDIUM
  for_each: learning_datasets
  param: learning_dataset
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.datasetAccessLoggingEnabled
      operator: equals
      expected: true
    - path: properties.loggingConfiguration.enableDatasetAccessLogging
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_dataset_ai_services_dataset_lifecycle_policy_configured
  name: 'AZURE MACHINE Learning_dataset: Ai Services Dataset Lifecycle Policy Configured'
  severity: MEDIUM
  for_each: learning_datasets
  param: learning_dataset
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.datasetSource.azureMLDatastoreReference.lifecyclePolicy
      operator: exists
      expected: true
    - path: properties.datasetSource.azureMLDatastoreReference.lifecyclePolicy.enabled
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_dataset_ai_services_dataset_s3_block_public_access
  name: 'AZURE MACHINE Learning_dataset: Ai Services Dataset S3 Block Public Access'
  severity: CRITICAL
  for_each: learning_datasets
  param: learning_dataset
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.datastoreType
      operator: equals
      expected: AzureBlob
    - path: properties.publicNetworkAccess
      operator: equals
      expected: Disabled
    - path: properties.datastore.properties.blockBlobPublicAccess
      operator: equals
      expected: true
    - path: properties.datastore.properties.allowBlobPublicAccess
      operator: equals
      expected: false
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_dataset_ai_services_dataset_s3_encrypted_at_rest
  name: 'AZURE MACHINE Learning_dataset: Ai Services Dataset S3 Encrypted At Rest'
  severity: MEDIUM
  for_each: learning_datasets
  param: learning_dataset
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.encryption.keyVaultProperties.keyIdentifier
      operator: exists
      expected: true
    - path: properties.datastore_type
      operator: equals
      expected: AzureBlob
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_deployment_data_governance_ai_endpoint_config_content_type_whitelist_enforced
  name: 'AZURE MACHINE Learning_deployment: Data Governance Ai Endpoint Config Content
    Ty'
  severity: MEDIUM
  for_each: learning_deployments
  param: learning_deployment
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.endpointComputeConfiguration.dataGovernance.contentTypeWhitelist
      operator: exists
      expected: true
    - path: properties.endpointComputeConfiguration.dataGovernance.contentTypeWhitelist
      operator: contains
      expected: application/json
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_deployment_data_governance_ai_endpoint_config_data_capture_bucket_encrypted_private
  name: 'AZURE MACHINE Learning_deployment: Data Governance Ai Endpoint Config Data
    Captu'
  severity: MEDIUM
  for_each: learning_deployments
  param: learning_deployment
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.endpointComputeType
      operator: exists
      expected: true
    - path: properties.dataCaptureConfig.destinationConfig.storageAccountName
      operator: exists
      expected: true
    - path: properties.dataCaptureConfig.destinationConfig.containerName
      operator: exists
      expected: true
    - path: properties.dataCaptureConfig.destinationConfig.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.dataCaptureConfig.destinationConfig.encryption.keyVaultProperties.keyIdentifier
      operator: exists
      expected: true
    - path: properties.dataCaptureConfig.destinationConfig.publicNetworkAccess
      operator: equals
      expected: Disabled
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_deployment_data_governance_ai_endpoint_config_kms_keys_restricted
  name: 'AZURE MACHINE Learning_deployment: Data Governance Ai Endpoint Config KMS
    Keys R'
  severity: HIGH
  for_each: learning_deployments
  param: learning_deployment
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.endpointComputeConfiguration.encryption.keyEncryptionKeyIdentity
      operator: exists
      expected: true
    - path: properties.endpointComputeConfiguration.encryption.keyEncryptionKeyUrl
      operator: exists
      expected: true
    - path: properties.endpointComputeConfiguration.encryption.keySource
      operator: equals
      expected: Microsoft.KeyVault
    - path: properties.dataGovernance.aiEndpointConfig.kmsKeyRestriction
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_deployment_data_privacy_ai_endpoint_config_capture_store_encrypted_and_private
  name: 'AZURE MACHINE Learning_deployment: Data Privacy Ai Endpoint Config Capture
    Store'
  severity: MEDIUM
  for_each: learning_deployments
  param: learning_deployment
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.endpointComputeType
      operator: exists
      expected: true
    - path: properties.dataCapture.enabled
      operator: equals
      expected: true
    - path: properties.dataCapture.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.dataCapture.encryption.keyVaultProperties.keyIdentifier
      operator: exists
      expected: true
    - path: properties.dataCapture.destinationStorageAccount.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.dataCapture.destinationStorageAccount.publicNetworkAccess
      operator: equals
      expected: Disabled
    - path: properties.endpointConfiguration.traffic.privateEndpointEnabled
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_deployment_data_privacy_ai_endpoint_config_content_type_whitelist_enforced
  name: 'AZURE MACHINE Learning_deployment: Data Privacy Ai Endpoint Config Content
    Type'
  severity: MEDIUM
  for_each: learning_deployments
  param: learning_deployment
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.endpointConfiguration.contentTypeWhitelist
      operator: exists
      expected: true
    - path: properties.endpointConfiguration.contentTypeWhitelist
      operator: contains
      expected: application/json
    - path: properties.endpointConfiguration.enforceContentTypeWhitelist
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_deployment_data_privacy_ai_endpoint_config_kms_keys_restricted
  name: 'AZURE MACHINE Learning_deployment: Data Privacy Ai Endpoint Config KMS Keys
    Rest'
  severity: HIGH
  for_each: learning_deployments
  param: learning_deployment
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.endpointComputeType
      operator: equals
      expected: AzureMLOnlineEndpoints
    - path: properties.dataCollection.encryption.keyVaultProperties.keyIdentifier
      operator: exists
      expected: true
    - path: properties.dataCollection.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.modelDataCollection.encryption.keyVaultProperties.keyIdentifier
      operator: exists
      expected: true
    - path: properties.modelDataCollection.encryption.status
      operator: equals
      expected: Enabled
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_deployment_learning_endpoint_config_content_type_whitelist_enforced
  name: 'AZURE MACHINE Learning_deployment: Learning Endpoint Config Content Type
    Whiteli'
  severity: LOW
  for_each: learning_deployments
  param: learning_deployment
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.endpointComputeType
      operator: exists
      expected: true
    - path: properties.computeConfiguration.contentTypeWhitelist
      operator: exists
      expected: true
    - path: properties.computeConfiguration.contentTypeWhitelist
      operator: contains
      expected: application/json
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_deployment_learning_endpoint_config_data_capture_bucket_encrypted_private
  name: 'AZURE MACHINE Learning_deployment: Learning Endpoint Config Data Capture
    Bucket'
  severity: MEDIUM
  for_each: learning_deployments
  param: learning_deployment
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.endpointComputeType
      operator: exists
      expected: true
    - path: properties.dataCapture.enabled
      operator: equals
      expected: true
    - path: properties.dataCapture.destination.storageAccount.encryption.keySource
      operator: equals
      expected: Microsoft.Storage
    - path: properties.dataCapture.destination.storageAccount.properties.allowBlobPublicAccess
      operator: equals
      expected: false
    - path: properties.dataCapture.destination.storageAccount.properties.networkRuleSet.defaultAction
      operator: equals
      expected: Deny
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_deployment_learning_endpoint_config_kms_keys_restricted
  name: 'AZURE MACHINE Learning_deployment: Learning Endpoint Config KMS Keys Restricted'
  severity: HIGH
  for_each: learning_deployments
  param: learning_deployment
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.endpointComputeType
      operator: exists
      expected: true
    - path: properties.properties.kvTags
      operator: exists
      expected: true
    - path: properties.properties.environmentVariables
      operator: exists
      expected: true
    - path: properties.scaleSettings.targetUtilizationPercentage
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_endpoint_ai_services_ai_endpoint_authn_required
  name: 'AZURE MACHINE Learning_endpoint: Ai Services Ai Endpoint Authn Required'
  severity: LOW
  for_each: learning_endpoints
  param: learning_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.auth_mode
      operator: equals
      expected: Key
    - path: properties.keys.primary_key
      operator: exists
      expected: true
    - path: properties.keys.secondary_key
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_endpoint_ai_services_ai_endpoint_authz_policies_enforced
  name: 'AZURE MACHINE Learning_endpoint: Ai Services Ai Endpoint Authz Policies Enforced'
  severity: LOW
  for_each: learning_endpoints
  param: learning_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.auth_mode
      operator: equals
      expected: key
    - path: properties.properties.enforceAccessToDefaultSecretStores
      operator: equals
      expected: true
    - path: properties.properties.authConfig.authType
      operator: exists
      expected: true
    - path: properties.identity.type
      operator: equals
      expected: SystemAssigned
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_endpoint_ai_services_ai_endpoint_private_networking_enforced
  name: 'AZURE MACHINE Learning_endpoint: Ai Services Ai Endpoint Private Networking
    Enfo'
  severity: MEDIUM
  for_each: learning_endpoints
  param: learning_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.publicNetworkAccess
      operator: equals
      expected: Disabled
    - path: properties.privateEndpointConnections
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_endpoint_ai_services_ai_endpoint_rate_limiting_enabled
  name: 'AZURE MACHINE Learning_endpoint: Ai Services Ai Endpoint Rate Limiting Enabled'
  severity: LOW
  for_each: learning_endpoints
  param: learning_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.traffic
      operator: exists
      expected: true
    - path: properties.traffic.rateLimitingEnabled
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_endpoint_ai_services_ai_endpoint_waf_attached
  name: 'AZURE MACHINE Learning_endpoint: Ai Services Ai Endpoint Waf Attached'
  severity: LOW
  for_each: learning_endpoints
  param: learning_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.traffic.web_application_firewall.enabled
      operator: equals
      expected: true
    - path: properties.traffic.web_application_firewall.policy_id
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_endpoint_ai_services_inference_endpoint_data_capture_s3_encrypted
  name: 'AZURE MACHINE Learning_endpoint: Ai Services Inference Endpoint Data Capture
    S3'
  severity: MEDIUM
  for_each: learning_endpoints
  param: learning_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.compute.properties.dataCapture.blobStorage.encryption.keySource
      operator: equals
      expected: Microsoft.KeyVault
    - path: properties.compute.properties.dataCapture.blobStorage.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.compute.properties.dataCapture.enabled
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_endpoint_ai_services_inference_endpoint_group_restrictive
  name: 'AZURE MACHINE Learning_endpoint: Ai Services Inference Endpoint Group Restrictiv'
  severity: LOW
  for_each: learning_endpoints
  param: learning_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.traffic
      operator: exists
      expected: true
    - path: properties.auth_mode
      operator: equals
      expected: AADToken
    - path: properties.public_network_access
      operator: equals
      expected: Disabled
    - path: properties.endpoint_compute_type
      operator: equals
      expected: Managed
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_endpoint_ai_services_inference_endpoint_kms_encryption_enabled
  name: 'AZURE MACHINE Learning_endpoint: Ai Services Inference Endpoint KMS Encryption
    E'
  severity: HIGH
  for_each: learning_endpoints
  param: learning_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.encryption.keySource
      operator: equals
      expected: Microsoft.KeyVault
    - path: properties.encryption.keyVaultProperties.keyIdentifier
      operator: exists
      expected: true
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_endpoint_ai_services_inference_endpoint_private_networking_enforced
  name: 'AZURE MACHINE Learning_endpoint: Ai Services Inference Endpoint Private Networki'
  severity: MEDIUM
  for_each: learning_endpoints
  param: learning_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.networkConfiguration.privateEndpointEnabled
      operator: equals
      expected: true
    - path: properties.networkConfiguration.publicNetworkAccess
      operator: equals
      expected: Disabled
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_endpoint_ai_services_model_deployment_endpoint_in_vpc
  name: 'AZURE MACHINE Learning_endpoint: Ai Services Model Deployment Endpoint In
    VPC'
  severity: LOW
  for_each: learning_endpoints
  param: learning_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.subnet.id
      operator: exists
      expected: true
    - path: properties.publicNetworkAccess
      operator: equals
      expected: Disabled
    - path: properties.privateEndpointConnections
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_endpoint_ai_services_model_deployment_kms_encryption_enabled
  name: 'AZURE MACHINE Learning_endpoint: Ai Services Model Deployment KMS Encryption
    Ena'
  severity: HIGH
  for_each: learning_endpoints
  param: learning_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.deploymentConfiguration.properties.encryption.keyVaultProperties.keyIdentifier
      operator: exists
      expected: true
    - path: properties.deploymentConfiguration.properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.deploymentConfiguration.properties.encryption.keySource
      operator: equals
      expected: Microsoft.KeyVault
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_endpoint_ai_services_model_deployment_logging_enabled
  name: 'AZURE MACHINE Learning_endpoint: Ai Services Model Deployment Logging Enabled'
  severity: MEDIUM
  for_each: learning_endpoints
  param: learning_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.traffic
      operator: exists
      expected: true
    - path: properties.traffic.*.deploymentName
      operator: exists
      expected: true
    - path: properties.mirrorTraffic
      operator: exists
      expected: true
    - path: properties.endpoint_compute_type
      operator: equals
      expected: Managed
    - path: properties.auth_mode
      operator: exists
      expected: true
    - path: properties.provisioning_state
      operator: equals
      expected: Succeeded
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_endpoint_ai_services_prompt_gateway_authn_required
  name: 'AZURE MACHINE Learning_endpoint: Ai Services Prompt Gateway Authn Required'
  severity: LOW
  for_each: learning_endpoints
  param: learning_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.auth_mode
      operator: equals
      expected: Key
    - path: properties.ai_services_prompt_gateway.authentication_enabled
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_endpoint_ai_services_prompt_gateway_private_networking_enforced
  name: 'AZURE MACHINE Learning_endpoint: Ai Services Prompt Gateway Private Networking
    E'
  severity: MEDIUM
  for_each: learning_endpoints
  param: learning_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.aiServicesPromptGateway.privateNetworkingEnforced
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_endpoint_ai_services_prompt_gateway_token_scopes_least_privilege
  name: 'AZURE MACHINE Learning_endpoint: Ai Services Prompt Gateway Token Scopes
    Least P'
  severity: HIGH
  for_each: learning_endpoints
  param: learning_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.ai_services_prompt_gateway.token_scopes
      operator: exists
      expected: true
    - path: properties.ai_services_prompt_gateway.token_scopes
      operator: contains
      expected: prompt.read
    - path: properties.ai_services_prompt_gateway.token_scopes
      operator: equals
      expected:
      - prompt.read
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_experiment_data_governance_ai_experiment_logs_enabled
  name: 'AZURE MACHINE Learning_experiment: Data Governance Ai Experiment Logs Enabled'
  severity: LOW
  for_each: learning_experiments
  param: learning_experiment
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.logging.enableDataGovernance
      operator: equals
      expected: true
    - path: properties.logging.aiExperimentLogs.enabled
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_experiment_data_governance_ai_experiment_metadata_store_encrypted
  name: 'AZURE MACHINE Learning_experiment: Data Governance Ai Experiment Metadata
    Store'
  severity: MEDIUM
  for_each: learning_experiments
  param: learning_experiment
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.encryption.keyVaultProperties.keyVaultArmId
      operator: exists
      expected: true
    - path: properties.encryption.keyVaultProperties.keyIdentifier
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_experiment_data_governance_ai_experiment_rbac_least_privilege
  name: 'AZURE MACHINE Learning_experiment: Data Governance Ai Experiment RBAC Least
    Priv'
  severity: HIGH
  for_each: learning_experiments
  param: learning_experiment
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.roleBasedAccessControl.enabled
      operator: equals
      expected: true
    - path: properties.roleBasedAccessControl.principalPermissions
      operator: exists
      expected: true
    - path: properties.dataGovernance.enabled
      operator: equals
      expected: true
    - path: properties.dataGovernance.rbacConfiguration.minimumPermissions
      operator: equals
      expected: true
    - path: properties.experimentAccess.restrictedAccess
      operator: equals
      expected: true
    - path: properties.roleAssignments.*.roleDefinitionName
      operator: contains
      expected: Reader
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_experiment_data_privacy_ai_experiment_logs_enabled
  name: 'AZURE MACHINE Learning_experiment: Data Privacy Ai Experiment Logs Enabled'
  severity: MEDIUM
  for_each: learning_experiments
  param: learning_experiment
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.logging.enabled
      operator: equals
      expected: true
    - path: properties.dataPrivacy.experimentLogsEnabled
      operator: equals
      expected: true
    - path: properties.experiment.logging.dataPrivacyCompliant
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_experiment_data_privacy_ai_experiment_metadata_store_encrypted
  name: 'AZURE MACHINE Learning_experiment: Data Privacy Ai Experiment Metadata Store
    Enc'
  severity: MEDIUM
  for_each: learning_experiments
  param: learning_experiment
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.encryption.keyVaultProperties.keyVaultArmId
      operator: exists
      expected: true
    - path: properties.encryption.keyVaultProperties.keyIdentifier
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_experiment_data_privacy_ai_experiment_rbac_least_privilege
  name: 'AZURE MACHINE Learning_experiment: Data Privacy Ai Experiment RBAC Least
    Privile'
  severity: HIGH
  for_each: learning_experiments
  param: learning_experiment
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.identity.type
      operator: equals
      expected: SystemAssigned
    - path: properties.publicNetworkAccess
      operator: equals
      expected: Disabled
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.hbiWorkspace
      operator: equals
      expected: true
    - path: properties.allowPublicAccessWhenBehindVnet
      operator: equals
      expected: false
    - path: properties.sharedPrivateLinkResources
      operator: exists
      expected: true
    - path: properties.v1LegacyMode
      operator: equals
      expected: false
    - path: properties.storageAccount
      operator: exists
      expected: true
    - path: properties.keyVault
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_experiment_logs_enabled
  name: 'AZURE MACHINE Learning_experiment: Logs Enabled'
  severity: LOW
  for_each: learning_experiments
  param: learning_experiment
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.logging.enabled
      operator: equals
      expected: true
    - path: properties.diagnosticSettings
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_experiment_metadata_store_encrypted
  name: 'AZURE MACHINE Learning_experiment: Metadata Store Encrypted'
  severity: MEDIUM
  for_each: learning_experiments
  param: learning_experiment
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.encryption.keyVaultProperties.keyVaultArmId
      operator: exists
      expected: true
    - path: properties.encryption.keyVaultProperties.keyIdentifier
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_experiment_rbac_least_privilege
  name: 'AZURE MACHINE Learning_experiment: RBAC Least Privilege'
  severity: HIGH
  for_each: learning_experiments
  param: learning_experiment
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.roleAssignments
      operator: exists
      expected: true
    - path: properties.roleAssignments[*].roleDefinitionId
      operator: contains
      expected: /subscriptions/{subscriptionId}/providers/Microsoft.Authorization/roleDefinitions/
    - path: properties.roleAssignments[*].principalType
      operator: equals
      expected: User
    - path: properties.builtInRoles
      operator: contains
      expected: Contributor
    - path: properties.customRoles
      operator: exists
      expected: true
    - path: properties.permissions.actions
      operator: exists
      expected: true
    - path: properties.permissions.dataActions
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_feature_store_ai_services_feature_store_offline_store_block_public_access
  name: 'AZURE MACHINE Learning_feature_store: Ai Services Feature Store Offline Store
    Bl'
  severity: CRITICAL
  for_each: learning_feature_stores
  param: learning_feature_store
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.featureStoreSettings.offlineStoreConnectionSettings.publicNetworkAccess
      operator: equals
      expected: Disabled
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_feature_store_ai_services_feature_store_offline_store_s3_encrypted
  name: 'AZURE MACHINE Learning_feature_store: Ai Services Feature Store Offline Store
    S3'
  severity: MEDIUM
  for_each: learning_feature_stores
  param: learning_feature_store
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.offline_store.s3.encryption.enabled
      operator: equals
      expected: true
    - path: properties.offline_store.s3.encryption.key_source
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_feature_store_ai_services_feature_store_online_store_kms_encryption_enabled
  name: 'AZURE MACHINE Learning_feature_store: Ai Services Feature Store Online Store
    KMS'
  severity: HIGH
  for_each: learning_feature_stores
  param: learning_feature_store
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.featureStoreSettings.onlineStoreConnectionString
      operator: exists
      expected: true
    - path: properties.encryption.keySource
      operator: equals
      expected: Microsoft.KeyVault
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_feature_store_ai_services_feature_store_private_networking_enforced
  name: 'AZURE MACHINE Learning_feature_store: Ai Services Feature Store Private Networki'
  severity: MEDIUM
  for_each: learning_feature_stores
  param: learning_feature_store
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.publicNetworkAccess
      operator: equals
      expected: Disabled
    - path: properties.privateEndpointConnections
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_feature_store_ai_services_feature_store_rbac_least_privilege
  name: 'AZURE MACHINE Learning_feature_store: Ai Services Feature Store RBAC Least
    Privi'
  severity: HIGH
  for_each: learning_feature_stores
  param: learning_feature_store
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.publicNetworkAccess
      operator: equals
      expected: Disabled
    - path: identity.type
      operator: exists
      expected: true
    - path: properties.featureStoreSettings.computeRuntime.sparkRuntimeVersion
      operator: exists
      expected: true
    - path: properties.managedNetwork.isolationMode
      operator: equals
      expected: AllowInternetOutbound
    - path: properties.featureStoreSettings.onlineStoreConnectionName
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_feature_store_ai_services_vector_index_authn_required
  name: 'AZURE MACHINE Learning_feature_store: Ai Services Vector Index Authn Required'
  severity: LOW
  for_each: learning_feature_stores
  param: learning_feature_store
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.aiServicesVectorIndexConfig.authenticationRequired
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_feature_store_ai_services_vector_index_encrypted_at_rest_cmek
  name: 'AZURE MACHINE Learning_feature_store: Ai Services Vector Index Encrypted
    At Rest'
  severity: MEDIUM
  for_each: learning_feature_stores
  param: learning_feature_store
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.aiServices.vectorIndex.encryption.keySource
      operator: equals
      expected: Microsoft.KeyVault
    - path: properties.aiServices.vectorIndex.encryption.keyVaultProperties.keyIdentifier
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_feature_store_ai_services_vector_index_private_networking_enforced
  name: 'AZURE MACHINE Learning_feature_store: Ai Services Vector Index Private Networkin'
  severity: MEDIUM
  for_each: learning_feature_stores
  param: learning_feature_store
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.aiServicesVectorIndex.privateNetworkingEnforced
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_feature_store_ai_services_vector_index_rbac_tenant_isolation_enforced
  name: 'AZURE MACHINE Learning_feature_store: Ai Services Vector Index RBAC Tenant
    Isolation Enforced'
  severity: MEDIUM
  for_each: learning_feature_stores
  param: learning_feature_store
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.aiServices.vectorIndex.rbac.tenantIsolationEnabled
      operator: equals
      expected: true
    - path: properties.aiServices.vectorIndex.rbac.tenantId
      operator: exists
      expected: true
    - path: properties.aiServices.vectorIndex.accessControl.type
      operator: equals
      expected: RBAC
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_hyperdrive_run_data_governance_ai_hpo_logs_enabled
  name: 'AZURE MACHINE Learning_hyperdrive_run: Data Governance Ai Hpo Logs Enabled'
  severity: LOW
  for_each: learning_hyperdrive_runs
  param: learning_hyperdrive_run
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.data_governance.ai_hpo_logs_enabled
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_hyperdrive_run_data_governance_ai_hpo_private_networking_enforced
  name: 'AZURE MACHINE Learning_hyperdrive_run: Data Governance Ai Hpo Private Networking'
  severity: MEDIUM
  for_each: learning_hyperdrive_runs
  param: learning_hyperdrive_run
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.compute_target.properties.subnet.id
      operator: exists
      expected: true
    - path: properties.compute_target.properties.disable_public_ip
      operator: equals
      expected: true
    - path: properties.settings.data_reference_configuration.data_reference_type
      operator: equals
      expected: datastore
    - path: properties.settings.enable_private_link
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_hyperdrive_run_data_governance_ai_hpo_roles_least_privilege
  name: 'AZURE MACHINE Learning_hyperdrive_run: Data Governance Ai Hpo Roles Least
    Privil'
  severity: HIGH
  for_each: learning_hyperdrive_runs
  param: learning_hyperdrive_run
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.identity.type
      operator: equals
      expected: UserAssigned
    - path: properties.identity.userAssignedIdentities
      operator: exists
      expected: true
    - path: properties.experimentSettings.maxConcurrentTrials
      operator: exists
      expected: true
    - path: properties.runConfiguration.dataReferences
      operator: exists
      expected: true
    - path: properties.access.roleAssignments
      operator: exists
      expected: true
    - path: properties.security.dataGovernancePolicy.enableDataAccess
      operator: equals
      expected: true
    - path: properties.security.roleBasedAccessControl.enabled
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_hyperdrive_run_data_privacy_ai_hpo_logs_enabled
  name: 'AZURE MACHINE Learning_hyperdrive_run: Data Privacy Ai Hpo Logs Enabled'
  severity: MEDIUM
  for_each: learning_hyperdrive_runs
  param: learning_hyperdrive_run
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.data_privacy.ai_hpo_logs_enabled
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_hyperdrive_run_data_privacy_ai_hpo_private_networking_enforced
  name: 'AZURE MACHINE Learning_hyperdrive_run: Data Privacy Ai Hpo Private Networking
    En'
  severity: MEDIUM
  for_each: learning_hyperdrive_runs
  param: learning_hyperdrive_run
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.compute.private_network_enabled
      operator: equals
      expected: true
    - path: properties.compute.subnet_resource_id
      operator: exists
      expected: true
    - path: properties.compute.enable_node_public_ip
      operator: equals
      expected: false
    - path: properties.data_privacy.ai_hpo_private_networking
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_hyperdrive_run_data_privacy_ai_hpo_roles_least_privilege
  name: 'AZURE MACHINE Learning_hyperdrive_run: Data Privacy Ai Hpo Roles Least Privilege'
  severity: HIGH
  for_each: learning_hyperdrive_runs
  param: learning_hyperdrive_run
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.compute_target.identity.type
      operator: equals
      expected: SystemAssigned
    - path: properties.experiment.workspace.identity.principal_assignments
      operator: exists
      expected: true
    - path: properties.user_account_credentials.username
      operator: exists
      expected: false
    - path: properties.run_configuration.data_references.*.datastore_name
      operator: exists
      expected: true
    - path: properties.hyperparameter_sampling.policy.type
      operator: exists
      expected: true
    - path: properties.primary_metric_config.goal
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_hyperdrive_run_learning_hpo_logs_enabled
  name: 'AZURE MACHINE Learning_hyperdrive_run: Learning Hpo Logs Enabled'
  severity: LOW
  for_each: learning_hyperdrive_runs
  param: learning_hyperdrive_run
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.hyperParameterTuning.enableLogging
      operator: equals
      expected: true
    - path: properties.logging.enabled
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_hyperdrive_run_learning_hpo_private_networking_enforced
  name: 'AZURE MACHINE Learning_hyperdrive_run: Learning Hpo Private Networking Enforced'
  severity: MEDIUM
  for_each: learning_hyperdrive_runs
  param: learning_hyperdrive_run
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.compute_target.properties.subnet.id
      operator: exists
      expected: true
    - path: properties.compute_target.properties.remoteLoginPortPublicAccess
      operator: equals
      expected: Disabled
    - path: properties.private_endpoint_connections
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_hyperdrive_run_learning_hpo_roles_least_privilege
  name: 'AZURE MACHINE Learning_hyperdrive_run: Learning Hpo Roles Least Privilege'
  severity: HIGH
  for_each: learning_hyperdrive_runs
  param: learning_hyperdrive_run
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.authorization.principalId
      operator: exists
      expected: true
    - path: properties.authorization.roleAssignments
      operator: exists
      expected: true
    - path: properties.authorization.permissions
      operator: contains
      expected: Microsoft.MachineLearningServices/workspaces/experiments/runs/read
    - path: properties.authorization.permissions
      operator: contains
      expected: Microsoft.MachineLearningServices/workspaces/experiments/runs/write
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_job_ai_services_training_job_inter_container_traffic_encryption_enabled
  name: 'AZURE MACHINE Learning_job: Ai Services Training Job Inter Container Traffic
    Enc'
  severity: HIGH
  for_each: learning_jobs
  param: learning_job
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.compute.properties.enableInterContainerTrafficEncryption
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_job_ai_services_training_job_network_isolation_enabled
  name: 'AZURE MACHINE Learning_job: Ai Services Training Job Network Isolation Enabled'
  severity: MEDIUM
  for_each: learning_jobs
  param: learning_job
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.services.training.networking.isolationMode
      operator: equals
      expected: AllowInternetOutbound
    - path: properties.services.training.networking.publicNetworkAccess
      operator: equals
      expected: Disabled
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_job_ai_services_training_job_output_encryption_enabled
  name: 'AZURE MACHINE Learning_job: Ai Services Training Job Output Encryption Enabled'
  severity: HIGH
  for_each: learning_jobs
  param: learning_job
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.services.aml.outputDatastoreAuthMode
      operator: exists
      expected: true
    - path: properties.outputs.encryption.keyVaultProperties.keyVaultArmId
      operator: exists
      expected: true
    - path: properties.outputs.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.environmentVariables.AZURE_ML_OUTPUT_ENCRYPTED
      operator: equals
      expected: 'true'
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_job_ai_services_training_job_volume_encryption_enabled
  name: 'AZURE MACHINE Learning_job: Ai Services Training Job Volume Encryption Enabled'
  severity: HIGH
  for_each: learning_jobs
  param: learning_job
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.compute.properties.vmSize
      operator: exists
      expected: true
    - path: properties.services.training.properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.services.training.properties.encryption.keyVaultProperties.keyIdentifier
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_job_ai_services_training_job_vpc_configured
  name: 'AZURE MACHINE Learning_job: Ai Services Training Job VPC Configured'
  severity: LOW
  for_each: learning_jobs
  param: learning_job
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.compute.target
      operator: exists
      expected: true
    - path: properties.compute.instanceType
      operator: exists
      expected: true
    - path: properties.services.jupyter.endpoint
      operator: exists
      expected: true
    - path: properties.services.tensorboard.endpoint
      operator: exists
      expected: true
    - path: properties.environment.python.condaDependencies
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_job_ai_services_training_pipeline_private_networking_enforced
  name: 'AZURE MACHINE Learning_job: Ai Services Training Pipeline Private Networking
    Enf'
  severity: MEDIUM
  for_each: learning_jobs
  param: learning_job
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.services.training.networking.isolation_mode
      operator: equals
      expected: AllowOnlyApprovedOutbound
    - path: properties.compute.target
      operator: exists
      expected: true
    - path: properties.compute.target_properties.subnet_resource_id
      operator: exists
      expected: true
    - path: properties.services.training.networking.outbound_rules
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_job_ai_services_training_pipeline_secrets_from_vault_only
  name: 'AZURE MACHINE Learning_job: Ai Services Training Pipeline Secrets From Vault
    Only'
  severity: HIGH
  for_each: learning_jobs
  param: learning_job
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.services.training.secrets.source
      operator: equals
      expected: KeyVault
    - path: properties.services.training.secrets.keyVaultUri
      operator: exists
      expected: true
    - path: properties.services.training.pipeline.secretsConfiguration.source
      operator: equals
      expected: vault
    - path: properties.services.training.pipeline.secretsConfiguration.allowPlainTextSecrets
      operator: equals
      expected: false
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_job_data_governance_ai_training_job_input_output_encrypted
  name: 'AZURE MACHINE Learning_job: Data Governance Ai Training Job Input Output
    Encrypt'
  severity: MEDIUM
  for_each: learning_jobs
  param: learning_job
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.compute.properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.inputs.data.encryption.enabled
      operator: equals
      expected: true
    - path: properties.outputs.data.encryption.enabled
      operator: equals
      expected: true
    - path: properties.datastore.encryption.keySource
      operator: equals
      expected: Microsoft.KeyVault
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_job_data_governance_ai_training_job_logs_enabled
  name: 'AZURE MACHINE Learning_job: Data Governance Ai Training Job Logs Enabled'
  severity: LOW
  for_each: learning_jobs
  param: learning_job
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.services.tracking.enabled
      operator: equals
      expected: true
    - path: properties.services.dataGovernance.enabled
      operator: equals
      expected: true
    - path: properties.logging.jobLogs.enabled
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_job_data_governance_ai_training_job_private_networking_enforced
  name: 'AZURE MACHINE Learning_job: Data Governance Ai Training Job Private Networking
    E'
  severity: MEDIUM
  for_each: learning_jobs
  param: learning_job
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.compute.computeType
      operator: equals
      expected: ComputeInstance
    - path: properties.compute.properties.subnet.id
      operator: exists
      expected: true
    - path: properties.compute.properties.enableNodePublicIp
      operator: equals
      expected: false
    - path: properties.services.Jupyter.accessType
      operator: equals
      expected: Private
    - path: properties.services.JupyterLab.accessType
      operator: equals
      expected: Private
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_job_data_governance_ai_training_job_roles_least_privilege
  name: 'AZURE MACHINE Learning_job: Data Governance Ai Training Job Roles Least Privileg'
  severity: HIGH
  for_each: learning_jobs
  param: learning_job
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.identity.type
      operator: equals
      expected: UserAssigned
    - path: properties.identity.userAssignedIdentities
      operator: exists
      expected: true
    - path: properties.services
      operator: exists
      expected: true
    - path: properties.compute.target
      operator: exists
      expected: true
    - path: properties.experimentName
      operator: exists
      expected: true
    - path: properties.environment.docker.baseImage
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_job_data_privacy_ai_training_job_input_output_encrypted
  name: 'AZURE MACHINE Learning_job: Data Privacy Ai Training Job Input Output Encrypted'
  severity: MEDIUM
  for_each: learning_jobs
  param: learning_job
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.compute.properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.inputs.encryption.keyVaultProperties.keyIdentifier
      operator: exists
      expected: true
    - path: properties.outputs.encryption.keyVaultProperties.keyIdentifier
      operator: exists
      expected: true
    - path: properties.datastore.encryption.keySource
      operator: equals
      expected: Microsoft.KeyVault
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_job_data_privacy_ai_training_job_logs_enabled
  name: 'AZURE MACHINE Learning_job: Data Privacy Ai Training Job Logs Enabled'
  severity: MEDIUM
  for_each: learning_jobs
  param: learning_job
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.services.tracking.enabled
      operator: equals
      expected: true
    - path: properties.environment_variables.AZUREML_DATAREFERENCE_LOGGING_ENABLED
      operator: equals
      expected: 'true'
    - path: properties.compute.properties.enable_node_public_ip
      operator: equals
      expected: false
    - path: properties.experiment_name
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_job_data_privacy_ai_training_job_private_networking_enforced
  name: 'AZURE MACHINE Learning_job: Data Privacy Ai Training Job Private Networking
    Enfo'
  severity: MEDIUM
  for_each: learning_jobs
  param: learning_job
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.compute.properties.subnet.id
      operator: exists
      expected: true
    - path: properties.compute.properties.enableNodePublicIp
      operator: equals
      expected: false
    - path: properties.services.*.properties.publicFqdn
      operator: exists
      expected: false
    - path: properties.networking.isolation_mode
      operator: equals
      expected: AllowOnlyApprovedOutbound
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_job_data_privacy_ai_training_job_roles_least_privilege
  name: 'AZURE MACHINE Learning_job: Data Privacy Ai Training Job Roles Least Privilege'
  severity: HIGH
  for_each: learning_jobs
  param: learning_job
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.identity.type
      operator: equals
      expected: UserAssigned
    - path: properties.identity.userAssignedIdentities
      operator: exists
      expected: true
    - path: properties.compute.target
      operator: exists
      expected: true
    - path: properties.services
      operator: exists
      expected: true
    - path: properties.environmentVariables
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_job_learning_training_job_input_output_encrypted
  name: 'AZURE MACHINE Learning_job: Learning Training Job Input Output Encrypted'
  description: Validates that AZURE machine learning_job has learning training job
    input output encrypted configured according to security best practices. Proper
    configuration reduces security risks, prevents unauth
  service: machine
  resource: learning_job
  severity: MEDIUM
  for_each: learning_jobs
  param: learning_job
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.inputs.encryption.enabled
      operator: equals
      expected: true
    - path: properties.outputs.encryption.enabled
      operator: equals
      expected: true
    - path: properties.encryption.keyVaultProperties.keyIdentifier
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_job_learning_training_job_logs_enabled
  name: 'AZURE MACHINE Learning_job: Learning Training Job Logs Enabled'
  severity: LOW
  for_each: learning_jobs
  param: learning_job
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.services.tracking.enabled
      operator: equals
      expected: true
    - path: properties.services.tracking.log_level
      operator: exists
      expected: true
    - path: properties.compute.enable_node_public_ip
      operator: equals
      expected: false
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_job_learning_training_job_private_networking_enforced
  name: 'AZURE MACHINE Learning_job: Learning Training Job Private Networking Enforced'
  severity: MEDIUM
  for_each: learning_jobs
  param: learning_job
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.networking.isolationMode
      operator: equals
      expected: Private
    - path: properties.networking.outboundRules
      operator: exists
      expected: true
    - path: properties.networking.publicNetworkAccess
      operator: equals
      expected: Disabled
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_job_learning_training_job_roles_least_privilege
  name: 'AZURE MACHINE Learning_job: Learning Training Job Roles Least Privilege'
  severity: HIGH
  for_each: learning_jobs
  param: learning_job
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.identity.type
      operator: equals
      expected: UserAssigned
    - path: properties.compute.target
      operator: exists
      expected: true
    - path: properties.services.tracking.endpoint
      operator: exists
      expected: true
    - path: properties.identity.userAssignedIdentities
      operator: exists
      expected: true
    - path: properties.compute.instanceCount
      operator: equals
      expected: 1
    - path: properties.environmentVariables
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_model_ai_services_model_artifact_encrypted_at_rest
  name: 'AZURE MACHINE Learning_model: Ai Services Model Artifact Encrypted At Rest'
  severity: MEDIUM
  for_each: learning_models
  param: learning_model
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.encryptionProperty.status
      operator: equals
      expected: Enabled
    - path: properties.encryptionProperty.keyVaultProperties.keyVaultArmId
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_model_ai_services_model_execution_role_least_privilege
  name: 'AZURE MACHINE Learning_model: Ai Services Model Execution Role Least Privilege'
  description: Validates that AZURE machine learning_model has ai services model execution
    role least privilege configured according to security best practices. Proper configuration
    reduces security risks, prevents unauthorized access and ensures compliance with
    least privilege principles.
  severity: HIGH
  service: machine
  resource: learning_model
  for_each: learning_models
  param: learning_model
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.identity.type
      operator: equals
      expected: SystemAssigned
    - path: properties.compute.computeType
      operator: exists
      expected: true
    - path: properties.authMode
      operator: equals
      expected: key
    - path: properties.publicNetworkAccess
      operator: equals
      expected: Disabled
    - path: properties.identity.principalId
      operator: exists
      expected: true
    - path: properties.hbiWorkspace
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_model_ai_services_model_image_scan_passed
  name: 'AZURE MACHINE Learning_model: Ai Services Model Image Scan Passed'
  severity: LOW
  for_each: learning_models
  param: learning_model
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.aiServices.modelImageScanStatus
      operator: equals
      expected: Passed
    - path: properties.aiServices.imageScanEnabled
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_model_ai_services_model_kms_cmk_used
  name: 'AZURE MACHINE Learning_model: Ai Services Model KMS CMK Used'
  severity: MEDIUM
  for_each: learning_models
  param: learning_model
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.encryption.keyVaultProperties.keyVaultArmId
      operator: exists
      expected: true
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.encryption.keyVaultProperties.keyIdentifier
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_model_ai_services_model_registry_access_rbac_least_privilege
  name: 'AZURE MACHINE Learning_model: Ai Services Model Registry Access RBAC Least
    Privi'
  severity: HIGH
  for_each: learning_models
  param: learning_model
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.hbiWorkspace
      operator: equals
      expected: true
    - path: properties.publicNetworkAccess
      operator: equals
      expected: Disabled
    - path: identity.type
      operator: equals
      expected: SystemAssigned
    - path: properties.imageBuildCompute
      operator: exists
      expected: true
    - path: properties.allowPublicAccessWhenBehindVnet
      operator: equals
      expected: false
    - path: properties.v1LegacyMode
      operator: equals
      expected: false
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_model_data_governance_ai_model_registry_artifact_encryption_enabled
  name: 'AZURE MACHINE Learning_model: Data Governance Ai Model Registry Artifact
    Encrypt'
  severity: HIGH
  for_each: learning_models
  param: learning_model
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.modelRegistry.encryptionInTransitEnabled
      operator: equals
      expected: true
    - path: properties.modelRegistry.encryptionAtRestEnabled
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_model_data_governance_ai_model_registry_cross_account_sharing_restricted
  name: 'AZURE MACHINE Learning_model: Data Governance Ai Model Registry Cross Account
    Sh'
  severity: MEDIUM
  for_each: learning_models
  param: learning_model
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.modelRegistry.crossTenantAccessPolicy.enabled
      operator: equals
      expected: false
    - path: properties.modelRegistry.publicNetworkAccess
      operator: equals
      expected: Disabled
    - path: properties.modelRegistry.allowedTenants
      operator: exists
      expected: true
    - path: properties.dataGovernance.crossAccountSharingRestricted
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_model_data_governance_ai_model_registry_rbac_least_privilege
  name: 'AZURE MACHINE Learning_model: Data Governance Ai Model Registry RBAC Least
    Privi'
  severity: HIGH
  for_each: learning_models
  param: learning_model
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.modelRegistry.accessControl.enableRBAC
      operator: equals
      expected: true
    - path: properties.modelRegistry.accessControl.principalType
      operator: equals
      expected: User
    - path: properties.modelRegistry.accessControl.role
      operator: contains
      expected: Reader
    - path: properties.dataGovernance.enabled
      operator: equals
      expected: true
    - path: properties.dataGovernance.modelApprovalRequired
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_model_data_privacy_ai_model_registry_artifact_encryption_enabled
  name: 'AZURE MACHINE Learning_model: Data Privacy Ai Model Registry Artifact Encryption'
  severity: HIGH
  for_each: learning_models
  param: learning_model
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.hbiWorkspace
      operator: equals
      expected: true
    - path: properties.encryption.keyVaultProperties.keyVaultArmId
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_model_data_privacy_ai_model_registry_cross_account_sharing_restricted
  name: 'AZURE MACHINE Learning_model: Data Privacy Ai Model Registry Cross Account
    Shari'
  severity: MEDIUM
  for_each: learning_models
  param: learning_model
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.modelRegistry.crossTenantAccessEnabled
      operator: equals
      expected: false
    - path: properties.modelRegistry.publicNetworkAccess
      operator: equals
      expected: Disabled
    - path: properties.modelRegistry.allowCrossSubscriptionSharing
      operator: equals
      expected: false
    - path: properties.access_control.external_sharing_enabled
      operator: equals
      expected: false
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_model_data_privacy_ai_model_registry_rbac_least_privilege
  name: 'AZURE MACHINE Learning_model: Data Privacy Ai Model Registry RBAC Least Privileg'
  severity: HIGH
  for_each: learning_models
  param: learning_model
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.access_control.role_assignments
      operator: exists
      expected: true
    - path: properties.access_control.role_assignments[*].role_definition_name
      operator: contains
      expected: Model Registry Reader
    - path: properties.access_control.role_assignments[*].principal_type
      operator: equals
      expected: User
    - path: properties.registry_private_endpoint_connections
      operator: exists
      expected: true
    - path: properties.public_network_access
      operator: equals
      expected: Disabled
    - path: properties.data_access_auth_mode
      operator: equals
      expected: identity
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_model_registry_artifact_encryption_enabled
  name: 'AZURE MACHINE Learning_model: Registry Artifact Encryption Enabled'
  severity: HIGH
  for_each: learning_models
  param: learning_model
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.hbiWorkspace
      operator: equals
      expected: true
    - path: properties.encryption.keyVaultProperties.keyVaultArmId
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_model_registry_cross_account_sharing_restricted
  name: 'AZURE MACHINE Learning_model: Registry Cross Account Sharing Restricted'
  severity: LOW
  for_each: learning_models
  param: learning_model
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.publicNetworkAccess
      operator: equals
      expected: Disabled
    - path: properties.allowPublicAccessWhenBehindVnet
      operator: equals
      expected: false
    - path: properties.discoveryUrl
      operator: exists
      expected: false
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_model_registry_rbac_least_privilege
  name: 'AZURE MACHINE Learning_model: Registry RBAC Least Privilege'
  severity: HIGH
  for_each: learning_models
  param: learning_model
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.hbiWorkspace
      operator: equals
      expected: true
    - path: properties.publicNetworkAccess
      operator: equals
      expected: Disabled
    - path: identity.type
      operator: equals
      expected: SystemAssigned
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.allowPublicAccessWhenBehindVnet
      operator: equals
      expected: false
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_model_package_artifact_signed_and_verified
  name: 'AZURE MACHINE Learning_model_package: Artifact Signed And Verified'
  severity: LOW
  for_each: learning_model_packages
  param: learning_model_package
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.modelPackageSettings.artifactSigning.enabled
      operator: equals
      expected: true
    - path: properties.modelPackageSettings.artifactVerification.enabled
      operator: equals
      expected: true
    - path: properties.modelPackageSettings.signatureValidation.required
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_model_package_data_governance_ai_model_package_artifact_signed_and_verified
  name: 'AZURE MACHINE Learning_model_package: Data Governance Ai Model Package Artifact'
  severity: MEDIUM
  for_each: learning_model_packages
  param: learning_model_package
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.packagedModel.signed
      operator: equals
      expected: true
    - path: properties.packagedModel.verified
      operator: equals
      expected: true
    - path: properties.packagedModel.signatureValidation.status
      operator: equals
      expected: Valid
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_model_package_data_governance_ai_model_package_encrypted
  name: 'AZURE MACHINE Learning_model_package: Data Governance Ai Model Package Encrypted'
  severity: MEDIUM
  for_each: learning_model_packages
  param: learning_model_package
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.encryption.keyVaultProperties.keyVaultArmId
      operator: exists
      expected: true
    - path: properties.encryption.keyVaultProperties.keyIdentifier
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_model_package_data_governance_ai_model_package_not_publicly_shared
  name: 'AZURE MACHINE Learning_model_package: Data Governance Ai Model Package Not
    Publi'
  severity: CRITICAL
  for_each: learning_model_packages
  param: learning_model_package
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.isAnonymous
      operator: equals
      expected: false
    - path: properties.isArchived
      operator: equals
      expected: true
    - path: properties.jobName
      operator: exists
      expected: true
    - path: properties.stage
      operator: equals
      expected: Production
    - path: properties.description
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_model_package_data_privacy_ai_model_package_artifact_signed_and_verified
  name: 'AZURE MACHINE Learning_model_package: Data Privacy Ai Model Package Artifact
    Sig'
  severity: MEDIUM
  for_each: learning_model_packages
  param: learning_model_package
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.modelPackageArtifact.signatureVerification.enabled
      operator: equals
      expected: true
    - path: properties.modelPackageArtifact.signature.status
      operator: equals
      expected: verified
    - path: properties.dataPrivacySettings.artifactSigning.enabled
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_model_package_data_privacy_ai_model_package_encrypted
  name: 'AZURE MACHINE Learning_model_package: Data Privacy Ai Model Package Encrypted'
  severity: MEDIUM
  for_each: learning_model_packages
  param: learning_model_package
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.encryption.keyVaultProperties.keyVaultArmId
      operator: exists
      expected: true
    - path: properties.encryption.keyVaultProperties.keyIdentifier
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_model_package_data_privacy_ai_model_package_not_publicly_shared
  name: 'AZURE MACHINE Learning_model_package: Data Privacy Ai Model Package Not Publicly'
  severity: CRITICAL
  for_each: learning_model_packages
  param: learning_model_package
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.isAnonymous
      operator: equals
      expected: false
    - path: properties.isArchived
      operator: equals
      expected: false
    - path: properties.stage
      operator: equals
      expected: None
    - path: properties.autoDeleteSetting.condition
      operator: equals
      expected: CreatedGreaterThan
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_model_package_encrypted
  name: 'AZURE MACHINE Learning_model_package: Encrypted'
  severity: MEDIUM
  for_each: learning_model_packages
  param: learning_model_package
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.encryption.keyVaultProperties.keyVaultArmId
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_model_package_not_publicly_shared
  name: 'AZURE MACHINE Learning_model_package: Not Publicly Shared'
  severity: CRITICAL
  for_each: learning_model_packages
  param: learning_model_package
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.isAnonymousAccess
      operator: equals
      expected: false
    - path: properties.publicNetworkAccess
      operator: equals
      expected: Disabled
    - path: properties.containerRegistryCredentials.loginServer
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_model_version_ai_services_model_artifact_encrypted_at_rest_cmek
  name: 'AZURE MACHINE Learning_model_version: Ai Services Model Artifact Encrypted
    At Re'
  severity: MEDIUM
  for_each: learning_model_versions
  param: learning_model_version
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.encryption.keyVaultProperties.keyVaultArmId
      operator: exists
      expected: true
    - path: properties.encryption.keyVaultProperties.keyIdentifier
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_model_version_ai_services_model_version_image_scan_passed
  name: 'AZURE MACHINE Learning_model_version: Ai Services Model Version Image Scan
    Passe'
  severity: LOW
  for_each: learning_model_versions
  param: learning_model_version
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.containerResource.imageScanStatus
      operator: equals
      expected: Passed
    - path: properties.containerResource.vulnerabilityAssessment.enabled
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_model_version_ai_services_model_version_kms_encryption_enabled
  name: 'AZURE MACHINE Learning_model_version: Ai Services Model Version KMS Encryption
    E'
  severity: HIGH
  for_each: learning_model_versions
  param: learning_model_version
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.encryption.keyVaultProperties.keyIdentifier
      operator: exists
      expected: true
    - path: properties.encryption.keyVaultProperties.identityClientId
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_model_version_ai_services_model_version_package_approved
  name: 'AZURE MACHINE Learning_model_version: Ai Services Model Version Package Approved'
  severity: LOW
  for_each: learning_model_versions
  param: learning_model_version
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.packageApprovalStatus
      operator: equals
      expected: Approved
    - path: properties.aiServicesModelVersionPackage.approvalStatus
      operator: equals
      expected: Approved
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_model_version_ai_services_supply_chain_model_artifact_image_scanned_no_critical
  name: 'AZURE MACHINE Learning_model_version: Ai Services Supply Chain Model Artifact
    Im'
  severity: LOW
  for_each: learning_model_versions
  param: learning_model_version
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.artifactScanResults.criticalVulnerabilities
      operator: equals
      expected: 0
    - path: properties.supplyChain.imageScanStatus
      operator: equals
      expected: Completed
    - path: properties.supplyChain.criticalSecurityIssues
      operator: equals
      expected: false
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_model_version_ai_services_supply_chain_model_artifact_sbom_present
  name: 'AZURE MACHINE Learning_model_version: Ai Services Supply Chain Model Artifact
    Sb'
  severity: LOW
  for_each: learning_model_versions
  param: learning_model_version
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.modelArtifact.sbom
      operator: exists
      expected: true
    - path: properties.aiServices.supplyChain.enabled
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_model_version_ai_services_supply_chain_model_artifact_signed_and_verified
  name: 'AZURE MACHINE Learning_model_version: Ai Services Supply Chain Model Artifact
    Si'
  severity: LOW
  for_each: learning_model_versions
  param: learning_model_version
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.modelArtifact.signature.verified
      operator: equals
      expected: true
    - path: properties.modelArtifact.signature.signedBy
      operator: exists
      expected: true
    - path: properties.supplyChain.modelArtifact.signatureValidation.enabled
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_online_endpoint_data_governance_ai_endpoint_authn_required
  name: 'AZURE MACHINE Learning_online_endpoint: Data Governance Ai Endpoint Authn
    Required'
  severity: MEDIUM
  for_each: learning_online_endpoints
  param: learning_online_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.auth_mode
      operator: equals
      expected: Key
    - path: properties.public_network_access
      operator: equals
      expected: Disabled
    - path: identity.type
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_online_endpoint_data_governance_ai_endpoint_authz_policies_enforced
  name: 'AZURE MACHINE Learning_online_endpoint: Data Governance Ai Endpoint Authz
    Polici'
  severity: MEDIUM
  for_each: learning_online_endpoints
  param: learning_online_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.auth_mode
      operator: equals
      expected: AMLToken
    - path: properties.public_network_access
      operator: equals
      expected: Disabled
    - path: properties.identity.type
      operator: exists
      expected: true
    - path: properties.compute
      operator: exists
      expected: true
    - path: properties.traffic
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_online_endpoint_data_governance_ai_endpoint_kms_encryption_enabled
  name: 'AZURE MACHINE Learning_online_endpoint: Data Governance Ai Endpoint KMS Encrypti'
  severity: HIGH
  for_each: learning_online_endpoints
  param: learning_online_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.encryption.keySource
      operator: equals
      expected: Microsoft.KeyVault
    - path: properties.encryption.keyVaultProperties.keyIdentifier
      operator: exists
      expected: true
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_online_endpoint_data_governance_ai_endpoint_logging_enabled
  name: 'AZURE MACHINE Learning_online_endpoint: Data Governance Ai Endpoint Logging
    Enab'
  severity: MEDIUM
  for_each: learning_online_endpoints
  param: learning_online_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.compute.properties.logging.enabled
      operator: equals
      expected: true
    - path: properties.compute.properties.logging.log_level
      operator: exists
      expected: true
    - path: properties.compute.properties.logging.audit_enabled
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_online_endpoint_data_governance_ai_endpoint_private_networking_enforced
  name: 'AZURE MACHINE Learning_online_endpoint: Data Governance Ai Endpoint Private
    Netw'
  severity: MEDIUM
  for_each: learning_online_endpoints
  param: learning_online_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.public_network_access
      operator: equals
      expected: Disabled
    - path: properties.traffic
      operator: exists
      expected: true
    - path: properties.traffic.type
      operator: equals
      expected: private
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_online_endpoint_data_privacy_ai_endpoint_authn_required
  name: 'AZURE MACHINE Learning_online_endpoint: Data Privacy Ai Endpoint Authn Required'
  severity: MEDIUM
  for_each: learning_online_endpoints
  param: learning_online_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.auth_mode
      operator: equals
      expected: Key
    - path: properties.public_network_access
      operator: equals
      expected: Disabled
    - path: properties.identity
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_online_endpoint_data_privacy_ai_endpoint_authz_policies_enforced
  name: 'AZURE MACHINE Learning_online_endpoint: Data Privacy Ai Endpoint Authz Policies'
  severity: MEDIUM
  for_each: learning_online_endpoints
  param: learning_online_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.authMode
      operator: equals
      expected: Key
    - path: properties.publicNetworkAccess
      operator: equals
      expected: Disabled
    - path: properties.compute
      operator: exists
      expected: true
    - path: identity.type
      operator: equals
      expected: SystemAssigned
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_online_endpoint_data_privacy_ai_endpoint_kms_encryption_enabled
  name: 'AZURE MACHINE Learning_online_endpoint: Data Privacy Ai Endpoint KMS Encryption'
  severity: HIGH
  for_each: learning_online_endpoints
  param: learning_online_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.encryption.keySource
      operator: equals
      expected: Microsoft.KeyVault
    - path: properties.encryption.keyVaultProperties.keyIdentifier
      operator: exists
      expected: true
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_online_endpoint_data_privacy_ai_endpoint_logging_enabled
  name: 'AZURE MACHINE Learning_online_endpoint: Data Privacy Ai Endpoint Logging
    Enabled'
  severity: MEDIUM
  for_each: learning_online_endpoints
  param: learning_online_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.traffic
      operator: exists
      expected: true
    - path: properties.mirror_traffic
      operator: exists
      expected: true
    - path: properties.compute
      operator: exists
      expected: true
    - path: properties.auth_mode
      operator: equals
      expected: AMLToken
    - path: properties.data_collector
      operator: exists
      expected: true
    - path: properties.data_collector.collections
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_online_endpoint_data_privacy_ai_endpoint_private_networking_enforced
  name: 'AZURE MACHINE Learning_online_endpoint: Data Privacy Ai Endpoint Private
    Network'
  severity: MEDIUM
  for_each: learning_online_endpoints
  param: learning_online_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.public_network_access
      operator: equals
      expected: Disabled
    - path: properties.traffic
      operator: exists
      expected: true
    - path: properties.traffic.0.type
      operator: equals
      expected: blue_green
    - path: properties.auth_mode
      operator: equals
      expected: key
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_online_endpoint_learning_endpoint_authn_required
  name: 'AZURE MACHINE Learning_online_endpoint: Learning Endpoint Authn Required'
  severity: LOW
  for_each: learning_online_endpoints
  param: learning_online_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.auth_mode
      operator: equals
      expected: Key
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_online_endpoint_learning_endpoint_authz_policies_enforced
  name: 'AZURE MACHINE Learning_online_endpoint: Learning Endpoint Authz Policies
    Enforce'
  severity: LOW
  for_each: learning_online_endpoints
  param: learning_online_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.authMode
      operator: equals
      expected: AMLToken
    - path: properties.publicNetworkAccess
      operator: equals
      expected: Disabled
    - path: properties.compute
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_online_endpoint_learning_endpoint_kms_encryption_enabled
  name: 'AZURE MACHINE Learning_online_endpoint: Learning Endpoint KMS Encryption
    Enabled'
  severity: HIGH
  for_each: learning_online_endpoints
  param: learning_online_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.encryption.keySource
      operator: equals
      expected: Microsoft.KeyVault
    - path: properties.encryption.keyVaultProperties.keyIdentifier
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_online_endpoint_learning_endpoint_logging_enabled
  name: 'AZURE MACHINE Learning_online_endpoint: Learning Endpoint Logging Enabled'
  severity: MEDIUM
  for_each: learning_online_endpoints
  param: learning_online_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.logging.enabled
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_online_endpoint_learning_endpoint_private_networking_enforced
  name: 'AZURE MACHINE Learning_online_endpoint: Learning Endpoint Private Networking
    Enf'
  severity: MEDIUM
  for_each: learning_online_endpoints
  param: learning_online_endpoint
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.public_network_access
      operator: equals
      expected: Disabled
    - path: properties.private_endpoint_connections
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_pipeline_ai_services_agent_orchestrator_data_exfiltration_policies_enforced
  name: 'AZURE MACHINE Learning_pipeline: Ai Services Agent Orchestrator Data Exfiltratio'
  severity: MEDIUM
  for_each: learning_pipelines
  param: learning_pipeline
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.settings.dataExfiltrationPrevention.enabled
      operator: equals
      expected: true
    - path: properties.agentOrchestrator.dataExfiltrationPolicies.enforced
      operator: equals
      expected: true
    - path: properties.security.dataLossPreventionEnabled
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_pipeline_ai_services_agent_orchestrator_secrets_isolation_enabled
  name: 'AZURE MACHINE Learning_pipeline: Ai Services Agent Orchestrator Secrets Isolatio'
  severity: HIGH
  for_each: learning_pipelines
  param: learning_pipeline
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.ai_services_agent_orchestrator.secrets_isolation_enabled
      operator: equals
      expected: true
    - path: properties.ai_services_agent_orchestrator.isolation_mode
      operator: equals
      expected: isolated
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_pipeline_ai_services_agent_orchestrator_tool_use_allowlist_enforced
  name: 'AZURE MACHINE Learning_pipeline: Ai Services Agent Orchestrator Tool Use
    Allowli'
  severity: LOW
  for_each: learning_pipelines
  param: learning_pipeline
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.aiServicesAgentOrchestrator.toolUseAllowlistEnabled
      operator: equals
      expected: true
    - path: properties.aiServicesAgentOrchestrator.toolUseAllowlist
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_pipeline_ai_services_data_pipeline_access_controls_least_privilege
  name: 'AZURE MACHINE Learning_pipeline: Ai Services Data Pipeline Access Controls
    Least'
  severity: HIGH
  for_each: learning_pipelines
  param: learning_pipeline
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.pipeline_endpoints
      operator: exists
      expected: true
    - path: properties.access_control.role_assignments
      operator: exists
      expected: true
    - path: properties.access_control.minimum_required_permissions
      operator: equals
      expected: true
    - path: properties.identity.type
      operator: equals
      expected: SystemAssigned
    - path: properties.security_profile.data_access_controls
      operator: equals
      expected: RestrictedAccess
    - path: properties.compute_target.access_policy
      operator: equals
      expected: LeastPrivilege
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_pipeline_ai_services_data_pipeline_private_networking_enforced
  name: 'AZURE MACHINE Learning_pipeline: Ai Services Data Pipeline Private Networking
    En'
  severity: MEDIUM
  for_each: learning_pipelines
  param: learning_pipeline
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.networkSettings.isolationMode
      operator: equals
      expected: AllowOnlyApprovedOutbound
    - path: properties.networkSettings.publicNetworkAccess
      operator: equals
      expected: Disabled
    - path: properties.compute.computeType
      operator: equals
      expected: ComputeInstance
    - path: properties.compute.properties.subnet.id
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_pipeline_ai_services_pipeline_iam_role_least_privileged
  name: 'AZURE MACHINE Learning_pipeline: Ai Services Pipeline IAM Role Least Privileged'
  severity: HIGH
  for_each: learning_pipelines
  param: learning_pipeline
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.identity.type
      operator: equals
      expected: SystemAssigned
    - path: properties.roleAssignments
      operator: exists
      expected: true
    - path: properties.roleAssignments[*].roleDefinitionName
      operator: contains
      expected: Machine Learning Data Scientist
    - path: properties.roleAssignments[*].scope
      operator: contains
      expected: /subscriptions/
    - path: properties.identity.principalId
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_pipeline_ai_services_pipeline_kms_encryption_enabled
  name: 'AZURE MACHINE Learning_pipeline: Ai Services Pipeline KMS Encryption Enabled'
  severity: HIGH
  for_each: learning_pipelines
  param: learning_pipeline
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.encryption.keyVaultProperties.keyVaultArmId
      operator: exists
      expected: true
    - path: properties.encryption.keyVaultProperties.keyIdentifier
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_pipeline_ai_services_pipeline_logging_enabled
  name: 'AZURE MACHINE Learning_pipeline: Ai Services Pipeline Logging Enabled'
  severity: MEDIUM
  for_each: learning_pipelines
  param: learning_pipeline
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.logging.enabled
      operator: equals
      expected: true
    - path: properties.logging.aiServicesLogging
      operator: equals
      expected: true
    - path: properties.logging.logLevel
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_pipeline_artifacts_private_and_encrypted
  name: 'AZURE MACHINE Learning_pipeline: Artifacts Private And Encrypted'
  severity: MEDIUM
  for_each: learning_pipelines
  param: learning_pipeline
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.artifacts.private
      operator: equals
      expected: true
    - path: properties.artifacts.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.artifacts.encryption.keySource
      operator: equals
      expected: Microsoft.KeyVault
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_pipeline_data_governance_ai_human_review_artifacts_encrypted
  name: 'AZURE MACHINE Learning_pipeline: Data Governance Ai Human Review Artifacts
    Encry'
  severity: MEDIUM
  for_each: learning_pipelines
  param: learning_pipeline
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.encryption.keyVaultProperties.keyVaultArmId
      operator: exists
      expected: true
    - path: properties.dataGovernance.aiHumanReview.artifactsEncryption.enabled
      operator: equals
      expected: true
    - path: properties.dataGovernance.aiHumanReview.artifactsEncryption.keySource
      operator: equals
      expected: Microsoft.KeyVault
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_pipeline_data_governance_ai_human_review_ui_private_networking_enforced
  name: 'AZURE MACHINE Learning_pipeline: Data Governance Ai Human Review Ui Private
    Netw'
  severity: MEDIUM
  for_each: learning_pipelines
  param: learning_pipeline
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.dataGovernance.humanReviewConfig.uiConfig.privateNetworkingEnabled
      operator: equals
      expected: true
    - path: properties.dataGovernance.humanReviewConfig.networkConfig.enablePrivateAccess
      operator: equals
      expected: true
    - path: properties.networkSettings.isolationMode
      operator: equals
      expected: AllowOnlyApprovedOutbound
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_pipeline_data_governance_ai_human_review_workteam_access_rbac_least_privilege
  name: 'AZURE MACHINE Learning_pipeline: Data Governance Ai Human Review Workteam
    Access'
  severity: HIGH
  for_each: learning_pipelines
  param: learning_pipeline
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.rbacEnabled
      operator: equals
      expected: true
    - path: properties.dataGovernance.humanReview.enabled
      operator: equals
      expected: true
    - path: properties.dataGovernance.humanReview.workteam.rbacConfiguration.roleAssignments
      operator: exists
      expected: true
    - path: properties.dataGovernance.humanReview.workteam.rbacConfiguration.principalType
      operator: equals
      expected: ServicePrincipal
    - path: properties.dataGovernance.humanReview.workteam.accessPolicy.permissions
      operator: contains
      expected: read
    - path: properties.security.accessControl.minimumPrivilegeEnabled
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_pipeline_data_governance_ai_pipeline_artifacts_private_and_encrypted
  name: 'AZURE MACHINE Learning_pipeline: Data Governance Ai Pipeline Artifacts Private
    A'
  severity: MEDIUM
  for_each: learning_pipelines
  param: learning_pipeline
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.datastore.is_default
      operator: equals
      expected: false
    - path: properties.datastore.has_been_validated
      operator: equals
      expected: true
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.encryption.key_vault_properties.key_identifier
      operator: exists
      expected: true
    - path: properties.public_network_access
      operator: equals
      expected: Disabled
    - path: properties.storage_account.enable_https_traffic_only
      operator: equals
      expected: true
    - path: properties.container_registry.admin_user_enabled
      operator: equals
      expected: false
    - path: properties.allow_public_access_when_behind_vnet
      operator: equals
      expected: false
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_pipeline_data_governance_ai_pipeline_kms_encryption_enabled
  name: 'AZURE MACHINE Learning_pipeline: Data Governance Ai Pipeline KMS Encryption
    Enab'
  severity: HIGH
  for_each: learning_pipelines
  param: learning_pipeline
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.encryption.keyVaultProperties.keyVaultArmId
      operator: exists
      expected: true
    - path: properties.encryption.keyVaultProperties.keyIdentifier
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_pipeline_data_governance_ai_pipeline_logging_enabled
  name: 'AZURE MACHINE Learning_pipeline: Data Governance Ai Pipeline Logging Enabled'
  severity: MEDIUM
  for_each: learning_pipelines
  param: learning_pipeline
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.settings.dataGovernance.aiPipelineLogging.enabled
      operator: equals
      expected: true
    - path: properties.settings.dataGovernance.aiPipelineLogging.logLevel
      operator: exists
      expected: true
    - path: properties.settings.dataGovernance.auditLogging.enabled
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_pipeline_data_governance_ai_pipeline_roles_least_privilege
  name: 'AZURE MACHINE Learning_pipeline: Data Governance Ai Pipeline Roles Least
    Privile'
  severity: HIGH
  for_each: learning_pipelines
  param: learning_pipeline
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.identity.type
      operator: equals
      expected: SystemAssigned
    - path: properties.compute.computeType
      operator: exists
      expected: true
    - path: properties.settings.dataAccessControl.enabled
      operator: equals
      expected: true
    - path: properties.settings.roleBasedAccessControl.enabled
      operator: equals
      expected: true
    - path: properties.permissions
      operator: exists
      expected: true
    - path: properties.roleAssignments
      operator: exists
      expected: true
    - path: properties.dataGovernance.enabled
      operator: equals
      expected: true
    - path: properties.dataGovernance.leastPrivilegeAccess
      operator: equals
      expected: true
    - path: properties.security.rbacEnabled
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_pipeline_data_privacy_ai_human_review_artifacts_encrypted
  name: 'AZURE MACHINE Learning_pipeline: Data Privacy Ai Human Review Artifacts Encrypte'
  severity: MEDIUM
  for_each: learning_pipelines
  param: learning_pipeline
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.encryption.keyVaultProperties.keyVaultArmId
      operator: exists
      expected: true
    - path: properties.humanReviewConfiguration.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.dataPrivacy.artifactEncryption.enabled
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_pipeline_data_privacy_ai_human_review_ui_private_networking_enforced
  name: 'AZURE MACHINE Learning_pipeline: Data Privacy Ai Human Review Ui Private
    Network'
  severity: MEDIUM
  for_each: learning_pipelines
  param: learning_pipeline
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.dataPrivacy.humanReviewUi.privateNetworkingEnforced
      operator: equals
      expected: true
    - path: properties.dataPrivacy.humanReviewUi.networkConfiguration.isolationMode
      operator: equals
      expected: private
    - path: properties.dataPrivacy.humanReviewUi.subnetId
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_pipeline_data_privacy_ai_human_review_workteam_access_rbac_least_privilege
  name: 'AZURE MACHINE Learning_pipeline: Data Privacy Ai Human Review Workteam Access
    RB'
  severity: HIGH
  for_each: learning_pipelines
  param: learning_pipeline
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.workteam.access_policy.rbac_enabled
      operator: equals
      expected: true
    - path: properties.workteam.members
      operator: exists
      expected: true
    - path: properties.human_review_config.data_privacy_mode
      operator: equals
      expected: enabled
    - path: properties.workteam.access_policy.minimum_required_permissions
      operator: equals
      expected: read_only
    - path: properties.data_access_controls.least_privilege_enabled
      operator: equals
      expected: true
    - path: properties.human_review_config.workteam_role_assignments
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_pipeline_data_privacy_ai_pipeline_artifacts_private_and_encrypted
  name: 'AZURE MACHINE Learning_pipeline: Data Privacy Ai Pipeline Artifacts Private
    And Encrypted'
  severity: MEDIUM
  for_each: learning_pipelines
  param: learning_pipeline
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.publicNetworkAccess
      operator: equals
      expected: Disabled
    - path: properties.encryption.keyVaultProperties.keyVaultArmId
      operator: exists
      expected: true
    - path: properties.encryption.keyVaultProperties.keyIdentifier
      operator: exists
      expected: true
    - path: properties.hbiWorkspace
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_pipeline_data_privacy_ai_pipeline_kms_encryption_enabled
  name: 'AZURE MACHINE Learning_pipeline: Data Privacy Ai Pipeline KMS Encryption
    Enabled'
  severity: HIGH
  for_each: learning_pipelines
  param: learning_pipeline
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.encryption.keySource
      operator: equals
      expected: Microsoft.KeyVault
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.encryption.keyVaultProperties.keyIdentifier
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_pipeline_data_privacy_ai_pipeline_logging_enabled
  name: 'AZURE MACHINE Learning_pipeline: Data Privacy Ai Pipeline Logging Enabled'
  severity: MEDIUM
  for_each: learning_pipelines
  param: learning_pipeline
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.settings.dataPrivacy.aiPipelineLoggingEnabled
      operator: equals
      expected: true
    - path: properties.logging.enabled
      operator: equals
      expected: true
    - path: properties.dataPrivacySettings.loggingEnabled
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_pipeline_data_privacy_ai_pipeline_roles_least_privilege
  name: 'AZURE MACHINE Learning_pipeline: Data Privacy Ai Pipeline Roles Least Privilege'
  severity: HIGH
  for_each: learning_pipelines
  param: learning_pipeline
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.rbacSettings.dataPrivacyRoles
      operator: exists
      expected: true
    - path: properties.rbacSettings.dataPrivacyRoles.minimumPrivilegeEnabled
      operator: equals
      expected: true
    - path: properties.rbacSettings.pipelineRoleAssignments
      operator: exists
      expected: true
    - path: properties.security.dataAccess.restrictedAccess
      operator: equals
      expected: true
    - path: properties.identity.type
      operator: equals
      expected: SystemAssigned
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_pipeline_kms_encryption_enabled
  name: 'AZURE MACHINE Learning_pipeline: KMS Encryption Enabled'
  severity: HIGH
  for_each: learning_pipelines
  param: learning_pipeline
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.encryption.keyEncryptionKeyIdentifier
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_pipeline_learning_human_review_artifacts_encrypted
  name: 'AZURE MACHINE Learning_pipeline: Learning Human Review Artifacts Encrypted'
  severity: MEDIUM
  for_each: learning_pipelines
  param: learning_pipeline
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.humanReviewConfig.artifactsEncryption.enabled
      operator: equals
      expected: true
    - path: properties.humanReviewConfig.artifactsEncryption.keyVaultProperties.keyVaultArmId
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_pipeline_learning_human_review_ui_private_networking_enforced
  name: 'AZURE MACHINE Learning_pipeline: Learning Human Review Ui Private Networking
    Enf'
  severity: MEDIUM
  for_each: learning_pipelines
  param: learning_pipeline
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.humanReviewConfig.privateNetworkingEnabled
      operator: equals
      expected: true
    - path: properties.humanReviewConfig.uiConfig.privateEndpointEnabled
      operator: equals
      expected: true
    - path: properties.networkConfig.privateNetworkingEnabled
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_pipeline_learning_human_review_workteam_access_rbac_least_privilege
  name: 'AZURE MACHINE Learning_pipeline: Learning Human Review Workteam Access RBAC
    Leas'
  severity: HIGH
  for_each: learning_pipelines
  param: learning_pipeline
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.workteam.rbac.enabled
      operator: equals
      expected: true
    - path: properties.workteam.rbac.principleOfLeastPrivilege
      operator: equals
      expected: true
    - path: properties.workteam.members
      operator: exists
      expected: true
    - path: properties.workteam.roleAssignments
      operator: exists
      expected: true
    - path: properties.humanReview.enabled
      operator: equals
      expected: true
    - path: properties.humanReview.workteam.accessControl
      operator: equals
      expected: RBAC
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_pipeline_logging_enabled
  name: 'AZURE MACHINE Learning_pipeline: Logging Enabled'
  severity: MEDIUM
  for_each: learning_pipelines
  param: learning_pipeline
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.logging.enabled
      operator: equals
      expected: true
    - path: properties.logging.logLevel
      operator: exists
      expected: true
    - path: properties.settings.enableLogging
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_pipeline_roles_least_privilege
  name: 'AZURE MACHINE Learning_pipeline: Roles Least Privilege'
  severity: HIGH
  for_each: learning_pipelines
  param: learning_pipeline
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.identity.type
      operator: equals
      expected: SystemAssigned
    - path: properties.rbacAuthorization.enabled
      operator: equals
      expected: true
    - path: properties.roleAssignments
      operator: exists
      expected: true
    - path: properties.roleAssignments[*].roleDefinitionName
      operator: contains
      expected: Machine Learning Pipeline Contributor
    - path: properties.publicNetworkAccess
      operator: equals
      expected: Disabled
    - path: properties.permissions.minimumPrivileges
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_workspace_ai_services_secrets_vault_access_rbac_least_privilege
  name: 'AZURE MACHINE Learning_workspace: Ai Services Secrets Vault Access RBAC Least
    Pr'
  severity: HIGH
  for_each: learning_workspaces
  param: learning_workspace
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.keyVault
      operator: exists
      expected: true
    - path: properties.keyVault.properties.enableRbacAuthorization
      operator: equals
      expected: true
    - path: properties.keyVault.properties.accessPolicies
      operator: exists
      expected: false
    - path: identity.type
      operator: equals
      expected: SystemAssigned
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.encryption.keyVaultProperties.keyVaultArmId
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_workspace_ai_services_secrets_vault_kms_encryption_and_rotation_enabled
  name: 'AZURE MACHINE Learning_workspace: Ai Services Secrets Vault KMS Encryption
    And R'
  severity: HIGH
  for_each: learning_workspaces
  param: learning_workspace
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.encryption.keyVaultProperties.keyVaultArmId
      operator: exists
      expected: true
    - path: properties.encryption.keyVaultProperties.keyIdentifier
      operator: exists
      expected: true
    - path: properties.encryption.keyVaultProperties.identityClientId
      operator: exists
      expected: true
    - path: properties.keyVault
      operator: exists
      expected: true
    - path: properties.keyVault.properties.enableSoftDelete
      operator: equals
      expected: true
    - path: properties.keyVault.properties.enablePurgeProtection
      operator: equals
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_workspace_ai_services_secrets_vault_no_plaintext_secrets_in_config
  name: 'AZURE MACHINE Learning_workspace: Ai Services Secrets Vault No Plaintext
    Secrets'
  severity: HIGH
  for_each: learning_workspaces
  param: learning_workspace
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.encryption.keyVaultProperties.keyVaultArmId
      operator: exists
      expected: true
    - path: properties.hbiWorkspace
      operator: equals
      expected: true
    - path: properties.publicNetworkAccess
      operator: equals
      expected: Disabled
    - path: properties.storageAccount
      operator: exists
      expected: true
    - path: properties.keyVault
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_workspace_ai_services_workspace_encryption_at_rest_enabled
  name: 'AZURE MACHINE Learning_workspace: Ai Services Workspace Encryption At Rest
    Enabl'
  severity: HIGH
  for_each: learning_workspaces
  param: learning_workspace
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.encryption.status
      operator: equals
      expected: Enabled
    - path: properties.encryption.keyVaultProperties.keyVaultArmId
      operator: exists
      expected: true
    - path: properties.encryption.keyVaultProperties.keyIdentifier
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_workspace_ai_services_workspace_iam_role_least_privileged
  name: 'AZURE MACHINE Learning_workspace: Ai Services Workspace IAM Role Least Privilege'
  severity: HIGH
  for_each: learning_workspaces
  param: learning_workspace
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.hbiWorkspace
      operator: equals
      expected: true
    - path: identity.type
      operator: equals
      expected: SystemAssigned
    - path: properties.publicNetworkAccess
      operator: equals
      expected: Disabled
    - path: properties.allowPublicAccessWhenBehindVnet
      operator: equals
      expected: false
    - path: properties.serviceProvisionedResourceGroup
      operator: exists
      expected: true
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_workspace_ai_services_workspace_idle_shutdown_configured
  name: 'AZURE MACHINE Learning_workspace: Ai Services Workspace Idle Shutdown Configured'
  severity: LOW
  for_each: learning_workspaces
  param: learning_workspace
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.compute_instances_idle_shutdown_time_in_minutes
      operator: exists
      expected: true
    - path: properties.compute_instances_idle_shutdown_time_in_minutes
      operator: equals
      expected: 60
  multi_step: false
  logic: AND
  errors_as_fail: []
- check_id: machine_learning_workspace_ai_services_workspace_private_networking_enforced
  name: 'AZURE MACHINE Learning_workspace: Ai Services Workspace Private Networking
    Enfor'
  severity: MEDIUM
  for_each: learning_workspaces
  param: learning_workspace
  calls:
  - action: identity
    params: {}
    fields:
    - path: properties.publicNetworkAccess
      operator: equals
      expected: Disabled
    - path: properties.privateEndpointConnections
      operator: exists
      expected: true
    - path: properties.allowPublicAccessWhenBehindVnet
      operator: equals
      expected: false
  multi_step: false
  logic: AND
  errors_as_fail: []
