version: '1.0'
provider: azure
service: synapse
discovery:
- discovery_id: azure.synapse.list
  calls:
  - action: list
    save_as: list_response
  emit:
    items_for: '{{ list_response.value }}'
    as: item
    item:
      value: '{{ item.value }}'
      next_link: '{{ item.next_link }}'
checks:
- rule_id: azure.synapse.cluster.public_access
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.cluster.audit_logging
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.cluster.encrypted
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.workspace.data_analytics_workgroup_query_result_encryption_enabled
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: exists
- rule_id: azure.synapse.sql_pool.data_warehouse_parameter_group_require_ssl
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: exists
- rule_id: azure.synapse.integration_runtime.data_catalog_dev_endpoint_role_least_privilege
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.sql_pool.data_warehouse_endpoint_authz_rbac_least_privilege
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.workspace.data_analytics_catalog_cross_account_sharing_restricted
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.workspace.data_warehouse_subnet_group_private_subnets_only
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.sql_pool.data_warehouse_cluster_private_networking_enforced
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.integration_runtime.data_catalog_dev_endpoint_encrypted
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: exists
- rule_id: azure.synapse.sql_pool.data_warehouse_snapshot_cross_region_copy_encrypted
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.sql_pool.data_warehouse_endpoint_authz_no_anonymous_access
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.sql_pool.data_warehouse_cluster_audit_logging_enabled
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.sql_pool.data_warehouse_snapshot_encrypted_at_rest_cmek
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.sql_pool.data_warehouse_hsm_only_approved_hsm_endpoints
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.sql_pool.data_analytics_parameter_group_tls_required
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: exists
- rule_id: azure.synapse.sql_pool.data_warehouse_cluster_tls_min_1_2_enforced
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: exists
- rule_id: azure.synapse.cluster.automated_snapshot
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.sql_pool.data_warehouse_snapshot_not_publicly_shared
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.sql_pool.data_warehouse_endpoint_access_tls_required
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: exists
- rule_id: azure.synapse.workspace.data_analytics_catalog_rbac_least_privilege
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.sql_pool.data_warehouse_hsm_client_cert_trusted_issuer
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.sql_pool.data_warehouse_parameter_group_logging_enabled_where_supported
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.cluster.maintenance_settings
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.workspace.data_analytics_catalog_metadata_encryption_enabled
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: exists
- rule_id: azure.synapse.workspace.data_analytics_workgroup_allowed_data_sources_allowlist
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.sql_pool.data_warehouse_hsm_keys_in_hsm_only
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.sql_pool.data_warehouse_endpoint_access_private_only
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.integration_runtime.data_catalog_dev_endpoint_no_public_access
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.sql_pool.data_warehouse_hsm_client_cert_key_length_minimum
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.sql_pool.data_analytics_parameter_group_logging_enabled_where_supported
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.workspace.data_analytics_subnet_group_private_subnets_only
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.sql_pool.data_warehouse_endpoint_access_allowed_cidrs_minimized
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.workspace.data_analytics_workgroup_network_access_private
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.workspace.encryption_enabled
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.cluster.automatic_upgrades
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.sql_pool.data_warehouse_hsm_configuration_present
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.sql_pool.data_warehouse_hsm_client_cert_not_expired
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.sql_pool.data_warehouse_cluster_admin_access_least_privilege
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
- rule_id: azure.synapse.sql_pool.data_warehouse_cluster_encryption_at_rest_cmek
  for_each: azure.synapse.list
  conditions:
    var: item.value
    op: not_empty
