version: '1.0'
provider: azure
service: cosmosdb
discovery:
- discovery_id: azure.cosmosdb.list_by_resource_group
  calls:
  - action: list_by_resource_group
    save_as: list_by_resource_group_response
  emit:
    items_for: '{{ list_by_resource_group_response.value }}'
    as: item
    item:
      id: '{{ item.id }}'
      name: '{{ item.name }}'
      type: '{{ item.type }}'
      location: '{{ item.location }}'
      tags: '{{ item.tags }}'
      identity: '{{ item.identity }}'
      properties: '{{ item.properties }}'
checks:
- rule_id: azure.cosmosdb.account.private.endpoint.approved
  for_each: azure.cosmosdb.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.cosmos.database.encryption_enabled
  for_each: azure.cosmosdb.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.cosmosdb.defender.status.check
  for_each: azure.cosmosdb.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.cosmos.table.pitr_enabled
  for_each: azure.cosmosdb.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.cosmos.table.kms_cmk_encryption_enabled
  for_each: azure.cosmosdb.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.cosmosdb.account.firewall_use_selected_networks
  for_each: azure.cosmosdb.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.cosmos.database.pitr_enabled
  for_each: azure.cosmosdb.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.cosmos.database.autoscale_enabled
  for_each: azure.cosmosdb.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.cosmos.database.backup_enabled
  for_each: azure.cosmosdb.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.cosmosdb.account.use_private_endpoints
  for_each: azure.cosmosdb.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.cosmos.database.global_tables_enabled
  for_each: azure.cosmosdb.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.cosmos.database.geo_redundant
  for_each: azure.cosmosdb.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.cosmosdb.network.restriction.enabled
  for_each: azure.cosmosdb.list_by_resource_group
  conditions:
    var: item.id
    op: exists
