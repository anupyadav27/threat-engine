version: '1.0'
provider: azure
service: security
discovery:
- discovery_id: azure.security.list
  calls:
  - action: list
    save_as: list_response
  emit:
    items_for: '{{ list_response.value }}'
    as: item
    item:
      id: '{{ item.id }}'
      name: '{{ item.name }}'
      type: '{{ item.type }}'
      deny_assignment_name: '{{ item.deny_assignment_name }}'
      description: '{{ item.description }}'
      permissions: '{{ item.permissions }}'
      scope: '{{ item.scope }}'
      do_not_apply_to_child_scopes: '{{ item.do_not_apply_to_child_scopes }}'
      principals: '{{ item.principals }}'
      exclude_principals: '{{ item.exclude_principals }}'
      is_system_protected: '{{ item.is_system_protected }}'
      condition: '{{ item.condition }}'
      condition_version: '{{ item.condition_version }}'
      created_on: '{{ item.created_on }}'
      updated_on: '{{ item.updated_on }}'
      created_by: '{{ item.created_by }}'
      updated_by: '{{ item.updated_by }}'
checks:
- rule_id: azure.security.defender.dns_protection_enabled
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.center_vulnerability_assessment.vuln_assessment_policy_store_encrypted
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.defender.fim.status.check
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.threat_ip_set.used_by_detectors
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.paas_app.tls_min_1_2_enforced
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.center_alert.incident_response_versioning_and_immutability_enabled
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.defender.cosmos_protection_enabled
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.defender.for.containers.pricing.tier.and.extensions.enabled
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.defender.sql_databases_protection_enabled
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.center.vulnerability_assessment_enabled
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.defender.system_updates_applied
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.serverless_layer.source_trusted
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.defender.email.notifications.attack.paths.enabled
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.defender.app.services_is_on
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.paas_application_version.paas_app_version_immutable
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.threat_custom_identifier.source_trusted
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.defender.for.apis.pricing.tier.standard
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.defender.mcas_enabled
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.center_alert.incident_response_storage_encrypted_and_private
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.center_detector.threat_detector_enabled_in_all_regions
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.center_alert.incident_response_access_rbac_least_privilege
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.aad.lustre.filesystem_customer_managed_key_enabled
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.defender.databases_protection_enabled
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.defender.vulnerability.assessment.status.check
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.defender.high_severity_alerts_enabled
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.center_patch_management.vuln_patch_baseline_defined_for_os_families
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.defender.vm.os.updates.configured
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.defender.iot_hub_protection_enabled
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.defender.arm_protection_enabled
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.center_patch_management.vuln_patch_approval_rules_defined
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.center_baseline.vuln_baseline_exemptions_have_expiry_and_owner
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.defender.container_vulnerabilities_resolved
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.defender.cspm.pricing.tier.standard.check
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.defender.email.notifications.owner.check
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.threat_ip_set.sources_trusted
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.center_finding.threat_finding_archival_export_encrypted
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.defender.servers_protection_enabled
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.defender.additional_email_configured
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.privacy_encryption.at_rest_cmek_enabled
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.defender.app.services.status.check
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.defender.notify_owners_enabled
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.center_finding.threat_finding_suppression_rules_documented_and_scoped
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.defender.resource.manager.pricing.standard.check
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.center.no_high_severity_findings
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.center_detector.threat_detector_finding_export_encrypted_destination
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.center_baseline.vuln_baseline_required_controls_present
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.defender.log_analytics_agent_auto_provisioning
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.privacy_encryption.in_transit_tls_min_1_2
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.defender.open.source.relational.databases.enabled
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.vulnerability_maintenance.vuln_maintenance_window_defined
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.defender.vulnerability_assessment_auto_provisioning
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.defender.email.notifications.severity.check
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.defender.containers_protection_enabled
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.defender.sql.server.pricing.tier.check
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.platform_usage_plan.rate_limits
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.defender.wdatp_enabled
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.defender.keyvault_protection_enabled
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.defender.sql_servers_protection_enabled
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.storage.defender.pricing.check
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.defender.relational_db_protection_enabled
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.center_vulnerability_scan.vuln_scan_agents_or_scanners_deployed
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.defender.vm.endpoint_protection_installed
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.threat_hub.master_member
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.defender.for.cloud.endpoint.protection.status.check
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.defender.agentless.scanning.status.check
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.serverless_layer.version_immutable
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.defender.storage.alerts.export.enabled
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.center.guardduty_enabled
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.center_vulnerability_assessment.vuln_assessment_roles_least_privilege
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.center_vulnerability_scan.vuln_scan_scope_includes_all_asset_groups
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.center.enabled
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.serverless_event_source.source_authenticated
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.center.exploit_guard_enabled
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.defender.no_high_severity_findings
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.platform_usage_plan.quota_limits
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.center_vulnerability_scan.vuln_scan_results_export_destination_encrypted
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.threat_hub.auto_enroll_new_accounts
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.defender.enabled
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.center_patch_management.vuln_patch_maintenance_windows_configured
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.defender.container_scan_enabled
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.defender.server_protection_enabled
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.security.center_finding.threat_finding_alert_destinations_configured
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.defender.for.servers.pricing.tier.standard.check
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.defender.for.cloud.security.contact.email.check
  for_each: azure.security.list
  conditions:
    var: item.id
    op: exists
