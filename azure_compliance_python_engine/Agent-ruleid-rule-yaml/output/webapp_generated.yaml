version: '1.0'
provider: azure
service: webapp
discovery:
- discovery_id: azure.webapp.list
  calls:
  - action: list
    save_as: list_response
  emit:
    items_for: '{{ list_response.value }}'
    as: item
    item:
      id: '{{ item.id }}'
      name: '{{ item.name }}'
      kind: '{{ item.kind }}'
      location: '{{ item.location }}'
      type: '{{ item.type }}'
      tags: '{{ item.tags }}'
      certificates: '{{ item.certificates }}'
      distinguished_name: '{{ item.distinguished_name }}'
      domain_verification_token: '{{ item.domain_verification_token }}'
      validity_in_years: '{{ item.validity_in_years }}'
      key_size: '{{ item.key_size }}'
      product_type: '{{ item.product_type }}'
      auto_renew: '{{ item.auto_renew }}'
      provisioning_state: '{{ item.provisioning_state }}'
      status: '{{ item.status }}'
      signed_certificate: '{{ item.signed_certificate }}'
      csr: '{{ item.csr }}'
      intermediate: '{{ item.intermediate }}'
      root: '{{ item.root }}'
      serial_number: '{{ item.serial_number }}'
checks:
- rule_id: azure.app.service.slot.check.minimum.tls.version
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.site.recovery_test_failover.dr_testing_logs_enabled
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.appservice.authentication.enabled.check
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.app.service.slot.public.network.access.check
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.app.service.function.slot.https.only.check
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.site.recovery_automation_runbook.dr_automation_change_audit_logging_enabled
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.site.recovery_test_failover.dr_testing_results_storage_encrypted_and_private
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.appservice.deployment.slot.php.version.check
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.application.insights_enabled
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.app.service.cors.check.allowed.origins
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.app.service.deployment.slot.https.only.enabled
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.app.service.deployment.slot.tls.encryption.check
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.application.gateway.waf.bot.protection.check
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.app.service.autoscale_enabled:az.azure_paas_app.paas_security_app_logging_enabled
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.site.recovery_notification_settings.dr_communication_destinations_access_least_privilege
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.app.service.environment.minimum.tls.version
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.app.service.deployment.slot.http.version.check
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.webapp.deployment.slot.python.version.supported
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.app.service.deployment.slot.remote.debugging.disabled
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.application.gateway.ssl.policy.minimum.tls.version
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.site.recovery_notification_settings.dr_communication_channels_configured
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.site.recovery.configured
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.app.service.slot.client.cert.check
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.site.recovery_automation_runbook.dr_automation_artifacts_encrypted_and_private
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.webapp.deployment.slot.vnet.configuration.enabled
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.app.service.deployment.slot.vnet.route.all.enabled.check
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.app.service.plan.private.endpoint.sku.compliance.check
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.app.service.http.logs.enabled
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.app.service.vnet.route.all.enabled.check
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.site.recovery_recovery_plan.dr_documentation_storage_encrypted_and_private
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.site.recovery_recovery_plan.dr_documentation_access_rbac_least_privilege
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.site.recovery_recovery_plan.dr_restore_from_encrypted_backups_only
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.site.recovery_recovery_plan.dr_restore_cross_account_restore_blocked_by_policy
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.application.gateway.waf.policy.request.body.inspection.enabled
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.application.gateway.http2.enabled
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.app.service.deployment.slot.java.version.check
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.appservice.app.ip.security.restrictions.disabled
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.site.recovery_replication_policy.dr_replication_lag_monitoring_alerts_enabled
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.app.service.deployment.slot.managed.identity.configured
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.site.recovery_replication_policy.dr_replication_auth_roles_least_privilege
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.site.recovery_notification_settings.dr_communication_no_public_webhooks_without_auth
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.app.service.private.endpoint.dns.zone.check
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.app.service.virtual.network.integration.check
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.site.recovery_automation_runbook.dr_automation_execution_roles_least_privilege
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.application.gateway.waf.enabled
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.app.service.identity.check
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.site.recovery_recovery_plan.dr_restore_roles_least_privilege
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.app.service.deployment.slots.basic.auth.disabled
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.site.recovery_replication_policy.dr_replication_cross_region_replication_encrypted
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.site.recovery_replication_policy.dr_replication_encryption_in_transit_tls_required
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.app.service.cors.wildcard.restriction
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.site.recovery_recovery_plan.dr_restore_logs_and_artifacts_encrypted
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.appservice.ase.internal.encryption.check
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.app.function.identity_without_admin_privileges
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.app.service.deployment.slot.ftps.state.check
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.app.service.private.endpoint.approved.check
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.appservice.ase.tls.cipher.suite.order.configured
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.appservice.deployment.slot.vnet.integration.check
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.app.service.managed_updates_enabled:az.azure_paas_app.paas_security_app_logging_enabled
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.site.recovery_test_failover.dr_testing_execution_roles_least_privilege
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.app.service.vnet.integration.check
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.app.service.environment.minimum.version.check
  for_each: azure.webapp.list
  conditions:
    var: item.id
    op: exists
