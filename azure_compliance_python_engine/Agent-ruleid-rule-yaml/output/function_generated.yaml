version: '1.0'
provider: azure
service: function
discovery:
- discovery_id: azure.function.list
  calls:
  - action: list
    save_as: list_response
  emit:
    items_for: '{{ list_response.value }}'
    as: item
    item:
      id: '{{ item.id }}'
      name: '{{ item.name }}'
      kind: '{{ item.kind }}'
      location: '{{ item.location }}'
      type: '{{ item.type }}'
      tags: '{{ item.tags }}'
      certificates: '{{ item.certificates }}'
      distinguished_name: '{{ item.distinguished_name }}'
      domain_verification_token: '{{ item.domain_verification_token }}'
      validity_in_years: '{{ item.validity_in_years }}'
      key_size: '{{ item.key_size }}'
      product_type: '{{ item.product_type }}'
      auto_renew: '{{ item.auto_renew }}'
      provisioning_state: '{{ item.provisioning_state }}'
      status: '{{ item.status }}'
      signed_certificate: '{{ item.signed_certificate }}'
      csr: '{{ item.csr }}'
      intermediate: '{{ item.intermediate }}'
      root: '{{ item.root }}'
      serial_number: '{{ item.serial_number }}'
checks:
- rule_id: azure.function.function_version.published_and_immutable
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.functionapp.vnet.routing.enabled.check
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.function.app.managed.identity.configured
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.functionapp.ftps.state.compliance.check
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.functionapp.basic.auth.publishing.disabled
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.functions.app.restrict_public_access
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.functionapp.https.only.check
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.functionapp.client.cert.required.check
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.function.function_version.rollforward_rollback_controls_present
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.function.app.minimum.tls.version
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.functionapp.python.version.check
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.functionapp.deployment.slot.vnet.integration.check
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.functionapp.deployment.slot.java.version.check
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.functionapp.deployment.slot.minimum.tls.version.check
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.function.app.deployment.slot.access.restrictions.disabled
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.function.serverless_function.dead_letter_queue
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.functionapp.authentication.enabled
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.function.app.vnet.integration.routing.enabled
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.function.app.function_restrict_public_access
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.functionapp.deployment.slot.identity.check
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.functionapp.incoming.client.certificates.required
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.function.app.deployment.slot.http.version.check
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.function.app.http.version.2.0.check
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.function.app.e2e.tls.enabled
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.function.app.deployment.slot.cors.restriction
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.function.app.deployment.slot.remote.debugging.disabled
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.function.serverless_function.env_no_plaintext_secrets
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.function.app.function_url_authentication
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.functionapp.tls.encryption.in.transit.check
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.functionapp.deployment.slots.basic.auth.disabled
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.function.serverless_function.vpc_private_networking_enabled
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.functions.app.url_public
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.function.app.vnet.integration.check
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.function.serverless_function.logging_and_tracing_enabled
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.function.serverless_function.role_least_privilege
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.function.app.cors.no.wildcard.origins
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.function.app.deployment.slot.vnet.routing.config.check
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.function.app.remote.debugging.check
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.function.app.deployment.slot.vnet.route.all.enabled
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.functionapp.java.supported.version.check
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.function.app.deployment.slot.python.version.check
  for_each: azure.function.list
  conditions:
    var: item.id
    op: exists
