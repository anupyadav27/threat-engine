version: '1.0'
provider: azure
service: dns
discovery:
- discovery_id: azure.dns.list
  calls:
  - action: list
    save_as: list_response
  emit:
    items_for: '{{ list_response.value }}'
    as: item
    item:
      id: '{{ item.id }}'
      name: '{{ item.name }}'
      type: '{{ item.type }}'
      location: '{{ item.location }}'
      tags: '{{ item.tags }}'
      etag: '{{ item.etag }}'
      zones: '{{ item.zones }}'
      identity: '{{ item.identity }}'
      sku: '{{ item.sku }}'
      ssl_policy: '{{ item.ssl_policy }}'
      operational_state: '{{ item.operational_state }}'
      gateway_ip_configurations: '{{ item.gateway_ip_configurations }}'
      authentication_certificates: '{{ item.authentication_certificates }}'
      trusted_root_certificates: '{{ item.trusted_root_certificates }}'
      trusted_client_certificates: '{{ item.trusted_client_certificates }}'
      ssl_certificates: '{{ item.ssl_certificates }}'
      frontend_ip_configurations: '{{ item.frontend_ip_configurations }}'
      frontend_ports: '{{ item.frontend_ports }}'
      probes: '{{ item.probes }}'
      backend_address_pools: '{{ item.backend_address_pools }}'
checks:
- rule_id: azure.dns.zone.cross_account_sharing_restricted
  for_each: azure.dns.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.dns.record_set.dmarc_record_present_when_mx_present
  for_each: azure.dns.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.dns.zone.query_logging_enabled
  for_each: azure.dns.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.dns.zone.zone_transfer_restricted_or_tsig_required
  for_each: azure.dns.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.dns.record_set.alias_targets_in_approved_services
  for_each: azure.dns.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.dns.health_probe.health_check_no_plaintext_credentials_in_url
  for_each: azure.dns.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.dns.record_set.caa_records_present_for_root_and_wildcard
  for_each: azure.dns.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.dns.health_probe.health_check_https_or_tls_used
  for_each: azure.dns.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.dns.record_set.no_rfc1918_in_public_zones
  for_each: azure.dns.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.dns.health_probe.health_check_alerts_configured
  for_each: azure.dns.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.dns.zone.dnssec_enabled_where_supported
  for_each: azure.dns.list
  conditions:
    var: item.id
    op: exists
- rule_id: azure.dns.record_set.no_overly_broad_wildcard_records_in_sensitive_zones
  for_each: azure.dns.list
  conditions:
    var: item.id
    op: exists
