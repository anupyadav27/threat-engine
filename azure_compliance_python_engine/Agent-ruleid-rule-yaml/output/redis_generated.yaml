version: '1.0'
provider: azure
service: redis
discovery:
- discovery_id: azure.redis.list_by_resource_group
  calls:
  - action: list_by_resource_group
    save_as: list_by_resource_group_response
  emit:
    items_for: '{{ list_by_resource_group_response.value }}'
    as: item
    item:
      id: '{{ item.id }}'
      name: '{{ item.name }}'
      type: '{{ item.type }}'
      location: '{{ item.location }}'
      tags: '{{ item.tags }}'
      group_short_name: '{{ item.group_short_name }}'
      enabled: '{{ item.enabled }}'
      email_receivers: '{{ item.email_receivers }}'
      sms_receivers: '{{ item.sms_receivers }}'
      webhook_receivers: '{{ item.webhook_receivers }}'
      itsm_receivers: '{{ item.itsm_receivers }}'
      azure_app_push_receivers: '{{ item.azure_app_push_receivers }}'
      automation_runbook_receivers: '{{ item.automation_runbook_receivers }}'
      voice_receivers: '{{ item.voice_receivers }}'
      logic_app_receivers: '{{ item.logic_app_receivers }}'
      azure_function_receivers: '{{ item.azure_function_receivers }}'
      arm_role_receivers: '{{ item.arm_role_receivers }}'
      event_hub_receivers: '{{ item.event_hub_receivers }}'
checks:
- rule_id: azure.redis.minimum.tls.version.check
  for_each: azure.redis.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.cache.redis.microsoft.entra.authentication.enabled
  for_each: azure.redis.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.cache.redis.ssl.only.access
  for_each: azure.redis.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.cache.redis.public.network.access.disabled
  for_each: azure.redis.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.redis.cache.system.assigned.identity.check
  for_each: azure.redis.list_by_resource_group
  conditions:
    var: item.id
    op: exists
