version: '1.0'
provider: azure
service: monitor
discovery:
- discovery_id: azure.monitor.list_by_resource_group
  calls:
  - action: list_by_resource_group
    save_as: list_by_resource_group_response
  emit:
    items_for: '{{ list_by_resource_group_response.value }}'
    as: item
    item:
      id: '{{ item.id }}'
      name: '{{ item.name }}'
      type: '{{ item.type }}'
      location: '{{ item.location }}'
      tags: '{{ item.tags }}'
      group_short_name: '{{ item.group_short_name }}'
      enabled: '{{ item.enabled }}'
      email_receivers: '{{ item.email_receivers }}'
      sms_receivers: '{{ item.sms_receivers }}'
      webhook_receivers: '{{ item.webhook_receivers }}'
      itsm_receivers: '{{ item.itsm_receivers }}'
      azure_app_push_receivers: '{{ item.azure_app_push_receivers }}'
      automation_runbook_receivers: '{{ item.automation_runbook_receivers }}'
      voice_receivers: '{{ item.voice_receivers }}'
      logic_app_receivers: '{{ item.logic_app_receivers }}'
      azure_function_receivers: '{{ item.azure_function_receivers }}'
      arm_role_receivers: '{{ item.arm_role_receivers }}'
      event_hub_receivers: '{{ item.event_hub_receivers }}'
checks:
- rule_id: azure.monitor.logging_store.access_rbac_least_privilege
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.activity.log.alert.create.or.update.public.ip.address
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.sampling_rule.access_rbac_least_privilege
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.logging_log_stream.logging_stream_encryption_at_rest_enabled
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.log.file_integrity_enabled
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.activity.log.alert.delete.policy.assignment.exists
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.log_analytics_workspace.logging_destination_tls_min_1_2_enforced
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert.delete_public_ip
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.action_group.incident_notification_endpoints_authenticated
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.admin.account.usage.check
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.logging_sink.destination_encrypted
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert_rule.dr_monitoring_alert_destinations_configured
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert.create_update_public_ip
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.group.kms_encryption_enabled
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.dashboard.public_embeds_disabled
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.log.metric.filter.policy.changes,.azure.active.directory.password.policy.reuse.24,.azure.active.directory.user.accesskey.unused,.azure.active.directory.user.console.access.unused
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.action_group.incident_notification_destinations_configured
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.activity.log.alert.sql.server.firewall.rule.exists
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.vm.cpu_alerts
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.network.route_tables_alarm_configured
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.action_group.incident_escalation_change_audit_logging_enabled
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.action_group.incident_notification_no_public_webhooks
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.action_group.incident_escalation_policy_exists_for_critical_severity
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.diagnostic.settings_exists
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert.create_update_sqlserver_fr
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert.delete_sqlserver_fr
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert.vnet_changes_configured
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.log.group.retention.policy.specific.days.enabled,.azure.storage.bucket.lifecycle.enabled
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.logging_log_stream.logging_stream_ingestion_auth_required
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.log.multi_region_enabled
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert.capacity_alerts_configured
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert.alarm_configured
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.vm.memory_alerts
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.resource.logging.enabled.check
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.log.metric_filter_alarm_configured
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.policy.specific_days_enabled
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.log.kms_encryption_enabled
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.logging_sink.cross_account_destinations_restricted
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.dashboard.sso_required
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.activity.log.alert.service.health.exists
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert.create_update_nsg
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.activity.log.alert.sql.server.firewall.rule.deletion.check
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.anomaly_detector.anomaly_detectors_enabled
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.logging_store.encryption_at_rest_cmek
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.network.acls_alarm_configured
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.paas_app.logging_enabled
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert.delete_security_solution
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.metric_alert.logging_metric_filter_kms_key_deletion_or_disable_detected_filter_present
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.metric_alert.logging_metric_filter_network_acl_or_sg_change_detected_filter_present
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.log.analysis_enabled
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.diagnostic.setting.categories.compliance.check
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.activity.log.alert.delete.nsg.exists
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert.destinations_authenticated
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.anomaly_detector.anomaly_alerts
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.activity.log.alert.exists.delete.security.solution
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert.create_update_security_solution
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.metric.filter.root.usage
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.network.gateways_alarm_configured
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.metrics.data_analytics_monitoring_query_access_logging_enabled
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.dashboard.sharing_restricted_to_org
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert_rule.dr_monitoring_alerts_for_rpo_rto_breach_configured
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.policy.assignment
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.log_analytics_workspace.logging_destination_iam_policy_least_privilege
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.logging_log_stream.logging_stream_retention_days_minimum
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.logging_store.immutability_or_object_lock_where_supported
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.activity.log.alert.public.ip.delete.check
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.activity.log.alert.nsg.operation.condition.check
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.storage.read_events_enabled
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.metric_alert.logging_metric_filter_console_root_login_detected_filter_present
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.sampling_rule.storage_encrypted
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.trace.retention_days_minimum
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.trace.access_rbac_least_privilege
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert.critical_alarms_enabled
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.logging_store.retention_days_minimum
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.log.retention_configured
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.storage.account_with_activity_logs_cmk_encrypted
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.trace.store_encrypted
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.diagnostic.settings.compliance.check
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.action_group.incident_notification_message_encryption_in_transit
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert_rule.dr_monitoring_alerts_for_backup_failures_configured
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert.alarm_actions
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.storage.write_events_enabled
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.log.logging_enabled
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.logging_query_definition.access_rbac_least_privilege
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.logging_query_definition.storage_encrypted
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.sampling_rule.rules_present
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.log_analytics_workspace.logging_destination_endpoint_private_networking
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.logging_sink.destination_least_privilege
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.activity.log.alert.policy.assignment.check
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.diagnostic.setting_appropriate_categories
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.action_group.incident_escalation_oncall_contacts_verified
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.metrics.data_analytics_monitoring_logs_retention_days_minimum
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.activity.log.alert.security.solution.update.check
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.metrics.data_analytics_monitoring_admin_activity_logging_enabled
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.storage.account_with_activity_logs_is_private
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert.delete_nsg
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.application.insights.configuration.check
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.metric_alert.logging_metric_filter_iam_policy_change_detected_filter_present
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.vulnerability_automation.vuln_automation_change_audit_logging_enabled
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.anomaly_detector.anomaly_training_data_sources_approved
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.monitor.alert_rule.dr_monitoring_alerts_for_replication_lag_configured
  for_each: azure.monitor.list_by_resource_group
  conditions:
    var: item.id
    op: exists
