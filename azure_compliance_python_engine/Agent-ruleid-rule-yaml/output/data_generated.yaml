version: '1.0'
provider: azure
service: data
discovery:
- discovery_id: azure.data.list_by_resource_group
  calls:
  - action: list_by_resource_group
    save_as: list_by_resource_group_response
  emit:
    items_for: '{{ list_by_resource_group_response.value }}'
    as: item
    item:
      id: '{{ item.id }}'
      name: '{{ item.name }}'
      type: '{{ item.type }}'
      location: '{{ item.location }}'
      tags: '{{ item.tags }}'
      group_short_name: '{{ item.group_short_name }}'
      enabled: '{{ item.enabled }}'
      email_receivers: '{{ item.email_receivers }}'
      sms_receivers: '{{ item.sms_receivers }}'
      webhook_receivers: '{{ item.webhook_receivers }}'
      itsm_receivers: '{{ item.itsm_receivers }}'
      azure_app_push_receivers: '{{ item.azure_app_push_receivers }}'
      automation_runbook_receivers: '{{ item.automation_runbook_receivers }}'
      voice_receivers: '{{ item.voice_receivers }}'
      logic_app_receivers: '{{ item.logic_app_receivers }}'
      azure_function_receivers: '{{ item.azure_function_receivers }}'
      arm_role_receivers: '{{ item.arm_role_receivers }}'
      event_hub_receivers: '{{ item.event_hub_receivers }}'
checks:
- rule_id: azure.data.lake_analytics_job.datalake_crawler_scope_restricted_to_allowlist
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_classifier.datalake_classifier_source_trusted
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_pipeline_parameter.pipeline_parameter_max_length_defined_where_applicable
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_quality.datalake_quality_role_least_privilege
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_pipeline_parameter.pipeline_parameter_constraint_allowlist_defined_when_applicable
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_dataset.pipeline_object_environment_no_plaintext_secrets
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_job.datalake_job_script_location_private_and_encrypted
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_pipeline_parameter.pipeline_parameter_constraint_min_length_defined_when_applicable
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_schema.datalake_schema_rbac_least_privilege
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_compute_policy.datalake_dev_endpoint_role_least_privilege
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_job.datalake_job_network_private_only
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_catalog.datalake_catalog_rbac_least_privilege
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_dataset.pipeline_object_network_private_only
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_ml_transform.datalake_ml_transform_network_private_only
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_workflow.datalake_workflow_kms_encryption_enabled
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_quality.datalake_quality_output_location_private_and_encrypted
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_pipeline_parameter.pipeline_parameter_type_set
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_job.datalake_crawler_network_private_only
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_pipeline_parameter.pipeline_parameter_default_not_sensitive
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_compute_policy.datalake_dev_endpoint_no_public_access
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_ml_transform.datalake_ml_transform_logs_enabled
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_partition.datalake_partition_catalog_encrypted
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.stream_analytics_job.streaming_analytics_checkpoints_and_outputs_encrypted
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_classifier.datalake_classifier_rbac_least_privilege
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_workflow.datalake_workflow_execution_role_least_privilege
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_catalog.datalake_catalog_cross_account_sharing_restricted
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_pipeline.pipeline_pipeline_artifacts_private_and_encrypted
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_job.datalake_job_role_least_privilege
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_connection.datalake_connection_credentials_in_secrets_manager
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.stream_analytics.logging_enabled
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_pipeline.pipeline_pipeline_execution_roles_least_privilege
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_ml_transform.datalake_ml_transform_role_least_privilege
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_pipeline_parameter.pipeline_parameter_constraint_pattern_defined_when_applicable
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_pipeline_parameter.pipeline_parameter_metadata_disallowed_attribute_keys_blocked
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_dataset.pipeline_object_logging_enabled
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_pipeline_parameter.pipeline_parameter_binding_secret_refs_resolved_at_runtime
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_pipeline_parameter.pipeline_parameter_allowed_values_defined_where_applicable
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.media_stream.streaming_video_retention_days_minimum
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_job.datalake_crawler_role_least_privilege
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_pipeline_parameter.pipeline_parameter_constraint_max_length_defined_when_applicable
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_pipeline_parameter.pipeline_parameter_value_from_secrets_manager_when_sensitive
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_database.datalake_database_policy_least_privilege
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_workflow.datalake_workflow_cross_account_trusts_restricted
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_dataset.pipeline_object_execution_role_least_privilege
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_compute_policy.datalake_dev_endpoint_encrypted
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_pipeline.pipeline_pipeline_kms_encryption_enabled
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_pipeline.pipeline_pipeline_private_networking_enforced
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_trigger.datalake_trigger_targets_least_privilege
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_registry.datalake_registry_cross_account_sharing_restricted
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_lineage.datalake_lineage_access_rbac_least_privilege
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_pipeline_parameter.pipeline_parameter_metadata_sensitive_keys_require_secret_type
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_pipeline_parameter.pipeline_parameter_attributes_no_plaintext_secrets
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.media_stream.streaming_video_encryption_at_rest_enabled
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_table.datalake_table_access_policies_least_privilege
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_registry.datalake_registry_rbac_least_privilege
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.stream_analytics.destination_least_privilege
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.media_stream.streaming_video_encryption_in_transit_required
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_trigger.datalake_trigger_event_sources_restricted
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.stream_analytics_job.streaming_analytics_network_private_only
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_schema.datalake_schema_version_immutability_enforced
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_pipeline_parameter.pipeline_parameter_binding_sensitive_params_not_logged
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_schema.datalake_schema_encrypted
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_pipeline_parameter.pipeline_parameter_min_length_defined_where_applicable
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_partition.datalake_partition_access_policies_least_privilege
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_pipeline_parameter.pipeline_parameter_metadata_values_not_plaintext_secret
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_pipeline_run.analytics_snapshot_encrypted_at_rest_cmek
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_database.datalake_database_encrypted
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_pipeline_parameter.pipeline_parameter_binding_only_expected_params_bound
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_registry.datalake_registry_metaencryption_enabled
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.stream_analytics.destination_encrypted
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_classifier.datalake_classifier_definition_version_pinned
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_pipeline_run.analytics_snapshot_not_publicly_shared
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_lineage.datalake_lineage_export_destination_encrypted
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_pipeline.pipeline_definition_version_immutability_enforced
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_job.datalake_crawler_logs_enabled
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_table.datalake_table_public_sharing_disabled
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_pipeline.pipeline_definition_storage_private
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_catalog.datalake_catalog_metaencryption_enabled
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_lineage.datalake_lineage_capture_enabled
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_pipeline.pipeline_definition_signed_and_verified
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_connection.datalake_connection_tls_required
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_catalog.datalake_catalog_audit_logging_enabled
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_table.datalake_table_encrypted
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.stream_analytics_job.streaming_analytics_role_least_privilege
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_trigger.datalake_trigger_logs_enabled
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_pipeline_run.analytics_snapshot_kms_key_policy_least_privilege
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_pipeline_parameter.pipeline_parameter_pattern_defined_where_applicable
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_quality.datalake_quality_logs_enabled
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_connection.datalake_connection_role_least_privilege
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_database.datalake_database_cross_account_sharing_restricted
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_pipeline.pipeline_pipeline_logs_and_metrics_enabled
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.factory_pipeline.pipeline_definition_storage_encrypted
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_job.datalake_job_logs_and_metrics_enabled
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_connection.datalake_connection_private_networking_enforced
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
- rule_id: azure.data.lake_analytics_table.datalake_table_column_level_access_controls_enabled
  for_each: azure.data.list_by_resource_group
  conditions:
    var: item.id
    op: exists
