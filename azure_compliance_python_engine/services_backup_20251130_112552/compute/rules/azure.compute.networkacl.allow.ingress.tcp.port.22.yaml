provider: azure
service: compute

discovery:
  - discovery_id: network_acls
    calls:
      - action: network_security_groups.list
        fields:
          - path: __self__
            var: nsg
          - path: security_rules[].properties
            var: security_rule
checks:
  - check_id: azure.compute.networkacl.allow.ingress.tcp.port.22
    title: Ensure Network ACLs do not allow ingress on TCP port 22
    severity: high
    for_each: network_acls
    param: security_rule
    calls:
      - action: self
        fields:
          - path: properties.direction
            operator: equals
            expected: Inbound
          - path: properties.protocol
            operator: equals
            expected: Tcp
          - path: properties.destinationPortRange
            operator: not_equals
            expected: 22
