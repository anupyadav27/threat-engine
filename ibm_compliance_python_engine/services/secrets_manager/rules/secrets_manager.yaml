secrets_manager:
  version: '1.0'
  provider: ibm
  service: secrets_manager
  scope: regional
  client_class: ResourceControllerV2
  discovery:
  - discovery_id: secrets_manager.secrets
    calls:
    - action: list_resource_instances
      params: &id001 {}
      save_as: secrets
  - discovery_id: secrets_manager.document_secretss
    calls:
    - action: list_resource_instances
      params: *id001
      save_as: document_secretss
  - discovery_id: secrets_manager.documents_set_as_publics
    calls:
    - action: list_resource_instances
      params: *id001
      save_as: documents_set_as_publics
  - discovery_id: secrets_manager.managed_compliant_patchings
    calls:
    - action: list_resource_instances
      params: *id001
      save_as: managed_compliant_patchings
  checks:
  - check_id: ibm.secrets_manager.secret.manager_secret_rotation_enabled
    title: Enforce Secret Rotation for Enhanced Security in IBM Secrets Manager
    severity: high
    for_each: secrets
    calls:
    - action: get_secrets_manager_resource
      fields:
      - path: last_rotation
        operator: age_days
        expected: 90
      note: IBM secrets_manager compliance check
    note: 'MANUAL_REVIEW: Verify field path "last_rotation" exists in secrets_manager.secrets response'
  - check_id: ibm.secrets_manager.secret.automatic_rotation_enabled
    title: Ensure Automatic Secret Rotation is Enabled in IBM Secrets Manager
    severity: medium
    for_each: secrets
    calls:
    - action: get_secrets_manager_resource
      fields:
      - path: last_rotation
        operator: age_days
        expected: 90
      note: IBM secrets_manager compliance check
    note: 'MANUAL_REVIEW: Verify field path "last_rotation" exists in secrets_manager.secrets response'
  - check_id: ibm.secrets_manager.document_secrets.document_secrets_enabled
    title: Ensure Document Secrets Are Enabled in IBM Cloud Secrets Manager
    severity: high
    for_each: document_secretss
    calls:
    - action: get_secrets_manager_resource
      fields:
      - path: status
        operator: exists
        expected: active
      note: IBM secrets_manager compliance check
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in secrets_manager.document_secretss response'
  - check_id: ibm.secrets_manager.documents_set_as_public.documents_set_as_public_blocked
    title: Prevent Public Access to Secrets Manager Documents
    severity: critical
    for_each: documents_set_as_publics
    calls:
    - action: get_secrets_manager_resource
      fields:
      - path: locked
        operator: equals
        expected: false
      note: IBM secrets_manager compliance check
    note: 'MANUAL_REVIEW: Verify field path "locked" exists in secrets_manager.documents_set_as_publics response'
  - check_id: ibm.secrets_manager.managed_compliant_patching.managed_compliant_patching_validated
    title: Ensure Managed Compliant Patching for IBM Secrets Manager
    severity: medium
    for_each: managed_compliant_patchings
    calls:
    - action: get_secrets_manager_resource
      fields:
      - path: status
        operator: exists
        expected: active
      note: IBM secrets_manager compliance check
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in secrets_manager.managed_compliant_patchings response'
  sdk_package: ibm_platform_services
