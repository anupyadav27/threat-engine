schematics:
  version: '1.0'
  provider: ibm
  service: schematics
  scope: regional
  client_class: ResourceControllerV2
  discovery:
  - discovery_id: schematics.workspaces
    calls:
    - action: list_resource_instances
      params: {}
      save_as: workspaces
  checks:
  - check_id: ibm.schematics.workspace.compliant_patching_ibm_iks_..._version_upgrade_enabled
    title: Ensure IKS Version Upgrade is Enabled for Secure Patch Management
    severity: medium
    for_each: workspaces
    calls:
    - action: get_schematics_resource
      fields:
      - path: '...version.upgrade.enabled'
        operator: exists
        expected: true
      note: IBM schematics compliance check
    note: 'MANUAL_REVIEW: Verify field path "...version.upgrade.enabled" exists in schematics.workspaces response'
  - check_id: ibm.schematics.workspace.config_aggregation_auto_enroll_new_accounts
    title: Ensure Auto Enrollment in Config Aggregation for New Accounts
    severity: low
    for_each: workspaces
    calls:
    - action: get_schematics_resource
      fields:
      - path: status
        operator: exists
        expected: active
      note: IBM schematics compliance check
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in schematics.workspaces response'
  - check_id: ibm.schematics.workspace.config_aggregation_org_aggregator_enabled
    title: Enable Config Aggregation for Organizational Security Monitoring
    severity: low
    for_each: workspaces
    calls:
    - action: get_schematics_resource
      fields:
      - path: status
        operator: exists
        expected: active
      note: IBM schematics compliance check
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in schematics.workspaces response'
  - check_id: ibm.schematics.workspace.config_baseline_conformance_pack_deployed
    title: Ensure Config Baseline Conformance Pack is Deployed in Schematics Workspace
    severity: low
    for_each: workspaces
    calls:
    - action: get_schematics_resource
      fields:
      - path: status
        operator: exists
        expected: active
      note: IBM schematics compliance check
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in schematics.workspaces response'
  - check_id: ibm.schematics.workspace.config_baseline_parameters_set
    title: Ensure Config Baseline Parameters Are Set for Schematics Workspaces
    severity: low
    for_each: workspaces
    calls:
    - action: get_schematics_resource
      fields:
      - path: status
        operator: exists
        expected: active
      note: IBM schematics compliance check
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in schematics.workspaces response'
  - check_id: ibm.schematics.workspace.destination_access_least_privilege
    title: Enforce Least Privilege Access in IBM Schematics Workspaces
    severity: high
    for_each: workspaces
    calls:
    - action: get_schematics_resource
      fields:
      - path: status
        operator: exists
        expected: active
      note: IBM schematics compliance check
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in schematics.workspaces response'
  - check_id: ibm.schematics.workspace.kms_encryption_enabled
    title: Ensure KMS Encryption is Enabled for IBM Schematics Workspaces
    severity: high
    for_each: workspaces
    calls:
    - action: get_schematics_resource
      fields:
      - path: encryption.kms_key_crn
        operator: exists
        expected: true
      note: IBM schematics compliance check
    note: 'MANUAL_REVIEW: Verify field path "encryption.kms_key_crn" exists in schematics.workspaces response'
  - check_id: ibm.schematics.workspace.secure_destination
    title: Ensure Secure Destination for IBM Schematics Workspaces
    severity: low
    for_each: workspaces
    calls:
    - action: get_schematics_resource
      fields:
      - path: status
        operator: exists
        expected: active
      note: IBM schematics compliance check
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in schematics.workspaces response'
  - check_id: ibm.schematics.workspace.alerts_configured
    title: Ensure Alerts are Configured for IBM Schematics Workspaces
    severity: low
    for_each: workspaces
    calls:
    - action: get_schematics_resource
      fields:
      - path: status
        operator: exists
        expected: active
      note: IBM schematics compliance check
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in schematics.workspaces response'
  - check_id: ibm.schematics.workspace.drift_detection_enabled
    title: Enable Drift Detection for IBM Schematics Workspaces
    severity: low
    for_each: workspaces
    calls:
    - action: get_schematics_resource
      fields:
      - path: status
        operator: exists
        expected: active
      note: IBM schematics compliance check
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in schematics.workspaces response'
  - check_id: ibm.schematics.workspace.enabled
    title: Ensure IBM Schematics Workspaces Are Enabled for Security Monitoring
    severity: low
    for_each: workspaces
    calls:
    - action: get_schematics_resource
      fields:
      - path: status
        operator: exists
        expected: active
      note: IBM schematics compliance check
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in schematics.workspaces response'
  - check_id: ibm.schematics.workspace.global_resources_tracked
    title: Ensure Global Resources Are Tracked in IBM Schematics Workspaces
    severity: low
    for_each: workspaces
    calls:
    - action: get_schematics_resource
      fields:
      - path: status
        operator: exists
        expected: active
      note: IBM schematics compliance check
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in schematics.workspaces response'
  - check_id: ibm.schematics.workspace.auto_remediation_high
    title: Enable Auto Remediation for High-Risk Schematics Workspace Issues
    severity: low
    for_each: workspaces
    calls:
    - action: get_schematics_resource
      fields:
      - path: status
        operator: exists
        expected: active
      note: IBM schematics compliance check
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in schematics.workspaces response'
  - check_id: ibm.schematics.workspace.manual_runbooks_attached
    title: Ensure Manual Runbooks are Attached to Schematics Workspaces
    severity: low
    for_each: workspaces
    calls:
    - action: get_schematics_resource
      fields:
      - path: status
        operator: exists
        expected: active
      note: IBM schematics compliance check
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in schematics.workspaces response'
  sdk_package: ibm_platform_services
