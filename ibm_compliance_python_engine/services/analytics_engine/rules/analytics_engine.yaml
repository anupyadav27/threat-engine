analytics_engine:
  version: '1.0'
  provider: ibm
  service: analytics_engine
  scope: regional
  client_class: ResourceControllerV2
  discovery:
  - discovery_id: analytics_engine.resources
    calls:
    - action: list_resource_instances
      params: {}
      save_as: resources
  - discovery_id: analytics_engine.clusters
    calls:
    - action: list_resource_instances
      params: {}
      save_as: clusters
  checks:
  - check_id: ibm.analytics_engine.resource.encrypted_with_cmks_disabled
    title: Enforce Customer-Managed Key Encryption for Analytics Engine
    severity: medium
    for_each: resources
    calls:
    - action: get_analytics_engine_resource
      fields:
      - path: encryption_at_rest
        operator: equals
        expected: true
      note: IBM analytics_engine compliance check
    note: 'MANUAL_REVIEW: Verify field path "encryption_at_rest" exists in analytics_engine.resources response'
  - check_id: ibm.analytics_engine.cluster.account_public_block_enabled
    title: Ensure Public Access Block is Enabled for IBM Analytics Engine Clusters
    severity: critical
    for_each: clusters
    calls:
    - action: get_analytics_engine_resource
      fields:
      - path: status
        operator: exists
        expected: active
      note: IBM analytics_engine compliance check
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in analytics_engine.clusters response'
  - check_id: ibm.analytics_engine.cluster.master_nodes_no_public_ip
    title: Ensure Master Nodes in IBM Analytics Engine Lack Public IP Addresses
    severity: critical
    for_each: clusters
    calls:
    - action: get_analytics_engine_resource
      fields:
      - path: status
        operator: exists
        expected: active
      note: IBM analytics_engine compliance check
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in analytics_engine.clusters response'
  - check_id: ibm.analytics_engine.cluster.publicly_accesible
    title: Prevent Public Access to IBM Analytics Engine Clusters
    severity: critical
    for_each: clusters
    calls:
    - action: get_analytics_engine_resource
      fields:
      - path: status
        operator: exists
        expected: active
      note: IBM analytics_engine compliance check
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in analytics_engine.clusters response'
  sdk_package: ibm_platform_services
