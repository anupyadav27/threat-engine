key_protect:
  version: '1.0'
  provider: ibm
  service: key_protect
  scope: regional
  package: ibm-cloud-sdk-core
  client_class: Key_ProtectV1
  discovery:
  - discovery_id: key_protect.instances
    calls:
    - action: self
      note: 'MANUAL_REVIEW_REQUIRED: Add real SDK method for key_protect.instances'
      save_as: instances
  - discovery_id: key_protect.keys
    calls:
    - action: self
      note: 'MANUAL_REVIEW_REQUIRED: Add real SDK method for key_protect.keys'
      save_as: keys
  - discovery_id: key_protect.resources
    calls:
    - action: self
      note: 'MANUAL_REVIEW_REQUIRED: Add real SDK method for key_protect.resources'
      save_as: resources
  - discovery_id: key_protect.instance_policys
    calls:
    - action: self
      note: 'MANUAL_REVIEW_REQUIRED: Add real SDK method for key_protect.instance_policys'
      save_as: instance_policys
  - discovery_id: key_protect.key_policys
    calls:
    - action: self
      note: 'MANUAL_REVIEW_REQUIRED: Add real SDK method for key_protect.key_policys'
      save_as: key_policys
  - discovery_id: key_protect.protect_secrets
    calls:
    - action: self
      note: 'MANUAL_REVIEW_REQUIRED: Add real SDK method for key_protect.protect_secrets'
      save_as: protect_secrets
  - discovery_id: key_protect.protect_vaults
    calls:
    - action: self
      note: 'MANUAL_REVIEW_REQUIRED: Add real SDK method for key_protect.protect_vaults'
      save_as: protect_vaults
  - discovery_id: key_protect.private_endpointss
    calls:
    - action: self
      note: 'MANUAL_REVIEW_REQUIRED: Add real SDK method for key_protect.private_endpointss'
      save_as: private_endpointss
  checks:
  - check_id: ibm.key_protect.instance.high_availability_enabled
    title: Ensure High Availability for IBM Key Protect Instances
    severity: medium
    for_each: key_protect.instances
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.instances response'
  - check_id: ibm.key_protect.key.expiration_set
    title: Ensure Key Expiration is Set for IBM Key Protect Keys
    severity: medium
    for_each: key_protect.keys
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.keys response'
  - check_id: ibm.key_protect.key.lifecycle_policy_configured
    title: Enforce Lifecycle Policy for Secure Key Management in IBM Key Protect
    severity: medium
    for_each: key_protect.keys
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.keys response'
  - check_id: ibm.key_protect.key.public_access_blocked
    title: Ensure Public Access to IBM Key Protect Keys is Blocked
    severity: critical
    for_each: key_protect.keys
    calls:
    - action: self
      fields:
      - path: public_access
        operator: equals
        expected: false
    note: 'MANUAL_REVIEW: Verify field path "public_access" exists in key_protect.keys response'
  - check_id: ibm.key_protect.key.not_scheduled_for_deletion
    title: Ensure IBM Key Protect Keys Are Not Scheduled for Deletion
    severity: medium
    for_each: key_protect.keys
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.keys response'
  - check_id: ibm.key_protect.key.rotation_enabled
    title: Enforce Key Rotation for Enhanced Security in IBM Key Protect
    severity: medium
    for_each: key_protect.keys
    calls:
    - action: self
      fields:
      - path: last_rotation
        operator: age_days
        expected: 90
    note: 'MANUAL_REVIEW: Verify field path "last_rotation" exists in key_protect.keys response'
  - check_id: ibm.key_protect.key.secrets_alias_points_to_active_key
    title: Ensure Secrets Alias Points to an Active Key in IBM Key Protect
    severity: high
    for_each: key_protect.keys
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.keys response'
  - check_id: ibm.key_protect.key.secrets_alias_has_alias
    title: Ensure All Key Protect Secrets Have a Defined Alias
    severity: high
    for_each: key_protect.keys
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.keys response'
  - check_id: ibm.key_protect.key.data_warehouse_hsm_client_cert_length_minimum
    title: Enforce Minimum Length for Data Warehouse HSM Client Certificates
    severity: medium
    for_each: key_protect.keys
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.keys response'
  - check_id: ibm.key_protect.key.data_warehouse_hsm_client_cert_not_expired
    title: Ensure Data Warehouse HSM Client Certificates Are Valid in Key Protect
    severity: medium
    for_each: key_protect.keys
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.keys response'
  - check_id: ibm.key_protect.key.data_warehouse_hsm_client_cert_trusted_issuer
    title: Ensure Trusted Issuer for Data Warehouse HSM Client Certificates
    severity: medium
    for_each: key_protect.keys
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.keys response'
  - check_id: ibm.key_protect.key.secrets_certificate_length_minimum
    title: Enforce Minimum Length for Secrets Certificates in Key Protect
    severity: high
    for_each: key_protect.keys
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.keys response'
  - check_id: ibm.key_protect.key.secrets_certificate_not_expired
    title: Ensure Secrets Certificate Validity in IBM Key Protect
    severity: high
    for_each: key_protect.keys
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.keys response'
  - check_id: ibm.key_protect.key.secrets_certificate_trusted_issuer
    title: Ensure Secrets Certificates Have Trusted Issuers in IBM Key Protect
    severity: high
    for_each: key_protect.keys
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.keys response'
  - check_id: ibm.key_protect.key.protect_cmk_are_used_enabled
    title: Ensure Custom Master Keys (CMKs) are Active in IBM Key Protect
    severity: medium
    for_each: key_protect.keys
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.keys response'
  - check_id: ibm.key_protect.key.protect_cmk_not_deleted_unintentionally_enabled
    title: Ensure Intentional Deletion Protocols for CMKs in IBM Key Protect
    severity: medium
    for_each: key_protect.keys
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.keys response'
  - check_id: ibm.key_protect.key.protect_cmk_not_multi_region_enabled
    title: Ensure CMK Multi-Region Support for Enhanced Resilience and Compliance
    severity: medium
    for_each: key_protect.keys
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.keys response'
  - check_id: ibm.key_protect.resource.protect_cmk_rotation_enabled
    title: Ensure CMK Rotation is Enabled in IBM Key Protect for Enhanced Security
    severity: medium
    for_each: key_protect.resources
    calls:
    - action: self
      fields:
      - path: last_rotation
        operator: age_days
        expected: 90
    note: 'MANUAL_REVIEW: Verify field path "last_rotation" exists in key_protect.resources response'
  - check_id: ibm.key_protect.instance_policy.data_warehouse_hsm_configuration_present
    title: Ensure Data Warehouse HSM Configuration is Present for Key Protect Instances
    severity: medium
    for_each: key_protect.instance_policys
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.instance_policys response'
  - check_id: ibm.key_protect.instance_policy.data_warehouse_hsm_keys_in_hsm_only
    title: Enforce HSM-Only Key Storage for Data Warehouse Encryption
    severity: high
    for_each: key_protect.instance_policys
    calls:
    - action: self
      fields:
      - path: encryption_at_rest
        operator: equals
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "encryption_at_rest" exists in key_protect.instance_policys response'
  - check_id: ibm.key_protect.instance_policy.data_warehouse_hsm_only_approved_hsm_endpoints
    title: Enforce Use of Approved HSM Endpoints for Key Protect Data Warehouses
    severity: medium
    for_each: key_protect.instance_policys
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.instance_policys response'
  - check_id: ibm.key_protect.key.privacy_encryption_at_rest_cmek_enabled
    title: Ensure Customer-Managed Encryption Keys (CMEK) for Data Privacy in IBM Key Protect
    severity: high
    for_each: key_protect.keys
    calls:
    - action: self
      fields:
      - path: encryption_at_rest
        operator: equals
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "encryption_at_rest" exists in key_protect.keys response'
  - check_id: ibm.key_protect.key.privacy_encryption_in_transit_tls_min_1_2
    title: Ensure TLS 1.2+ for Key Protect Encryption In Transit
    severity: high
    for_each: key_protect.keys
    calls:
    - action: self
      fields:
      - path: encryption_at_rest
        operator: equals
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "encryption_at_rest" exists in key_protect.keys response'
  - check_id: ibm.key_protect.key_policy.secrets_kms_grant_constraints_present
    title: Enforce Secrets KMS Grant Constraints in IBM Key Protect Policies
    severity: high
    for_each: key_protect.key_policys
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.key_policys response'
  - check_id: ibm.key_protect.key_policy.secrets_kms_grant_grantee_principal_valid
    title: Validate Grantee Principals in Secrets KMS Key Policies
    severity: high
    for_each: key_protect.key_policys
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.key_policys response'
  - check_id: ibm.key_protect.key_policy.secrets_kms_grant_lessthan_wildcard_permissions
    title: Enforce Restrictive Permissions for IBM Key Protect Secrets Management
    severity: high
    for_each: key_protect.key_policys
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.key_policys response'
  - check_id: ibm.key_protect.instance_policy.secrets_parameter_access_rbac_least_privilege
    title: Enforce RBAC Least Privilege for Key Protect Secrets Access
    severity: high
    for_each: key_protect.instance_policys
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.instance_policys response'
  - check_id: ibm.key_protect.instance_policy.secrets_parameter_kms_configured
    title: Ensure KMS Configured for Secrets in IBM Key Protect Instance Policies
    severity: high
    for_each: key_protect.instance_policys
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.instance_policys response'
  - check_id: ibm.key_protect.instance_policy.secrets_parameter_secure_string_type_for_sensitive
    title: Enforce Secure String Parameter for Sensitive Secrets in Key Protect
    severity: high
    for_each: key_protect.instance_policys
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.instance_policys response'
  - check_id: ibm.key_protect.key.secrets_private_ca_access_rbac_least_privilege
    title: Enforce Least Privilege for Secrets Private CA Access in IBM Key Protect
    severity: high
    for_each: key_protect.keys
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.keys response'
  - check_id: ibm.key_protect.key.secrets_private_ca_in_hsm_where_supported
    title: Enforce HSM Storage for Private CA Secrets in IBM Key Protect
    severity: high
    for_each: key_protect.keys
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.keys response'
  - check_id: ibm.key_protect.key.secrets_private_ca_crl_or_ocsp_configured
    title: Ensure CRL or OCSP is Configured for IBM Key Protect Secrets
    severity: high
    for_each: key_protect.keys
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.keys response'
  - check_id: ibm.key_protect.key.secrets_private_ca_path_length_constraints_set
    title: Enforce Path Length Constraints for Secrets Manager Private CA
    severity: high
    for_each: key_protect.keys
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.keys response'
  - check_id: ibm.key_protect.protect_secret.secrets_secret_kms_configured
    title: Ensure KMS Configuration for Secrets in IBM Key Protect
    severity: high
    for_each: key_protect.protect_secrets
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.protect_secrets response'
  - check_id: ibm.key_protect.protect_secret.secrets_secret_no_plaintext_exposed_in_policy_or_tags
    title: Prevent Plaintext Exposure in Key Protect Policies and Tags
    severity: critical
    for_each: key_protect.protect_secrets
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.protect_secrets response'
  - check_id: ibm.key_protect.protect_secret.secrets_secret_rotation_configured_where_applicable
    title: Ensure Secret Rotation is Configured for IBM Key Protect Secrets
    severity: high
    for_each: key_protect.protect_secrets
    calls:
    - action: self
      fields:
      - path: last_rotation
        operator: age_days
        expected: 90
    note: 'MANUAL_REVIEW: Verify field path "last_rotation" exists in key_protect.protect_secrets response'
  - check_id: ibm.key_protect.protect_vault.secrets_store_access_rbac_least_privilege
    title: Enforce Least Privilege for Secrets Store Access in IBM Key Protect
    severity: high
    for_each: key_protect.protect_vaults
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.protect_vaults response'
  - check_id: ibm.key_protect.protect_vault.secrets_store_kms_encryption_enabled
    title: Enforce KMS Encryption for Secrets in IBM Key Protect Vaults
    severity: high
    for_each: key_protect.protect_vaults
    calls:
    - action: self
      fields:
      - path: encryption.kms_key_crn
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "encryption.kms_key_crn" exists in key_protect.protect_vaults response'
  - check_id: ibm.key_protect.protect_vault.secrets_store_rotation_enabled_for_rotatable_secrets
    title: Enforce Rotation for Rotatable Secrets in IBM Key Protect Vaults
    severity: high
    for_each: key_protect.protect_vaults
    calls:
    - action: self
      fields:
      - path: last_rotation
        operator: age_days
        expected: 90
    note: 'MANUAL_REVIEW: Verify field path "last_rotation" exists in key_protect.protect_vaults response'
  - check_id: ibm.key_protect.resource.logging_enabled
    title: Ensure Logging is Enabled for IBM Key Protect Resources
    severity: medium
    for_each: key_protect.resources
    calls:
    - action: self
      fields:
      - path: logging_enabled
        operator: equals
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "logging_enabled" exists in key_protect.resources response'
  - check_id: ibm.key_protect.private_endpoints.private_endpoints_enabled
    title: Enforce Private Endpoints for IBM Cloud Key Protect Service
    severity: low
    for_each: key_protect.private_endpointss
    calls:
    - action: self
      fields:
      - path: enabled
        operator: exists
        expected: true
    note: 'MANUAL_REVIEW: Verify field path "enabled" exists in key_protect.private_endpointss response'
  - check_id: ibm.key_protect.key.protect_rotation_policy_interval_enabled
    title: Enforce Key Rotation Policy Interval in IBM Key Protect
    severity: medium
    for_each: key_protect.keys
    calls:
    - action: self
      fields:
      - path: last_rotation
        operator: age_days
        expected: 90
    note: 'MANUAL_REVIEW: Verify field path "last_rotation" exists in key_protect.keys response'
