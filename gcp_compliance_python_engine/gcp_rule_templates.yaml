# GCP Rule Templates (for gcp_compliance_python_engine)
# Replace <placeholders> accordingly.

# Global service example (GCS)
<gcs>:
  scope: global
  discovery:
    - discovery_id: <buckets>
      calls:
        - action: list_buckets
          fields:
            - path: __self__
              var: bucket
    - discovery_id: <bucket_meta>
      for_each: <buckets>
      calls:
        - action: get_bucket_metadata
          fields:
            - path: raw.location
              var: location
  checks:
    - check_id: <gcs_check>
      title: <name>
      severity: <low|medium|high|critical>
      for_each: <buckets>
      param: bucket
      logic: AND
      calls:
        - action: get_bucket_metadata
          fields:
            - path: raw.iamConfiguration.bucketPolicyOnly.enabled
              operator: equals
              expected: true

# Regional service example (Compute)
<compute>:
  scope: regional
  discovery:
    - discovery_id: <instances>
      calls:
        - action: eval
          fields:
            - path: name
              var: instance_name
            - path: has_external_ip
              var: has_external_ip
    - discovery_id: <firewalls>
      calls:
        - action: eval
          fields:
            - path: name
              var: firewall_name
            - path: allowed_tcp_ports[]
              var: allowed_tcp_ports
  checks:
    - check_id: <no_external_ip>
      title: Instances should not have external IPs
      severity: high
      for_each: <instances>
      param: item
      calls:
        - action: eval
          fields:
            - path: has_external_ip
              operator: equals
              expected: false 