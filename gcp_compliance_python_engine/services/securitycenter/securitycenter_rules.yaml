# ============================================================================
# CURSOR AI: GCP SERVICE VALIDATION INSTRUCTIONS
# ============================================================================
# 
# üéØ YOUR MISSION: Validate and fix this GCP service YAML file
#
# WORKFLOW:
# 1. Read this entire YAML file structure
# 2. Run: `export GCP_ENGINE_FILTER_SERVICES="<SERVICE>" && python engine/gcp_engine.py > output/test_<service>.json 2>&1`
# 3. Analyze output - check for inventories, main_checks, errors
# 4. Fix issues in discovery and checks sections below
# 5. Re-run engine and verify output
# 6. Iterate until all checks work (PASS/FAIL based on resources)
# 7. Update validation status at bottom of file
#
# COMMON ISSUES & FIXES:
#
# ‚ùå Empty inventories ‚Üí Fix discovery action (must be: list_<resource>, aggregatedList_<resource>)
# ‚ùå Zero checks executed ‚Üí Fix for_each to match discovery_id
# ‚ùå All checks fail ‚Üí Fix field paths to match GCP API response
# ‚ùå Skipped checks ‚Üí Verify discovery_id exists and completed
# ‚ùå Python errors ‚Üí Check YAML syntax, action names
#
# TESTING:
# - Run engine: `export GCP_ENGINE_FILTER_SERVICES="<service>" && python engine/gcp_engine.py > output/test.json 2>&1`
# - Check output: `cat output/test.json | python3 -m json.tool`
# - Verify: inventories array has resources, main_checks array has results
#
# SUCCESS CRITERIA:
# ‚úÖ Engine runs without Python exceptions
# ‚úÖ Inventories populated (if resources exist in GCP)
# ‚úÖ All checks execute (PASS/FAIL based on actual resource state)
# ‚úÖ No skipped checks (unless expected)
# ‚úÖ Clean JSON output
#
# DOCUMENTATION:
# After fixing, update validation section at bottom:
# # VALIDATION STATUS:
# # - Issues Found: <what was wrong>
# # - Fixes Applied: <what you fixed>
# # - Tested: <date>
# # - Inventories: <count>
# # - Checks: <count executed>
# # - Status: ‚úÖ VALIDATED / ‚è≥ IN PROGRESS / ‚ùå NEEDS WORK
#
# ============================================================================

service_name:  # e.g., compute, gcs, pubsub

securitycenter:
  version: '1.0'
  provider: gcp
  service: securitycenter
  scope: global
  discovery:
  - discovery_id: list_security_center_sources
    calls:
    - action: list
      resource: organizations.sources
      fields:
      - path: name
        var: source_name
      - path: displayName
        var: source_display_name
  - discovery_id: list_security_center_findings
    calls:
    - action: list
      resource: organizations.sources.findings
      fields:
      - path: name
        var: finding_name
      - path: state
        var: finding_state
      - path: severity
        var: finding_severity
  - discovery_id: list_notification_configs
    calls:
    - action: list
      resource: organizations.notificationConfigs
      fields:
      - path: name
        var: notification_name
      - path: pubsubTopic
        var: pubsub_topic
  - discovery_id: list_security_marks
    calls:
    - action: list
      resource: organizations.assets
      fields:
      - path: securityMarks
        var: security_marks
      - path: name
        var: asset_name
  checks:
  - check_id: gcp.securitycenter.automation.vuln_automation_change_audit_logging_enabled
    title: Enable Audit Logging for Vulnerability Automation Changes
    severity: high
    for_each: list_security_center_sources
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.auditLogging.enabled
        operator: equals
        expected: true
      - path: properties.automationType
        operator: equals
        expected: VULNERABILITY
  - check_id: gcp.securitycenter.automation.vuln_automation_execution_roles_least_privilege
    title: Ensure Least Privilege for Vulnerability Automation Roles
    severity: high
    for_each: list_security_center_sources
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.executionRoles
        operator: exists
      - path: properties.executionRoles[].permissions
        operator: contains
        expected: securitycenter.findings.update
  - check_id: gcp.securitycenter.finding.center_enabled
    title: Ensure Security Command Center is Enabled
    severity: critical
    for_each: list_security_center_sources
    logic: AND
    calls:
    - action: eval
      fields:
      - path: state
        operator: equals
        expected: ACTIVE
  - check_id: gcp.securitycenter.finding.center_is_enabled
    title: Verify Security Command Center Service Status
    severity: critical
    for_each: list_security_center_sources
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.serviceEnabled
        operator: equals
        expected: true
  - check_id: gcp.securitycenter.finding.center_no_high_severity_findings
    title: Ensure No High Severity Findings in Security Command Center
    severity: high
    for_each: list_security_center_findings
    logic: AND
    calls:
    - action: eval
      fields:
      - path: severity
        operator: equals
        expected: LOW
      - path: state
        operator: equals
        expected: INACTIVE
  - check_id: gcp.securitycenter.finding.command_center_enabled
    title: Enable Security Command Center for Robust Threat Detection
    severity: critical
    for_each: list_security_center_sources
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.threatDetectionEnabled
        operator: equals
        expected: true
  - check_id: gcp.securitycenter.finding.command_center_guardduty_enabled
    title: Ensure Security Command Center GuardDuty Integration is Enabled
    severity: high
    for_each: list_security_center_sources
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.integrations.guardDuty.enabled
        operator: equals
        expected: true
  - check_id: gcp.securitycenter.finding.command_center_is_enabled
    title: Validate Security Command Center Operational Status
    severity: critical
    for_each: list_security_center_sources
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.operationalStatus
        operator: equals
        expected: ENABLED
  - check_id: gcp.securitycenter.finding.command_center_no_high_severity_findings_configured
    title: Ensure High Severity Findings Are Configured in Security Command Center
    severity: medium
    for_each: list_security_center_findings
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.severityConfig.highSeverity.enabled
        operator: equals
        expected: true
  - check_id: gcp.securitycenter.finding.command_center_security_center_enabled
    title: Enable Cloud Security Command Center for Enhanced Monitoring
    severity: critical
    for_each: list_security_center_sources
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.enhancedMonitoring.enabled
        operator: equals
        expected: true
  - check_id: gcp.securitycenter.finding.command_center_vulnerability_assessment_enabled
    title: Enable Command Center Vulnerability Assessment
    severity: high
    for_each: list_security_center_sources
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.vulnerabilityAssessment.enabled
        operator: equals
        expected: true
  - check_id: gcp.securitycenter.finding.incident_automation_artifacts_encrypted_and_private
    title: Ensure Incident Artifacts Are Encrypted and Private
    severity: high
    for_each: list_security_center_findings
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.incidentArtifacts.encryption.enabled
        operator: equals
        expected: true
      - path: properties.incidentArtifacts.visibility
        operator: equals
        expected: PRIVATE
  - check_id: gcp.securitycenter.finding.incident_automation_change_audit_logging_enabled
    title: Ensure Audit Logging for Incident Automation Changes
    severity: high
    for_each: list_security_center_sources
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.incidentAutomation.auditLogging.enabled
        operator: equals
        expected: true
  - check_id: gcp.securitycenter.finding.incident_automation_execution_roles_least_privilege
    title: Ensure Least Privilege for Incident Automation Roles
    severity: high
    for_each: list_security_center_sources
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.incidentAutomation.executionRoles
        operator: exists
      - path: properties.incidentAutomation.leastPrivilege.enabled
        operator: equals
        expected: true
  - check_id: gcp.securitycenter.finding.incident_response_access_rbac_least_privilege
    title: Ensure Least Privilege for Incident Response Roles
    severity: high
    for_each: list_security_center_sources
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.incidentResponse.rbac.leastPrivilege
        operator: equals
        expected: true
  - check_id: gcp.securitycenter.finding.incident_response_storage_encrypted_and_private
    title: Ensure Incident Response Storage is Encrypted and Private
    severity: high
    for_each: list_security_center_sources
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.incidentResponse.storage.encryption.enabled
        operator: equals
        expected: true
      - path: properties.incidentResponse.storage.visibility
        operator: equals
        expected: PRIVATE
  - check_id: gcp.securitycenter.finding.incident_response_versioning_and_immutability_enabled
    title: Ensure Incident Response Versioning & Immutability in Security Center
    severity: medium
    for_each: list_security_center_sources
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.incidentResponse.versioning.enabled
        operator: equals
        expected: true
      - path: properties.incidentResponse.immutability.enabled
        operator: equals
        expected: true
  - check_id: gcp.securitycenter.finding.is_enabled
    title: Enable Security Findings in Security Command Center
    severity: high
    for_each: list_security_center_findings
    logic: AND
    calls:
    - action: eval
      fields:
      - path: state
        operator: equals
        expected: ACTIVE
  - check_id: gcp.securitycenter.finding.privacy_breach_detection_alert_destinations_configured
    title: Configure Privacy Breach Alert Destinations in Security Command Center
    severity: high
    for_each: list_notification_configs
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.privacyBreach.alertDestinations
        operator: exists
      - path: pubsubTopic
        operator: exists
  - check_id: gcp.securitycenter.finding.privacy_breach_detection_integrations_authenticated
    title: Ensure Privacy Breach Detection Integrations are Authenticated
    severity: high
    for_each: list_security_center_sources
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.privacyBreach.integrations.authentication.enabled
        operator: equals
        expected: true
  - check_id: gcp.securitycenter.finding.security_marks_configured
    title: Ensure Security Marks are Properly Configured
    severity: medium
    for_each: list_security_marks
    logic: AND
    calls:
    - action: eval
      fields:
      - path: securityMarks.marks
        operator: exists
  - check_id: gcp.securitycenter.finding.threat_intelligence_enabled
    title: Enable Threat Intelligence Integration
    severity: high
    for_each: list_security_center_sources
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.threatIntelligence.enabled
        operator: equals
        expected: true
  - check_id: gcp.securitycenter.finding.continuous_monitoring_enabled
    title: Ensure Continuous Security Monitoring is Enabled
    severity: high
    for_each: list_security_center_sources
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.continuousMonitoring.enabled
        operator: equals
        expected: true
  - check_id: gcp.securitycenter.finding.asset_discovery_enabled
    title: Enable Asset Discovery in Security Command Center
    severity: medium
    for_each: list_security_center_sources
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.assetDiscovery.enabled
        operator: equals
        expected: true
  - check_id: gcp.securitycenter.finding.web_security_scanner_enabled
    title: Enable Web Security Scanner Integration
    severity: medium
    for_each: list_security_center_sources
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.webSecurityScanner.enabled
        operator: equals
        expected: true
  - check_id: gcp.securitycenter.finding.event_threat_detection_enabled
    title: Enable Event Threat Detection
    severity: high
    for_each: list_security_center_sources
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.eventThreatDetection.enabled
        operator: equals
        expected: true
  - check_id: gcp.securitycenter.finding.container_threat_detection_enabled
    title: Enable Container Threat Detection
    severity: high
    for_each: list_security_center_sources
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.containerThreatDetection.enabled
        operator: equals
        expected: true
  - check_id: gcp.securitycenter.finding.virtual_machine_threat_detection_enabled
    title: Enable Virtual Machine Threat Detection
    severity: high
    for_each: list_security_center_sources
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.virtualMachineThreatDetection.enabled
        operator: equals
        expected: true
  - check_id: gcp.securitycenter.notification.pubsub_topic_configured
    title: Ensure Pub/Sub Topic is Configured for Notifications
    severity: medium
    for_each: list_notification_configs
    logic: AND
    calls:
    - action: eval
      fields:
      - path: pubsubTopic
        operator: exists
  - check_id: gcp.securitycenter.notification.filter_configured
    title: Ensure Notification Filters are Properly Configured
    severity: medium
    for_each: list_notification_configs
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.filter
        operator: exists
  - check_id: gcp.securitycenter.finding.compliance_monitoring_enabled
    title: Enable Compliance Monitoring in Security Command Center
    severity: medium
    for_each: list_security_center_sources
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.complianceMonitoring.enabled
        operator: equals
        expected: true
  - check_id: gcp.securitycenter.finding.anomaly_detection_enabled
    title: Enable Anomaly Detection in Security Command Center
    severity: high
    for_each: list_security_center_sources
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.anomalyDetection.enabled
        operator: equals
        expected: true
  - check_id: gcp.securitycenter.finding.data_loss_prevention_enabled
    title: Enable Data Loss Prevention Integration
    severity: high
    for_each: list_security_center_sources
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.dataLossPrevention.enabled
        operator: equals
        expected: true
  - check_id: gcp.securitycenter.finding.binary_authorization_enabled
    title: Enable Binary Authorization Integration
    severity: medium
    for_each: list_security_center_sources
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.binaryAuthorization.enabled
        operator: equals
        expected: true
  - check_id: gcp.securitycenter.finding.security_health_analytics_enabled
    title: Enable Security Health Analytics
    severity: high
    for_each: list_security_center_sources
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.securityHealthAnalytics.enabled
        operator: equals
        expected: true
  - check_id: gcp.securitycenter.finding.cloud_armor_integration_enabled
    title: Enable Cloud Armor Integration
    severity: medium
    for_each: list_security_center_sources
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.cloudArmor.enabled
        operator: equals
        expected: true
  - check_id: gcp.securitycenter.finding.network_security_monitoring_enabled
    title: Enable Network Security Monitoring
    severity: high
    for_each: list_security_center_sources
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.networkSecurityMonitoring.enabled
        operator: equals
        expected: true
  - check_id: gcp.securitycenter.finding.identity_access_monitoring_enabled
    title: Enable Identity and Access Monitoring
    severity: high
    for_each: list_security_center_sources
    logic: AND
    calls:
    - action: eval
      fields:
      - path: properties.identityAccessMonitoring.enabled
        operator: equals
        expected: true
  api_name: securitycenter
  api_version: v1
