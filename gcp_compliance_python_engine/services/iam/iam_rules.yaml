# ============================================================================
# CURSOR AI: GCP SERVICE VALIDATION INSTRUCTIONS
# ============================================================================
# 
# üéØ YOUR MISSION: Validate and fix this GCP service YAML file
#
# WORKFLOW:
# 1. Read this entire YAML file structure
# 2. Run: `export GCP_ENGINE_FILTER_SERVICES="<SERVICE>" && python engine/gcp_engine.py > output/test_<service>.json 2>&1`
# 3. Analyze output - check for inventories, main_checks, errors
# 4. Fix issues in discovery and checks sections below
# 5. Re-run engine and verify output
# 6. Iterate until all checks work (PASS/FAIL based on resources)
# 7. Update validation status at bottom of file
#
# COMMON ISSUES & FIXES:
#
# ‚ùå Empty inventories ‚Üí Fix discovery action (must be: list_<resource>, aggregatedList_<resource>)
# ‚ùå Zero checks executed ‚Üí Fix for_each to match discovery_id
# ‚ùå All checks fail ‚Üí Fix field paths to match GCP API response
# ‚ùå Skipped checks ‚Üí Verify discovery_id exists and completed
# ‚ùå Python errors ‚Üí Check YAML syntax, action names
#
# TESTING:
# - Run engine: `export GCP_ENGINE_FILTER_SERVICES="<service>" && python engine/gcp_engine.py > output/test.json 2>&1`
# - Check output: `cat output/test.json | python3 -m json.tool`
# - Verify: inventories array has resources, main_checks array has results
#
# SUCCESS CRITERIA:
# ‚úÖ Engine runs without Python exceptions
# ‚úÖ Inventories populated (if resources exist in GCP)
# ‚úÖ All checks execute (PASS/FAIL based on actual resource state)
# ‚úÖ No skipped checks (unless expected)
# ‚úÖ Clean JSON output
#
# DOCUMENTATION:
# After fixing, update validation section at bottom:
# # VALIDATION STATUS:
# # - Issues Found: <what was wrong>
# # - Fixes Applied: <what you fixed>
# # - Tested: <date>
# # - Inventories: <count>
# # - Checks: <count executed>
# # - Status: ‚úÖ VALIDATED / ‚è≥ IN PROGRESS / ‚ùå NEEDS WORK
#
# ============================================================================

service_name:  # e.g., compute, gcs, pubsub

iam:
  version: '1.0'
  provider: gcp
  service: iam
  scope: global
  api_name: iam
  api_version: v1
  sdk_package: google-cloud-iam
  discovery:
  - discovery_id: list_service_accounts
    calls:
    - action: sdk_list
      method: list_service_accounts
      fields:
      - path: name
        var: service_account_name
      - path: email
        var: service_account_email
  - discovery_id: list_roles
    calls:
    - action: sdk_list
      method: list_roles
      fields:
      - path: name
        var: role_name
      - path: title
        var: role_title
  - discovery_id: list_service_account_keys
    calls:
    - action: sdk_list
      method: list_service_account_keys
      fields:
      - path: name
        var: key_name
      - path: valid_after_time
        var: key_created_time
  - discovery_id: list_workload_identity_pools
    calls:
    - action: sdk_list
      method: list_workload_identity_pools
      fields:
      - path: name
        var: pool_name
      - path: state
        var: pool_state
  checks:
  - check_id: gcp.iam.group.has_users
    title: Ensure IAM Groups Contain Active Users
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: bindings[].members[]
        operator: exists
        expected: true
  - check_id: gcp.iam.group.identity_access_rbac_attached_policies_not_admin_star
    title: Restrict Admin Role in Group IAM Policies
    severity: high
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: bindings[].role
        operator: not_contains
        expected: roles/owner
  - check_id: gcp.iam.group.identity_access_rbac_external_sharing_restricted_w_supported
    title: Restrict External Sharing of IAM Group Access
    severity: high
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: bindings[].members[]
        operator: not_contains
        expected: allUsers
  - check_id: gcp.iam.group.identity_access_rbac_no_inline_policies
    title: Avoid Inline Policies for IAM Group Access Control
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: bindings[].condition
        operator: not_exists
        expected: true
  - check_id: gcp.iam.key.90_days
    title: Ensure IAM Keys Are Rotated Every 90 Days
    severity: high
    for_each: list_service_account_keys
    logic: AND
    calls:
    - action: eval
      fields:
      - path: valid_after_time
        operator: age_days
        expected: 90
  - check_id: gcp.iam.key.access_key_90_days
    title: Rotate IAM Access Keys Every 90 Days
    severity: high
    for_each: list_service_account_keys
    logic: AND
    calls:
    - action: eval
      fields:
      - path: valid_after_time
        operator: age_days
        expected: 90
  - check_id: gcp.iam.key.key_configured
    title: Ensure IAM Keys are Properly Configured
    severity: medium
    for_each: list_service_account_keys
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account_key
      fields:
      - path: key_algorithm
        operator: exists
        expected: true
  - check_id: gcp.iam.policy.attached_only_to_group_or_roles
    title: Ensure IAM Policies Are Attached Only to Groups or Roles
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: bindings[].members[]
        operator: not_contains
        expected: 'user:'
  - check_id: gcp.iam.policy.audit_logs_enabled
    title: Ensure IAM Audit Logs Are Enabled for All Services
    severity: high
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: audit_configs
        operator: exists
        expected: true
  - check_id: gcp.iam.policy.cloud_asset_inventory_enabled
    title: Ensure Cloud Asset Inventory is Enabled for IAM Policies
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account
      fields:
      - path: description
        operator: exists
        expected: true
  - check_id: gcp.iam.policy.compliance
    title: Ensure IAM Policies Meet Compliance Standards
    severity: high
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: bindings[].condition.expression
        operator: exists
        expected: true
  - check_id: gcp.iam.policy.console_mfa_enabled
    title: Ensure Multi-Factor Authentication for Console Access
    severity: critical
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: bindings[].condition.expression
        operator: contains
        expected: has({}.assertion.access_levels)
  - check_id: gcp.iam.policy.domain_compliance_configured
    title: Ensure Domain Compliance for IAM Policies
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: bindings[].members[]
        operator: contains
        expected: '@'
  - check_id: gcp.iam.policy.identity_access_rbac_conditions_used_where_applicable
    title: Ensure Use of Conditional Access in IAM Policies
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: bindings[].condition
        operator: exists
        expected: true
  - check_id: gcp.iam.policy.identity_access_rbac_no_action_star_on_resource_star
    title: Restrict IAM Action Star on Resource Star
    severity: high
    for_each: list_roles
    logic: AND
    calls:
    - action: sdk_get
      method: get_role
      fields:
      - path: included_permissions[]
        operator: not_equals
        expected: '*'
  - check_id: gcp.iam.policy.identity_access_rbac_no_policy_allows_without_constraints
    title: Restrict IAM Policies Without Constraints
    severity: high
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: bindings[].condition
        operator: exists
        expected: true
  - check_id: gcp.iam.policy.identity_access_rbac_resource_constraints_present
    title: Ensure RBAC Resource Constraints are Defined in IAM Policies
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: bindings[].condition.expression
        operator: contains
        expected: resource.
  - check_id: gcp.iam.policy.minimum_length_14
    title: Enforce IAM Policy Password Minimum Length of 14 Characters
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account
      fields:
      - path: display_name
        operator: min_length
        expected: 14
  - check_id: gcp.iam.policy.no_administrative_privileges
    title: Restrict IAM Policies to Prevent Excessive Privileges
    severity: high
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: bindings[].role
        operator: not_contains
        expected: roles/editor
  - check_id: gcp.iam.policy.overly_permissive
    title: Identify and Mitigate Overly Permissive IAM Policies
    severity: high
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: bindings[].members[]
        operator: not_equals
        expected: allAuthenticatedUsers
  - check_id: gcp.iam.policy.password_complexity
    title: Enforce Password Complexity Requirements for IAM
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account
      fields:
      - path: oauth2_client_id
        operator: exists
        expected: true
  - check_id: gcp.iam.policy.password_reuse_prevention
    title: Prevent Password Reuse in IAM Policies
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account
      fields:
      - path: unique_id
        operator: exists
        expected: true
  - check_id: gcp.iam.policy.privileged_access_management
    title: Implement Privileged Access Management for IAM
    severity: high
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: bindings[].condition.title
        operator: contains
        expected: privileged
  - check_id: gcp.iam.policy.regular_access_review
    title: Conduct Regular Access Reviews for IAM Policies
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account
      fields:
      - path: description
        operator: contains
        expected: reviewed
  - check_id: gcp.iam.policy.resource_based_policies_restricted
    title: Restrict Resource-Based IAM Policies
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: bindings[].condition.expression
        operator: contains
        expected: resource.name
  - check_id: gcp.iam.policy.service_account_key_rotation
    title: Ensure Service Account Key Rotation Policy
    severity: high
    for_each: list_service_account_keys
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account_key
      fields:
      - path: valid_before_time
        operator: exists
        expected: true
  - check_id: gcp.iam.policy.temporary_credentials_time_limited
    title: Ensure Temporary Credentials are Time-Limited
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: bindings[].condition.expression
        operator: contains
        expected: request.time
  - check_id: gcp.iam.policy.unused_credentials_removed
    title: Remove Unused IAM Credentials
    severity: medium
    for_each: list_service_account_keys
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account_key
      fields:
      - path: disabled
        operator: not_equals
        expected: true
  - check_id: gcp.iam.role.admin_privileges_limited
    title: Limit Administrative Privileges in IAM Roles
    severity: high
    for_each: list_roles
    logic: AND
    calls:
    - action: sdk_get
      method: get_role
      fields:
      - path: included_permissions[]
        operator: not_contains
        expected: iam.serviceAccounts.actAs
  - check_id: gcp.iam.role.custom_roles_least_privilege
    title: Ensure Custom IAM Roles Follow Least Privilege
    severity: medium
    for_each: list_roles
    logic: AND
    calls:
    - action: sdk_get
      method: get_role
      fields:
      - path: stage
        operator: not_equals
        expected: DEPRECATED
  - check_id: gcp.iam.role.excessive_permissions
    title: Identify IAM Roles with Excessive Permissions
    severity: high
    for_each: list_roles
    logic: AND
    calls:
    - action: sdk_get
      method: get_role
      fields:
      - path: included_permissions
        operator: count_less_than
        expected: 50
  - check_id: gcp.iam.role.predefined_roles_preferred
    title: Prefer Predefined IAM Roles Over Custom Roles
    severity: low
    for_each: list_roles
    logic: AND
    calls:
    - action: sdk_get
      method: get_role
      fields:
      - path: name
        operator: contains
        expected: roles/
  - check_id: gcp.iam.role.regular_review_and_cleanup
    title: Regular Review and Cleanup of IAM Roles
    severity: medium
    for_each: list_roles
    logic: AND
    calls:
    - action: sdk_get
      method: get_role
      fields:
      - path: description
        operator: exists
        expected: true
  - check_id: gcp.iam.role.separation_of_duties
    title: Enforce Separation of Duties in IAM Roles
    severity: high
    for_each: list_roles
    logic: AND
    calls:
    - action: sdk_get
      method: get_role
      fields:
      - path: included_permissions[]
        operator: not_contains
        expected: iam.roles.create
  - check_id: gcp.iam.service_account.cross_project_access_restricted
    title: Restrict Cross-Project Access for Service Accounts
    severity: high
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: bindings[].condition.expression
        operator: contains
        expected: resource.name.startsWith
  - check_id: gcp.iam.service_account.default_service_account_usage_restricted
    title: Restrict Usage of Default Service Accounts
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account
      fields:
      - path: email
        operator: not_contains
        expected: compute@developer.gserviceaccount.com
  - check_id: gcp.iam.service_account.external_key_management
    title: Use External Key Management for Service Account Keys
    severity: medium
    for_each: list_service_account_keys
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account_key
      fields:
      - path: key_origin
        operator: equals
        expected: USER_PROVIDED
  - check_id: gcp.iam.service_account.impersonation_logging
    title: Enable Logging for Service Account Impersonation
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: audit_configs[].service
        operator: contains
        expected: iam.googleapis.com
  - check_id: gcp.iam.service_account.key_management_best_practices
    title: Follow Key Management Best Practices for Service Accounts
    severity: high
    for_each: list_service_account_keys
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account_key
      fields:
      - path: key_type
        operator: equals
        expected: USER_MANAGED
  - check_id: gcp.iam.service_account.least_privilege_access
    title: Ensure Service Accounts Have Least Privilege Access
    severity: high
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: bindings[].role
        operator: not_equals
        expected: roles/owner
  - check_id: gcp.iam.service_account.monitoring_and_alerting
    title: Implement Monitoring and Alerting for Service Account Usage
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account
      fields:
      - path: description
        operator: contains
        expected: monitored
  - check_id: gcp.iam.service_account.regular_key_rotation
    title: Implement Regular Key Rotation for Service Accounts
    severity: high
    for_each: list_service_account_keys
    logic: AND
    calls:
    - action: eval
      fields:
      - path: valid_after_time
        operator: age_days
        expected: 90
  - check_id: gcp.iam.service_account.unused_service_accounts_removed
    title: Remove Unused Service Accounts
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account
      fields:
      - path: disabled
        operator: not_equals
        expected: true
  - check_id: gcp.iam.user.access_review_process
    title: Implement Access Review Process for IAM Users
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: bindings[].members[]
        operator: not_contains
        expected: 'deleted:'
  - check_id: gcp.iam.user.account_lockout_policy
    title: Implement Account Lockout Policy for IAM Users
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account
      fields:
      - path: disabled
        operator: exists
        expected: false
  - check_id: gcp.iam.user.inactive_user_access_removal
    title: Remove Access for Inactive IAM Users
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: bindings[].condition.expression
        operator: contains
        expected: request.time
  - check_id: gcp.iam.user.mfa_enforcement
    title: Enforce Multi-Factor Authentication for IAM Users
    severity: critical
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: bindings[].condition.expression
        operator: contains
        expected: has({}.assertion.access_levels)
  - check_id: gcp.iam.user.password_policy_compliance
    title: Ensure IAM User Password Policy Compliance
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account
      fields:
      - path: display_name
        operator: min_length
        expected: 8
  - check_id: gcp.iam.user.privileged_user_monitoring
    title: Monitor Privileged IAM User Activities
    severity: high
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: audit_configs[].audit_log_configs[].log_type
        operator: contains
        expected: ADMIN_READ
  - check_id: gcp.iam.user.session_timeout_configured
    title: Configure Session Timeout for IAM Users
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: bindings[].condition.expression
        operator: contains
        expected: request.time <
  - check_id: gcp.iam.user.temporary_access_time_bound
    title: Ensure Temporary IAM User Access is Time-Bound
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: bindings[].condition.expression
        operator: contains
        expected: request.time
  - check_id: gcp.iam.workload_identity.cross_cluster_access_restricted
    title: Restrict Cross-Cluster Access in Workload Identity
    severity: high
    for_each: list_workload_identity_pools
    logic: AND
    calls:
    - action: sdk_get
      method: get_workload_identity_pool
      fields:
      - path: description
        operator: contains
        expected: cluster-restricted
  - check_id: gcp.iam.workload_identity.federation_security_best_practices
    title: Follow Security Best Practices for Workload Identity Federation
    severity: high
    for_each: list_workload_identity_pools
    logic: AND
    calls:
    - action: sdk_get
      method: get_workload_identity_pool
      fields:
      - path: state
        operator: equals
        expected: ACTIVE
  - check_id: gcp.iam.workload_identity.kubernetes_service_account_binding
    title: Secure Kubernetes Service Account Binding in Workload Identity
    severity: medium
    for_each: list_workload_identity_pools
    logic: AND
    calls:
    - action: sdk_get
      method: get_workload_identity_pool
      fields:
      - path: display_name
        operator: contains
        expected: k8s
  - check_id: gcp.iam.workload_identity.least_privilege_workload_access
    title: Ensure Least Privilege Access for Workload Identity
    severity: high
    for_each: list_workload_identity_pools
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: bindings[].role
        operator: not_contains
        expected: roles/editor
  - check_id: gcp.iam.workload_identity.monitoring_and_logging
    title: Enable Monitoring and Logging for Workload Identity
    severity: medium
    for_each: list_workload_identity_pools
    logic: AND
    calls:
    - action: sdk_get
      method: get_workload_identity_pool
      fields:
      - path: description
        operator: contains
        expected: monitored
  - check_id: gcp.iam.workload_identity.pool_configuration_security
    title: Secure Workload Identity Pool Configuration
    severity: high
    for_each: list_workload_identity_pools
    logic: AND
    calls:
    - action: sdk_get
      method: get_workload_identity_pool
      fields:
      - path: disabled
        operator: equals
        expected: false
  - check_id: gcp.iam.workload_identity.provider_attribute_mapping
    title: Secure Provider Attribute Mapping in Workload Identity
    severity: medium
    for_each: list_workload_identity_pools
    logic: AND
    calls:
    - action: sdk_get
      method: get_workload_identity_pool
      fields:
      - path: display_name
        operator: exists
        expected: true
  - check_id: gcp.iam.workload_identity.token_exchange_security
    title: Secure Token Exchange in Workload Identity
    severity: high
    for_each: list_workload_identity_pools
    logic: AND
    calls:
    - action: sdk_get
      method: get_workload_identity_pool
      fields:
      - path: state
        operator: equals
        expected: ACTIVE
  - check_id: gcp.iam.audit.comprehensive_audit_logging
    title: Enable Comprehensive IAM Audit Logging
    severity: high
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: audit_configs[].audit_log_configs[]
        operator: exists
        expected: true
  - check_id: gcp.iam.audit.log_retention_policy
    title: Configure IAM Audit Log Retention Policy
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: audit_configs[].service
        operator: equals
        expected: allServices
  - check_id: gcp.iam.audit.privileged_operation_logging
    title: Log All Privileged IAM Operations
    severity: high
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: audit_configs[].audit_log_configs[].log_type
        operator: contains
        expected: ADMIN_READ
  - check_id: gcp.iam.audit.real_time_monitoring
    title: Implement Real-Time Monitoring for IAM Events
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: audit_configs[].audit_log_configs[].log_type
        operator: contains
        expected: DATA_READ
  - check_id: gcp.iam.compliance.data_residency_requirements
    title: Meet Data Residency Requirements for IAM
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account
      fields:
      - path: description
        operator: contains
        expected: region-restricted
  - check_id: gcp.iam.compliance.gdpr_compliance
    title: Ensure GDPR Compliance for IAM Data
    severity: high
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account
      fields:
      - path: description
        operator: contains
        expected: gdpr-compliant
  - check_id: gcp.iam.compliance.hipaa_compliance
    title: Ensure HIPAA Compliance for IAM
    severity: high
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account
      fields:
      - path: description
        operator: contains
        expected: hipaa-compliant
  - check_id: gcp.iam.compliance.pci_dss_compliance
    title: Ensure PCI DSS Compliance for IAM
    severity: high
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account
      fields:
      - path: description
        operator: contains
        expected: pci-compliant
  - check_id: gcp.iam.compliance.sox_compliance
    title: Ensure SOX Compliance for IAM Controls
    severity: high
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account
      fields:
      - path: description
        operator: contains
        expected: sox-compliant
  - check_id: gcp.iam.security.anomaly_detection
    title: Implement Anomaly Detection for IAM Activities
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account
      fields:
      - path: description
        operator: contains
        expected: anomaly-detection
  - check_id: gcp.iam.security.encryption_at_rest
    title: Ensure Encryption at Rest for IAM Data
    severity: high
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account
      fields:
      - path: description
        operator: contains
        expected: encrypted
  - check_id: gcp.iam.security.encryption_in_transit
    title: Ensure Encryption in Transit for IAM Communications
    severity: high
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account
      fields:
      - path: oauth2_client_id
        operator: exists
        expected: true
  - check_id: gcp.iam.security.incident_response_plan
    title: Maintain IAM Security Incident Response Plan
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account
      fields:
      - path: description
        operator: contains
        expected: incident-response
  - check_id: gcp.iam.security.penetration_testing
    title: Conduct Regular IAM Penetration Testing
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account
      fields:
      - path: description
        operator: contains
        expected: pen-tested
  - check_id: gcp.iam.security.threat_intelligence_integration
    title: Integrate Threat Intelligence with IAM Security
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account
      fields:
      - path: description
        operator: contains
        expected: threat-intel
  - check_id: gcp.iam.security.vulnerability_management
    title: Implement IAM Vulnerability Management
    severity: high
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account
      fields:
      - path: description
        operator: contains
        expected: vuln-managed
  - check_id: gcp.iam.security.zero_trust_architecture
    title: Implement Zero Trust Architecture for IAM
    severity: high
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: bindings[].condition.expression
        operator: contains
        expected: origin.ip
  - check_id: gcp.iam.governance.access_certification
    title: Implement IAM Access Certification Process
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account
      fields:
      - path: description
        operator: contains
        expected: certified
  - check_id: gcp.iam.governance.change_management
    title: Implement IAM Change Management Process
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account
      fields:
      - path: description
        operator: contains
        expected: change-managed
  - check_id: gcp.iam.governance.documentation_maintenance
    title: Maintain Comprehensive IAM Documentation
    severity: low
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account
      fields:
      - path: description
        operator: exists
        expected: true
  - check_id: gcp.iam.governance.policy_enforcement
    title: Enforce IAM Governance Policies
    severity: high
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get_iam_policy
      method: get_iam_policy
      fields:
      - path: bindings[].condition
        operator: exists
        expected: true
  - check_id: gcp.iam.governance.risk_assessment
    title: Conduct Regular IAM Risk Assessments
    severity: medium
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account
      fields:
      - path: description
        operator: contains
        expected: risk-assessed
  - check_id: gcp.iam.governance.training_and_awareness
    title: Provide IAM Security Training and Awareness
    severity: low
    for_each: list_service_accounts
    logic: AND
    calls:
    - action: sdk_get
      method: get_service_account
      fields:
      - path: description
        operator: contains
        expected: training-provided
