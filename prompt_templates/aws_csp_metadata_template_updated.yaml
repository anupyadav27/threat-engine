
## Complete Metadata Template

```yaml
metadata:
  # ============================================================================
  # RULE IDENTIFICATION
  # ============================================================================
  rule_id: <rule_id>  # e.g., aws.s3.bucket.encryption_at_rest_enabled
  uniform_rule_format: <uniform_rule_format>  # From CSV - standardized rule format
  title: <human_readable_title>  # e.g., "S3 Bucket Encryption At Rest Enabled"
  description: |
    <detailed_description>
    Explain what this check validates and why it's important.
    Include security implications and best practices.
  
  # ============================================================================
  # SERVICE AND CATEGORIZATION
  # ============================================================================
  service: <aws_service>  # e.g., s3, ec2, iam
  provider: aws
  category: <category>  # From CSV - e.g., backup, security, data_governance
  
  # ============================================================================
  # CSPM CATEGORIZATION
  # ============================================================================
  cspm_category: <cspm_category>
  # Options:
  # - data_security
  # - entitlement
  # - network_security
  # - compute_security
  # - secrets_management
  # - compliance_governance
  # - monitoring_detection
  # - infrastructure_security
  
  # ============================================================================
  # RISK ASSESSMENT
  # ============================================================================
  severity: <critical|high|medium|low>
  risk_level: <critical|high|medium|low>  # Usually same as severity
  impact: <description_of_impact_if_violated>
  likelihood: <high|medium|low>  # Likelihood of exploitation

# ============================================================================
# DETECTION
# ============================================================================
detection:
  method: <API|CloudTrail|Config|Custom>
  query: |
    <description_of_how_check_works>
    Include API calls, fields checked, conditions evaluated.
  
  frequency: <realtime|hourly|daily|on_demand>
  
  false_positives:
    - scenario: "<scenario_description>"
      mitigation: "<how_to_handle>"
  
  dependencies:
    - "<service_or_feature_required>"  # e.g., "AWS Config must be enabled"

# ============================================================================
# REFERENCES
# ============================================================================
references:
  aws_documentation:
    - url: "https://docs.aws.amazon.com/<service>/<topic>"
      title: "<doc_title>"
  
  security_best_practices:
    - url: "<best_practice_url>"
      title: "<title>"
  
  related_checks:
    - rule_id: "<related_rule_id>"
      relationship: "<how_related>"  # e.g., "prerequisite", "related", "alternative"

# ============================================================================
# ADDITIONAL METADATA
# ============================================================================

created_date: "<YYYY-MM-DD>"
last_updated: "<YYYY-MM-DD>"
version: "1.0"
```

## Example: S3 Bucket Encryption

```yaml
metadata:
  rule_id: aws.s3.bucket.encryption_at_rest_enabled
  uniform_rule_format: aws.s3.bucket.encryption_at_rest_enabled
  title: "S3 Bucket Encryption At Rest Enabled"
  description: |
    Ensures that all S3 buckets have default encryption enabled to protect
    data at rest. Without encryption, data stored in S3 buckets is vulnerable
    to unauthorized access if AWS credentials are compromised or if there are
    misconfigurations in access policies.
  
  service: s3
  provider: aws
  category: backup
  

  severity: high
  risk_level: high
  impact: "Unencrypted data at rest can be accessed if storage media is compromised"
  likelihood: medium

remediation:
  description: |
    Enable default encryption for all S3 buckets to ensure data is
    encrypted at rest using either SSE-S3 or SSE-KMS.
  
  automated: true

detection:
  method: "API"
  query: |
    Calls s3:GetBucketEncryption API for each bucket.
    Checks if ServerSideEncryptionConfiguration.Rules[] exists.
    Validates SSEAlgorithm is set (AES256 or aws:kms).

  dependencies:
    - "s3:GetBucketEncryption permission required"

references:
  aws_documentation:
    - url: "https://docs.aws.amazon.com/AmazonS3/latest/userguide/default-bucket-encryption.html"
      title: "Setting default server-side encryption for S3 buckets"
  
  security_best_practices:
## Example: S3 Bucket Encryption

```yaml
metadata:
  rule_id: aws.s3.bucket.encryption_at_rest_enabled
  uniform_rule_format: aws.s3.bucket.encryption_at_rest_enabled
  title: "S3 Bucket Encryption At Rest Enabled"
  description: |
    Ensures that all S3 buckets have default encryption enabled to protect
    data at rest. Without encryption, data stored in S3 buckets is vulnerable
    to unauthorized access if AWS credentials are compromised or if there are
    misconfigurations in access policies.
  
  service: s3
  provider: aws
  category: backup
  
  
  severity: high
  risk_level: high
  impact: "Unencrypted data at rest can be accessed if storage media is compromised"
  likelihood: medium
  
    

remediation:
  description: |
    Enable default encryption for all S3 buckets to ensure data is
    encrypted at rest using either SSE-S3 or SSE-KMS.
  
  automated: true
  
detection:
  method: "API"
  query: |
    Calls s3:GetBucketEncryption API for each bucket.
    Checks if ServerSideEncryptionConfiguration.Rules[] exists.
    Validates SSEAlgorithm is set (AES256 or aws:kms).
  
  frequency: "on_demand"
  
  dependencies:
    - "s3:GetBucketEncryption permission required"

references:
  aws_documentation:
    - url: "https://docs.aws.amazon.com/AmazonS3/latest/userguide/default-bucket-encryption.html"
      title: "Setting default server-side encryption for S3 buckets"
  
  compliance_guides:
    - url: "https://www.cisecurity.org/benchmark/amazon_web_services"
      title: "CIS AWS Foundations Benchmark v1.4.0"
      framework: "CIS"

tags:
  - encryption
  - data-protection
  - at-rest
  - s3

cloud_provider_specific:
  aws:
    services_impacted:
      - s3
    required_permissions:
      - s3:GetBucketEncryption
    cost_impact: "low"
    performance_impact: "none"

created_date: "2025-11-15"
last_updated: "2025-11-15"
version: "1.0"
```

## Field Descriptions

### Compliance Mappings (From CSV)

- **aws_mapped_compliance_functions**: The specific AWS Config rule or function name that validates this control
- **aws_mapped_compliance_ids**: Semicolon-separated list of compliance framework control IDs in format `<framework>_<control>_<sequence>`
- **aws_mapping_sources**: How the mapping was derived (DIRECT_TOKEN_MEDIUM, AI_FULL_CONTEXT, CROSS_SERVICE, STEP1_DIRECT)

### CSPM Categories

Map checks to standard CSPM categories for better organization in security tools:
- **data_security**: Encryption, data protection, data loss prevention
- **entitlement**: IAM, RBAC, access management, privilege escalation
- **network_security**: VPC, security groups, network ACLs, firewalls
- **compute_security**: EC2, Lambda, container security
- **secrets_management**: KMS, Secrets Manager, credential rotation
- **compliance_governance**: Config, CloudTrail, audit logging
- **monitoring_detection**: CloudWatch, GuardDuty, alerts
- **infrastructure_security**: Resource configuration, hardening

### Severity Levels

- **critical**: Data exposure, authentication bypass, public access to sensitive resources
- **high**: Encryption disabled, missing MFA, excessive permissions, unrestricted network access
- **medium**: Missing monitoring, suboptimal configuration, missing logging
- **low**: Best practices, optimization recommendations, non-critical configuration

## Notes

1. **uniform_rule_format**: Must match exactly from CSV - this is the standardized rule identifier
2. **compliance_mappings**: Extract from CSV columns - leave empty if not present in CSV
3. **compliance_frameworks**: Add all applicable frameworks based on the control's purpose
4. **remediation steps**: Provide both console and CLI methods when possible
5. **tags**: Use for easy filtering and searching in CSPM tools

