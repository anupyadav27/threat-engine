========================================
3-AGENT PIPELINE
Processing 5 services: accessanalyzer, acm, athena, apigateway, s3
========================================

Step 1/3: AI Requirements Generator
------------------------------------
Loading boto3 catalog...
âœ… Loaded
================================================================================
AGENT 1: Requirements Generator (GPT-4o + Boto3 Fields)
================================================================================
AI picks from actual boto3 field names


ðŸ“¦ accessanalyzer
   access_analyzer_enabled... âœ… 1 fields
   access_analyzer_enabled_without_findings... âœ… 2 fields
   âœ… 2 rules

ðŸ“¦ acm
   ca_certificate_crl_or_ocsp_configured... âœ… 1 fields
   key_length_minimum... âœ… 1 fields
   ca_certificate_path_length_constraints_configured... âœ… 1 fields
   ca_key_in_hsm_enabled_if_supported... âœ… 1 fields
   expiration_monitored... âœ… 1 fields
   ca_access_rbac_least_privilege... âœ… 1 fields
   mtls_required_for_internal_services_if_supported... âœ… 3 fields
   trusted_issuer_verified... âœ… 1 fields
   certificate_expiration_monitored... âœ… 1 fields
   key_length_minimum... âœ… 1 fields
   ca_certificate_trusted_issuer_verified... âœ… 1 fields
   tls_min_1_2_enforced... âœ… 1 fields
   valid... âœ… 1 fields
   ca_certificate_valid... âœ… 1 fields
   âœ… 14 rules

ðŸ“¦ athena
   workgroup_logging_enabled... âœ… 1 fields
   admin_activity_logging_enabled... âœ… 1 fields
   encryption_at_rest_enabled... âœ… 1 fields
   logs_retention_days_minimum... âœ… 1 fields
   query_access_logging_enabled... âœ… 1 fields
   athena_allowed_data_sources_allowlist_configured... âœ… 1 fields
   query_result_encryption_enabled... âœ… 1 fields
   at_rest_enabled... âœ… 1 fields
   âœ… 8 rules

ðŸ“¦ apigateway
   api_stage_rate_limit_configured... âœ… 1 fields
   authorization_enabled... âœ… 1 fields
   key_rotation_policy_configured... âœ… 1 fields
   api_quota_limit_configured... âœ… 1 fields
   cache_ttl_configured... âœ… 1 fields
   api_required_security_headers_enforced... âœ… 2 fields
   logging_enabled... âœ… 1 fields
   api_content_type_whitelist_enforced... âœ… 2 fields
   api_stage_overrides_bounded... âœ… 1 fields
   api_request_schema_validation_enabled... âœ… 2 fields
   waf_enabled... âœ… 1 fields
   restapi_cache_encrypted... âœ… 1 fields
   waf_enabled... âœ… 1 fields
   api_usage_plan_for_keys_required... âœ… 1 fields
   authz_policies_enforced... âœ… 1 fields
   tls_min_1_2_enforced... âœ… 1 fields
   api_logs_retention_days_minimum... âœ… 1 fields
   api_access_log_sink_configured... âœ… 1 fields
   api_gateway_https_required... âœ… 1 fields
   api_rate_limits_configured... âœ… 1 fields
   api_stage_throttle_overrides_bounded... âœ… 1 fields
   scopes_least_privilege... âœ… 1 fields
   api_stage_burst_limit_configured... âœ… 1 fields
   api_access_log_fields_identity_configured... âœ… 1 fields
   api_parameters_validation_enabled... âœ… 1 fields
   throttling_enabled... âœ… 1 fields
   api_token_audience_restricted... âœ… 2 fields
   tracing_enabled... âœ… 1 fields
   private_networking_enforced... âœ… 1 fields
   api_stage_rate_limit_configured... âœ… 1 fields
   key_expiration_required... âœ… 1 fields
   api_keys_required... âœ… 1 fields
   authz_policies_enforced... âœ… 1 fields
   public_access_restricted... âœ… 1 fields
   api_request_body_size_limit_configured... âœ… 1 fields
   restapi_logging_enabled... âœ… 1 fields
   api_execution_logging_level_minimum_error_configured... âœ… 1 fields
   api_access_logging_enabled... âœ… 1 fields
   api_quota_limit_configured... âœ… 1 fields
   authn_required... âœ… 1 fields
   authn_required... âœ… 1 fields
   api_quota_limits_configured... âœ… 1 fields
   certificate_enabled... âœ… 1 fields
   private_networking_enforced... âœ… 1 fields
   api_response_schema_validation_enabled... âœ… 1 fields
   usage_plan_for_api_keys_required... âœ… 1 fields
   api_stage_burst_limit_configured... âœ… 1 fields
   api_resource_attached_enabled... âœ… 1 fields
   logging_enabled... âœ… 1 fields
   âœ… 49 rules

ðŸ“¦ s3
   macie_classification_jobs_status_configured... âœ… 1 fields
   encryption_enabled... âœ… 1 fields
   object_versioning_configured... âœ… 1 fields
   destination_private_only_configured... âœ… 1 fields
   key_rotation_enabled... âœ… 1 fields
   bucket_destination_least_privilege... âœ… 1 fields
   object_level_write_logging_enabled... âœ… 1 fields
   bucket_destination_encrypted... âœ… 1 fields
   cmk_cmek_key_configured... âœ… 1 fields
   website_https_only_configured... âœ… 1 fields
   no_public_principals_configured... âœ… 1 fields
   require_tls_in_transit_configured... âœ… 1 fields
   bucket_deny_insecure_transport_configured... âœ… 1 fields
   s3_encrypted_at_rest... âœ… 1 fields
   bucket_deny_unencrypted_puts... âœ… 1 fields
   block_public_access_configured... âœ… 4 fields
   lock_or_immutability_enabled_if_supported... âœ… 1 fields
   schedule_defined_min_frequency_configured... âœ… 1 fields
   level_public_access_blocks_configured... âœ… 4 fields
   policy_public_write_access_configured... âœ… 2 fields
   storage_encrypted_and_private... âœ… 2 fields
   public_access_configured... âœ… 4 fields
   lifecycle_enabled... âœ… 1 fields
   bucket_at_rest_cmek_enabled... âœ… 1 fields
   block_public_access_enabled... âœ… 4 fields
   encryption_in_transit_tls_required... âœ… 1 fields
   rbac_least_privilege... âœ… 2 fields
   bucket_enforced_on_sensitive_datasets_configured... âœ… 1 fields
   versioning_enabled_if_supported... âœ… 1 fields
   metrics_enabled... âœ… 1 fields
   immutable_retention_locked_where_required... âœ… 1 fields
   immutable_or_worm_enabled_if_supported... âœ… 1 fields
   versioning_enabled... âœ… 1 fields
   access_logging_enabled... âœ… 1 fields
   retention_days_minimum... âœ… 2 fields
   policies_configured... âœ… 1 fields
   server_access_logging_enabled... âœ… 1 fields
   in_transit_tls_min_1_2_configured... âœ… 1 fields
   key_policy_least_privilege... âœ… 1 fields
   encryption_at_rest_enabled... âœ… 1 fields
   default_encryption_configured... âœ… 1 fields
   public_write_prohibited_configured... âœ… 2 fields
   protected_from_public_override_configured... âœ… 1 fields
   auth_roles_least_privilege... âœ… 1 fields
   policy_denies_public_and_insecure_configured... âœ… 2 fields
   lag_monitoring_alerts_enabled... âœ… 1 fields
   encryption_at_rest_enabled... âœ… 1 fields
   policies_configured... âœ… 1 fields
   cmk_cmek_configured... âœ… 1 fields
   kms_encryption_configured... âœ… 1 fields
   bucket_no_wildcards_on_actions_or_principals_configured... âœ… 1 fields
   immutability_or_object_lock_if_supported... âœ… 1 fields
   bucket_enforced_on_sensitive_datasets_configured... âœ… 1 fields
   not_publicly_readable_configured... âœ… 1 fields
   public_read_prohibited_configured... âœ… 1 fields
   protected_from_public_override_configured... âœ… 1 fields
   certificate_expiration_rules_configured... âœ… 1 fields
   lifecycle_policy_configured... âœ… 1 fields
   secure_transport_policy_configured... âœ… 1 fields
   backup_storage_immutability_enabled... âœ… 2 fields
   bucket_cross_account_destinations_restricted... âœ… 1 fields
   replication_enabled... âœ… 1 fields
   encryption_in_transit_tls_min_1_2_configured... âœ… 1 fields
   encryption_at_rest_cmek_configured... âœ… 1 fields
   âœ… 64 rules

================================================================================
âœ… Generated 137 requirements
Saved to: agents/output/requirements_initial.json

Next: Run Agent 2

Step 2/3: Function Name Validator
------------------------------------
================================================================================
AGENT 2: Function Name Validator
================================================================================


ðŸ“¦ Processing accessanalyzer (2 rules)...
Traceback (most recent call last):
  File "/Users/apple/Desktop/threat-engine/aws_compliance_python_engine/agents/agent2_function_validator.py", line 266, in <module>
    main()
    ~~~~^^
  File "/Users/apple/Desktop/threat-engine/aws_compliance_python_engine/agents/agent2_function_validator.py", line 242, in main
    enriched = validate_and_enrich_requirements(requirements, boto3_data)
  File "/Users/apple/Desktop/threat-engine/aws_compliance_python_engine/agents/agent2_function_validator.py", line 193, in validate_and_enrich_requirements
    fields_needed = [f['name'] for f in ai_reqs.get('fields', [])]
                     ~^^^^^^^^
KeyError: 'name'
