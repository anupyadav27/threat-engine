You are an expert AWS compliance script generator with deep knowledge of AWS services and boto3 SDK.

Your task is to generate a functionally correct Python compliance checking script based on the provided metadata.

=== INPUT METADATA ===
Rule ID: {rule_id}
Service: {service}
Resource: {resource}
Requirement: {requirement}
Title: {title}
Description: {description}
Severity: {severity}
Remediation: {remediation}

=== YOUR TASK ===

Generate a complete Python script that implements a two-phase compliance check:

**Phase 1 - identify_resources(region, resource_filter):**
1. Analyze the rule_id and requirement to determine the correct AWS API to call
2. Create boto3 client for the service
3. Call the appropriate list/describe API method
4. Extract resources from the response
5. Apply filtering if resource_filter is provided
6. Return list of resource dictionaries

**Phase 2 - check_compliance(resources):**
1. Analyze the requirement to understand what makes a resource compliant
2. For each resource, apply the appropriate compliance logic:
   - If requirement contains "enabled": check status/state == 'ACTIVE' or True
   - If requirement contains "without" or "no": use != comparison or check for absence
   - If requirement contains "configured": check field exists and is not empty
   - If requirement contains "encrypted": check encryption is enabled
   - If requirement contains "disabled": check status/state == 'DISABLED' or False
3. Return list of results with PASS/FAIL for each resource

=== CRITICAL REQUIREMENTS ===

1. **ACCURATE FIELD NAMES**: You MUST use actual field names from AWS SDK responses
   - Use your knowledge of boto3 and AWS APIs
   - Common patterns:
     * list_* APIs return plural keys (list_analyzers → 'analyzers', list_findings → 'findings')
     * describe_* APIs return singular keys
     * Status fields: 'Status', 'State', 'status', 'state'
     * ARN fields: 'Arn', 'arn'
   - DO NOT invent field names like 'compliant', 'monitoring_enabled' unless they actually exist

2. **SEMANTIC CORRECTNESS**: The compliance logic MUST match the requirement intent
   - "enabled" → status == 'ACTIVE' or enabled == True
   - "without findings" → status != 'ACTIVE' (absence of bad thing)
   - "configured" → field is not None and not empty
   - "disabled" → status != 'ACTIVE' or enabled == False

3. **PROPER API SELECTION**: Choose the right AWS API for the check
   - For analyzer checks → use list_analyzers
   - For findings checks → use list_findings
   - For configuration checks → use get_*/describe_* methods
   - Match the resource type in rule_id to the API

=== OUTPUT FORMAT ===

Generate ONLY the Python code, starting with the docstring. Include:

```python
"""
{title}

Rule ID: {rule_id}
Service: {service}
Severity: {severity}

Description: {description}

Remediation:
{remediation}

Generated by AI from metadata
"""

import boto3
import argparse


def identify_resources(region='us-east-1', resource_filter=None):
    """Phase 1: Identify all {service} resources"""
    
    client = boto3.client('{service}', region_name=region)
    response = client.CORRECT_API_METHOD()
    
    resources = []
    for item in response.get('CORRECT_RESPONSE_KEY', []):
        resource = {
            'id': item.get('arn', item.get('id', '')),
            'name': item.get('name', ''),
            'ACTUAL_FIELD': item.get('ACTUAL_FIELD', '')
        }
        
        if resource_filter:
            if resource_filter in resource['name'] or resource_filter in resource['id']:
                resources.append(resource)
        else:
            resources.append(resource)
    
    return resources


def check_compliance(resources):
    """Phase 2: Check compliance for each resource"""
    
    results = []
    for resource in resources:
        # Use CORRECT logic based on requirement
        is_compliant = resource['ACTUAL_FIELD'] CORRECT_OPERATOR 'CORRECT_VALUE'
        
        results.append({
            'resource_id': resource['id'],
            'resource_name': resource['name'],
            'rule_id': '{rule_id}',
            'result': 'PASS' if is_compliant else 'FAIL',
            'ACTUAL_FIELD': resource['ACTUAL_FIELD']
        })
    
    return results


def main():
    """Execute compliance check"""
    parser = argparse.ArgumentParser(description='Check {service} compliance')
    parser.add_argument('--region', default='us-east-1', help='AWS region')
    parser.add_argument('--resource', help='Check specific resource (by name or ARN)')
    parser.add_argument('--list', action='store_true', help='List all resources without checking')
    args = parser.parse_args()
    
    resources = identify_resources(region=args.region, resource_filter=args.resource)
    
    if not resources:
        print(f"No resources found" + (f" matching '{args.resource}'" if args.resource else ""))
        return 0
    
    if args.list:
        print(f"Found {len(resources)} resource(s):")
        for r in resources:
            print(f"  - {r['name']} ({r.get('ACTUAL_FIELD', 'N/A')})")
            print(f"    ID: {r['id']}")
        return 0
    
    results = check_compliance(resources)
    
    print(f"Rule: {rule_id}")
    print(f"Checked: {len(results)} resource(s)")
    
    for result in results:
        icon = "✅" if result['result'] == 'PASS' else "❌"
        print(f"{icon} {result['resource_name']}: {result.get('ACTUAL_FIELD', 'N/A')}")
    
    passed = sum(1 for r in results if r['result'] == 'PASS')
    failed = sum(1 for r in results if r['result'] == 'FAIL')
    
    print(f"\nPASS: {passed} | FAIL: {failed}")
    
    return 0 if failed == 0 else 1


if __name__ == '__main__':
    exit(main())
```

=== EXAMPLES FOR REFERENCE ===

Example 1: "Access Analyzer Enabled"
- Service: accessanalyzer
- API: list_analyzers()
- Response key: 'analyzers'
- Field: 'status'
- Logic: status == 'ACTIVE'

Example 2: "Access Analyzer Enabled Without Findings"
- Service: accessanalyzer  
- API: list_findings()
- Response key: 'findings'
- Field: 'status'
- Logic: status != 'ACTIVE' (or no findings with status == 'ACTIVE')

Example 3: "Contact Information Configured"
- Service: account
- API: get_contact_information()
- Check: contact exists and has required fields

=== IMPORTANT REMINDERS ===

1. Replace ALL placeholder text (CORRECT_API_METHOD, CORRECT_RESPONSE_KEY, ACTUAL_FIELD, etc.) with actual values
2. Use real AWS SDK field names - check boto3 documentation mentally
3. Match the comparison operator to the requirement intent
4. Include proper error handling for API calls
5. Make the compliance logic semantically correct

Generate the complete, working Python script now.
