version: 1.0
provider: aws
service: dlm
discovery:
  discovery_id: aws.dlm.resources
  calls:
    - client: dlm
      action: describe_dlms
      paginate: true
  fields:
    - name: id
      save_as: resource_id
  emit:
    items_for:
      as: resource
      item: resource_id
checks:
  - title: Backup Encryption Enabled
    severity: low
    rule_id: aws.dlm.dlm.backup_encryption_enabled
    assertion_id: data_protection_storage.backup_recovery.backup_encryption_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement backup encryption enabled for dlm"
    references:
      - "https://docs.aws.amazon.com/dlm/"
  - title: Backup Retention Configured
    severity: low
    rule_id: aws.dlm.dlm.backup_retention_configured
    assertion_id: data_protection_storage.backup_recovery.backup_retention_configured
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement backup retention configured for dlm"
    references:
      - "https://docs.aws.amazon.com/dlm/"
  - title: Automated Backups Enabled
    severity: low
    rule_id: aws.dlm.dlm.automated_backups_enabled
    assertion_id: resilience_recovery.backup_strategy.automated_backups_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement automated backups enabled for dlm"
    references:
      - "https://docs.aws.amazon.com/dlm/"
  - title: Backup Testing Conducted
    severity: low
    rule_id: aws.dlm.dlm.backup_testing_conducted
    assertion_id: resilience_recovery.backup_strategy.backup_testing_conducted
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement backup testing conducted for dlm"
    references:
      - "https://docs.aws.amazon.com/dlm/"
  - title: Geographic Redundancy Enabled
    severity: low
    rule_id: aws.dlm.dlm.geographic_redundancy_enabled
    assertion_id: resilience_recovery.backup_strategy.geographic_redundancy_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement geographic redundancy enabled for dlm"
    references:
      - "https://docs.aws.amazon.com/dlm/"
