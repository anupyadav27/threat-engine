version: '1.0'
provider: aws
service: glue
discovery:
- discovery_id: aws.glue.datalineages
  calls:
  - client: glue
    action: get_databases
    save_as: datalineage_list
    on_error: continue
    fields:
    - Glues
  emit:
    items_for: datalineage_list[]
    as: datalineage
    item:
      id: '{{ datalineage.Id }}'
      name: '{{ datalineage.Name }}'
- discovery_id: aws.glue.datalineage_encryption
  for_each: aws.glue.datalineages
  calls:
  - client: glue
    action: get_databases
    params:
      DatalineageId: '{{ item.id }}'
    save_as: encryption
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      encryption_enabled: '{{ encryption.Encrypted if encryption.Encrypted is defined
        else false }}'
- discovery_id: aws.glue.datalineage_logging
  for_each: aws.glue.datalineages
  calls:
  - client: glue
    action: describe_connection_type
    params:
      DatalineageId: '{{ item.id }}'
    save_as: logging
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      logging_enabled: '{{ logging.LoggingEnabled is defined if logging else false
        }}'
- discovery_id: aws.glue.registrys
  for_each: aws.glue.registry
  calls:
  - client: glue
    action: describe_connection_type
    save_as: registrys
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.triggers
  for_each: aws.glue.trigger
  calls:
  - client: glue
    action: describe_connection_type
    save_as: triggers
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.tables
  for_each: aws.glue.table
  calls:
  - client: glue
    action: describe_connection_type
    save_as: tables
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.crawler_logging
  calls:
  - client: glue
    action: list_blueprints
    save_as: crawler_logging
    on_error: continue
  emit:
    items_for: crawler_logging[]
    as: crawler_logging
    item:
      id: '{{ crawler_logging.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.catalog_logging
  calls:
  - client: glue
    action: list_blueprints
    save_as: catalog_logging
    on_error: continue
  emit:
    items_for: catalog_logging[]
    as: catalog_logging
    item:
      id: '{{ catalog_logging.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.resource_logging
  calls:
  - client: glue
    action: list_blueprints
    save_as: resource_logging
    on_error: continue
  emit:
    items_for: resource_logging[]
    as: resource_logging
    item:
      id: '{{ resource_logging.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.registry_encryption
  calls:
  - client: glue
    action: list_blueprints
    save_as: registry_encryption
    on_error: continue
  emit:
    items_for: registry_encryption[]
    as: registry_encryption
    item:
      id: '{{ registry_encryption.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.data_quality_rulesets
  for_each: aws.glue.data_quality_ruleset
  calls:
  - client: glue
    action: describe_connection_type
    save_as: data_quality_rulesets
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.devendpoint_encryption
  calls:
  - client: glue
    action: list_blueprints
    save_as: devendpoint_encryption
    on_error: continue
  emit:
    items_for: devendpoint_encryption[]
    as: devendpoint_encryption
    item:
      id: '{{ devendpoint_encryption.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.workflow_logging
  calls:
  - client: glue
    action: list_blueprints
    save_as: workflow_logging
    on_error: continue
  emit:
    items_for: workflow_logging[]
    as: workflow_logging
    item:
      id: '{{ workflow_logging.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.workflows
  for_each: aws.glue.workflow
  calls:
  - client: glue
    action: describe_connection_type
    save_as: workflows
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.classifiers
  for_each: aws.glue.classifier
  calls:
  - client: glue
    action: describe_connection_type
    save_as: classifiers
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.workflow_encryption
  calls:
  - client: glue
    action: list_blueprints
    save_as: workflow_encryption
    on_error: continue
  emit:
    items_for: workflow_encryption[]
    as: workflow_encryption
    item:
      id: '{{ workflow_encryption.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.schema_encryption
  calls:
  - client: glue
    action: list_blueprints
    save_as: schema_encryption
    on_error: continue
  emit:
    items_for: schema_encryption[]
    as: schema_encryption
    item:
      id: '{{ schema_encryption.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.job_encryption
  calls:
  - client: glue
    action: list_blueprints
    save_as: job_encryption
    on_error: continue
  emit:
    items_for: job_encryption[]
    as: job_encryption
    item:
      id: '{{ job_encryption.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.jobs
  for_each: aws.glue.job
  calls:
  - client: glue
    action: describe_connection_type
    save_as: jobs
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.mltransforms
  for_each: aws.glue.mltransform
  calls:
  - client: glue
    action: describe_connection_type
    save_as: mltransforms
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.databases
  for_each: aws.glue.database
  calls:
  - client: glue
    action: describe_connection_type
    save_as: databases
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.database_encryption
  calls:
  - client: glue
    action: list_blueprints
    save_as: database_encryption
    on_error: continue
  emit:
    items_for: database_encryption[]
    as: database_encryption
    item:
      id: '{{ database_encryption.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.table_logging
  calls:
  - client: glue
    action: list_blueprints
    save_as: table_logging
    on_error: continue
  emit:
    items_for: table_logging[]
    as: table_logging
    item:
      id: '{{ table_logging.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.job_logging
  calls:
  - client: glue
    action: list_blueprints
    save_as: job_logging
    on_error: continue
  emit:
    items_for: job_logging[]
    as: job_logging
    item:
      id: '{{ job_logging.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.partition_encryption
  calls:
  - client: glue
    action: list_blueprints
    save_as: partition_encryption
    on_error: continue
  emit:
    items_for: partition_encryption[]
    as: partition_encryption
    item:
      id: '{{ partition_encryption.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.data_catalogs_not_publicly_accessible_logging
  calls:
  - client: glue
    action: list_blueprints
    save_as: data_catalogs_not_publicly_accessible_logging
    on_error: continue
  emit:
    items_for: data_catalogs_not_publicly_accessible_logging[]
    as: data_catalogs_not_publicly_accessible_logging
    item:
      id: '{{ data_catalogs_not_publicly_accessible_logging.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.resource_encryption
  calls:
  - client: glue
    action: list_blueprints
    save_as: resource_encryption
    on_error: continue
  emit:
    items_for: resource_encryption[]
    as: resource_encryption
    item:
      id: '{{ resource_encryption.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.crawlers
  for_each: aws.glue.crawler
  calls:
  - client: glue
    action: describe_connection_type
    save_as: crawlers
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.trigger_logging
  calls:
  - client: glue
    action: list_blueprints
    save_as: trigger_logging
    on_error: continue
  emit:
    items_for: trigger_logging[]
    as: trigger_logging
    item:
      id: '{{ trigger_logging.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.connections
  for_each: aws.glue.connection
  calls:
  - client: glue
    action: describe_connection_type
    save_as: connections
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.catalog_encryption
  calls:
  - client: glue
    action: list_blueprints
    save_as: catalog_encryption
    on_error: continue
  emit:
    items_for: catalog_encryption[]
    as: catalog_encryption
    item:
      id: '{{ catalog_encryption.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.schemas
  for_each: aws.glue.schema
  calls:
  - client: glue
    action: describe_connection_type
    save_as: schemas
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.database_logging
  calls:
  - client: glue
    action: list_blueprints
    save_as: database_logging
    on_error: continue
  emit:
    items_for: database_logging[]
    as: database_logging
    item:
      id: '{{ database_logging.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.data_quality_ruleset_encryption
  calls:
  - client: glue
    action: list_blueprints
    save_as: data_quality_ruleset_encryption
    on_error: continue
  emit:
    items_for: data_quality_ruleset_encryption[]
    as: data_quality_ruleset_encryption
    item:
      id: '{{ data_quality_ruleset_encryption.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.table_encryption
  calls:
  - client: glue
    action: list_blueprints
    save_as: table_encryption
    on_error: continue
  emit:
    items_for: table_encryption[]
    as: table_encryption
    item:
      id: '{{ table_encryption.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.data_quality_ruleset_logging
  calls:
  - client: glue
    action: list_blueprints
    save_as: data_quality_ruleset_logging
    on_error: continue
  emit:
    items_for: data_quality_ruleset_logging[]
    as: data_quality_ruleset_logging
    item:
      id: '{{ data_quality_ruleset_logging.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.devendpoints
  for_each: aws.glue.devendpoint
  calls:
  - client: glue
    action: describe_connection_type
    save_as: devendpoints
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.partitions
  for_each: aws.glue.partition
  calls:
  - client: glue
    action: describe_connection_type
    save_as: partitions
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.glue.mltransform_logging
  calls:
  - client: glue
    action: list_blueprints
    save_as: mltransform_logging
    on_error: continue
  emit:
    items_for: mltransform_logging[]
    as: mltransform_logging
    item:
      id: '{{ mltransform_logging.Id }}'
      compliant: '{{ true }}'
checks:
- title: 'GLUE registry: Metadata Encryption Enabled'
  severity: high
  rule_id: aws.glue.registry.metadata_encryption_enabled
  for_each:
    discovery: aws.glue.registry_encryption
    as: registry
    item: registry
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'GLUE table: Access Logging Enabled'
  severity: medium
  rule_id: aws.glue.table.access_logging_enabled
  for_each:
    discovery: aws.glue.table_logging
    as: table
    item: table
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'GLUE devendpoint: No Public Access Configured'
  severity: high
  rule_id: aws.glue.devendpoint.no_public_access_configured
  for_each:
    discovery: aws.glue.devendpoints
    as: devendpoint
    item: devendpoint
  conditions:
    var: devendpoint.is_public
    op: equals
    value: false
- title: 'GLUE job: Policies Present For Sensitive Fields Configured'
  severity: medium
  rule_id: aws.glue.job.policies_present_for_sensitive_fields_configured
  for_each:
    discovery: aws.glue.jobs
    as: job
    item: job
  conditions:
    var: job.compliant
    op: equals
    value: true
- title: 'GLUE job: Execution Roles Least Privilege'
  severity: high
  rule_id: aws.glue.job.execution_roles_least_privilege
  for_each:
    discovery: aws.glue.jobs
    as: job
    item: job
  conditions:
    var: job.is_public
    op: equals
    value: false
- title: 'GLUE trigger: Targets Least Privilege'
  severity: high
  rule_id: aws.glue.trigger.targets_least_privilege
  for_each:
    discovery: aws.glue.triggers
    as: trigger
    item: trigger
  conditions:
    var: trigger.is_public
    op: equals
    value: false
- title: 'GLUE data quality ruleset: Execution Role Least Privilege'
  severity: high
  rule_id: aws.glue.data_quality_ruleset.execution_role_least_privilege
  for_each:
    discovery: aws.glue.data_quality_rulesets
    as: data_quality_ruleset
    item: data_quality_ruleset
  conditions:
    var: data_quality_ruleset.is_public
    op: equals
    value: false
- title: 'GLUE mltransform: Network Private Only Configured'
  severity: high
  rule_id: aws.glue.mltransform.network_private_only_configured
  for_each:
    discovery: aws.glue.mltransforms
    as: mltransform
    item: mltransform
  conditions:
    var: mltransform.is_public
    op: equals
    value: false
- title: 'GLUE connection: Credentials In Secrets Manager Configured'
  severity: medium
  rule_id: aws.glue.connection.credentials_in_secrets_manager_configured
  for_each:
    discovery: aws.glue.connections
    as: connection
    item: connection
  conditions:
    var: connection.compliant
    op: equals
    value: true
- title: 'GLUE data quality ruleset: Output Encrypted Private'
  severity: high
  rule_id: aws.glue.data_quality_ruleset.output_encrypted_private
  for_each:
    discovery: aws.glue.data_quality_ruleset_encryption
    as: data_quality_ruleset
    item: data_quality_ruleset
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'GLUE table: Lifecycle Policy Configured'
  severity: high
  rule_id: aws.glue.table.lifecycle_policy_configured
  for_each:
    discovery: aws.glue.tables
    as: table
    item: table
  conditions:
    var: table.is_public
    op: equals
    value: false
- title: 'GLUE data quality ruleset: Output Location Private And Encrypted'
  severity: high
  rule_id: aws.glue.data_quality_ruleset.output_location_private_and_encrypted
  for_each:
    discovery: aws.glue.data_quality_ruleset_encryption
    as: data_quality_ruleset
    item: data_quality_ruleset
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'GLUE database: Rbac Least Privilege'
  severity: high
  rule_id: aws.glue.database.rbac_least_privilege
  for_each:
    discovery: aws.glue.databases
    as: database
    item: database
  conditions:
    var: database.is_public
    op: equals
    value: false
- title: 'GLUE trigger: Logging Enabled'
  severity: medium
  rule_id: aws.glue.trigger.logging_enabled
  for_each:
    discovery: aws.glue.trigger_logging
    as: trigger
    item: trigger
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'GLUE table: S3 Encrypted At Rest'
  severity: high
  rule_id: aws.glue.table.s3_encrypted_at_rest
  for_each:
    discovery: aws.glue.table_encryption
    as: table
    item: table
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'GLUE catalog: Log Catalog Cross Account Sharing Review Required'
  severity: medium
  rule_id: aws.glue.catalog.log_catalog_cross_account_sharing_review_required
  for_each:
    discovery: aws.glue.catalog_logging
    as: catalog
    item: catalog
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'GLUE resource: Dev Endpoints Logs Encrypted'
  severity: high
  rule_id: aws.glue.resource.dev_endpoints_logs_encrypted
  for_each:
    discovery: aws.glue.resource_encryption
    as: resource
    item: resource
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'GLUE job: Network Private Only Configured'
  severity: high
  rule_id: aws.glue.job.network_private_only_configured
  for_each:
    discovery: aws.glue.jobs
    as: job
    item: job
  conditions:
    var: job.is_public
    op: equals
    value: false
- title: 'GLUE resource: Etl Jobs Job Bookmark Encryption Enabled'
  severity: high
  rule_id: aws.glue.resource.etl_jobs_job_bookmark_encryption_enabled
  for_each:
    discovery: aws.glue.resource_encryption
    as: resource
    item: resource
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'GLUE devendpoint: Encryption At Rest Enabled'
  severity: high
  rule_id: aws.glue.devendpoint.encryption_at_rest_enabled
  for_each:
    discovery: aws.glue.devendpoint_encryption
    as: devendpoint
    item: devendpoint
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'GLUE resource: Etl Jobs Cloudwatch Logs Encryption Enabled'
  severity: high
  rule_id: aws.glue.resource.etl_jobs_cloudwatch_logs_encryption_enabled
  for_each:
    discovery: aws.glue.resource_encryption
    as: resource
    item: resource
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'GLUE resource: Dev Endpoints Bookmark Encrypted'
  severity: high
  rule_id: aws.glue.resource.dev_endpoints_bookmark_encrypted
  for_each:
    discovery: aws.glue.resource_encryption
    as: resource
    item: resource
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'GLUE crawler: Scope Restricted To Allowlist Configured'
  severity: medium
  rule_id: aws.glue.crawler.scope_restricted_to_allowlist_configured
  for_each:
    discovery: aws.glue.crawlers
    as: crawler
    item: crawler
  conditions:
    var: crawler.compliant
    op: equals
    value: true
- title: 'GLUE classifier: Rbac Least Privilege'
  severity: high
  rule_id: aws.glue.classifier.rbac_least_privilege
  for_each:
    discovery: aws.glue.classifiers
    as: classifier
    item: classifier
  conditions:
    var: classifier.is_public
    op: equals
    value: false
- title: 'GLUE data quality ruleset: Rbac Least Privilege'
  severity: high
  rule_id: aws.glue.data_quality_ruleset.rbac_least_privilege
  for_each:
    discovery: aws.glue.data_quality_rulesets
    as: data_quality_ruleset
    item: data_quality_ruleset
  conditions:
    var: data_quality_ruleset.is_public
    op: equals
    value: false
- title: 'GLUE database: Metadata Encryption Enabled'
  severity: high
  rule_id: aws.glue.database.metadata_encryption_enabled
  for_each:
    discovery: aws.glue.database_encryption
    as: database
    item: database
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'GLUE datalineage: Capture Enabled'
  severity: medium
  rule_id: aws.glue.datalineage.capture_enabled
  for_each:
    discovery: aws.glue.datalineages
    as: datalineage
    item: datalineage
  conditions:
    var: datalineage.compliant
    op: equals
    value: true
- title: 'GLUE job: Logs And Metrics Enabled'
  severity: medium
  rule_id: aws.glue.job.logs_and_metrics_enabled
  for_each:
    discovery: aws.glue.job_logging
    as: job
    item: job
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'GLUE data quality ruleset: Version Immutable Configured'
  severity: low
  rule_id: aws.glue.data_quality_ruleset.version_immutable_configured
  for_each:
    discovery: aws.glue.data_quality_rulesets
    as: data_quality_ruleset
    item: data_quality_ruleset
  conditions:
    var: data_quality_ruleset.versioning_enabled
    op: equals
    value: true
- title: 'GLUE schema: Encryption At Rest Enabled'
  severity: high
  rule_id: aws.glue.schema.encryption_at_rest_enabled
  for_each:
    discovery: aws.glue.schema_encryption
    as: schema
    item: schema
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'GLUE workflow: Private Networking Enforced'
  severity: high
  rule_id: aws.glue.workflow.private_networking_enforced
  for_each:
    discovery: aws.glue.workflows
    as: workflow
    item: workflow
  conditions:
    var: workflow.is_public
    op: equals
    value: false
- title: 'GLUE table: S3 Block Public Access Configured'
  severity: high
  rule_id: aws.glue.table.s3_block_public_access_configured
  for_each:
    discovery: aws.glue.tables
    as: table
    item: table
  conditions:
    var: table.is_public
    op: equals
    value: false
- title: 'GLUE catalog: Change Audit Logging Enabled'
  severity: medium
  rule_id: aws.glue.catalog.change_audit_logging_enabled
  for_each:
    discovery: aws.glue.catalog_logging
    as: catalog
    item: catalog
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'GLUE job: Role Least Privilege'
  severity: high
  rule_id: aws.glue.job.role_least_privilege
  for_each:
    discovery: aws.glue.jobs
    as: job
    item: job
  conditions:
    var: job.is_public
    op: equals
    value: false
- title: 'GLUE table: Access Policies Least Privilege'
  severity: high
  rule_id: aws.glue.table.access_policies_least_privilege
  for_each:
    discovery: aws.glue.tables
    as: table
    item: table
  conditions:
    var: table.is_public
    op: equals
    value: false
- title: 'GLUE catalog: Log Catalog Store Encrypted'
  severity: high
  rule_id: aws.glue.catalog.log_catalog_store_encrypted
  for_each:
    discovery: aws.glue.catalog_encryption
    as: catalog
    item: catalog
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'GLUE workflow: Execution Roles Least Privilege'
  severity: high
  rule_id: aws.glue.workflow.execution_roles_least_privilege
  for_each:
    discovery: aws.glue.workflows
    as: workflow
    item: workflow
  conditions:
    var: workflow.is_public
    op: equals
    value: false
- title: 'GLUE classifier: Source Trusted Configured'
  severity: medium
  rule_id: aws.glue.classifier.source_trusted_configured
  for_each:
    discovery: aws.glue.classifiers
    as: classifier
    item: classifier
  conditions:
    var: classifier.compliant
    op: equals
    value: true
- title: 'GLUE schema: Immutability Enforced'
  severity: medium
  rule_id: aws.glue.schema.immutability_enforced
  for_each:
    discovery: aws.glue.schemas
    as: schema
    item: schema
  conditions:
    var: schema.compliant
    op: equals
    value: true
- title: 'GLUE job: Outputs Encrypted'
  severity: high
  rule_id: aws.glue.job.outputs_encrypted
  for_each:
    discovery: aws.glue.job_encryption
    as: job
    item: job
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'GLUE registry: Rbac Least Privilege'
  severity: high
  rule_id: aws.glue.registry.rbac_least_privilege
  for_each:
    discovery: aws.glue.registrys
    as: registry
    item: registry
  conditions:
    var: registry.is_public
    op: equals
    value: false
- title: 'GLUE database: Cross Account Sharing Review Required'
  severity: medium
  rule_id: aws.glue.database.cross_account_sharing_review_required
  for_each:
    discovery: aws.glue.databases
    as: database
    item: database
  conditions:
    var: database.compliant
    op: equals
    value: true
- title: 'GLUE partition: Catalog Glue Catalog Encrypted'
  severity: high
  rule_id: aws.glue.partition.catalog_glue_catalog_encrypted
  for_each:
    discovery: aws.glue.partition_encryption
    as: partition
    item: partition
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'GLUE data quality ruleset: Encryption At Rest Enabled'
  severity: high
  rule_id: aws.glue.data_quality_ruleset.encryption_at_rest_enabled
  for_each:
    discovery: aws.glue.data_quality_ruleset_encryption
    as: data_quality_ruleset
    item: data_quality_ruleset
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'GLUE mltransform: Role Least Privilege'
  severity: high
  rule_id: aws.glue.mltransform.role_least_privilege
  for_each:
    discovery: aws.glue.mltransforms
    as: mltransform
    item: mltransform
  conditions:
    var: mltransform.is_public
    op: equals
    value: false
- title: 'GLUE database: Update Rbac Least Privilege'
  severity: high
  rule_id: aws.glue.database.update_rbac_least_privilege
  for_each:
    discovery: aws.glue.databases
    as: database
    item: database
  conditions:
    var: database.is_public
    op: equals
    value: false
- title: 'GLUE crawler: Role Least Privilege'
  severity: high
  rule_id: aws.glue.crawler.role_least_privilege
  for_each:
    discovery: aws.glue.crawlers
    as: crawler
    item: crawler
  conditions:
    var: crawler.is_public
    op: equals
    value: false
- title: 'GLUE data quality ruleset: Role Least Privilege'
  severity: high
  rule_id: aws.glue.data_quality_ruleset.role_least_privilege
  for_each:
    discovery: aws.glue.data_quality_rulesets
    as: data_quality_ruleset
    item: data_quality_ruleset
  conditions:
    var: data_quality_ruleset.is_public
    op: equals
    value: false
- title: 'GLUE workflow: Artifacts Private And Encrypted'
  severity: high
  rule_id: aws.glue.workflow.artifacts_private_and_encrypted
  for_each:
    discovery: aws.glue.workflow_encryption
    as: workflow
    item: workflow
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'GLUE mltransform: Logging Enabled'
  severity: medium
  rule_id: aws.glue.mltransform.logging_enabled
  for_each:
    discovery: aws.glue.mltransform_logging
    as: mltransform
    item: mltransform
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'GLUE resource: Etl Jobs Logging Enabled'
  severity: medium
  rule_id: aws.glue.resource.etl_jobs_logging_enabled
  for_each:
    discovery: aws.glue.resource_logging
    as: resource
    item: resource
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'GLUE data quality ruleset: Version Pinned Configured'
  severity: low
  rule_id: aws.glue.data_quality_ruleset.version_pinned_configured
  for_each:
    discovery: aws.glue.data_quality_rulesets
    as: data_quality_ruleset
    item: data_quality_ruleset
  conditions:
    var: data_quality_ruleset.versioning_enabled
    op: equals
    value: true
- title: 'GLUE registry: Cross Account Sharing Restricted'
  severity: medium
  rule_id: aws.glue.registry.cross_account_sharing_restricted
  for_each:
    discovery: aws.glue.registrys
    as: registry
    item: registry
  conditions:
    var: registry.compliant
    op: equals
    value: true
- title: 'GLUE classifier: Definition Version Pinned Configured'
  severity: low
  rule_id: aws.glue.classifier.definition_version_pinned_configured
  for_each:
    discovery: aws.glue.classifiers
    as: classifier
    item: classifier
  conditions:
    var: classifier.versioning_enabled
    op: equals
    value: true
- title: 'GLUE data quality ruleset: Logging Enabled'
  severity: medium
  rule_id: aws.glue.data_quality_ruleset.logging_enabled
  for_each:
    discovery: aws.glue.data_quality_ruleset_logging
    as: data_quality_ruleset
    item: data_quality_ruleset
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'GLUE table: Encryption At Rest Enabled'
  severity: high
  rule_id: aws.glue.table.encryption_at_rest_enabled
  for_each:
    discovery: aws.glue.table_encryption
    as: table
    item: table
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'GLUE resource: Data Catalogs Metadata Encryption Enabled'
  severity: high
  rule_id: aws.glue.resource.data_catalogs_metadata_encryption_enabled
  for_each:
    discovery: aws.glue.resource_encryption
    as: resource
    item: resource
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: Data lake catalog access is properly controlled
  severity: high
  rule_id: aws.glue.database.audit_logging_enabled
  for_each:
    discovery: aws.glue.database_logging
    as: database
    item: database
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'GLUE data quality ruleset: Definition Version Pinned Configured'
  severity: low
  rule_id: aws.glue.data_quality_ruleset.definition_version_pinned_configured
  for_each:
    discovery: aws.glue.data_quality_rulesets
    as: data_quality_ruleset
    item: data_quality_ruleset
  conditions:
    var: data_quality_ruleset.versioning_enabled
    op: equals
    value: true
- title: 'GLUE table: Column Level Access Controls Enabled'
  severity: medium
  rule_id: aws.glue.table.column_level_access_controls_enabled
  for_each:
    discovery: aws.glue.tables
    as: table
    item: table
  conditions:
    var: table.is_public
    op: equals
    value: false
- title: 'GLUE partition: Access Policies Least Privilege'
  severity: high
  rule_id: aws.glue.partition.access_policies_least_privilege
  for_each:
    discovery: aws.glue.partitions
    as: partition
    item: partition
  conditions:
    var: partition.is_public
    op: equals
    value: false
- title: Data lineage tracking is enabled for analytics
  severity: medium
  rule_id: aws.glue.database.change_audit_logging_enabled
  for_each:
    discovery: aws.glue.database_logging
    as: database
    item: database
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'GLUE data quality ruleset: Source Trusted Configured'
  severity: medium
  rule_id: aws.glue.data_quality_ruleset.source_trusted_configured
  for_each:
    discovery: aws.glue.data_quality_rulesets
    as: data_quality_ruleset
    item: data_quality_ruleset
  conditions:
    var: data_quality_ruleset.compliant
    op: equals
    value: true
- title: 'GLUE resource: Development Endpoints S3 Encryption Enabled'
  severity: high
  rule_id: aws.glue.resource.development_endpoints_s3_encryption_enabled
  for_each:
    discovery: aws.glue.resource_encryption
    as: resource
    item: resource
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'GLUE resource: Etl Jobs Amazon S3 Encryption Enabled'
  severity: high
  rule_id: aws.glue.resource.etl_jobs_amazon_s3_encryption_enabled
  for_each:
    discovery: aws.glue.resource_encryption
    as: resource
    item: resource
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'GLUE schema: Rbac Least Privilege'
  severity: high
  rule_id: aws.glue.schema.rbac_least_privilege
  for_each:
    discovery: aws.glue.schemas
    as: schema
    item: schema
  conditions:
    var: schema.is_public
    op: equals
    value: false
- title: 'GLUE datalineage: Rbac Least Privilege'
  severity: high
  rule_id: aws.glue.datalineage.rbac_least_privilege
  for_each:
    discovery: aws.glue.datalineages
    as: datalineage
    item: datalineage
  conditions:
    var: datalineage.is_public
    op: equals
    value: false
- title: 'GLUE job: Script Location Private And Encrypted'
  severity: high
  rule_id: aws.glue.job.script_location_private_and_encrypted
  for_each:
    discovery: aws.glue.job_encryption
    as: job
    item: job
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'GLUE table: Public Sharing Disabled'
  severity: high
  rule_id: aws.glue.table.public_sharing_disabled
  for_each:
    discovery: aws.glue.tables
    as: table
    item: table
  conditions:
    var: table.is_public
    op: equals
    value: false
- title: 'GLUE database: Cross Account Sharing Restricted'
  severity: medium
  rule_id: aws.glue.database.cross_account_sharing_restricted
  for_each:
    discovery: aws.glue.databases
    as: database
    item: database
  conditions:
    var: database.compliant
    op: equals
    value: true
- title: 'GLUE workflow: Logs And Metrics Enabled'
  severity: medium
  rule_id: aws.glue.workflow.logs_and_metrics_enabled
  for_each:
    discovery: aws.glue.workflow_logging
    as: workflow
    item: workflow
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'GLUE database: Policy Least Privilege'
  severity: high
  rule_id: aws.glue.database.policy_least_privilege
  for_each:
    discovery: aws.glue.databases
    as: database
    item: database
  conditions:
    var: database.is_public
    op: equals
    value: false
- title: 'GLUE workflow: Kms Encryption Enabled'
  severity: high
  rule_id: aws.glue.workflow.kms_encryption_enabled
  for_each:
    discovery: aws.glue.workflow_encryption
    as: workflow
    item: workflow
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'GLUE data quality ruleset: Run Metadata Logging Enabled'
  severity: medium
  rule_id: aws.glue.data_quality_ruleset.run_metadata_logging_enabled
  for_each:
    discovery: aws.glue.data_quality_ruleset_logging
    as: data_quality_ruleset
    item: data_quality_ruleset
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'GLUE crawler: Network Private Only Configured'
  severity: high
  rule_id: aws.glue.crawler.network_private_only_configured
  for_each:
    discovery: aws.glue.crawlers
    as: crawler
    item: crawler
  conditions:
    var: crawler.is_public
    op: equals
    value: false
- title: 'GLUE job: S Private Networking Configured'
  severity: high
  rule_id: aws.glue.job.s_private_networking_configured
  for_each:
    discovery: aws.glue.jobs
    as: job
    item: job
  conditions:
    var: job.is_public
    op: equals
    value: false
- title: 'GLUE connection: Role Least Privilege'
  severity: high
  rule_id: aws.glue.connection.role_least_privilege
  for_each:
    discovery: aws.glue.connections
    as: connection
    item: connection
  conditions:
    var: connection.is_public
    op: equals
    value: false
- title: Data catalog encryption is enabled
  severity: medium
  rule_id: aws.glue.catalog.metadata_encryption_enabled
  for_each:
    discovery: aws.glue.catalog_encryption
    as: catalog
    item: catalog
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'GLUE data quality ruleset: Parameters No Plaintext Secrets Configured'
  severity: medium
  rule_id: aws.glue.data_quality_ruleset.parameters_no_plaintext_secrets_configured
  for_each:
    discovery: aws.glue.data_quality_rulesets
    as: data_quality_ruleset
    item: data_quality_ruleset
  conditions:
    var: data_quality_ruleset.compliant
    op: equals
    value: true
- title: 'GLUE workflow: Cross Account Trusts Restricted'
  severity: medium
  rule_id: aws.glue.workflow.cross_account_trusts_restricted
  for_each:
    discovery: aws.glue.workflows
    as: workflow
    item: workflow
  conditions:
    var: workflow.compliant
    op: equals
    value: true
- title: 'GLUE data catalogs not publicly accessible: Data Catalogs Not Publicly Accessible
    Configured'
  severity: medium
  rule_id: aws.glue.data_catalogs_not_publicly_accessible.data_catalogs_not_publicly_accessible_configured
  for_each:
    discovery: aws.glue.data_catalogs_not_publicly_accessible_logging
    as: data_catalogs_not_publicly_accessible
    item: data_catalogs_not_publicly_accessible
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'GLUE resource: Ml Transform Encrypted At Rest'
  severity: high
  rule_id: aws.glue.resource.ml_transform_encrypted_at_rest
  for_each:
    discovery: aws.glue.resource_encryption
    as: resource
    item: resource
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'GLUE data quality ruleset: Outputs Encrypted And Private'
  severity: high
  rule_id: aws.glue.data_quality_ruleset.outputs_encrypted_and_private
  for_each:
    discovery: aws.glue.data_quality_ruleset_encryption
    as: data_quality_ruleset
    item: data_quality_ruleset
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'GLUE database: Encryption At Rest Enabled'
  severity: high
  rule_id: aws.glue.database.encryption_at_rest_enabled
  for_each:
    discovery: aws.glue.database_encryption
    as: database
    item: database
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'GLUE connection: Private Networking Enforced'
  severity: high
  rule_id: aws.glue.connection.private_networking_enforced
  for_each:
    discovery: aws.glue.connections
    as: connection
    item: connection
  conditions:
    var: connection.is_public
    op: equals
    value: false
- title: 'GLUE trigger: Event Sources Restricted'
  severity: medium
  rule_id: aws.glue.trigger.event_sources_restricted
  for_each:
    discovery: aws.glue.triggers
    as: trigger
    item: trigger
  conditions:
    var: trigger.compliant
    op: equals
    value: true
- title: 'GLUE catalog: Log Catalog Cross Account Sharing Restricted'
  severity: medium
  rule_id: aws.glue.catalog.log_catalog_cross_account_sharing_restricted
  for_each:
    discovery: aws.glue.catalog_logging
    as: catalog
    item: catalog
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'GLUE catalog: Update Rbac Least Privilege'
  severity: high
  rule_id: aws.glue.catalog.update_rbac_least_privilege
  for_each:
    discovery: aws.glue.catalog_logging
    as: catalog
    item: catalog
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'GLUE resource: Catalog Passwords Encrypted'
  severity: high
  rule_id: aws.glue.resource.catalog_passwords_encrypted
  for_each:
    discovery: aws.glue.resource_encryption
    as: resource
    item: resource
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'GLUE datalineage: Export Destination Encrypted'
  severity: high
  rule_id: aws.glue.datalineage.export_destination_encrypted
  for_each:
    discovery: aws.glue.datalineage_encryption
    as: datalineage
    item: datalineage
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'GLUE crawler: Logging Enabled'
  severity: medium
  rule_id: aws.glue.crawler.logging_enabled
  for_each:
    discovery: aws.glue.crawler_logging
    as: crawler
    item: crawler
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'GLUE data quality ruleset: Jobs Role Least Privilege'
  severity: high
  rule_id: aws.glue.data_quality_ruleset.jobs_role_least_privilege
  for_each:
    discovery: aws.glue.data_quality_rulesets
    as: data_quality_ruleset
    item: data_quality_ruleset
  conditions:
    var: data_quality_ruleset.is_public
    op: equals
    value: false
- title: 'GLUE catalog: Rbac Least Privilege'
  severity: high
  rule_id: aws.glue.catalog.rbac_least_privilege
  for_each:
    discovery: aws.glue.catalog_logging
    as: catalog
    item: catalog
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'GLUE catalog: Audit Logging Enabled'
  severity: medium
  rule_id: aws.glue.catalog.audit_logging_enabled
  for_each:
    discovery: aws.glue.catalog_logging
    as: catalog
    item: catalog
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'GLUE workflow: Execution Role Least Privilege'
  severity: high
  rule_id: aws.glue.workflow.execution_role_least_privilege
  for_each:
    discovery: aws.glue.workflows
    as: workflow
    item: workflow
  conditions:
    var: workflow.is_public
    op: equals
    value: false
- title: 'GLUE connection: Tls Required'
  severity: high
  rule_id: aws.glue.connection.tls_required
  for_each:
    discovery: aws.glue.connections
    as: connection
    item: connection
  conditions:
    var: connection.in_vpc
    op: equals
    value: true
- title: 'GLUE devendpoint: Role Least Privilege'
  severity: high
  rule_id: aws.glue.devendpoint.role_least_privilege
  for_each:
    discovery: aws.glue.devendpoints
    as: devendpoint
    item: devendpoint
  conditions:
    var: devendpoint.is_public
    op: equals
    value: false
