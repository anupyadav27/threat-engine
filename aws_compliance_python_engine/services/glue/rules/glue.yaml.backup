version: '1.0'
provider: aws
service: glue
discovery:
- discovery_id: aws.glue.get_data_catalog_encryption_settings
  calls:
  - action: get_data_catalog_encryption_settings
    save_as: get_data_catalog_encryption_settings_response
  emit:
    items_for: '{{ get_data_catalog_encryption_settings_response.DataCatalogEncryptionSettings
      }}'
    as: resource
    item:
      encryption_at_rest: '{{ resource.EncryptionAtRest }}'
      connection_password_encryption: '{{ resource.ConnectionPasswordEncryption }}'
- discovery_id: aws.glue.get_catalogs
  calls:
  - action: get_catalogs
    save_as: get_catalogs_response
  emit:
    items_for: '{{ get_catalogs_response.CatalogList }}'
    as: resource
    item:
      catalog_id: '{{ resource.CatalogId }}'
      name: '{{ resource.Name }}'
      resource_arn: '{{ resource.ResourceArn }}'
      description: '{{ resource.Description }}'
      parameters: '{{ resource.Parameters }}'
      create_time: '{{ resource.CreateTime }}'
      update_time: '{{ resource.UpdateTime }}'
      target_redshift_catalog: '{{ resource.TargetRedshiftCatalog }}'
      federated_catalog: '{{ resource.FederatedCatalog }}'
      catalog_properties: '{{ resource.CatalogProperties }}'
- discovery_id: aws.glue.get_dev_endpoints
  calls:
  - action: get_dev_endpoints
    save_as: get_dev_endpoints_response
  emit:
    items_for: '{{ get_dev_endpoints_response.DevEndpoints }}'
    as: resource
    item:
      endpoint_name: '{{ resource.EndpointName }}'
      role_arn: '{{ resource.RoleArn }}'
      security_group_ids: '{{ resource.SecurityGroupIds }}'
      subnet_id: '{{ resource.SubnetId }}'
      yarn_endpoint_address: '{{ resource.YarnEndpointAddress }}'
      private_address: '{{ resource.PrivateAddress }}'
      zeppelin_remote_spark_interpreter_port: '{{ resource.ZeppelinRemoteSparkInterpreterPort
        }}'
      public_address: '{{ resource.PublicAddress }}'
      status: '{{ resource.Status }}'
      worker_type: '{{ resource.WorkerType }}'
- discovery_id: aws.glue.get_crawlers
  calls:
  - action: get_crawlers
    save_as: get_crawlers_response
  emit:
    items_for: '{{ get_crawlers_response.Crawlers }}'
    as: resource
    item:
      name: '{{ resource.Name }}'
      role: '{{ resource.Role }}'
      targets: '{{ resource.Targets }}'
      database_name: '{{ resource.DatabaseName }}'
      description: '{{ resource.Description }}'
      classifiers: '{{ resource.Classifiers }}'
      recrawl_policy: '{{ resource.RecrawlPolicy }}'
      schema_change_policy: '{{ resource.SchemaChangePolicy }}'
      lineage_configuration: '{{ resource.LineageConfiguration }}'
      state: '{{ resource.State }}'
- discovery_id: aws.glue.get_triggers
  calls:
  - action: get_triggers
    save_as: get_triggers_response
  emit:
    items_for: '{{ get_triggers_response.Triggers }}'
    as: resource
    item:
      name: '{{ resource.Name }}'
      workflow_name: '{{ resource.WorkflowName }}'
      id: '{{ resource.Id }}'
      type: '{{ resource.Type }}'
      state: '{{ resource.State }}'
      description: '{{ resource.Description }}'
      schedule: '{{ resource.Schedule }}'
      actions: '{{ resource.Actions }}'
      predicate: '{{ resource.Predicate }}'
      event_batching_condition: '{{ resource.EventBatchingCondition }}'
- discovery_id: aws.glue.describe_inbound_integrations
  calls:
  - action: describe_inbound_integrations
    save_as: describe_inbound_integrations_response
  emit:
    items_for: '{{ describe_inbound_integrations_response.InboundIntegrations }}'
    as: resource
    item:
      source_arn: '{{ resource.SourceArn }}'
      target_arn: '{{ resource.TargetArn }}'
      integration_arn: '{{ resource.IntegrationArn }}'
      status: '{{ resource.Status }}'
      create_time: '{{ resource.CreateTime }}'
      integration_config: '{{ resource.IntegrationConfig }}'
      errors: '{{ resource.Errors }}'
- discovery_id: aws.glue.get_security_configurations
  calls:
  - action: get_security_configurations
    save_as: get_security_configurations_response
  emit:
    items_for: '{{ get_security_configurations_response.SecurityConfigurations }}'
    as: resource
    item:
      name: '{{ resource.Name }}'
      created_time_stamp: '{{ resource.CreatedTimeStamp }}'
      encryption_configuration: '{{ resource.EncryptionConfiguration }}'
- discovery_id: aws.glue.get_jobs
  calls:
  - action: get_jobs
    save_as: get_jobs_response
  emit:
    items_for: '{{ get_jobs_response.Jobs }}'
    as: resource
    item:
      name: '{{ resource.Name }}'
      job_mode: '{{ resource.JobMode }}'
      job_run_queuing_enabled: '{{ resource.JobRunQueuingEnabled }}'
      description: '{{ resource.Description }}'
      log_uri: '{{ resource.LogUri }}'
      role: '{{ resource.Role }}'
      created_on: '{{ resource.CreatedOn }}'
      last_modified_on: '{{ resource.LastModifiedOn }}'
      execution_property: '{{ resource.ExecutionProperty }}'
      command: '{{ resource.Command }}'
- discovery_id: aws.glue.search_tables
  calls:
  - action: search_tables
    save_as: search_tables_response
  emit:
    items_for: '{{ search_tables_response.TableList }}'
    as: resource
    item:
      name: '{{ resource.Name }}'
      database_name: '{{ resource.DatabaseName }}'
      description: '{{ resource.Description }}'
      owner: '{{ resource.Owner }}'
      create_time: '{{ resource.CreateTime }}'
      update_time: '{{ resource.UpdateTime }}'
      last_access_time: '{{ resource.LastAccessTime }}'
      last_analyzed_time: '{{ resource.LastAnalyzedTime }}'
      retention: '{{ resource.Retention }}'
      storage_descriptor: '{{ resource.StorageDescriptor }}'
- discovery_id: aws.glue.get_resource_policies
  calls:
  - action: get_resource_policies
    save_as: get_resource_policies_response
  emit:
    items_for: '{{ get_resource_policies_response.GetResourcePoliciesResponseList
      }}'
    as: resource
    item:
      policy_in_json: '{{ resource.PolicyInJson }}'
      policy_hash: '{{ resource.PolicyHash }}'
      create_time: '{{ resource.CreateTime }}'
      update_time: '{{ resource.UpdateTime }}'
- discovery_id: aws.glue.get_databases
  calls:
  - action: get_databases
    save_as: get_databases_response
  emit:
    items_for: '{{ get_databases_response.DatabaseList }}'
    as: resource
    item:
      name: '{{ resource.Name }}'
      description: '{{ resource.Description }}'
      location_uri: '{{ resource.LocationUri }}'
      parameters: '{{ resource.Parameters }}'
      create_time: '{{ resource.CreateTime }}'
      create_table_default_permissions: '{{ resource.CreateTableDefaultPermissions
        }}'
      target_database: '{{ resource.TargetDatabase }}'
      catalog_id: '{{ resource.CatalogId }}'
      federated_database: '{{ resource.FederatedDatabase }}'
- discovery_id: aws.glue.describe_integrations
  calls:
  - action: describe_integrations
    save_as: describe_integrations_response
  emit:
    items_for: '{{ describe_integrations_response.Integrations }}'
    as: resource
    item:
      source_arn: '{{ resource.SourceArn }}'
      target_arn: '{{ resource.TargetArn }}'
      description: '{{ resource.Description }}'
      integration_name: '{{ resource.IntegrationName }}'
      integration_arn: '{{ resource.IntegrationArn }}'
      kms_key_id: '{{ resource.KmsKeyId }}'
      additional_encryption_context: '{{ resource.AdditionalEncryptionContext }}'
      tags: '{{ resource.Tags }}'
      status: '{{ resource.Status }}'
      create_time: '{{ resource.CreateTime }}'
- discovery_id: aws.glue.get_ml_transforms
  calls:
  - action: get_ml_transforms
    save_as: get_ml_transforms_response
  emit:
    items_for: '{{ get_ml_transforms_response.Transforms }}'
    as: resource
    item:
      transform_id: '{{ resource.TransformId }}'
      name: '{{ resource.Name }}'
      description: '{{ resource.Description }}'
      status: '{{ resource.Status }}'
      created_on: '{{ resource.CreatedOn }}'
      last_modified_on: '{{ resource.LastModifiedOn }}'
      input_record_tables: '{{ resource.InputRecordTables }}'
      parameters: '{{ resource.Parameters }}'
      evaluation_metrics: '{{ resource.EvaluationMetrics }}'
      label_count: '{{ resource.LabelCount }}'
- discovery_id: aws.glue.get_connections
  calls:
  - action: get_connections
    save_as: get_connections_response
  emit:
    items_for: '{{ get_connections_response.ConnectionList }}'
    as: resource
    item:
      name: '{{ resource.Name }}'
      description: '{{ resource.Description }}'
      connection_type: '{{ resource.ConnectionType }}'
      match_criteria: '{{ resource.MatchCriteria }}'
      connection_properties: '{{ resource.ConnectionProperties }}'
      spark_properties: '{{ resource.SparkProperties }}'
      athena_properties: '{{ resource.AthenaProperties }}'
      python_properties: '{{ resource.PythonProperties }}'
      physical_connection_requirements: '{{ resource.PhysicalConnectionRequirements
        }}'
      creation_time: '{{ resource.CreationTime }}'
checks:
- rule_id: aws.glue.registry.metadata_encryption_enabled
  for_each: aws.glue.get_data_catalog_encryption_settings
  conditions:
    var: item.encryption_at_rest
    op: equals
    value: true
- rule_id: aws.glue.table.access_logging_enabled
  for_each: aws.glue.get_catalogs
  conditions:
    var: item.parameters
    op: contains
    value: access_logging_enabled
- rule_id: aws.glue.devendpoint.no_public_access_configured
  for_each: aws.glue.get_dev_endpoints
  conditions:
    var: item.public_address
    op: exists
- rule_id: aws.glue.job.execution_roles_least_privilege
  for_each: aws.glue.get_crawlers
  conditions:
    all:
    - var: item.role
      op: exists
    - var: item.role
      op: equals
      value: arn:aws:iam::123456789012:role/service-role/AWSGlueServiceRole
- rule_id: aws.glue.trigger.targets_least_privilege
  for_each: aws.glue.get_triggers
  conditions:
    all:
    - var: item.actions
      op: exists
    - var: item.state
      op: equals
      value: ENABLED
- rule_id: aws.glue.data_quality_ruleset.execution_role_least_privilege
  for_each: aws.glue.get_crawlers
  conditions:
    var: item.role
    op: exists
- rule_id: aws.glue.mltransform.network_private_only_configured
  for_each: aws.glue.get_dev_endpoints
  conditions:
    all:
    - var: item.subnet_id
      op: exists
    - var: item.public_address
      op: equals
      value: null
- rule_id: aws.glue.connection.credentials_in_secrets_manager_configured
  for_each: aws.glue.get_data_catalog_encryption_settings
  conditions:
    var: item.connection_password_encryption
    op: exists
- rule_id: aws.glue.data_quality_ruleset.output_encrypted_private
  for_each: aws.glue.get_data_catalog_encryption_settings
  conditions:
    var: item.encryption_at_rest
    op: equals
    value: ENABLED
- rule_id: aws.glue.table.lifecycle_policy_configured
  for_each: aws.glue.get_catalogs
  conditions:
    var: item.parameters
    op: exists
- rule_id: aws.glue.data_quality_ruleset.output_location_private_and_encrypted
  for_each: aws.glue.get_data_catalog_encryption_settings
  conditions:
    all:
    - var: item.encryption_at_rest
      op: equals
      value: true
    - var: item.connection_password_encryption
      op: exists
- rule_id: aws.glue.database.rbac_least_privilege
  for_each: aws.glue.get_catalogs
  conditions:
    all:
    - var: item.create_database_default_permissions
      op: equals
      value: []
    - var: item.create_table_default_permissions
      op: equals
      value: []
- rule_id: aws.glue.trigger.logging_enabled
  for_each: aws.glue.get_crawlers
  conditions:
    var: item.state
    op: equals
    value: ENABLED
- rule_id: aws.glue.table.s3_encrypted_at_rest
  for_each: aws.glue.get_data_catalog_encryption_settings
  conditions:
    var: item.encryption_at_rest
    op: equals
    value: true
- rule_id: aws.glue.catalog.log_catalog_cross_account_sharing_review_required
  for_each: aws.glue.describe_inbound_integrations
  conditions:
    var: item.status
    op: equals
    value: ACTIVE
- rule_id: aws.glue.resource.dev_endpoints_logs_encrypted
  for_each: aws.glue.describe_inbound_integrations
  conditions:
    var: item.status
    op: equals
    value: ACTIVE
- rule_id: aws.glue.job.network_private_only_configured
  for_each: aws.glue.get_dev_endpoints
  conditions:
    all:
    - var: item.subnet_id
      op: exists
    - var: item.public_address
      op: equals
      value: null
- rule_id: aws.glue.resource.etl_jobs_job_bookmark_encryption_enabled
  for_each: aws.glue.get_data_catalog_encryption_settings
  conditions:
    var: item.encryption_at_rest
    op: equals
    value: true
- rule_id: aws.glue.devendpoint.encryption_at_rest_enabled
  for_each: aws.glue.get_data_catalog_encryption_settings
  conditions:
    var: item.encryption_at_rest
    op: exists
- rule_id: aws.glue.resource.etl_jobs_cloudwatch_logs_encryption_enabled
  for_each: aws.glue.get_security_configurations
  conditions:
    var: item.encryption_configuration
    op: exists
- rule_id: aws.glue.resource.dev_endpoints_bookmark_encrypted
  for_each: aws.glue.get_security_configurations
  conditions:
    var: item.encryption_configuration
    op: exists
- rule_id: aws.glue.crawler.scope_restricted_to_allowlist_configured
  for_each: aws.glue.get_crawlers
  conditions:
    var: item.targets
    op: exists
- rule_id: aws.glue.classifier.rbac_least_privilege
  for_each: aws.glue.get_crawlers
  conditions:
    var: item.role
    op: equals
    value: arn:aws:iam::123456789012:role/GlueMinimalRole
- rule_id: aws.glue.database.metadata_encryption_enabled
  for_each: aws.glue.get_data_catalog_encryption_settings
  conditions:
    var: item.encryption_at_rest
    op: equals
    value: true
- rule_id: aws.glue.datalineage.capture_enabled
  for_each: aws.glue.get_crawlers
  conditions:
    var: item.lineage_configuration
    op: equals
    value: ENABLED
- rule_id: aws.glue.job.logs_and_metrics_enabled
  for_each: aws.glue.get_jobs
  conditions:
    all:
    - var: item.log_uri
      op: exists
    - var: item.job_run_queuing_enabled
      op: equals
      value: true
- rule_id: aws.glue.data_quality_ruleset.version_immutable_configured
  for_each: aws.glue.search_tables
  conditions:
    var: item.version_id
    op: exists
- rule_id: aws.glue.schema.encryption_at_rest_enabled
  for_each: aws.glue.get_data_catalog_encryption_settings
  conditions:
    var: item.encryption_at_rest
    op: exists
- rule_id: aws.glue.workflow.private_networking_enforced
  for_each: aws.glue.get_dev_endpoints
  conditions:
    all:
    - var: item.private_address
      op: exists
    - var: item.public_address
      op: equals
      value: null
- rule_id: aws.glue.table.s3_block_public_access_configured
  for_each: aws.glue.get_catalogs
  conditions:
    var: item.allow_full_table_external_data_access
    op: equals
    value: false
- rule_id: aws.glue.catalog.change_audit_logging_enabled
  for_each: aws.glue.get_data_catalog_encryption_settings
  conditions:
    all:
    - var: item.encryption_at_rest
      op: equals
      value: ENABLED
    - var: item.connection_password_encryption
      op: equals
      value: ENABLED
- rule_id: aws.glue.job.role_least_privilege
  for_each: aws.glue.get_crawlers
  conditions:
    var: item.role
    op: exists
- rule_id: aws.glue.table.access_policies_least_privilege
  for_each: aws.glue.get_catalogs
  conditions:
    all:
    - var: item.create_table_default_permissions
      op: equals
      value: []
    - var: item.create_database_default_permissions
      op: equals
      value: []
- rule_id: aws.glue.catalog.log_catalog_store_encrypted
  for_each: aws.glue.get_data_catalog_encryption_settings
  conditions:
    var: item.encryption_at_rest
    op: equals
    value: true
- rule_id: aws.glue.workflow.execution_roles_least_privilege
  for_each: aws.glue.get_crawlers
  conditions:
    var: item.role
    op: exists
- rule_id: aws.glue.classifier.source_trusted_configured
  for_each: aws.glue.describe_inbound_integrations
  conditions:
    all:
    - var: item.status
      op: equals
      value: ACTIVE
    - var: item.errors
      op: equals
      value: []
- rule_id: aws.glue.schema.immutability_enforced
  for_each: aws.glue.get_crawlers
  conditions:
    var: item.schema_change_policy
    op: equals
    value:
      UpdateBehavior: LOG
      DeleteBehavior: DEPRECATE_IN_DATABASE
- rule_id: aws.glue.job.outputs_encrypted
  for_each: aws.glue.get_data_catalog_encryption_settings
  conditions:
    var: item.encryption_at_rest
    op: equals
    value: ENABLED
- rule_id: aws.glue.registry.rbac_least_privilege
  for_each: aws.glue.describe_inbound_integrations
  conditions:
    var: item.status
    op: equals
    value: ACTIVE
- rule_id: aws.glue.database.cross_account_sharing_review_required
  for_each: aws.glue.describe_inbound_integrations
  conditions:
    all:
    - var: item.status
      op: equals
      value: ACTIVE
    - var: item.target_arn
      op: exists
- rule_id: aws.glue.partition.catalog_glue_catalog_encrypted
  for_each: aws.glue.get_data_catalog_encryption_settings
  conditions:
    var: item.encryption_at_rest
    op: equals
    value: true
- rule_id: aws.glue.data_quality_ruleset.encryption_at_rest_enabled
  for_each: aws.glue.get_data_catalog_encryption_settings
  conditions:
    var: item.encryption_at_rest
    op: exists
- rule_id: aws.glue.mltransform.role_least_privilege
  for_each: aws.glue.get_crawlers
  conditions:
    var: item.role
    op: exists
- rule_id: aws.glue.database.update_rbac_least_privilege
  for_each: aws.glue.get_catalogs
  conditions:
    all:
    - var: item.create_database_default_permissions
      op: equals
      value: []
    - var: item.create_table_default_permissions
      op: equals
      value: []
- rule_id: aws.glue.crawler.role_least_privilege
  for_each: aws.glue.get_crawlers
  conditions:
    var: item.role
    op: exists
- rule_id: aws.glue.data_quality_ruleset.role_least_privilege
  for_each: aws.glue.get_crawlers
  conditions:
    var: item.role
    op: exists
- rule_id: aws.glue.workflow.artifacts_private_and_encrypted
  for_each: aws.glue.get_data_catalog_encryption_settings
  conditions:
    all:
    - var: item.encryption_at_rest
      op: equals
      value: ENABLED
    - var: item.connection_password_encryption
      op: equals
      value: ENABLED
- rule_id: aws.glue.mltransform.logging_enabled
  for_each: aws.glue.describe_inbound_integrations
  conditions:
    var: item.status
    op: equals
    value: ACTIVE
- rule_id: aws.glue.resource.etl_jobs_logging_enabled
  for_each: aws.glue.get_jobs
  conditions:
    var: item.log_uri
    op: exists
- rule_id: aws.glue.data_quality_ruleset.version_pinned_configured
  for_each: aws.glue.get_dev_endpoints
  conditions:
    var: item.glue_version
    op: exists
- rule_id: aws.glue.registry.cross_account_sharing_restricted
  for_each: aws.glue.describe_inbound_integrations
  conditions:
    var: item.status
    op: equals
    value: ACTIVE
- rule_id: aws.glue.classifier.definition_version_pinned_configured
  for_each: aws.glue.describe_inbound_integrations
  conditions:
    var: item.status
    op: equals
    value: ACTIVE
- rule_id: aws.glue.data_quality_ruleset.logging_enabled
  for_each: aws.glue.describe_inbound_integrations
  conditions:
    var: item.status
    op: equals
    value: ACTIVE
- rule_id: aws.glue.table.encryption_at_rest_enabled
  for_each: aws.glue.get_data_catalog_encryption_settings
  conditions:
    var: item.encryption_at_rest
    op: exists
- rule_id: aws.glue.resource.data_catalogs_metadata_encryption_enabled
  for_each: aws.glue.get_data_catalog_encryption_settings
  conditions:
    var: item.encryption_at_rest
    op: equals
    value: true
- rule_id: aws.glue.database.audit_logging_enabled
  for_each: aws.glue.describe_inbound_integrations
  conditions:
    var: item.status
    op: equals
    value: ENABLED
- rule_id: aws.glue.data_quality_ruleset.definition_version_pinned_configured
  for_each: aws.glue.describe_inbound_integrations
  conditions:
    var: item.status
    op: equals
    value: ACTIVE
- rule_id: aws.glue.table.column_level_access_controls_enabled
  for_each: aws.glue.get_catalogs
  conditions:
    var: item.parameters
    op: contains
    value: columnLevelAccessControlsEnabled
- rule_id: aws.glue.partition.access_policies_least_privilege
  for_each: aws.glue.get_resource_policies
  conditions:
    var: item.policy_in_json
    op: exists
- rule_id: aws.glue.database.change_audit_logging_enabled
  for_each: aws.glue.describe_inbound_integrations
  conditions:
    var: item.status
    op: equals
    value: ENABLED
- rule_id: aws.glue.resource.development_endpoints_s3_encryption_enabled
  for_each: aws.glue.get_data_catalog_encryption_settings
  conditions:
    var: item.encryption_at_rest
    op: exists
- rule_id: aws.glue.resource.etl_jobs_amazon_s3_encryption_enabled
  for_each: aws.glue.get_data_catalog_encryption_settings
  conditions:
    var: item.encryption_at_rest
    op: exists
- rule_id: aws.glue.datalineage.rbac_least_privilege
  for_each: aws.glue.get_dev_endpoints
  conditions:
    all:
    - var: item.status
      op: equals
      value: ACTIVE
    - var: item.role_arn
      op: exists
- rule_id: aws.glue.job.script_location_private_and_encrypted
  for_each: aws.glue.get_data_catalog_encryption_settings
  conditions:
    all:
    - var: item.encryption_at_rest
      op: equals
      value: ENABLED
    - var: item.connection_password_encryption
      op: equals
      value: ENABLED
- rule_id: aws.glue.table.public_sharing_disabled
  for_each: aws.glue.get_catalogs
  conditions:
    var: item.allow_full_table_external_data_access
    op: equals
    value: false
- rule_id: aws.glue.database.cross_account_sharing_restricted
  for_each: aws.glue.get_databases
  conditions:
    var: item.federated_database
    op: exists
- rule_id: aws.glue.workflow.logs_and_metrics_enabled
  for_each: aws.glue.get_jobs
  conditions:
    var: item.log_uri
    op: exists
- rule_id: aws.glue.database.policy_least_privilege
  for_each: aws.glue.get_catalogs
  conditions:
    all:
    - var: item.create_database_default_permissions
      op: equals
      value: []
    - var: item.create_table_default_permissions
      op: equals
      value: []
- rule_id: aws.glue.workflow.kms_encryption_enabled
  for_each: aws.glue.describe_integrations
  conditions:
    var: item.kms_key_id
    op: exists
- rule_id: aws.glue.data_quality_ruleset.run_metadata_logging_enabled
  for_each: aws.glue.describe_inbound_integrations
  conditions:
    var: item.status
    op: equals
    value: ENABLED
- rule_id: aws.glue.crawler.network_private_only_configured
  for_each: aws.glue.get_dev_endpoints
  conditions:
    all:
    - var: item.subnet_id
      op: exists
    - var: item.security_group_ids
      op: exists
    - var: item.public_address
      op: equals
      value: null
- rule_id: aws.glue.job.s_private_networking_configured
  for_each: aws.glue.get_dev_endpoints
  conditions:
    all:
    - var: item.subnet_id
      op: exists
    - var: item.security_group_ids
      op: exists
- rule_id: aws.glue.connection.role_least_privilege
  for_each: aws.glue.get_ml_transforms
  conditions:
    all:
    - var: item.role
      op: exists
    - var: item.status
      op: equals
      value: ACTIVE
- rule_id: aws.glue.catalog.metadata_encryption_enabled
  for_each: aws.glue.get_data_catalog_encryption_settings
  conditions:
    var: item.encryption_at_rest
    op: exists
- rule_id: aws.glue.data_quality_ruleset.parameters_no_plaintext_secrets_configured
  for_each: aws.glue.get_data_catalog_encryption_settings
  conditions:
    all:
    - var: item.encryption_at_rest
      op: exists
    - var: item.connection_password_encryption
      op: exists
- rule_id: aws.glue.workflow.cross_account_trusts_restricted
  for_each: aws.glue.get_dev_endpoints
  conditions:
    var: item.role_arn
    op: exists
- rule_id: aws.glue.data_catalogs_not_publicly_accessible.data_catalogs_not_publicly_accessible_configured
  for_each: aws.glue.get_catalogs
  conditions:
    var: item.allow_full_table_external_data_access
    op: equals
    value: false
- rule_id: aws.glue.resource.ml_transform_encrypted_at_rest
  for_each: aws.glue.get_data_catalog_encryption_settings
  conditions:
    var: item.encryption_at_rest
    op: exists
- rule_id: aws.glue.data_quality_ruleset.outputs_encrypted_and_private
  for_each: aws.glue.get_data_catalog_encryption_settings
  conditions:
    all:
    - var: item.encryption_at_rest
      op: exists
    - var: item.connection_password_encryption
      op: exists
- rule_id: aws.glue.database.encryption_at_rest_enabled
  for_each: aws.glue.get_data_catalog_encryption_settings
  conditions:
    var: item.encryption_at_rest
    op: exists
- rule_id: aws.glue.trigger.event_sources_restricted
  for_each: aws.glue.get_crawlers
  conditions:
    var: item.state
    op: equals
    value: ENABLED
- rule_id: aws.glue.catalog.log_catalog_cross_account_sharing_restricted
  for_each: aws.glue.get_catalogs
  conditions:
    var: item.allow_full_table_external_data_access
    op: equals
    value: false
- rule_id: aws.glue.catalog.update_rbac_least_privilege
  for_each: aws.glue.get_catalogs
  conditions:
    all:
    - var: item.create_table_default_permissions
      op: equals
      value: []
    - var: item.create_database_default_permissions
      op: equals
      value: []
- rule_id: aws.glue.resource.catalog_passwords_encrypted
  for_each: aws.glue.get_data_catalog_encryption_settings
  conditions:
    var: item.connection_password_encryption
    op: exists
- rule_id: aws.glue.datalineage.export_destination_encrypted
  for_each: aws.glue.get_security_configurations
  conditions:
    var: item.encryption_configuration
    op: exists
- rule_id: aws.glue.crawler.logging_enabled
  for_each: aws.glue.get_crawlers
  conditions:
    var: item.state
    op: equals
    value: ENABLED
- rule_id: aws.glue.data_quality_ruleset.jobs_role_least_privilege
  for_each: aws.glue.get_crawlers
  conditions:
    var: item.role
    op: exists
- rule_id: aws.glue.catalog.rbac_least_privilege
  for_each: aws.glue.get_catalogs
  conditions:
    all:
    - var: item.create_table_default_permissions
      op: equals
      value: []
    - var: item.create_database_default_permissions
      op: equals
      value: []
- rule_id: aws.glue.catalog.audit_logging_enabled
  for_each: aws.glue.get_data_catalog_encryption_settings
  conditions:
    all:
    - var: item.encryption_at_rest
      op: exists
    - var: item.connection_password_encryption
      op: exists
- rule_id: aws.glue.workflow.execution_role_least_privilege
  for_each: aws.glue.get_crawlers
  conditions:
    var: item.role
    op: exists
- rule_id: aws.glue.connection.tls_required
  for_each: aws.glue.get_connections
  conditions:
    var: item.connection_properties
    op: contains
    value: Tls
- rule_id: aws.glue.devendpoint.role_least_privilege
  for_each: aws.glue.get_dev_endpoints
  conditions:
    var: item.role_arn
    op: exists
