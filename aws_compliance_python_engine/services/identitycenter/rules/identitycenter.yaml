version: '1.0'
provider: aws
service: identitystore
discovery:
- discovery_id: aws.identitycenter.groups
  calls:
  - client: identitystore
    action: list_users
    save_as: group_list
    on_error: continue
    fields:
    - Identitycenters
  emit:
    items_for: group_list[]
    as: group
    item:
      id: '{{ group.Id }}'
      name: '{{ group.Name }}'
- discovery_id: aws.identitycenter.users
  for_each: aws.identitycenter.user
  calls:
  - client: identitystore
    action: list_users
    save_as: users
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.identitycenter.permissionsets
  for_each: aws.identitycenter.permissionset
  calls:
  - client: identitystore
    action: describe_permissionsets
    save_as: permissionsets
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
checks:
- title: 'IDENTITYCENTER permissionset: Identitycenter Trust Principals Allowlist Only Configured'
  severity: medium
  rule_id: aws.identitycenter.permissionset.identitycenter_trust_principals_allowlist_only_configured
  for_each:
    discovery: aws.identitycenter.permissionsets
    as: permissionset
    item: permissionset
  conditions:
    var: permissionset.is_public
    op: equals
    value: false
  remediation: "Restrict public access for identitycenter permissionset:\n\n1. Open IDENTITYCENTER console\n2. Select the\
    \ permissionset\n3. Go to Permissions/Access Control\n4. Review current permissions:\n   - Remove public access grants\n\
    \   - Remove wildcard (*) principals\n   - Implement least privilege\n5. Update resource policy or IAM policies\n6. Enable\
    \ resource-level access control\n7. Save changes\n\nSecurity Recommendations:\n\u2022 Use IAM roles instead of access\
    \ keys\n\u2022 Implement condition keys for additional security\n\u2022 Enable MFA for sensitive operations\n\u2022 Regularly\
    \ audit access permissions\n\u2022 Use AWS Organizations SCPs for guardrails"
  references:
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: 'IDENTITYCENTER permissionset: Max Session Duration Configured'
  severity: medium
  rule_id: aws.identitycenter.permissionset.max_session_duration_configured
  for_each:
    discovery: aws.identitycenter.permissionsets
    as: permissionset
    item: permissionset
  conditions:
    var: permissionset.is_public
    op: equals
    value: false
  remediation: "Restrict public access for identitycenter permissionset:\n\n1. Open IDENTITYCENTER console\n2. Select the\
    \ permissionset\n3. Go to Permissions/Access Control\n4. Review current permissions:\n   - Remove public access grants\n\
    \   - Remove wildcard (*) principals\n   - Implement least privilege\n5. Update resource policy or IAM policies\n6. Enable\
    \ resource-level access control\n7. Save changes\n\nSecurity Recommendations:\n\u2022 Use IAM roles instead of access\
    \ keys\n\u2022 Implement condition keys for additional security\n\u2022 Enable MFA for sensitive operations\n\u2022 Regularly\
    \ audit access permissions\n\u2022 Use AWS Organizations SCPs for guardrails"
  references:
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: 'IDENTITYCENTER permissionset: Scopes Or Roles Least Privilege'
  severity: high
  rule_id: aws.identitycenter.permissionset.scopes_or_roles_least_privilege
  for_each:
    discovery: aws.identitycenter.permissionsets
    as: permissionset
    item: permissionset
  conditions:
    var: permissionset.is_public
    op: equals
    value: false
  remediation: "Restrict public access for identitycenter permissionset:\n\n1. Open IDENTITYCENTER console\n2. Select the\
    \ permissionset\n3. Go to Permissions/Access Control\n4. Review current permissions:\n   - Remove public access grants\n\
    \   - Remove wildcard (*) principals\n   - Implement least privilege\n5. Update resource policy or IAM policies\n6. Enable\
    \ resource-level access control\n7. Save changes\n\nSecurity Recommendations:\n\u2022 Use IAM roles instead of access\
    \ keys\n\u2022 Implement condition keys for additional security\n\u2022 Enable MFA for sensitive operations\n\u2022 Regularly\
    \ audit access permissions\n\u2022 Use AWS Organizations SCPs for guardrails"
  references:
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: 'IDENTITYCENTER permissionset: Identitycenter Workload Identity Federation Used If Supported'
  severity: medium
  rule_id: aws.identitycenter.permissionset.identitycenter_workload_identity_federation_used_if_supported
  for_each:
    discovery: aws.identitycenter.permissionsets
    as: permissionset
    item: permissionset
  conditions:
    var: permissionset.is_public
    op: equals
    value: false
  remediation: "Restrict public access for identitycenter permissionset:\n\n1. Open IDENTITYCENTER console\n2. Select the\
    \ permissionset\n3. Go to Permissions/Access Control\n4. Review current permissions:\n   - Remove public access grants\n\
    \   - Remove wildcard (*) principals\n   - Implement least privilege\n5. Update resource policy or IAM policies\n6. Enable\
    \ resource-level access control\n7. Save changes\n\nSecurity Recommendations:\n\u2022 Use IAM roles instead of access\
    \ keys\n\u2022 Implement condition keys for additional security\n\u2022 Enable MFA for sensitive operations\n\u2022 Regularly\
    \ audit access permissions\n\u2022 Use AWS Organizations SCPs for guardrails"
  references:
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: 'IDENTITYCENTER permissionset: Identitycenter No Inline Policies Configured'
  severity: medium
  rule_id: aws.identitycenter.permissionset.identitycenter_no_inline_policies_configured
  for_each:
    discovery: aws.identitycenter.permissionsets
    as: permissionset
    item: permissionset
  conditions:
    var: permissionset.is_public
    op: equals
    value: false
  remediation: "Restrict public access for identitycenter permissionset:\n\n1. Open IDENTITYCENTER console\n2. Select the\
    \ permissionset\n3. Go to Permissions/Access Control\n4. Review current permissions:\n   - Remove public access grants\n\
    \   - Remove wildcard (*) principals\n   - Implement least privilege\n5. Update resource policy or IAM policies\n6. Enable\
    \ resource-level access control\n7. Save changes\n\nSecurity Recommendations:\n\u2022 Use IAM roles instead of access\
    \ keys\n\u2022 Implement condition keys for additional security\n\u2022 Enable MFA for sensitive operations\n\u2022 Regularly\
    \ audit access permissions\n\u2022 Use AWS Organizations SCPs for guardrails"
  references:
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: 'IDENTITYCENTER permissionset: Keys Not Used Or Rotated 90 Days Or Less Configured'
  severity: medium
  rule_id: aws.identitycenter.permissionset.keys_not_used_or_rotated_90_days_or_less_configured
  for_each:
    discovery: aws.identitycenter.permissionsets
    as: permissionset
    item: permissionset
  conditions:
    var: permissionset.is_public
    op: equals
    value: false
  remediation: "Restrict public access for identitycenter permissionset:\n\n1. Open IDENTITYCENTER console\n2. Select the\
    \ permissionset\n3. Go to Permissions/Access Control\n4. Review current permissions:\n   - Remove public access grants\n\
    \   - Remove wildcard (*) principals\n   - Implement least privilege\n5. Update resource policy or IAM policies\n6. Enable\
    \ resource-level access control\n7. Save changes\n\nSecurity Recommendations:\n\u2022 Use IAM roles instead of access\
    \ keys\n\u2022 Implement condition keys for additional security\n\u2022 Enable MFA for sensitive operations\n\u2022 Regularly\
    \ audit access permissions\n\u2022 Use AWS Organizations SCPs for guardrails"
  references:
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: 'IDENTITYCENTER user: Console Password Present Only If Required'
  severity: critical
  rule_id: aws.identitycenter.user.console_password_present_only_if_required
  for_each:
    discovery: aws.identitycenter.users
    as: user
    item: user
  conditions:
    var: user.compliant
    op: equals
    value: true
  remediation: "Configure identitycenter user for compliance:\n\nRequirement: Console Password Present Only If Required\n\n\
    Description: Validates critical security configuration for AWS IDENTITYCENTER user to prevent security incidents that\
    \ could result in significant data breaches, compliance violations, or business disruption. This control addresses high-risk\
    \ vulnerabilities that require immediate remediation.\n\nSteps:\n1. Open IDENTITYCENTER console\n2. Select the user\n\
    3. Review security configuration\n4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save\
    \ changes\n\nGeneral Security Recommendations:\n\u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense\
    \ in depth\n\u2022 Enable logging and monitoring\n\u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: 'IDENTITYCENTER user: Access Keys Rotated 90 Days Or Less When Present'
  severity: medium
  rule_id: aws.identitycenter.user.access_keys_rotated_90_days_or_less_when_present
  for_each:
    discovery: aws.identitycenter.users
    as: user
    item: user
  conditions:
    var: user.is_public
    op: equals
    value: false
  remediation: "Restrict public access for identitycenter user:\n\n1. Open IDENTITYCENTER console\n2. Select the user\n3.\
    \ Go to Permissions/Access Control\n4. Review current permissions:\n   - Remove public access grants\n   - Remove wildcard\
    \ (*) principals\n   - Implement least privilege\n5. Update resource policy or IAM policies\n6. Enable resource-level\
    \ access control\n7. Save changes\n\nSecurity Recommendations:\n\u2022 Use IAM roles instead of access keys\n\u2022 Implement\
    \ condition keys for additional security\n\u2022 Enable MFA for sensitive operations\n\u2022 Regularly audit access permissions\n\
    \u2022 Use AWS Organizations SCPs for guardrails"
  references:
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: 'IDENTITYCENTER permissionset: Session Duration Reasonable If Applicable Configured'
  severity: medium
  rule_id: aws.identitycenter.permissionset.session_duration_reasonable_if_applicable_configured
  for_each:
    discovery: aws.identitycenter.permissionsets
    as: permissionset
    item: permissionset
  conditions:
    var: permissionset.is_public
    op: equals
    value: false
  remediation: "Restrict public access for identitycenter permissionset:\n\n1. Open IDENTITYCENTER console\n2. Select the\
    \ permissionset\n3. Go to Permissions/Access Control\n4. Review current permissions:\n   - Remove public access grants\n\
    \   - Remove wildcard (*) principals\n   - Implement least privilege\n5. Update resource policy or IAM policies\n6. Enable\
    \ resource-level access control\n7. Save changes\n\nSecurity Recommendations:\n\u2022 Use IAM roles instead of access\
    \ keys\n\u2022 Implement condition keys for additional security\n\u2022 Enable MFA for sensitive operations\n\u2022 Regularly\
    \ audit access permissions\n\u2022 Use AWS Organizations SCPs for guardrails"
  references:
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: 'IDENTITYCENTER user: Identitycenter No Inline Policies Enabled'
  severity: medium
  rule_id: aws.identitycenter.user.identitycenter_no_inline_policies_enabled
  for_each:
    discovery: aws.identitycenter.users
    as: user
    item: user
  conditions:
    var: user.compliant
    op: equals
    value: true
  remediation: "Configure identitycenter user for compliance:\n\nRequirement: Identitycenter No Inline Policies Enabled\n\n\
    Description: Verifies security configuration for AWS IDENTITYCENTER user to ensure alignment with AWS security best practices\
    \ and compliance requirements. Proper configuration reduces security risks, maintains defense in depth, and supports overall\
    \ security posture.\n\nSteps:\n1. Open IDENTITYCENTER console\n2. Select the user\n3. Review security configuration\n\
    4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\
    \u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\
    \u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: 'IDENTITYCENTER group: Identitycenter Membership Review Enabled If Supported'
  severity: medium
  rule_id: aws.identitycenter.group.identitycenter_membership_review_enabled_if_supported
  for_each:
    discovery: aws.identitycenter.groups
    as: group
    item: group
  conditions:
    var: group.compliant
    op: equals
    value: true
  remediation: "Configure identitycenter group for compliance:\n\nRequirement: Identitycenter Membership Review Enabled If\
    \ Supported\n\nDescription: Verifies security configuration for AWS IDENTITYCENTER group to ensure alignment with AWS\
    \ security best practices and compliance requirements. Proper configuration reduces security risks, maintains defense\
    \ in depth, and supports overall security posture.\n\nSteps:\n1. Open IDENTITYCENTER console\n2. Select the group\n3.\
    \ Review security configuration\n4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\
    \nGeneral Security Recommendations:\n\u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\
    \u2022 Enable logging and monitoring\n\u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: 'IDENTITYCENTER group: Identitycenter External Sharing Restricted If Supported'
  severity: medium
  rule_id: aws.identitycenter.group.identitycenter_external_sharing_restricted_if_supported
  for_each:
    discovery: aws.identitycenter.groups
    as: group
    item: group
  conditions:
    var: group.compliant
    op: equals
    value: true
  remediation: "Configure identitycenter group for compliance:\n\nRequirement: Identitycenter External Sharing Restricted\
    \ If Supported\n\nDescription: Verifies security configuration for AWS IDENTITYCENTER group to ensure alignment with AWS\
    \ security best practices and compliance requirements. Proper configuration reduces security risks, maintains defense\
    \ in depth, and supports overall security posture.\n\nSteps:\n1. Open IDENTITYCENTER console\n2. Select the group\n3.\
    \ Review security configuration\n4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\
    \nGeneral Security Recommendations:\n\u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\
    \u2022 Enable logging and monitoring\n\u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: 'IDENTITYCENTER user: Identitycenter Inactive 90 Days Disabled'
  severity: medium
  rule_id: aws.identitycenter.user.identitycenter_inactive_90_days_disabled
  for_each:
    discovery: aws.identitycenter.users
    as: user
    item: user
  conditions:
    var: user.compliant
    op: equals
    value: true
  remediation: "Configure identitycenter user for compliance:\n\nRequirement: Identitycenter Inactive 90 Days Disabled\n\n\
    Description: Verifies security configuration for AWS IDENTITYCENTER user to ensure alignment with AWS security best practices\
    \ and compliance requirements. Proper configuration reduces security risks, maintains defense in depth, and supports overall\
    \ security posture.\n\nSteps:\n1. Open IDENTITYCENTER console\n2. Select the user\n3. Review security configuration\n\
    4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\
    \u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\
    \u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: 'IDENTITYCENTER group: Identitycenter Attached Policies Not Admin Star Configured'
  severity: medium
  rule_id: aws.identitycenter.group.identitycenter_attached_policies_not_admin_star_configured
  for_each:
    discovery: aws.identitycenter.groups
    as: group
    item: group
  conditions:
    var: group.compliant
    op: equals
    value: true
  remediation: "Configure identitycenter group for compliance:\n\nRequirement: Identitycenter Attached Policies Not Admin\
    \ Star Configuration\n\nDescription: Verifies security configuration for AWS IDENTITYCENTER group to ensure alignment\
    \ with AWS security best practices and compliance requirements. Proper configuration reduces security risks, maintains\
    \ defense in depth, and supports overall security posture.\n\nSteps:\n1. Open IDENTITYCENTER console\n2. Select the group\n\
    3. Review security configuration\n4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save\
    \ changes\n\nGeneral Security Recommendations:\n\u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense\
    \ in depth\n\u2022 Enable logging and monitoring\n\u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: 'IDENTITYCENTER group: Identitycenter No Inline Policies Configured'
  severity: medium
  rule_id: aws.identitycenter.group.identitycenter_no_inline_policies_configured
  for_each:
    discovery: aws.identitycenter.groups
    as: group
    item: group
  conditions:
    var: group.compliant
    op: equals
    value: true
  remediation: "Configure identitycenter group for compliance:\n\nRequirement: Identitycenter No Inline Policies Configuration\n\
    \nDescription: Verifies security configuration for AWS IDENTITYCENTER group to ensure alignment with AWS security best\
    \ practices and compliance requirements. Proper configuration reduces security risks, maintains defense in depth, and\
    \ supports overall security posture.\n\nSteps:\n1. Open IDENTITYCENTER console\n2. Select the group\n3. Review security\
    \ configuration\n4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral\
    \ Security Recommendations:\n\u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable\
    \ logging and monitoring\n\u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: 'IDENTITYCENTER user: Mfa Required'
  severity: critical
  rule_id: aws.identitycenter.user.mfa_required
  for_each:
    discovery: aws.identitycenter.users
    as: user
    item: user
  conditions:
    var: user.compliant
    op: equals
    value: true
  remediation: "Configure identitycenter user for compliance:\n\nRequirement: Multi-Factor Authentication\n\nDescription:\
    \ Checks that AWS IDENTITYCENTER user requires multi-factor authentication (MFA) for access, combining something you know\
    \ (password) with something you have (token/device). MFA significantly reduces account compromise risk from phishing,\
    \ credential stuffing, and password reuse attacks.\n\nSteps:\n1. Open IDENTITYCENTER console\n2. Select the user\n3. Review\
    \ security configuration\n4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\
    \nGeneral Security Recommendations:\n\u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\
    \u2022 Enable logging and monitoring\n\u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: 'IDENTITYCENTER permissionset: Identitycenter Trust External Id Or Audience Required'
  severity: medium
  rule_id: aws.identitycenter.permissionset.identitycenter_trust_external_id_or_audience_required
  for_each:
    discovery: aws.identitycenter.permissionsets
    as: permissionset
    item: permissionset
  conditions:
    var: permissionset.is_public
    op: equals
    value: false
  remediation: "Restrict public access for identitycenter permissionset:\n\n1. Open IDENTITYCENTER console\n2. Select the\
    \ permissionset\n3. Go to Permissions/Access Control\n4. Review current permissions:\n   - Remove public access grants\n\
    \   - Remove wildcard (*) principals\n   - Implement least privilege\n5. Update resource policy or IAM policies\n6. Enable\
    \ resource-level access control\n7. Save changes\n\nSecurity Recommendations:\n\u2022 Use IAM roles instead of access\
    \ keys\n\u2022 Implement condition keys for additional security\n\u2022 Enable MFA for sensitive operations\n\u2022 Regularly\
    \ audit access permissions\n\u2022 Use AWS Organizations SCPs for guardrails"
  references:
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: 'IDENTITYCENTER permissionset: Identitycenter Attached Policies Not Admin Star Configured'
  severity: medium
  rule_id: aws.identitycenter.permissionset.identitycenter_attached_policies_not_admin_star_configured
  for_each:
    discovery: aws.identitycenter.permissionsets
    as: permissionset
    item: permissionset
  conditions:
    var: permissionset.is_public
    op: equals
    value: false
  remediation: "Restrict public access for identitycenter permissionset:\n\n1. Open IDENTITYCENTER console\n2. Select the\
    \ permissionset\n3. Go to Permissions/Access Control\n4. Review current permissions:\n   - Remove public access grants\n\
    \   - Remove wildcard (*) principals\n   - Implement least privilege\n5. Update resource policy or IAM policies\n6. Enable\
    \ resource-level access control\n7. Save changes\n\nSecurity Recommendations:\n\u2022 Use IAM roles instead of access\
    \ keys\n\u2022 Implement condition keys for additional security\n\u2022 Enable MFA for sensitive operations\n\u2022 Regularly\
    \ audit access permissions\n\u2022 Use AWS Organizations SCPs for guardrails"
  references:
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: 'IDENTITYCENTER permissionset: No User Managed Long Lived Keys Configured'
  severity: medium
  rule_id: aws.identitycenter.permissionset.no_user_managed_long_lived_keys_configured
  for_each:
    discovery: aws.identitycenter.permissionsets
    as: permissionset
    item: permissionset
  conditions:
    var: permissionset.is_public
    op: equals
    value: false
  remediation: "Restrict public access for identitycenter permissionset:\n\n1. Open IDENTITYCENTER console\n2. Select the\
    \ permissionset\n3. Go to Permissions/Access Control\n4. Review current permissions:\n   - Remove public access grants\n\
    \   - Remove wildcard (*) principals\n   - Implement least privilege\n5. Update resource policy or IAM policies\n6. Enable\
    \ resource-level access control\n7. Save changes\n\nSecurity Recommendations:\n\u2022 Use IAM roles instead of access\
    \ keys\n\u2022 Implement condition keys for additional security\n\u2022 Enable MFA for sensitive operations\n\u2022 Regularly\
    \ audit access permissions\n\u2022 Use AWS Organizations SCPs for guardrails"
  references:
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
