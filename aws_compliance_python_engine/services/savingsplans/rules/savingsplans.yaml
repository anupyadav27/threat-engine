version: '1.0'
provider: aws
service: savingsplans
services:
  client: savingsplans
  module: boto3.client
discovery:
- discovery_id: aws.savingsplans.describe_savings_plans
  calls:
  - action: describe_savings_plans
    save_as: response
  emit:
    item:
      offeringId: '{{ response.savingsPlans.offeringId }}'
      savingsPlanId: '{{ response.savingsPlans.savingsPlanId }}'
      savingsPlanArn: '{{ response.savingsPlans.savingsPlanArn }}'
      description: '{{ response.savingsPlans.description }}'
      start: '{{ response.savingsPlans.start }}'
      end: '{{ response.savingsPlans.end }}'
      state: '{{ response.savingsPlans.state }}'
      region: '{{ response.savingsPlans.region }}'
      ec2InstanceFamily: '{{ response.savingsPlans.ec2InstanceFamily }}'
      savingsPlanType: '{{ response.savingsPlans.savingsPlanType }}'
      paymentOption: '{{ response.savingsPlans.paymentOption }}'
      productTypes: '{{ response.savingsPlans.productTypes }}'
      currency: '{{ response.savingsPlans.currency }}'
      commitment: '{{ response.savingsPlans.commitment }}'
      upfrontPaymentAmount: '{{ response.savingsPlans.upfrontPaymentAmount }}'
      recurringPaymentAmount: '{{ response.savingsPlans.recurringPaymentAmount }}'
      termDurationInSeconds: '{{ response.savingsPlans.termDurationInSeconds }}'
      tags: '{{ response.savingsPlans.tags }}'
      returnableUntil: '{{ response.savingsPlans.returnableUntil }}'
checks:
- rule_id: aws.savingsplans.savingsplan.savingsplans_approval_workflow_required
  for_each: aws.savingsplans.describe_savings_plans
  conditions:
    var: item.state
    op: equals
    value: ACTIVE
- rule_id: aws.savingsplans.savingsplan.billing_admins_mfa_required
  for_each: aws.savingsplans.describe_savings_plans
  conditions:
    var: item.state
    op: equals
    value: ACTIVE
