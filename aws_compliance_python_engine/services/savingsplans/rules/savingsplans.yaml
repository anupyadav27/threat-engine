version: '1.0'
provider: aws
service: savingsplans
discovery:
- discovery_id: aws.savingsplans.savingsplans
  calls:
  - client: savingsplans
    action: list_tags_for_resource
    save_as: savingsplan_list
    on_error: continue
    fields:
    - Savingsplanss
  emit:
    items_for: savingsplan_list[]
    as: savingsplan
    item:
      id: '{{ savingsplan.Id }}'
      name: '{{ savingsplan.Name }}'
checks:
- title: 'SAVINGSPLANS savingsplan: Savingsplans Approval Workflow Required'
  severity: medium
  rule_id: aws.savingsplans.savingsplan.savingsplans_approval_workflow_required
  for_each:
    discovery: aws.savingsplans.savingsplans
    as: savingsplan
    item: savingsplan
  conditions:
    var: savingsplan.compliant
    op: equals
    value: true
  remediation: "Configure savingsplans savingsplan for compliance:\n\nRequirement: Savingsplans Approval Workflow Required\n\
    \nDescription: Verifies security configuration for AWS SAVINGSPLANS savingsplan to ensure alignment with AWS security\
    \ best practices and compliance requirements. Proper configuration reduces security risks, maintains defense in depth,\
    \ and supports overall security posture.\n\nSteps:\n1. Open SAVINGSPLANS console\n2. Select the savingsplan\n3. Review\
    \ security configuration\n4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\
    \nGeneral Security Recommendations:\n\u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\
    \u2022 Enable logging and monitoring\n\u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: 'SAVINGSPLANS savingsplan: Purchase Permissions Restricted'
  severity: high
  rule_id: aws.savingsplans.savingsplan.purchase_permissions_restricted
  for_each:
    discovery: aws.savingsplans.savingsplans
    as: savingsplan
    item: savingsplan
  conditions:
    var: savingsplan.is_public
    op: equals
    value: false
  remediation: "Restrict public access for savingsplans savingsplan:\n\n1. Open SAVINGSPLANS console\n2. Select the savingsplan\n\
    3. Go to Permissions/Access Control\n4. Review current permissions:\n   - Remove public access grants\n   - Remove wildcard\
    \ (*) principals\n   - Implement least privilege\n5. Update resource policy or IAM policies\n6. Enable resource-level\
    \ access control\n7. Save changes\n\nSecurity Recommendations:\n\u2022 Use IAM roles instead of access keys\n\u2022 Implement\
    \ condition keys for additional security\n\u2022 Enable MFA for sensitive operations\n\u2022 Regularly audit access permissions\n\
    \u2022 Use AWS Organizations SCPs for guardrails"
  references:
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: 'SAVINGSPLANS savingsplan: Billing Admins Mfa Required'
  severity: critical
  rule_id: aws.savingsplans.savingsplan.billing_admins_mfa_required
  for_each:
    discovery: aws.savingsplans.savingsplans
    as: savingsplan
    item: savingsplan
  conditions:
    var: savingsplan.compliant
    op: equals
    value: true
  remediation: "Configure savingsplans savingsplan for compliance:\n\nRequirement: Multi-Factor Authentication\n\nDescription:\
    \ Checks that AWS SAVINGSPLANS savingsplan requires multi-factor authentication (MFA) for access, combining something\
    \ you know (password) with something you have (token/device). MFA significantly reduces account compromise risk from phishing,\
    \ credential stuffing, and password reuse attacks.\n\nSteps:\n1. Open SAVINGSPLANS console\n2. Select the savingsplan\n\
    3. Review security configuration\n4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save\
    \ changes\n\nGeneral Security Recommendations:\n\u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense\
    \ in depth\n\u2022 Enable logging and monitoring\n\u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
