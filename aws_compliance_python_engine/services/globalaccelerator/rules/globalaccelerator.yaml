version: '1.0'
provider: aws
service: globalaccelerator
services:
  client: globalaccelerator
  module: boto3.client
discovery:
- discovery_id: aws.globalaccelerator.list_accelerators
  calls:
  - action: list_accelerators
    save_as: response
  emit:
    items_for: '{{ response.Accelerators }}'
    as: resource
    item:
      AcceleratorArn: '{{ resource.AcceleratorArn }}'
      Name: '{{ resource.Name }}'
      IpAddressType: '{{ resource.IpAddressType }}'
      Enabled: '{{ resource.Enabled }}'
      IpSets: '{{ resource.IpSets }}'
      DnsName: '{{ resource.DnsName }}'
      Status: '{{ resource.Status }}'
      CreatedTime: '{{ resource.CreatedTime }}'
      LastModifiedTime: '{{ resource.LastModifiedTime }}'
      DualStackDnsName: '{{ resource.DualStackDnsName }}'
      Events: '{{ resource.Events }}'
- discovery_id: aws.globalaccelerator.list_cross_account_attachments
  calls:
  - action: list_cross_account_attachments
    save_as: response
  emit:
    items_for: '{{ response.CrossAccountAttachments }}'
    as: resource
    item:
      AttachmentArn: '{{ resource.AttachmentArn }}'
      Name: '{{ resource.Name }}'
      Principals: '{{ resource.Principals }}'
      Resources: '{{ resource.Resources }}'
      LastModifiedTime: '{{ resource.LastModifiedTime }}'
      CreatedTime: '{{ resource.CreatedTime }}'
checks:
- rule_id: aws.globalaccelerator.accelerator.access_logs_enabled
  for_each: aws.globalaccelerator.list_accelerators
  conditions:
    var: item.Enabled
    op: equals
    value: true
- rule_id: aws.globalaccelerator.accelerator.listener_tls_min_1_2_configured
  for_each: aws.globalaccelerator.list_accelerators
  conditions:
    var: item.Enabled
    op: equals
    value: 'true'
- rule_id: aws.globalaccelerator.accelerator.valid_certificate_enabled
  for_each: aws.globalaccelerator.list_accelerators
  conditions:
    var: item.Enabled
    op: equals
    value: true
- rule_id: aws.globalaccelerator.accelerator.waf_attached_if_supported
  for_each: aws.globalaccelerator.list_cross_account_attachments
  conditions:
    var: item.AttachmentArn
    op: not_equals
    value: 'null'
