version: '1.0'
provider: aws
service: organizations
discovery:
- discovery_id: aws.organizations.policys
  calls:
  - client: organizations
    action: list_accounts
    save_as: policy_list
    on_error: continue
    fields:
    - Organizationss
  emit:
    items_for: policy_list[]
    as: policy
    item:
      id: '{{ policy.Id }}'
      name: '{{ policy.Name }}'
- discovery_id: aws.organizations.resources
  for_each: aws.organizations.resource
  calls:
  - client: organizations
    action: describe_account
    save_as: resources
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.organizations.accounts
  for_each: aws.organizations.account
  calls:
  - client: organizations
    action: describe_account
    save_as: accounts
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.organizations.organizational_units
  for_each: aws.organizations.organizational_unit
  calls:
  - client: organizations
    action: describe_account
    save_as: organizational_units
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.organizations.service_control_policys
  for_each: aws.organizations.service_control_policy
  calls:
  - client: organizations
    action: describe_account
    save_as: service_control_policys
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.organizations.organizations
  for_each: aws.organizations.organization
  calls:
  - client: organizations
    action: describe_account
    save_as: organizations
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.organizations.policy_logging
  calls:
  - client: organizations
    action: list_accounts
    save_as: policy_logging
    on_error: continue
  emit:
    items_for: policy_logging[]
    as: policy_logging
    item:
      id: '{{ policy_logging.Id }}'
      compliant: '{{ true }}'
checks:
- title: 'ORGANIZATIONS service control policy: Organizations Mandatory Block Disabling
    Guardrail Services Configured'
  severity: medium
  rule_id: aws.organizations.service_control_policy.organizations_mandatory_block_disabling_guardrail_services_configured
  for_each:
    discovery: aws.organizations.service_control_policys
    as: service_control_policy
    item: service_control_policy
  conditions:
    var: service_control_policy.is_public
    op: equals
    value: false
- title: 'ORGANIZATIONS organization: Inactive User Disable Threshold Configured'
  severity: medium
  rule_id: aws.organizations.organization.inactive_user_disable_threshold_configured
  for_each:
    discovery: aws.organizations.organizations
    as: organization
    item: organization
  conditions:
    var: organization.compliant
    op: equals
    value: true
- title: 'ORGANIZATIONS service control policy: Mandatory Deny Iam Star Admin Configured'
  severity: high
  rule_id: aws.organizations.service_control_policy.mandatory_deny_iam_star_admin_configured
  for_each:
    discovery: aws.organizations.service_control_policys
    as: service_control_policy
    item: service_control_policy
  conditions:
    var: service_control_policy.is_public
    op: equals
    value: false
- title: 'ORGANIZATIONS account: Break Glass S Mfa Enforced'
  severity: critical
  rule_id: aws.organizations.account.break_glass_s_mfa_enforced
  for_each:
    discovery: aws.organizations.accounts
    as: account
    item: account
  conditions:
    var: account.compliant
    op: equals
    value: true
- title: 'ORGANIZATIONS account: Organizations Lockout Threshold Configured'
  severity: medium
  rule_id: aws.organizations.account.organizations_lockout_threshold_configured
  for_each:
    discovery: aws.organizations.accounts
    as: account
    item: account
  conditions:
    var: account.compliant
    op: equals
    value: true
- title: 'ORGANIZATIONS organizational unit: Organizations No Overly Permissive Exceptions
    Configured'
  severity: medium
  rule_id: aws.organizations.organizational_unit.organizations_no_overly_permissive_exceptions_configured
  for_each:
    discovery: aws.organizations.organizational_units
    as: organizational_unit
    item: organizational_unit
  conditions:
    var: organizational_unit.compliant
    op: equals
    value: true
- title: 'ORGANIZATIONS policy: Organizations No Wildcard Admin Actions Configured'
  severity: medium
  rule_id: aws.organizations.policy.organizations_no_wildcard_admin_actions_configured
  for_each:
    discovery: aws.organizations.policys
    as: policy
    item: policy
  conditions:
    var: policy.is_public
    op: equals
    value: false
- title: 'ORGANIZATIONS organization: Organizations Sso Federation Configured If Supported'
  severity: medium
  rule_id: aws.organizations.organization.organizations_sso_federation_configured_if_supported
  for_each:
    discovery: aws.organizations.organizations
    as: organization
    item: organization
  conditions:
    var: organization.compliant
    op: equals
    value: true
- title: 'ORGANIZATIONS account: Inactive User Disable Threshold Configured'
  severity: medium
  rule_id: aws.organizations.account.inactive_user_disable_threshold_configured
  for_each:
    discovery: aws.organizations.accounts
    as: account
    item: account
  conditions:
    var: account.compliant
    op: equals
    value: true
- title: 'ORGANIZATIONS organization: Api Access Keys Root Or Owner Disallowed Configured'
  severity: medium
  rule_id: aws.organizations.organization.api_access_keys_root_or_owner_disallowed_configured
  for_each:
    discovery: aws.organizations.organizations
    as: organization
    item: organization
  conditions:
    var: organization.is_public
    op: equals
    value: false
- title: 'ORGANIZATIONS organization: Organizations Lockout Threshold Configured'
  severity: medium
  rule_id: aws.organizations.organization.organizations_lockout_threshold_configured
  for_each:
    discovery: aws.organizations.organizations
    as: organization
    item: organization
  conditions:
    var: organization.compliant
    op: equals
    value: true
- title: 'ORGANIZATIONS policy: Editors Rbac Least Privilege'
  severity: high
  rule_id: aws.organizations.policy.editors_rbac_least_privilege
  for_each:
    discovery: aws.organizations.policys
    as: policy
    item: policy
  conditions:
    var: policy.is_public
    op: equals
    value: false
- title: 'ORGANIZATIONS account: Password Policy Compliant'
  severity: high
  rule_id: aws.organizations.account.password_policy_compliant
  for_each:
    discovery: aws.organizations.accounts
    as: account
    item: account
  conditions:
    var: account.is_public
    op: equals
    value: false
- title: 'ORGANIZATIONS account: Organizations Part Of Organizations Configured'
  severity: medium
  rule_id: aws.organizations.account.organizations_part_of_organizations_configured
  for_each:
    discovery: aws.organizations.accounts
    as: account
    item: account
  conditions:
    var: account.compliant
    op: equals
    value: true
- title: 'ORGANIZATIONS resource: Organizations Tags Policies Enabled And'
  severity: medium
  rule_id: aws.organizations.resource.organizations_tags_policies_enabled_and
  for_each:
    discovery: aws.organizations.resources
    as: resource
    item: resource
  conditions:
    var: resource.compliant
    op: equals
    value: true
- title: 'ORGANIZATIONS account: No Public Admin Roles Configured'
  severity: high
  rule_id: aws.organizations.account.no_public_admin_roles_configured
  for_each:
    discovery: aws.organizations.accounts
    as: account
    item: account
  conditions:
    var: account.is_public
    op: equals
    value: false
- title: 'ORGANIZATIONS organization: Organizations Min Length 14 Configured'
  severity: medium
  rule_id: aws.organizations.organization.organizations_min_length_14_configured
  for_each:
    discovery: aws.organizations.organizations
    as: organization
    item: organization
  conditions:
    var: organization.compliant
    op: equals
    value: true
- title: 'ORGANIZATIONS organization: Organizations All Accounts Enrolled In Org Configured'
  severity: medium
  rule_id: aws.organizations.organization.organizations_all_accounts_enrolled_in_org_configured
  for_each:
    discovery: aws.organizations.organizations
    as: organization
    item: organization
  conditions:
    var: organization.compliant
    op: equals
    value: true
- title: 'ORGANIZATIONS account: Organizations Max Age 90 Days Or Less Configured'
  severity: medium
  rule_id: aws.organizations.account.organizations_max_age_90_days_or_less_configured
  for_each:
    discovery: aws.organizations.accounts
    as: account
    item: account
  conditions:
    var: account.compliant
    op: equals
    value: true
- title: 'ORGANIZATIONS organization: Organizations Prevent Reuse Last 24 Configured'
  severity: medium
  rule_id: aws.organizations.organization.organizations_prevent_reuse_last_24_configured
  for_each:
    discovery: aws.organizations.organizations
    as: organization
    item: organization
  conditions:
    var: organization.compliant
    op: equals
    value: true
- title: 'ORGANIZATIONS account: Api Access Keys Root Or Owner Disallowed Configured'
  severity: medium
  rule_id: aws.organizations.account.api_access_keys_root_or_owner_disallowed_configured
  for_each:
    discovery: aws.organizations.accounts
    as: account
    item: account
  conditions:
    var: account.is_public
    op: equals
    value: false
- title: 'ORGANIZATIONS service control policy: Organizations No Allow Star On Star
    Resources Configured'
  severity: medium
  rule_id: aws.organizations.service_control_policy.organizations_no_allow_star_on_star_resources_configured
  for_each:
    discovery: aws.organizations.service_control_policys
    as: service_control_policy
    item: service_control_policy
  conditions:
    var: service_control_policy.is_public
    op: equals
    value: false
- title: Trust relationships are properly managed
  severity: low
  rule_id: aws.organizations.account.console_mfa_required_org_wide
  for_each:
    discovery: aws.organizations.accounts
    as: account
    item: account
  conditions:
    var: account.compliant
    op: equals
    value: true
- title: 'ORGANIZATIONS account: Organizations Sso Federation Configured If Supported'
  severity: medium
  rule_id: aws.organizations.account.organizations_sso_federation_configured_if_supported
  for_each:
    discovery: aws.organizations.accounts
    as: account
    item: account
  conditions:
    var: account.compliant
    op: equals
    value: true
- title: 'ORGANIZATIONS account: Organizations Require Upper Lower Number Special
    Configured'
  severity: medium
  rule_id: aws.organizations.account.organizations_require_upper_lower_number_special_configured
  for_each:
    discovery: aws.organizations.accounts
    as: account
    item: account
  conditions:
    var: account.compliant
    op: equals
    value: true
- title: 'ORGANIZATIONS account: Organizations Required Guardrail Policies Enabled'
  severity: medium
  rule_id: aws.organizations.account.organizations_required_guardrail_policies_enabled
  for_each:
    discovery: aws.organizations.accounts
    as: account
    item: account
  conditions:
    var: account.compliant
    op: equals
    value: true
- title: 'ORGANIZATIONS service control policy: Mandatory Require Mfa For Console
    If Supported'
  severity: critical
  rule_id: aws.organizations.service_control_policy.mandatory_require_mfa_for_console_if_supported
  for_each:
    discovery: aws.organizations.service_control_policys
    as: service_control_policy
    item: service_control_policy
  conditions:
    var: service_control_policy.is_public
    op: equals
    value: false
- title: 'ORGANIZATIONS account: Organizations Prevent Reuse Last 24 Configured'
  severity: medium
  rule_id: aws.organizations.account.organizations_prevent_reuse_last_24_configured
  for_each:
    discovery: aws.organizations.accounts
    as: account
    item: account
  conditions:
    var: account.compliant
    op: equals
    value: true
- title: 'ORGANIZATIONS organization: Organizations Scps Enabled'
  severity: medium
  rule_id: aws.organizations.organization.organizations_scps_enabled
  for_each:
    discovery: aws.organizations.organizations
    as: organization
    item: organization
  conditions:
    var: organization.compliant
    op: equals
    value: true
- title: 'ORGANIZATIONS organization: Organizations Max Age 90 Days Or Less Configured'
  severity: medium
  rule_id: aws.organizations.organization.organizations_max_age_90_days_or_less_configured
  for_each:
    discovery: aws.organizations.organizations
    as: organization
    item: organization
  conditions:
    var: organization.compliant
    op: equals
    value: true
- title: 'ORGANIZATIONS account: Security Services Mandatory Enabled'
  severity: medium
  rule_id: aws.organizations.account.security_services_mandatory_enabled
  for_each:
    discovery: aws.organizations.accounts
    as: account
    item: account
  conditions:
    var: account.compliant
    op: equals
    value: true
- title: 'ORGANIZATIONS organization: Block Leave Org By Policy Configured'
  severity: high
  rule_id: aws.organizations.organization.block_leave_org_by_policy_configured
  for_each:
    discovery: aws.organizations.organizations
    as: organization
    item: organization
  conditions:
    var: organization.is_public
    op: equals
    value: false
- title: 'ORGANIZATIONS organizational unit: Organizations Required Scps Enabled'
  severity: medium
  rule_id: aws.organizations.organizational_unit.organizations_required_scps_enabled
  for_each:
    discovery: aws.organizations.organizational_units
    as: organizational_unit
    item: organizational_unit
  conditions:
    var: organizational_unit.compliant
    op: equals
    value: true
- title: 'ORGANIZATIONS organization: Organizations Require Upper Lower Number Special
    Configured'
  severity: medium
  rule_id: aws.organizations.organization.organizations_require_upper_lower_number_special_configured
  for_each:
    discovery: aws.organizations.organizations
    as: organization
    item: organization
  conditions:
    var: organization.compliant
    op: equals
    value: true
- title: 'ORGANIZATIONS organizational unit: Organizations Auto Tag Policies Enabled
    If Supported'
  severity: medium
  rule_id: aws.organizations.organizational_unit.organizations_auto_tag_policies_enabled_if_supported
  for_each:
    discovery: aws.organizations.organizational_units
    as: organizational_unit
    item: organizational_unit
  conditions:
    var: organizational_unit.compliant
    op: equals
    value: true
- title: 'ORGANIZATIONS account: Organizations Min Length 14 Configured'
  severity: medium
  rule_id: aws.organizations.account.organizations_min_length_14_configured
  for_each:
    discovery: aws.organizations.accounts
    as: account
    item: account
  conditions:
    var: account.compliant
    op: equals
    value: true
- title: Require approval for exceptions
  severity: medium
  rule_id: aws.organizations.organization.console_mfa_required_org_wide
  for_each:
    discovery: aws.organizations.organizations
    as: organization
    item: organization
  conditions:
    var: organization.compliant
    op: equals
    value: true
- title: 'ORGANIZATIONS organization: Break Glass Accounts Mfa Enforced'
  severity: critical
  rule_id: aws.organizations.organization.break_glass_accounts_mfa_enforced
  for_each:
    discovery: aws.organizations.organizations
    as: organization
    item: organization
  conditions:
    var: organization.compliant
    op: equals
    value: true
- title: 'ORGANIZATIONS organization: Restrict Region Usage By Policy Where Required'
  severity: high
  rule_id: aws.organizations.organization.restrict_region_usage_by_policy_where_required
  for_each:
    discovery: aws.organizations.organizations
    as: organization
    item: organization
  conditions:
    var: organization.is_public
    op: equals
    value: false
- title: 'ORGANIZATIONS policy: Versioning And Change Audit Enabled'
  severity: medium
  rule_id: aws.organizations.policy.versioning_and_change_audit_enabled
  for_each:
    discovery: aws.organizations.policy_logging
    as: policy
    item: policy
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'ORGANIZATIONS organization: Password Policy Compliant'
  severity: high
  rule_id: aws.organizations.organization.password_policy_compliant
  for_each:
    discovery: aws.organizations.organizations
    as: organization
    item: organization
  conditions:
    var: organization.is_public
    op: equals
    value: false
