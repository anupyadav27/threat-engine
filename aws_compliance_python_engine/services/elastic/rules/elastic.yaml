version: '1.0'
provider: aws
service: elastic
services:
  client: elastic
  module: boto3.client
discovery:
- discovery_id: aws.elastic.describe_inbound_cross_cluster_search_connections
  calls:
  - action: describe_inbound_cross_cluster_search_connections
    save_as: response
  emit:
    item:
      SourceDomainInfo: '{{ response.CrossClusterSearchConnections.SourceDomainInfo
        }}'
      DestinationDomainInfo: '{{ response.CrossClusterSearchConnections.DestinationDomainInfo
        }}'
      CrossClusterSearchConnectionId: '{{ response.CrossClusterSearchConnections.CrossClusterSearchConnectionId
        }}'
      ConnectionStatus: '{{ response.CrossClusterSearchConnections.ConnectionStatus
        }}'
      Status: '{{ resource.Status }}'
checks:
- rule_id: aws.elastic.resource.disaster_recovery_drill_execution_configured
  for_each: aws.elastic.describe_inbound_cross_cluster_search_connections
  conditions:
    var: item.Status
    op: not_equals
    value: DELETE_FAILED
