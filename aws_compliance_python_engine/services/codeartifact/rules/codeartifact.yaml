version: '1.0'
provider: aws
service: codeartifact
services:
  client: codeartifact
  module: boto3.client
discovery:
- discovery_id: aws.codeartifact.list_domains
  calls:
  - action: list_domains
    save_as: response
  emit:
    items_for: '{{ response.domains }}'
    as: resource
    item:
      name: '{{ resource.name }}'
      owner: '{{ resource.owner }}'
      arn: '{{ resource.arn }}'
      status: '{{ resource.status }}'
      createdTime: '{{ resource.createdTime }}'
      encryptionKey: '{{ resource.encryptionKey }}'
checks:
- rule_id: aws.codeartifact.resource.packages_external_public_publishing_disabled
  for_each: aws.codeartifact.list_domains
  conditions:
    var: item.status
    op: not_equals
    value: Deleted
