version: 1.0
provider: aws
service: ecr
discovery:
  discovery_id: aws.ecr.resources
  calls:
    - client: ecr
      action: describe_ecrs
      paginate: true
  fields:
    - name: id
      save_as: resource_id
  emit:
    items_for:
      as: resource
      item: resource_id
checks:
  - title: Vulnerability Scanning Enabled
    severity: low
    rule_id: aws.ecr.image_scanning.vulnerability_scanning_enabled
    assertion_id: containers_kubernetes.image_security.vulnerability_scanning_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement vulnerability scanning enabled for ecr"
    references:
      - "https://docs.aws.amazon.com/ecr/"
  - title: Vulnerability Scanning Enabled
    severity: low
    rule_id: aws.ecr.image_vulnerability_scanning.vulnerability_scanning_enabled
    assertion_id: containers_kubernetes.image_security.vulnerability_scanning_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement vulnerability scanning enabled for ecr"
    references:
      - "https://docs.aws.amazon.com/ecr/"
  - title: Vulnerability Scanning Enabled
    severity: low
    rule_id: aws.ecr.image_signing.vulnerability_scanning_enabled
    assertion_id: containers_kubernetes.image_security.vulnerability_scanning_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement vulnerability scanning enabled for ecr"
    references:
      - "https://docs.aws.amazon.com/ecr/"
  - title: Base Images Approved
    severity: low
    rule_id: aws.ecr.image_scanning.base_images_approved
    assertion_id: containers_kubernetes.image_security.base_images_approved
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement base images approved for ecr"
    references:
      - "https://docs.aws.amazon.com/ecr/"
  - title: Base Images Approved
    severity: low
    rule_id: aws.ecr.image_vulnerability_scanning.base_images_approved
    assertion_id: containers_kubernetes.image_security.base_images_approved
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement base images approved for ecr"
    references:
      - "https://docs.aws.amazon.com/ecr/"
  - title: Base Images Approved
    severity: low
    rule_id: aws.ecr.image_signing.base_images_approved
    assertion_id: containers_kubernetes.image_security.base_images_approved
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement base images approved for ecr"
    references:
      - "https://docs.aws.amazon.com/ecr/"
  - title: Image Signing Enabled
    severity: low
    rule_id: aws.ecr.image_scanning.image_signing_enabled
    assertion_id: containers_kubernetes.image_security.image_signing_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement image signing enabled for ecr"
    references:
      - "https://docs.aws.amazon.com/ecr/"
  - title: Image Signing Enabled
    severity: low
    rule_id: aws.ecr.image_vulnerability_scanning.image_signing_enabled
    assertion_id: containers_kubernetes.image_security.image_signing_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement image signing enabled for ecr"
    references:
      - "https://docs.aws.amazon.com/ecr/"
  - title: Image Signing Enabled
    severity: low
    rule_id: aws.ecr.image_signing.image_signing_enabled
    assertion_id: containers_kubernetes.image_security.image_signing_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement image signing enabled for ecr"
    references:
      - "https://docs.aws.amazon.com/ecr/"
  - title: Access Control Enforced
    severity: low
    rule_id: aws.ecr.registry_security.access_control_enforced
    assertion_id: supply_chain_registries.registry_security.access_control_enforced
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement access control enforced for ecr"
    references:
      - "https://docs.aws.amazon.com/ecr/"
  - title: Access Control Enforced
    severity: low
    rule_id: aws.ecr.repository_policies.access_control_enforced
    assertion_id: supply_chain_registries.registry_security.access_control_enforced
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement access control enforced for ecr"
    references:
      - "https://docs.aws.amazon.com/ecr/"
  - title: Access Control Enforced
    severity: low
    rule_id: aws.ecr.lifecycle_policies.access_control_enforced
    assertion_id: supply_chain_registries.registry_security.access_control_enforced
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement access control enforced for ecr"
    references:
      - "https://docs.aws.amazon.com/ecr/"
  - title: Vulnerability Scanning Enabled
    severity: low
    rule_id: aws.ecr.registry_security.vulnerability_scanning_enabled
    assertion_id: supply_chain_registries.registry_security.vulnerability_scanning_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement vulnerability scanning enabled for ecr"
    references:
      - "https://docs.aws.amazon.com/ecr/"
  - title: Vulnerability Scanning Enabled
    severity: low
    rule_id: aws.ecr.repository_policies.vulnerability_scanning_enabled
    assertion_id: supply_chain_registries.registry_security.vulnerability_scanning_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement vulnerability scanning enabled for ecr"
    references:
      - "https://docs.aws.amazon.com/ecr/"
  - title: Vulnerability Scanning Enabled
    severity: low
    rule_id: aws.ecr.lifecycle_policies.vulnerability_scanning_enabled
    assertion_id: supply_chain_registries.registry_security.vulnerability_scanning_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement vulnerability scanning enabled for ecr"
    references:
      - "https://docs.aws.amazon.com/ecr/"
  - title: Immutable Tags Enforced
    severity: low
    rule_id: aws.ecr.registry_security.immutable_tags_enforced
    assertion_id: supply_chain_registries.registry_security.immutable_tags_enforced
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement immutable tags enforced for ecr"
    references:
      - "https://docs.aws.amazon.com/ecr/"
  - title: Immutable Tags Enforced
    severity: low
    rule_id: aws.ecr.repository_policies.immutable_tags_enforced
    assertion_id: supply_chain_registries.registry_security.immutable_tags_enforced
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement immutable tags enforced for ecr"
    references:
      - "https://docs.aws.amazon.com/ecr/"
  - title: Immutable Tags Enforced
    severity: low
    rule_id: aws.ecr.lifecycle_policies.immutable_tags_enforced
    assertion_id: supply_chain_registries.registry_security.immutable_tags_enforced
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement immutable tags enforced for ecr"
    references:
      - "https://docs.aws.amazon.com/ecr/"
  - title: Dependency Scanning Enabled
    severity: low
    rule_id: aws.ecr.dependency_scanning.dependency_scanning_enabled
    assertion_id: supply_chain_registries.dependency_management.dependency_scanning_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement dependency scanning enabled for ecr"
    references:
      - "https://docs.aws.amazon.com/ecr/"
  - title: Dependency Scanning Enabled
    severity: low
    rule_id: aws.ecr.software_bill_of_materials.dependency_scanning_enabled
    assertion_id: supply_chain_registries.dependency_management.dependency_scanning_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement dependency scanning enabled for ecr"
    references:
      - "https://docs.aws.amazon.com/ecr/"
  - title: License Compliance Checked
    severity: low
    rule_id: aws.ecr.dependency_scanning.license_compliance_checked
    assertion_id: supply_chain_registries.dependency_management.license_compliance_checked
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement license compliance checked for ecr"
    references:
      - "https://docs.aws.amazon.com/ecr/"
  - title: License Compliance Checked
    severity: low
    rule_id: aws.ecr.software_bill_of_materials.license_compliance_checked
    assertion_id: supply_chain_registries.dependency_management.license_compliance_checked
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement license compliance checked for ecr"
    references:
      - "https://docs.aws.amazon.com/ecr/"
  - title: Outdated Dependencies Blocked
    severity: low
    rule_id: aws.ecr.dependency_scanning.outdated_dependencies_blocked
    assertion_id: supply_chain_registries.dependency_management.outdated_dependencies_blocked
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement outdated dependencies blocked for ecr"
    references:
      - "https://docs.aws.amazon.com/ecr/"
  - title: Outdated Dependencies Blocked
    severity: low
    rule_id: aws.ecr.software_bill_of_materials.outdated_dependencies_blocked
    assertion_id: supply_chain_registries.dependency_management.outdated_dependencies_blocked
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement outdated dependencies blocked for ecr"
    references:
      - "https://docs.aws.amazon.com/ecr/"
  - title: Continuous Scanning Enabled
    severity: low
    rule_id: aws.ecr.vulnerability_scanning.continuous_scanning_enabled
    assertion_id: supply_chain_registries.vulnerability_scanning.continuous_scanning_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement continuous scanning enabled for ecr"
    references:
      - "https://docs.aws.amazon.com/ecr/"
  - title: Critical Vulnerabilities Blocked
    severity: low
    rule_id: aws.ecr.vulnerability_scanning.critical_vulnerabilities_blocked
    assertion_id: supply_chain_registries.vulnerability_scanning.critical_vulnerabilities_blocked
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement critical vulnerabilities blocked for ecr"
    references:
      - "https://docs.aws.amazon.com/ecr/"
  - title: Digital Signatures Verified
    severity: low
    rule_id: aws.ecr.image_signing.digital_signatures_verified
    assertion_id: supply_chain_registries.signing_verification.digital_signatures_verified
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement digital signatures verified for ecr"
    references:
      - "https://docs.aws.amazon.com/ecr/"
  - title: Chain Of Trust Maintained
    severity: low
    rule_id: aws.ecr.image_signing.chain_of_trust_maintained
    assertion_id: supply_chain_registries.signing_verification.chain_of_trust_maintained
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement chain of trust maintained for ecr"
    references:
      - "https://docs.aws.amazon.com/ecr/"
