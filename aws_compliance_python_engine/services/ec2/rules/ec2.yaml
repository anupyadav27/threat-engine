version: '1.0'
provider: aws
service: ec2
services:
  client: ec2
  module: boto3.client
discovery:
- discovery_id: aws.ec2.authorize_security_group_ingress
  calls:
  - action: authorize_security_group_ingress
    save_as: response
  emit:
    item:
      SecurityGroupRuleId: '{{ response.SecurityGroupRules.SecurityGroupRuleId }}'
      GroupId: '{{ response.SecurityGroupRules.GroupId }}'
      GroupOwnerId: '{{ response.SecurityGroupRules.GroupOwnerId }}'
      IsEgress: '{{ response.SecurityGroupRules.IsEgress }}'
      IpProtocol: '{{ response.SecurityGroupRules.IpProtocol }}'
      FromPort: '{{ response.SecurityGroupRules.FromPort }}'
      ToPort: '{{ response.SecurityGroupRules.ToPort }}'
      CidrIpv4: '{{ response.SecurityGroupRules.CidrIpv4 }}'
      CidrIpv6: '{{ response.SecurityGroupRules.CidrIpv6 }}'
      PrefixListId: '{{ response.SecurityGroupRules.PrefixListId }}'
      ReferencedGroupInfo: '{{ response.SecurityGroupRules.ReferencedGroupInfo }}'
      Description: '{{ response.SecurityGroupRules.Description }}'
      Tags: '{{ response.SecurityGroupRules.Tags }}'
      SecurityGroupRuleArn: '{{ response.SecurityGroupRules.SecurityGroupRuleArn }}'
- discovery_id: aws.ec2.create_default_subnet
  calls:
  - action: create_default_subnet
    save_as: response
  emit:
    item:
      AvailabilityZoneId: '{{ response.Subnet.AvailabilityZoneId }}'
      EnableLniAtDeviceIndex: '{{ response.Subnet.EnableLniAtDeviceIndex }}'
      MapCustomerOwnedIpOnLaunch: '{{ response.Subnet.MapCustomerOwnedIpOnLaunch }}'
      CustomerOwnedIpv4Pool: '{{ response.Subnet.CustomerOwnedIpv4Pool }}'
      OwnerId: '{{ response.Subnet.OwnerId }}'
      AssignIpv6AddressOnCreation: '{{ response.Subnet.AssignIpv6AddressOnCreation
        }}'
      Ipv6CidrBlockAssociationSet: '{{ response.Subnet.Ipv6CidrBlockAssociationSet
        }}'
      Tags: '{{ response.Subnet.Tags }}'
      SubnetArn: '{{ response.Subnet.SubnetArn }}'
      OutpostArn: '{{ response.Subnet.OutpostArn }}'
      EnableDns64: '{{ response.Subnet.EnableDns64 }}'
      Ipv6Native: '{{ response.Subnet.Ipv6Native }}'
      PrivateDnsNameOptionsOnLaunch: '{{ response.Subnet.PrivateDnsNameOptionsOnLaunch
        }}'
      BlockPublicAccessStates: '{{ response.Subnet.BlockPublicAccessStates }}'
      Type: '{{ response.Subnet.Type }}'
      SubnetId: '{{ response.Subnet.SubnetId }}'
      State: '{{ response.Subnet.State }}'
      VpcId: '{{ response.Subnet.VpcId }}'
      CidrBlock: '{{ response.Subnet.CidrBlock }}'
      AvailableIpAddressCount: '{{ response.Subnet.AvailableIpAddressCount }}'
      AvailabilityZone: '{{ response.Subnet.AvailabilityZone }}'
      DefaultForAz: '{{ response.Subnet.DefaultForAz }}'
      MapPublicIpOnLaunch: '{{ response.Subnet.MapPublicIpOnLaunch }}'
- discovery_id: aws.ec2.create_default_vpc
  calls:
  - action: create_default_vpc
    save_as: response
  emit:
    item:
      OwnerId: '{{ response.Vpc.OwnerId }}'
      InstanceTenancy: '{{ response.Vpc.InstanceTenancy }}'
      Ipv6CidrBlockAssociationSet: '{{ response.Vpc.Ipv6CidrBlockAssociationSet }}'
      CidrBlockAssociationSet: '{{ response.Vpc.CidrBlockAssociationSet }}'
      IsDefault: '{{ response.Vpc.IsDefault }}'
      EncryptionControl: '{{ response.Vpc.EncryptionControl }}'
      Tags: '{{ response.Vpc.Tags }}'
      BlockPublicAccessStates: '{{ response.Vpc.BlockPublicAccessStates }}'
      VpcId: '{{ response.Vpc.VpcId }}'
      State: '{{ response.Vpc.State }}'
      CidrBlock: '{{ response.Vpc.CidrBlock }}'
      DhcpOptionsId: '{{ response.Vpc.DhcpOptionsId }}'
- discovery_id: aws.ec2.create_nat_gateway
  calls:
  - action: create_nat_gateway
    save_as: response
  emit:
    item:
      CreateTime: '{{ response.NatGateway.CreateTime }}'
      DeleteTime: '{{ response.NatGateway.DeleteTime }}'
      FailureCode: '{{ response.NatGateway.FailureCode }}'
      FailureMessage: '{{ response.NatGateway.FailureMessage }}'
      NatGatewayAddresses: '{{ response.NatGateway.NatGatewayAddresses }}'
      NatGatewayId: '{{ response.NatGateway.NatGatewayId }}'
      ProvisionedBandwidth: '{{ response.NatGateway.ProvisionedBandwidth }}'
      State: '{{ response.NatGateway.State }}'
      SubnetId: '{{ response.NatGateway.SubnetId }}'
      VpcId: '{{ response.NatGateway.VpcId }}'
      Tags: '{{ response.NatGateway.Tags }}'
      ConnectivityType: '{{ response.NatGateway.ConnectivityType }}'
      AvailabilityMode: '{{ response.NatGateway.AvailabilityMode }}'
      AutoScalingIps: '{{ response.NatGateway.AutoScalingIps }}'
      AutoProvisionZones: '{{ response.NatGateway.AutoProvisionZones }}'
      AttachedAppliances: '{{ response.NatGateway.AttachedAppliances }}'
      RouteTableId: '{{ response.NatGateway.RouteTableId }}'
- discovery_id: aws.ec2.create_traffic_mirror_target
  calls:
  - action: create_traffic_mirror_target
    save_as: response
  emit:
    item:
      TrafficMirrorTargetId: '{{ response.TrafficMirrorTarget.TrafficMirrorTargetId
        }}'
      NetworkInterfaceId: '{{ response.TrafficMirrorTarget.NetworkInterfaceId }}'
      NetworkLoadBalancerArn: '{{ response.TrafficMirrorTarget.NetworkLoadBalancerArn
        }}'
      Type: '{{ response.TrafficMirrorTarget.Type }}'
      Description: '{{ response.TrafficMirrorTarget.Description }}'
      OwnerId: '{{ response.TrafficMirrorTarget.OwnerId }}'
      Tags: '{{ response.TrafficMirrorTarget.Tags }}'
      GatewayLoadBalancerEndpointId: '{{ response.TrafficMirrorTarget.GatewayLoadBalancerEndpointId
        }}'
- discovery_id: aws.ec2.create_verified_access_instance
  calls:
  - action: create_verified_access_instance
    save_as: response
  emit:
    item:
      VerifiedAccessInstanceId: '{{ response.VerifiedAccessInstance.VerifiedAccessInstanceId
        }}'
      Description: '{{ response.VerifiedAccessInstance.Description }}'
      VerifiedAccessTrustProviders: '{{ response.VerifiedAccessInstance.VerifiedAccessTrustProviders
        }}'
      CreationTime: '{{ response.VerifiedAccessInstance.CreationTime }}'
      LastUpdatedTime: '{{ response.VerifiedAccessInstance.LastUpdatedTime }}'
      Tags: '{{ response.VerifiedAccessInstance.Tags }}'
      FipsEnabled: '{{ response.VerifiedAccessInstance.FipsEnabled }}'
      CidrEndpointsCustomSubDomain: '{{ response.VerifiedAccessInstance.CidrEndpointsCustomSubDomain
        }}'
- discovery_id: aws.ec2.describe_address_transfers
  calls:
  - action: describe_address_transfers
    save_as: response
  emit:
    item:
      PublicIp: '{{ response.AddressTransfers.PublicIp }}'
      AllocationId: '{{ response.AddressTransfers.AllocationId }}'
      TransferAccountId: '{{ response.AddressTransfers.TransferAccountId }}'
      TransferOfferExpirationTimestamp: '{{ response.AddressTransfers.TransferOfferExpirationTimestamp
        }}'
      TransferOfferAcceptedTimestamp: '{{ response.AddressTransfers.TransferOfferAcceptedTimestamp
        }}'
      AddressTransferStatus: '{{ response.AddressTransfers.AddressTransferStatus }}'
- discovery_id: aws.ec2.describe_addresses
  calls:
  - action: describe_addresses
    save_as: response
  emit:
    item:
      AllocationId: '{{ response.Addresses.AllocationId }}'
      AssociationId: '{{ response.Addresses.AssociationId }}'
      Domain: '{{ response.Addresses.Domain }}'
      NetworkInterfaceId: '{{ response.Addresses.NetworkInterfaceId }}'
      NetworkInterfaceOwnerId: '{{ response.Addresses.NetworkInterfaceOwnerId }}'
      PrivateIpAddress: '{{ response.Addresses.PrivateIpAddress }}'
      Tags: '{{ response.Addresses.Tags }}'
      PublicIpv4Pool: '{{ response.Addresses.PublicIpv4Pool }}'
      NetworkBorderGroup: '{{ response.Addresses.NetworkBorderGroup }}'
      CustomerOwnedIp: '{{ response.Addresses.CustomerOwnedIp }}'
      CustomerOwnedIpv4Pool: '{{ response.Addresses.CustomerOwnedIpv4Pool }}'
      CarrierIp: '{{ response.Addresses.CarrierIp }}'
      SubnetId: '{{ response.Addresses.SubnetId }}'
      ServiceManaged: '{{ response.Addresses.ServiceManaged }}'
      InstanceId: '{{ response.Addresses.InstanceId }}'
      PublicIp: '{{ response.Addresses.PublicIp }}'
- discovery_id: aws.ec2.describe_classic_link_instances
  calls:
  - action: describe_classic_link_instances
    save_as: response
  emit:
    item:
      Groups: '{{ response.Instances.Groups }}'
      InstanceId: '{{ response.Instances.InstanceId }}'
      Tags: '{{ response.Instances.Tags }}'
      VpcId: '{{ response.Instances.VpcId }}'
- discovery_id: aws.ec2.describe_client_vpn_endpoints
  calls:
  - action: describe_client_vpn_endpoints
    save_as: response
  emit:
    item:
      ClientVpnEndpointId: '{{ response.ClientVpnEndpoints.ClientVpnEndpointId }}'
      Description: '{{ response.ClientVpnEndpoints.Description }}'
      Status: '{{ response.ClientVpnEndpoints.Status }}'
      CreationTime: '{{ response.ClientVpnEndpoints.CreationTime }}'
      DeletionTime: '{{ response.ClientVpnEndpoints.DeletionTime }}'
      DnsName: '{{ response.ClientVpnEndpoints.DnsName }}'
      ClientCidrBlock: '{{ response.ClientVpnEndpoints.ClientCidrBlock }}'
      DnsServers: '{{ response.ClientVpnEndpoints.DnsServers }}'
      SplitTunnel: '{{ response.ClientVpnEndpoints.SplitTunnel }}'
      VpnProtocol: '{{ response.ClientVpnEndpoints.VpnProtocol }}'
      TransportProtocol: '{{ response.ClientVpnEndpoints.TransportProtocol }}'
      VpnPort: '{{ response.ClientVpnEndpoints.VpnPort }}'
      AssociatedTargetNetworks: '{{ response.ClientVpnEndpoints.AssociatedTargetNetworks
        }}'
      ServerCertificateArn: '{{ response.ClientVpnEndpoints.ServerCertificateArn }}'
      AuthenticationOptions: '{{ response.ClientVpnEndpoints.AuthenticationOptions
        }}'
      ConnectionLogOptions: '{{ response.ClientVpnEndpoints.ConnectionLogOptions }}'
      Tags: '{{ response.ClientVpnEndpoints.Tags }}'
      SecurityGroupIds: '{{ response.ClientVpnEndpoints.SecurityGroupIds }}'
      VpcId: '{{ response.ClientVpnEndpoints.VpcId }}'
      SelfServicePortalUrl: '{{ response.ClientVpnEndpoints.SelfServicePortalUrl }}'
      ClientConnectOptions: '{{ response.ClientVpnEndpoints.ClientConnectOptions }}'
      SessionTimeoutHours: '{{ response.ClientVpnEndpoints.SessionTimeoutHours }}'
      ClientLoginBannerOptions: '{{ response.ClientVpnEndpoints.ClientLoginBannerOptions
        }}'
      ClientRouteEnforcementOptions: '{{ response.ClientVpnEndpoints.ClientRouteEnforcementOptions
        }}'
      DisconnectOnSessionTimeout: '{{ response.ClientVpnEndpoints.DisconnectOnSessionTimeout
        }}'
      EndpointIpAddressType: '{{ response.ClientVpnEndpoints.EndpointIpAddressType
        }}'
      TrafficIpAddressType: '{{ response.ClientVpnEndpoints.TrafficIpAddressType }}'
- discovery_id: aws.ec2.describe_export_image_tasks
  calls:
  - action: describe_export_image_tasks
    save_as: response
  emit:
    item:
      Description: '{{ response.ExportImageTasks.Description }}'
      ExportImageTaskId: '{{ response.ExportImageTasks.ExportImageTaskId }}'
      ImageId: '{{ response.ExportImageTasks.ImageId }}'
      Progress: '{{ response.ExportImageTasks.Progress }}'
      S3ExportLocation: '{{ response.ExportImageTasks.S3ExportLocation }}'
      Status: '{{ response.ExportImageTasks.Status }}'
      StatusMessage: '{{ response.ExportImageTasks.StatusMessage }}'
      Tags: '{{ response.ExportImageTasks.Tags }}'
- discovery_id: aws.ec2.describe_fast_snapshot_restores
  calls:
  - action: describe_fast_snapshot_restores
    save_as: response
  emit:
    item:
      SnapshotId: '{{ response.FastSnapshotRestores.SnapshotId }}'
      AvailabilityZone: '{{ response.FastSnapshotRestores.AvailabilityZone }}'
      AvailabilityZoneId: '{{ response.FastSnapshotRestores.AvailabilityZoneId }}'
      State: '{{ response.FastSnapshotRestores.State }}'
      StateTransitionReason: '{{ response.FastSnapshotRestores.StateTransitionReason
        }}'
      OwnerId: '{{ response.FastSnapshotRestores.OwnerId }}'
      OwnerAlias: '{{ response.FastSnapshotRestores.OwnerAlias }}'
      EnablingTime: '{{ response.FastSnapshotRestores.EnablingTime }}'
      OptimizingTime: '{{ response.FastSnapshotRestores.OptimizingTime }}'
      EnabledTime: '{{ response.FastSnapshotRestores.EnabledTime }}'
      DisablingTime: '{{ response.FastSnapshotRestores.DisablingTime }}'
      DisabledTime: '{{ response.FastSnapshotRestores.DisabledTime }}'
- discovery_id: aws.ec2.describe_flow_logs
  calls:
  - action: describe_flow_logs
    save_as: response
  emit:
    item:
      CreationTime: '{{ response.FlowLogs.CreationTime }}'
      DeliverLogsErrorMessage: '{{ response.FlowLogs.DeliverLogsErrorMessage }}'
      DeliverLogsPermissionArn: '{{ response.FlowLogs.DeliverLogsPermissionArn }}'
      DeliverCrossAccountRole: '{{ response.FlowLogs.DeliverCrossAccountRole }}'
      DeliverLogsStatus: '{{ response.FlowLogs.DeliverLogsStatus }}'
      FlowLogId: '{{ response.FlowLogs.FlowLogId }}'
      FlowLogStatus: '{{ response.FlowLogs.FlowLogStatus }}'
      LogGroupName: '{{ response.FlowLogs.LogGroupName }}'
      ResourceId: '{{ response.FlowLogs.ResourceId }}'
      TrafficType: '{{ response.FlowLogs.TrafficType }}'
      LogDestinationType: '{{ response.FlowLogs.LogDestinationType }}'
      LogDestination: '{{ response.FlowLogs.LogDestination }}'
      LogFormat: '{{ response.FlowLogs.LogFormat }}'
      Tags: '{{ response.FlowLogs.Tags }}'
      MaxAggregationInterval: '{{ response.FlowLogs.MaxAggregationInterval }}'
      DestinationOptions: '{{ response.FlowLogs.DestinationOptions }}'
- discovery_id: aws.ec2.describe_fpga_images
  calls:
  - action: describe_fpga_images
    save_as: response
  emit:
    item:
      FpgaImageId: '{{ response.FpgaImages.FpgaImageId }}'
      FpgaImageGlobalId: '{{ response.FpgaImages.FpgaImageGlobalId }}'
      Name: '{{ response.FpgaImages.Name }}'
      Description: '{{ response.FpgaImages.Description }}'
      ShellVersion: '{{ response.FpgaImages.ShellVersion }}'
      PciId: '{{ response.FpgaImages.PciId }}'
      State: '{{ response.FpgaImages.State }}'
      CreateTime: '{{ response.FpgaImages.CreateTime }}'
      UpdateTime: '{{ response.FpgaImages.UpdateTime }}'
      OwnerId: '{{ response.FpgaImages.OwnerId }}'
      OwnerAlias: '{{ response.FpgaImages.OwnerAlias }}'
      ProductCodes: '{{ response.FpgaImages.ProductCodes }}'
      Tags: '{{ response.FpgaImages.Tags }}'
      Public: '{{ response.FpgaImages.Public }}'
      DataRetentionSupport: '{{ response.FpgaImages.DataRetentionSupport }}'
      InstanceTypes: '{{ response.FpgaImages.InstanceTypes }}'
- discovery_id: aws.ec2.describe_hosts
  calls:
  - action: describe_hosts
    save_as: response
  emit:
    item:
      AutoPlacement: '{{ response.Hosts.AutoPlacement }}'
      AvailabilityZone: '{{ response.Hosts.AvailabilityZone }}'
      AvailableCapacity: '{{ response.Hosts.AvailableCapacity }}'
      ClientToken: '{{ response.Hosts.ClientToken }}'
      HostId: '{{ response.Hosts.HostId }}'
      HostProperties: '{{ response.Hosts.HostProperties }}'
      HostReservationId: '{{ response.Hosts.HostReservationId }}'
      Instances: '{{ response.Hosts.Instances }}'
      State: '{{ response.Hosts.State }}'
      AllocationTime: '{{ response.Hosts.AllocationTime }}'
      ReleaseTime: '{{ response.Hosts.ReleaseTime }}'
      Tags: '{{ response.Hosts.Tags }}'
      HostRecovery: '{{ response.Hosts.HostRecovery }}'
      AllowsMultipleInstanceTypes: '{{ response.Hosts.AllowsMultipleInstanceTypes
        }}'
      OwnerId: '{{ response.Hosts.OwnerId }}'
      AvailabilityZoneId: '{{ response.Hosts.AvailabilityZoneId }}'
      MemberOfServiceLinkedResourceGroup: '{{ response.Hosts.MemberOfServiceLinkedResourceGroup
        }}'
      OutpostArn: '{{ response.Hosts.OutpostArn }}'
      HostMaintenance: '{{ response.Hosts.HostMaintenance }}'
      AssetId: '{{ response.Hosts.AssetId }}'
- discovery_id: aws.ec2.describe_images
  calls:
  - action: describe_images
    save_as: response
  emit:
    item:
      PlatformDetails: '{{ response.Images.PlatformDetails }}'
      UsageOperation: '{{ response.Images.UsageOperation }}'
      BlockDeviceMappings: '{{ response.Images.BlockDeviceMappings }}'
      Description: '{{ response.Images.Description }}'
      EnaSupport: '{{ response.Images.EnaSupport }}'
      Hypervisor: '{{ response.Images.Hypervisor }}'
      ImageOwnerAlias: '{{ response.Images.ImageOwnerAlias }}'
      Name: '{{ response.Images.Name }}'
      RootDeviceName: '{{ response.Images.RootDeviceName }}'
      RootDeviceType: '{{ response.Images.RootDeviceType }}'
      SriovNetSupport: '{{ response.Images.SriovNetSupport }}'
      StateReason: '{{ response.Images.StateReason }}'
      Tags: '{{ response.Images.Tags }}'
      VirtualizationType: '{{ response.Images.VirtualizationType }}'
      BootMode: '{{ response.Images.BootMode }}'
      TpmSupport: '{{ response.Images.TpmSupport }}'
      DeprecationTime: '{{ response.Images.DeprecationTime }}'
      ImdsSupport: '{{ response.Images.ImdsSupport }}'
      SourceInstanceId: '{{ response.Images.SourceInstanceId }}'
      DeregistrationProtection: '{{ response.Images.DeregistrationProtection }}'
      LastLaunchedTime: '{{ response.Images.LastLaunchedTime }}'
      ImageAllowed: '{{ response.Images.ImageAllowed }}'
      SourceImageId: '{{ response.Images.SourceImageId }}'
      SourceImageRegion: '{{ response.Images.SourceImageRegion }}'
      FreeTierEligible: '{{ response.Images.FreeTierEligible }}'
      ImageId: '{{ response.Images.ImageId }}'
      ImageLocation: '{{ response.Images.ImageLocation }}'
      State: '{{ response.Images.State }}'
      OwnerId: '{{ response.Images.OwnerId }}'
      CreationDate: '{{ response.Images.CreationDate }}'
      Public: '{{ response.Images.Public }}'
      ProductCodes: '{{ response.Images.ProductCodes }}'
      Architecture: '{{ response.Images.Architecture }}'
      ImageType: '{{ response.Images.ImageType }}'
      KernelId: '{{ response.Images.KernelId }}'
      RamdiskId: '{{ response.Images.RamdiskId }}'
      Platform: '{{ response.Images.Platform }}'
- discovery_id: aws.ec2.describe_import_image_tasks
  calls:
  - action: describe_import_image_tasks
    save_as: response
  emit:
    item:
      Architecture: '{{ response.ImportImageTasks.Architecture }}'
      Description: '{{ response.ImportImageTasks.Description }}'
      Encrypted: '{{ response.ImportImageTasks.Encrypted }}'
      Hypervisor: '{{ response.ImportImageTasks.Hypervisor }}'
      ImageId: '{{ response.ImportImageTasks.ImageId }}'
      ImportTaskId: '{{ response.ImportImageTasks.ImportTaskId }}'
      KmsKeyId: '{{ response.ImportImageTasks.KmsKeyId }}'
      LicenseType: '{{ response.ImportImageTasks.LicenseType }}'
      Platform: '{{ response.ImportImageTasks.Platform }}'
      Progress: '{{ response.ImportImageTasks.Progress }}'
      SnapshotDetails: '{{ response.ImportImageTasks.SnapshotDetails }}'
      Status: '{{ response.ImportImageTasks.Status }}'
      StatusMessage: '{{ response.ImportImageTasks.StatusMessage }}'
      Tags: '{{ response.ImportImageTasks.Tags }}'
      LicenseSpecifications: '{{ response.ImportImageTasks.LicenseSpecifications }}'
      UsageOperation: '{{ response.ImportImageTasks.UsageOperation }}'
      BootMode: '{{ response.ImportImageTasks.BootMode }}'
- discovery_id: aws.ec2.describe_key_pairs
  calls:
  - action: describe_key_pairs
    save_as: response
  emit:
    item:
      KeyPairId: '{{ response.KeyPairs.KeyPairId }}'
      KeyType: '{{ response.KeyPairs.KeyType }}'
      Tags: '{{ response.KeyPairs.Tags }}'
      PublicKey: '{{ response.KeyPairs.PublicKey }}'
      CreateTime: '{{ response.KeyPairs.CreateTime }}'
      KeyName: '{{ response.KeyPairs.KeyName }}'
      KeyFingerprint: '{{ response.KeyPairs.KeyFingerprint }}'
- discovery_id: aws.ec2.describe_launch_template_versions
  calls:
  - action: describe_launch_template_versions
    save_as: response
  emit:
    item:
      LaunchTemplateId: '{{ response.LaunchTemplateVersions.LaunchTemplateId }}'
      LaunchTemplateName: '{{ response.LaunchTemplateVersions.LaunchTemplateName }}'
      VersionNumber: '{{ response.LaunchTemplateVersions.VersionNumber }}'
      VersionDescription: '{{ response.LaunchTemplateVersions.VersionDescription }}'
      CreateTime: '{{ response.LaunchTemplateVersions.CreateTime }}'
      CreatedBy: '{{ response.LaunchTemplateVersions.CreatedBy }}'
      DefaultVersion: '{{ response.LaunchTemplateVersions.DefaultVersion }}'
      LaunchTemplateData: '{{ response.LaunchTemplateVersions.LaunchTemplateData }}'
      Operator: '{{ response.LaunchTemplateVersions.Operator }}'
- discovery_id: aws.ec2.describe_network_acls
  calls:
  - action: describe_network_acls
    save_as: response
  emit:
    item:
      Associations: '{{ response.NetworkAcls.Associations }}'
      Entries: '{{ response.NetworkAcls.Entries }}'
      IsDefault: '{{ response.NetworkAcls.IsDefault }}'
      NetworkAclId: '{{ response.NetworkAcls.NetworkAclId }}'
      Tags: '{{ response.NetworkAcls.Tags }}'
      VpcId: '{{ response.NetworkAcls.VpcId }}'
      OwnerId: '{{ response.NetworkAcls.OwnerId }}'
- discovery_id: aws.ec2.describe_security_groups
  calls:
  - action: describe_security_groups
    save_as: response
  emit:
    item:
      GroupId: '{{ response.SecurityGroups.GroupId }}'
      IpPermissionsEgress: '{{ response.SecurityGroups.IpPermissionsEgress }}'
      Tags: '{{ response.SecurityGroups.Tags }}'
      VpcId: '{{ response.SecurityGroups.VpcId }}'
      SecurityGroupArn: '{{ response.SecurityGroups.SecurityGroupArn }}'
      OwnerId: '{{ response.SecurityGroups.OwnerId }}'
      GroupName: '{{ response.SecurityGroups.GroupName }}'
      Description: '{{ response.SecurityGroups.Description }}'
      IpPermissions: '{{ response.SecurityGroups.IpPermissions }}'
- discovery_id: aws.ec2.describe_snapshots
  calls:
  - action: describe_snapshots
    save_as: response
  emit:
    item:
      OwnerAlias: '{{ response.Snapshots.OwnerAlias }}'
      OutpostArn: '{{ response.Snapshots.OutpostArn }}'
      Tags: '{{ response.Snapshots.Tags }}'
      StorageTier: '{{ response.Snapshots.StorageTier }}'
      RestoreExpiryTime: '{{ response.Snapshots.RestoreExpiryTime }}'
      SseType: '{{ response.Snapshots.SseType }}'
      AvailabilityZone: '{{ response.Snapshots.AvailabilityZone }}'
      TransferType: '{{ response.Snapshots.TransferType }}'
      CompletionDurationMinutes: '{{ response.Snapshots.CompletionDurationMinutes
        }}'
      CompletionTime: '{{ response.Snapshots.CompletionTime }}'
      FullSnapshotSizeInBytes: '{{ response.Snapshots.FullSnapshotSizeInBytes }}'
      SnapshotId: '{{ response.Snapshots.SnapshotId }}'
      VolumeId: '{{ response.Snapshots.VolumeId }}'
      State: '{{ response.Snapshots.State }}'
      StateMessage: '{{ response.Snapshots.StateMessage }}'
      StartTime: '{{ response.Snapshots.StartTime }}'
      Progress: '{{ response.Snapshots.Progress }}'
      OwnerId: '{{ response.Snapshots.OwnerId }}'
      Description: '{{ response.Snapshots.Description }}'
      VolumeSize: '{{ response.Snapshots.VolumeSize }}'
      Encrypted: '{{ response.Snapshots.Encrypted }}'
      KmsKeyId: '{{ response.Snapshots.KmsKeyId }}'
      DataEncryptionKeyId: '{{ response.Snapshots.DataEncryptionKeyId }}'
- discovery_id: aws.ec2.describe_vpc_block_public_access_options
  calls:
  - action: describe_vpc_block_public_access_options
    save_as: response
  emit:
    item:
      AwsAccountId: '{{ response.VpcBlockPublicAccessOptions.AwsAccountId }}'
      AwsRegion: '{{ response.VpcBlockPublicAccessOptions.AwsRegion }}'
      State: '{{ response.VpcBlockPublicAccessOptions.State }}'
      InternetGatewayBlockMode: '{{ response.VpcBlockPublicAccessOptions.InternetGatewayBlockMode
        }}'
      Reason: '{{ response.VpcBlockPublicAccessOptions.Reason }}'
      LastUpdateTimestamp: '{{ response.VpcBlockPublicAccessOptions.LastUpdateTimestamp
        }}'
      ManagedBy: '{{ response.VpcBlockPublicAccessOptions.ManagedBy }}'
      ExclusionsAllowed: '{{ response.VpcBlockPublicAccessOptions.ExclusionsAllowed
        }}'
- discovery_id: aws.ec2.describe_vpc_endpoints
  calls:
  - action: describe_vpc_endpoints
    save_as: response
  emit:
    item:
      VpcEndpointId: '{{ response.VpcEndpoints.VpcEndpointId }}'
      VpcEndpointType: '{{ response.VpcEndpoints.VpcEndpointType }}'
      VpcId: '{{ response.VpcEndpoints.VpcId }}'
      ServiceName: '{{ response.VpcEndpoints.ServiceName }}'
      State: '{{ response.VpcEndpoints.State }}'
      PolicyDocument: '{{ response.VpcEndpoints.PolicyDocument }}'
      RouteTableIds: '{{ response.VpcEndpoints.RouteTableIds }}'
      SubnetIds: '{{ response.VpcEndpoints.SubnetIds }}'
      Groups: '{{ response.VpcEndpoints.Groups }}'
      IpAddressType: '{{ response.VpcEndpoints.IpAddressType }}'
      DnsOptions: '{{ response.VpcEndpoints.DnsOptions }}'
      PrivateDnsEnabled: '{{ response.VpcEndpoints.PrivateDnsEnabled }}'
      RequesterManaged: '{{ response.VpcEndpoints.RequesterManaged }}'
      NetworkInterfaceIds: '{{ response.VpcEndpoints.NetworkInterfaceIds }}'
      DnsEntries: '{{ response.VpcEndpoints.DnsEntries }}'
      CreationTimestamp: '{{ response.VpcEndpoints.CreationTimestamp }}'
      Tags: '{{ response.VpcEndpoints.Tags }}'
      OwnerId: '{{ response.VpcEndpoints.OwnerId }}'
      LastError: '{{ response.VpcEndpoints.LastError }}'
      Ipv4Prefixes: '{{ response.VpcEndpoints.Ipv4Prefixes }}'
      Ipv6Prefixes: '{{ response.VpcEndpoints.Ipv6Prefixes }}'
      FailureReason: '{{ response.VpcEndpoints.FailureReason }}'
      ServiceNetworkArn: '{{ response.VpcEndpoints.ServiceNetworkArn }}'
      ResourceConfigurationArn: '{{ response.VpcEndpoints.ResourceConfigurationArn
        }}'
      ServiceRegion: '{{ response.VpcEndpoints.ServiceRegion }}'
- discovery_id: aws.ec2.get_instance_metadata_defaults
  calls:
  - action: get_instance_metadata_defaults
    save_as: response
  emit:
    item:
      HttpTokens: '{{ response.AccountLevel.HttpTokens }}'
      HttpPutResponseHopLimit: '{{ response.AccountLevel.HttpPutResponseHopLimit }}'
      HttpEndpoint: '{{ response.AccountLevel.HttpEndpoint }}'
      InstanceMetadataTags: '{{ response.AccountLevel.InstanceMetadataTags }}'
      ManagedBy: '{{ response.AccountLevel.ManagedBy }}'
      ManagedExceptionMessage: '{{ response.AccountLevel.ManagedExceptionMessage }}'
- discovery_id: aws.ec2.get_launch_template_data
  calls:
  - action: get_launch_template_data
    save_as: response
    params:
      InstanceId: '{{ item.InstanceId }}'
  on_error: continue
  for_each: aws.ec2.describe_classic_link_instances
  emit:
    item:
      KernelId: '{{ response.LaunchTemplateData.KernelId }}'
      EbsOptimized: '{{ response.LaunchTemplateData.EbsOptimized }}'
      IamInstanceProfile: '{{ response.LaunchTemplateData.IamInstanceProfile }}'
      BlockDeviceMappings: '{{ response.LaunchTemplateData.BlockDeviceMappings }}'
      NetworkInterfaces: '{{ response.LaunchTemplateData.NetworkInterfaces }}'
      ImageId: '{{ response.LaunchTemplateData.ImageId }}'
      InstanceType: '{{ response.LaunchTemplateData.InstanceType }}'
      KeyName: '{{ response.LaunchTemplateData.KeyName }}'
      Monitoring: '{{ response.LaunchTemplateData.Monitoring }}'
      Placement: '{{ response.LaunchTemplateData.Placement }}'
      RamDiskId: '{{ response.LaunchTemplateData.RamDiskId }}'
      DisableApiTermination: '{{ response.LaunchTemplateData.DisableApiTermination
        }}'
      InstanceInitiatedShutdownBehavior: '{{ response.LaunchTemplateData.InstanceInitiatedShutdownBehavior
        }}'
      UserData: '{{ response.LaunchTemplateData.UserData }}'
      TagSpecifications: '{{ response.LaunchTemplateData.TagSpecifications }}'
      ElasticGpuSpecifications: '{{ response.LaunchTemplateData.ElasticGpuSpecifications
        }}'
      ElasticInferenceAccelerators: '{{ response.LaunchTemplateData.ElasticInferenceAccelerators
        }}'
      SecurityGroupIds: '{{ response.LaunchTemplateData.SecurityGroupIds }}'
      SecurityGroups: '{{ response.LaunchTemplateData.SecurityGroups }}'
      InstanceMarketOptions: '{{ response.LaunchTemplateData.InstanceMarketOptions
        }}'
      CreditSpecification: '{{ response.LaunchTemplateData.CreditSpecification }}'
      CpuOptions: '{{ response.LaunchTemplateData.CpuOptions }}'
      CapacityReservationSpecification: '{{ response.LaunchTemplateData.CapacityReservationSpecification
        }}'
      LicenseSpecifications: '{{ response.LaunchTemplateData.LicenseSpecifications
        }}'
      HibernationOptions: '{{ response.LaunchTemplateData.HibernationOptions }}'
      MetadataOptions: '{{ response.LaunchTemplateData.MetadataOptions }}'
      EnclaveOptions: '{{ response.LaunchTemplateData.EnclaveOptions }}'
      InstanceRequirements: '{{ response.LaunchTemplateData.InstanceRequirements }}'
      PrivateDnsNameOptions: '{{ response.LaunchTemplateData.PrivateDnsNameOptions
        }}'
      MaintenanceOptions: '{{ response.LaunchTemplateData.MaintenanceOptions }}'
      DisableApiStop: '{{ response.LaunchTemplateData.DisableApiStop }}'
      Operator: '{{ response.LaunchTemplateData.Operator }}'
      NetworkPerformanceOptions: '{{ response.LaunchTemplateData.NetworkPerformanceOptions
        }}'
checks:
- rule_id: aws.ec2.resource.ebs_encryption_by_default_enabled
  for_each: aws.ec2.create_default_vpc
  conditions:
    var: item.EncryptionControl
    op: equals
    value: ENABLED
- rule_id: aws.ec2.instance.vtpm_enabled
  for_each: aws.ec2.create_verified_access_instance
  conditions:
    var: item.FipsEnabled
    op: equals
    value: true
- rule_id: aws.ec2.instance.user_data_no_secrets_configured
  for_each: aws.ec2.get_launch_template_data
  conditions:
    var: item.UserData
    op: equals
- rule_id: aws.ec2.security_group.default_deny_between_network_tiers_enforced
  for_each: aws.ec2.describe_security_groups
  conditions:
    var: item.IpPermissions
    op: equals
    value: []
- rule_id: aws.ec2.launchtemplate.no_public_ip_default_configured
  for_each: aws.ec2.describe_address_transfers
  conditions:
    var: item.PublicIp
    op: exists
- rule_id: aws.ec2.networkacl.network_egress_restricted
  for_each: aws.ec2.describe_network_acls
  conditions:
    var: item.Entries
    op: equals
    value: []
- rule_id: aws.ec2.launch_template_no_secrets.launch_template_no_secrets_configured
  for_each: aws.ec2.describe_launch_template_versions
  conditions:
    var: item.LaunchTemplateData
    op: equals
- rule_id: aws.ec2.resource.backup_enabled
  for_each: aws.ec2.create_default_subnet
  conditions:
    var: item.State
    op: equals
    value: ENABLED
- rule_id: aws.ec2.ami.not_publicly_shared_configured
  for_each: aws.ec2.describe_fpga_images
  conditions:
    var: item.Public
    op: equals
    value: false
- rule_id: aws.ec2.networkacl.network_no_allow_all_rules_configured
  for_each: aws.ec2.describe_network_acls
  conditions:
    var: item.Entries
    op: equals
    value: []
- rule_id: aws.ec2.instance.serial_console_access_restricted
  for_each: aws.ec2.create_default_subnet
  conditions:
    var: item.State
    op: equals
    value: DISABLED
- rule_id: aws.ec2.security_group_internet_ingress_all_ports.internet_ingress_all_ports_blocked
  for_each: aws.ec2.describe_security_groups
  conditions:
    var: item.IpPermissions
    op: equals
    value: []
- rule_id: aws.ec2.security_group_ssh_restricted.ssh_access_restricted
  for_each: aws.ec2.authorize_security_group_ingress
  conditions:
    var: item.CidrIpv4
    op: equals
    value: 0.0.0.0/0
- rule_id: aws.ec2.ebs.public_snapshot_configured
  for_each: aws.ec2.create_default_subnet
  conditions:
    var: item.State
    op: equals
    value: available
- rule_id: aws.ec2.instance.older_than_specific_days_configured
  for_each: aws.ec2.create_nat_gateway
  conditions:
    var: item.CreateTime
    op: lt
    value: '2023-10-01T00:00:00Z'
- rule_id: aws.ec2.resource.client_vpn_endpoint_connection_logging_enabled
  for_each: aws.ec2.describe_client_vpn_endpoints
  conditions:
    var: item.Status
    op: equals
    value: ENABLED
- rule_id: aws.ec2.amipublic.ami_public_configured
  for_each: aws.ec2.describe_fpga_images
  conditions:
    var: item.Public
    op: equals
    value: false
- rule_id: aws.ec2.networkacl.ingress_restrict_all_traffic
  for_each: aws.ec2.describe_network_acls
  conditions:
    var: item.Entries
    op: equals
    value: []
- rule_id: aws.ec2.subnet.public_s_use_nacl_restrictions_configured
  for_each: aws.ec2.create_default_subnet
  conditions:
    var: item.BlockPublicAccessStates
    op: equals
    value:
    - RESTRICTED
- rule_id: aws.ec2.vpcendpoint.private_dns_enabled_if_supported
  for_each: aws.ec2.describe_vpc_endpoints
  conditions:
    var: item.PrivateDnsEnabled
    op: equals
    value: true
- rule_id: aws.ec2.subnet.route_table_association_present
  for_each: aws.ec2.describe_network_acls
  conditions:
    var: item.Associations
    op: exists
- rule_id: aws.ec2.subnet.quarantine_network_configured
  for_each: aws.ec2.create_default_subnet
  conditions:
    var: item.BlockPublicAccessStates
    op: equals
    value:
    - BLOCKED
- rule_id: aws.ec2.resource.ami_public_visibility_configured
  for_each: aws.ec2.describe_fpga_images
  conditions:
    var: item.Public
    op: equals
    value: false
- rule_id: aws.ec2.resource.ebs_snapshots_encrypted
  for_each: aws.ec2.describe_snapshots
  conditions:
    var: item.SseType
    op: equals
    value: ENCRYPTED
- rule_id: aws.ec2.launchtemplate.no_public_ip_assigned_configured
  for_each: aws.ec2.describe_address_transfers
  conditions:
    var: item.PublicIp
    op: exists
- rule_id: aws.ec2.networkacl.unused_network_acl_configured
  for_each: aws.ec2.describe_network_acls
  conditions:
    var: item.Associations
    op: equals
    value: []
- rule_id: aws.ec2.eip.not_in_use
  for_each: aws.ec2.describe_addresses
  conditions:
    var: item.InstanceId
    op: equals
- rule_id: aws.ec2.subnet.automated_isolation_supported_configured
  for_each: aws.ec2.create_default_subnet
  conditions:
    var: item.BlockPublicAccessStates
    op: equals
    value: []
- rule_id: aws.ec2.instance.uses_single_eni_configured
  for_each: aws.ec2.create_traffic_mirror_target
  conditions:
    var: item.NetworkInterfaceId
    op: exists
- rule_id: aws.ec2.keypair.key_max_age_days_configured
  for_each: aws.ec2.create_nat_gateway
  conditions:
    var: item.CreateTime
    op: lte
    value: '30'
- rule_id: aws.ec2.subnet.public_subnets_use_nacl_restrictions_configured
  for_each: aws.ec2.create_default_subnet
  conditions:
    var: item.BlockPublicAccessStates
    op: equals
    value:
    - RESTRICTED
- rule_id: aws.ec2.volume.encryption_at_rest_enabled
  for_each: aws.ec2.describe_snapshots
  conditions:
    var: item.SseType
    op: equals
    value: aws:kms
- rule_id: aws.ec2.resource.vpc_flow_logging_reject_enabled
  for_each: aws.ec2.describe_flow_logs
  conditions:
    var: item.FlowLogStatus
    op: equals
    value: ACTIVE
- rule_id: aws.ec2.spotinstance.no_public_ip_assigned_configured
  for_each: aws.ec2.describe_address_transfers
  conditions:
    var: item.PublicIp
    op: exists
- rule_id: aws.ec2.network_interface.security_groups_present
  for_each: aws.ec2.describe_classic_link_instances
  conditions:
    var: item.Groups
    op: exists
- rule_id: aws.ec2.instance.public_ip_configured
  for_each: aws.ec2.describe_address_transfers
  conditions:
    var: item.PublicIp
    op: exists
- rule_id: aws.ec2.ebs.volume_encryption_configured
  for_each: aws.ec2.create_default_vpc
  conditions:
    var: item.EncryptionControl
    op: equals
    value: ENABLED
- rule_id: aws.ec2.security_group_rdp_restricted.rdp_access_restricted
  for_each: aws.ec2.authorize_security_group_ingress
  conditions:
    var: item.CidrIpv4
    op: equals
    value: 0.0.0.0/0
- rule_id: aws.ec2.security_group_not_used.unused_security_groups_removed
  for_each: aws.ec2.authorize_security_group_ingress
  conditions:
    var: item.GroupId
    op: equals
    value: []
- rule_id: aws.ec2.volume.snapshots_exists_configured
  for_each: aws.ec2.describe_fast_snapshot_restores
  conditions:
    var: item.SnapshotId
    op: exists
- rule_id: aws.ec2.volume.protected_by_backup_plan_configured
  for_each: aws.ec2.create_default_subnet
  conditions:
    var: item.State
    op: equals
    value: ENABLED
- rule_id: aws.ec2.resource.launch_template_imdsv2_required
  for_each: aws.ec2.get_instance_metadata_defaults
  conditions:
    var: item.HttpTokens
    op: equals
    value: required
- rule_id: aws.ec2.dedicatedhost.host_sharing_restricted
  for_each: aws.ec2.describe_hosts
  conditions:
    var: item.AllowsMultipleInstanceTypes
    op: equals
    value: false
- rule_id: aws.ec2.dedicatedhost.instance_auto_placement_controlled_configured
  for_each: aws.ec2.describe_hosts
  conditions:
    var: item.AutoPlacement
    op: equals
    value: 'on'
- rule_id: aws.ec2.security_group.permit_all_egress_rules_blocked
  for_each: aws.ec2.describe_security_groups
  conditions:
    var: item.IpPermissionsEgress
    op: equals
    value: []
- rule_id: aws.ec2.group.ingress_ipv6_restriction_configured
  for_each: aws.ec2.authorize_security_group_ingress
  conditions:
    var: item.CidrIpv6
    op: exists
- rule_id: aws.ec2.security_group.policy_store_encrypted_configured
  for_each: aws.ec2.create_default_vpc
  conditions:
    var: item.EncryptionControl
    op: equals
    value: ENABLED
- rule_id: aws.ec2.instance.ssh_key_based_auth_required
  for_each: aws.ec2.describe_key_pairs
  conditions:
    var: item.KeyName
    op: exists
- rule_id: aws.ec2.instance.data_volumes_encrypted_cmek
  for_each: aws.ec2.describe_snapshots
  conditions:
    var: item.SseType
    op: equals
    value: aws:kms
- rule_id: aws.ec2.instance.paravirtual_type_configured
  for_each: aws.ec2.describe_images
  conditions:
    var: item.VirtualizationType
    op: equals
    value: paravirtual
- rule_id: aws.ec2.keypair.disable_unused_keys_configured
  for_each: aws.ec2.describe_key_pairs
  conditions:
    var: item.KeyPairId
    op: exists
- rule_id: aws.ec2.instance.managed_by_ssm_configured
  for_each: aws.ec2.describe_vpc_block_public_access_options
  conditions:
    var: item.ManagedBy
    op: equals
    value: true
- rule_id: aws.ec2.vpnconnection.tunnel_health_monitoring_enabled
  for_each: aws.ec2.create_default_subnet
  conditions:
    var: item.State
    op: equals
    value: AVAILABLE
- rule_id: aws.ec2.security_group.identity_aware_network_policies_enabled
  for_each: aws.ec2.authorize_security_group_ingress
  conditions:
    var: item.IsEgress
    op: equals
    value: false
- rule_id: aws.ec2.autoscalinggroup.no_public_ip_assigned_configured
  for_each: aws.ec2.describe_address_transfers
  conditions:
    var: item.PublicIp
    op: exists
- rule_id: aws.ec2.eip.shodan_exposure_detected
  for_each: aws.ec2.create_default_subnet
  conditions:
    var: item.State
    op: equals
    value: EXPOSED
- rule_id: aws.ec2.reserved_instance.instance_approval_workflow_required
  for_each: aws.ec2.create_default_subnet
  conditions:
    var: item.State
    op: equals
    value: ENABLED
- rule_id: aws.ec2.instance.secrets_user_data_configured
  for_each: aws.ec2.get_launch_template_data
  conditions:
    var: item.UserData
    op: exists
- rule_id: aws.ec2.security_group.egress_access_restricted
  for_each: aws.ec2.describe_security_groups
  conditions:
    var: item.IpPermissionsEgress
    op: equals
    value: []
- rule_id: aws.ec2.launchtemplate.user_data_no_secrets_configured
  for_each: aws.ec2.get_launch_template_data
  conditions:
    var: item.UserData
    op: equals
- rule_id: aws.ec2.networkacl.unrestricted_ingress_blocked
  for_each: aws.ec2.describe_network_acls
  conditions:
    var: item.Entries
    op: equals
    value: []
- rule_id: aws.ec2.subnet.default_deny_between_tiers_configured
  for_each: aws.ec2.create_default_subnet
  conditions:
    var: item.BlockPublicAccessStates
    op: equals
    value: []
- rule_id: aws.ec2.reserved_instance.purchase_permissions_restricted
  for_each: aws.ec2.create_default_subnet
  conditions:
    var: item.State
    op: equals
    value: RESTRICTED
- rule_id: aws.ec2.routetable.no_0_from_private_subnets_configured
  for_each: aws.ec2.describe_network_acls
  conditions:
    var: item.Associations
    op: equals
    value: []
- rule_id: aws.ec2.vpc.flow_logging_enabled
  for_each: aws.ec2.describe_flow_logs
  conditions:
    var: item.FlowLogStatus
    op: equals
    value: ACTIVE
- rule_id: aws.ec2.snapshot.encryption_at_rest_enabled
  for_each: aws.ec2.describe_snapshots
  conditions:
    var: item.SseType
    op: equals
    value: aws:kms
- rule_id: aws.ec2.instance.detailed_monitoring_enabled
  for_each: aws.ec2.get_launch_template_data
  conditions:
    var: item.Monitoring
    op: equals
    value: enabled
- rule_id: aws.ec2.ami.encryption_at_rest_enabled
  for_each: aws.ec2.describe_import_image_tasks
  conditions:
    var: item.Encrypted
    op: equals
    value: true
- rule_id: aws.ec2.networkacl.network_no_unrestricted_ingress_configured
  for_each: aws.ec2.describe_network_acls
  conditions:
    var: item.Entries
    op: equals
    value: []
- rule_id: aws.ec2.launchtemplate.imds_hardened_configured
  for_each: aws.ec2.get_instance_metadata_defaults
  conditions:
    var: item.HttpTokens
    op: equals
    value: required
- rule_id: aws.ec2.snapshot.cross_region_copy_encrypted
  for_each: aws.ec2.describe_import_image_tasks
  conditions:
    var: item.Encrypted
    op: equals
    value: true
- rule_id: aws.ec2.autoscalinggroup.volumes_encrypted
  for_each: aws.ec2.create_default_vpc
  conditions:
    var: item.EncryptionControl
    op: equals
    value: ENABLED
- rule_id: aws.ec2.instance.secure_boot_enabled
  for_each: aws.ec2.describe_images
  conditions:
    var: item.BootMode
    op: equals
    value: UEFI
- rule_id: aws.ec2.snapshot.not_public_configured
  for_each: aws.ec2.create_default_subnet
  conditions:
    var: item.State
    op: equals
    value: private
- rule_id: aws.ec2.volume.cmk_cmek_configured
  for_each: aws.ec2.describe_snapshots
  conditions:
    var: item.SseType
    op: equals
    value: aws:kms
- rule_id: aws.ec2.instance.security_group_inbound_restricted
  for_each: aws.ec2.describe_security_groups
  conditions:
    var: item.IpPermissions
    op: equals
    value: []
- rule_id: aws.ec2.volume.in_use_configured
  for_each: aws.ec2.create_default_subnet
  conditions:
    var: item.State
    op: equals
    value: in-use
- rule_id: aws.ec2.instance.imdsv2_enabled
  for_each: aws.ec2.get_instance_metadata_defaults
  conditions:
    var: item.HttpTokens
    op: equals
    value: required
- rule_id: aws.ec2.transitgateway.auto_cross_account_attachment_disabled
  for_each: aws.ec2.create_default_subnet
  conditions:
    var: item.State
    op: equals
    value: DISABLED
- rule_id: aws.ec2.volume.snapshots_encrypted
  for_each: aws.ec2.describe_snapshots
  conditions:
    var: item.SseType
    op: equals
    value: ENCRYPTED
- rule_id: aws.ec2.group.cifs_unrestricted_access_configured
  for_each: aws.ec2.authorize_security_group_ingress
  conditions:
    var: item.CidrIpv4
    op: equals
    value: 0.0.0.0/0
- rule_id: aws.ec2.networkacl.network_allow_ingress_any_port_configured
  for_each: aws.ec2.describe_network_acls
  conditions:
    var: item.Entries
    op: exists
- rule_id: aws.ec2.launch_template_no_public_ip.launch_template_no_public_ip_configured
  for_each: aws.ec2.describe_address_transfers
  conditions:
    var: item.PublicIp
    op: equals
    value: false
- rule_id: aws.ec2.launchtemplate.root_volume_encrypted_by_default
  for_each: aws.ec2.create_default_vpc
  conditions:
    var: item.EncryptionControl
    op: equals
    value: ENABLED
- rule_id: aws.ec2.instance.no_public_ip_assigned_configured
  for_each: aws.ec2.describe_address_transfers
  conditions:
    var: item.PublicIp
    op: exists
- rule_id: aws.ec2.ami.approved_image_allowlist_enforced
  for_each: aws.ec2.describe_export_image_tasks
  conditions:
    var: item.ImageId
    op: contains
    value:
    - ami-12345678
    - ami-87654321
- rule_id: aws.ec2.ebs.default_encryption_configured
  for_each: aws.ec2.create_default_vpc
  conditions:
    var: item.EncryptionControl
    op: equals
    value: ENABLED
- rule_id: aws.ec2.security_group.vpc_endpoint_policies_applied
  for_each: aws.ec2.describe_vpc_endpoints
  conditions:
    var: item.PolicyDocument
    op: exists
- rule_id: aws.ec2.instance.root_volume_encrypted_cmek
  for_each: aws.ec2.create_default_vpc
  conditions:
    var: item.EncryptionControl
    op: equals
    value: ENABLED
- rule_id: aws.ec2.networkacl.network_identity_aware_policies_enabled
  for_each: aws.ec2.create_default_vpc
  conditions:
    var: item.IsDefault
    op: equals
    value: false
- rule_id: aws.ec2.instance.ssh_password_auth_disabled
  for_each: aws.ec2.authorize_security_group_ingress
  conditions:
    var: item.SecurityGroupRuleId
    op: equals
    value: []
- rule_id: aws.ec2.launchtemplate.volumes_encrypted
  for_each: aws.ec2.create_default_vpc
  conditions:
    var: item.EncryptionControl
    op: equals
    value: ENABLED
- rule_id: aws.ec2.instance.patch_compliance_status_check
  for_each: aws.ec2.create_default_subnet
  conditions:
    var: item.State
    op: equals
    value: COMPLIANT
- rule_id: aws.ec2.instance.ssh_key_authentication_configured
  for_each: aws.ec2.describe_key_pairs
  conditions:
    var: item.KeyName
    op: exists
- rule_id: aws.ec2.reserved_instance.billing_admins_mfa_required
  for_each: aws.ec2.create_default_subnet
  conditions:
    var: item.State
    op: equals
    value: ENABLED
- rule_id: aws.ec2.instance.stopped_instances_removed
  for_each: aws.ec2.create_default_subnet
  conditions:
    var: item.State
    op: equals
    value: stopped
- rule_id: aws.ec2.instance.iam_role_compliance_configured
  for_each: aws.ec2.create_default_subnet
  conditions:
    var: item.State
    op: equals
    value: ASSOCIATED
- rule_id: aws.ec2.instance.ssm_association_compliant
  for_each: aws.ec2.create_default_subnet
  conditions:
    var: item.State
    op: equals
    value: COMPLIANT
- rule_id: aws.ec2.instance.no_public_ip_configured
  for_each: aws.ec2.describe_address_transfers
  conditions:
    var: item.PublicIp
    op: exists
- rule_id: aws.ec2.subnet.private_s_no_igw_route_configured
  for_each: aws.ec2.create_nat_gateway
  conditions:
    var: item.RouteTableId
    op: exists
- rule_id: aws.ec2.account.block_public_access_configured
  for_each: aws.ec2.create_default_subnet
  conditions:
    var: item.BlockPublicAccessStates
    op: equals
    value: []
- rule_id: aws.ec2.ebs_public_snapshot.ebs_public_snapshot_configured
  for_each: aws.ec2.create_default_subnet
  conditions:
    var: item.State
    op: equals
    value: private
- rule_id: aws.ec2.instance.profile_enabled
  for_each: aws.ec2.create_default_subnet
  conditions:
    var: item.State
    op: equals
    value: ASSOCIATED
