version: '1.0'
provider: aws
service: edr
services:
  client: edr
  module: boto3.client
discovery:
- discovery_id: aws.edr.list_memberships
  calls:
  - action: list_memberships
    save_as: response
  emit:
    items_for: '{{ response.items }}'
    as: resource
    item:
      membershipId: '{{ resource.membershipId }}'
      accountId: '{{ resource.accountId }}'
      region: '{{ resource.region }}'
      membershipArn: '{{ resource.membershipArn }}'
      membershipStatus: '{{ resource.membershipStatus }}'
checks:
- rule_id: aws.edr.resource.edr_operational_readiness_configured
  for_each: aws.edr.list_memberships
  conditions:
    var: item.membershipStatus
    op: equals
    value: Active
