version: '1.0'
provider: aws
service: sagemaker
discovery:
- discovery_id: aws.sagemaker.list_endpoints
  calls:
  - action: list_endpoints
    save_as: list_endpoints_response
  emit:
    items_for: '{{ list_endpoints_response.Endpoints }}'
    as: resource
    item:
      endpoint_name: '{{ resource.EndpointName }}'
      endpoint_arn: '{{ resource.EndpointArn }}'
      creation_time: '{{ resource.CreationTime }}'
      last_modified_time: '{{ resource.LastModifiedTime }}'
      endpoint_status: '{{ resource.EndpointStatus }}'
- discovery_id: aws.sagemaker.list_model_packages
  calls:
  - action: list_model_packages
    save_as: list_model_packages_response
  emit:
    items_for: '{{ list_model_packages_response.ModelPackageSummaryList }}'
    as: resource
    item:
      model_package_name: '{{ resource.ModelPackageName }}'
      model_package_group_name: '{{ resource.ModelPackageGroupName }}'
      model_package_version: '{{ resource.ModelPackageVersion }}'
      model_package_arn: '{{ resource.ModelPackageArn }}'
      model_package_description: '{{ resource.ModelPackageDescription }}'
      creation_time: '{{ resource.CreationTime }}'
      model_package_status: '{{ resource.ModelPackageStatus }}'
      model_approval_status: '{{ resource.ModelApprovalStatus }}'
      model_life_cycle: '{{ resource.ModelLifeCycle }}'
- discovery_id: aws.sagemaker.list_feature_groups
  calls:
  - action: list_feature_groups
    save_as: list_feature_groups_response
  emit:
    items_for: '{{ list_feature_groups_response.FeatureGroupSummaries }}'
    as: resource
    item:
      feature_group_name: '{{ resource.FeatureGroupName }}'
      feature_group_arn: '{{ resource.FeatureGroupArn }}'
      creation_time: '{{ resource.CreationTime }}'
      feature_group_status: '{{ resource.FeatureGroupStatus }}'
      offline_store_status: '{{ resource.OfflineStoreStatus }}'
- discovery_id: aws.sagemaker.list_hyper_parameter_tuning_jobs
  calls:
  - action: list_hyper_parameter_tuning_jobs
    save_as: list_hyper_parameter_tuning_jobs_response
  emit:
    items_for: '{{ list_hyper_parameter_tuning_jobs_response.HyperParameterTuningJobSummaries
      }}'
    as: resource
    item:
      hyper_parameter_tuning_job_name: '{{ resource.HyperParameterTuningJobName }}'
      hyper_parameter_tuning_job_arn: '{{ resource.HyperParameterTuningJobArn }}'
      hyper_parameter_tuning_job_status: '{{ resource.HyperParameterTuningJobStatus
        }}'
      strategy: '{{ resource.Strategy }}'
      creation_time: '{{ resource.CreationTime }}'
      hyper_parameter_tuning_end_time: '{{ resource.HyperParameterTuningEndTime }}'
      last_modified_time: '{{ resource.LastModifiedTime }}'
      training_job_status_counters: '{{ resource.TrainingJobStatusCounters }}'
      objective_status_counters: '{{ resource.ObjectiveStatusCounters }}'
      resource_limits: '{{ resource.ResourceLimits }}'
- discovery_id: aws.sagemaker.list_notebook_instance_lifecycle_configs
  calls:
  - action: list_notebook_instance_lifecycle_configs
    save_as: list_notebook_instance_lifecycle_configs_response
  emit:
    items_for: '{{ list_notebook_instance_lifecycle_configs_response.NotebookInstanceLifecycleConfigs
      }}'
    as: resource
    item:
      notebook_instance_lifecycle_config_name: '{{ resource.NotebookInstanceLifecycleConfigName
        }}'
      notebook_instance_lifecycle_config_arn: '{{ resource.NotebookInstanceLifecycleConfigArn
        }}'
      creation_time: '{{ resource.CreationTime }}'
      last_modified_time: '{{ resource.LastModifiedTime }}'
- discovery_id: aws.sagemaker.list_transform_jobs
  calls:
  - action: list_transform_jobs
    save_as: list_transform_jobs_response
  emit:
    items_for: '{{ list_transform_jobs_response.TransformJobSummaries }}'
    as: resource
    item:
      transform_job_name: '{{ resource.TransformJobName }}'
      transform_job_arn: '{{ resource.TransformJobArn }}'
      creation_time: '{{ resource.CreationTime }}'
      transform_end_time: '{{ resource.TransformEndTime }}'
      last_modified_time: '{{ resource.LastModifiedTime }}'
      transform_job_status: '{{ resource.TransformJobStatus }}'
      failure_reason: '{{ resource.FailureReason }}'
- discovery_id: aws.sagemaker.list_notebook_instances
  calls:
  - action: list_notebook_instances
    save_as: list_notebook_instances_response
  emit:
    items_for: '{{ list_notebook_instances_response.NotebookInstances }}'
    as: resource
    item:
      notebook_instance_name: '{{ resource.NotebookInstanceName }}'
      notebook_instance_arn: '{{ resource.NotebookInstanceArn }}'
      notebook_instance_status: '{{ resource.NotebookInstanceStatus }}'
      url: '{{ resource.Url }}'
      instance_type: '{{ resource.InstanceType }}'
      creation_time: '{{ resource.CreationTime }}'
      last_modified_time: '{{ resource.LastModifiedTime }}'
      notebook_instance_lifecycle_config_name: '{{ resource.NotebookInstanceLifecycleConfigName
        }}'
      default_code_repository: '{{ resource.DefaultCodeRepository }}'
      additional_code_repositories: '{{ resource.AdditionalCodeRepositories }}'
- discovery_id: aws.sagemaker.list_actions
  calls:
  - action: list_actions
    save_as: list_actions_response
  emit:
    items_for: '{{ list_actions_response.ActionSummaries }}'
    as: resource
    item:
      action_arn: '{{ resource.ActionArn }}'
      action_name: '{{ resource.ActionName }}'
      source: '{{ resource.Source }}'
      action_type: '{{ resource.ActionType }}'
      status: '{{ resource.Status }}'
      creation_time: '{{ resource.CreationTime }}'
      last_modified_time: '{{ resource.LastModifiedTime }}'
- discovery_id: aws.sagemaker.list_inference_experiments
  calls:
  - action: list_inference_experiments
    save_as: list_inference_experiments_response
  emit:
    items_for: '{{ list_inference_experiments_response.InferenceExperiments }}'
    as: resource
    item:
      name: '{{ resource.Name }}'
      type: '{{ resource.Type }}'
      schedule: '{{ resource.Schedule }}'
      status: '{{ resource.Status }}'
      status_reason: '{{ resource.StatusReason }}'
      description: '{{ resource.Description }}'
      creation_time: '{{ resource.CreationTime }}'
      completion_time: '{{ resource.CompletionTime }}'
      last_modified_time: '{{ resource.LastModifiedTime }}'
      role_arn: '{{ resource.RoleArn }}'
- discovery_id: aws.sagemaker.list_flow_definitions
  calls:
  - action: list_flow_definitions
    save_as: list_flow_definitions_response
  emit:
    items_for: '{{ list_flow_definitions_response.FlowDefinitionSummaries }}'
    as: resource
    item:
      flow_definition_name: '{{ resource.FlowDefinitionName }}'
      flow_definition_arn: '{{ resource.FlowDefinitionArn }}'
      flow_definition_status: '{{ resource.FlowDefinitionStatus }}'
      creation_time: '{{ resource.CreationTime }}'
      failure_reason: '{{ resource.FailureReason }}'
- discovery_id: aws.sagemaker.list_training_jobs
  calls:
  - action: list_training_jobs
    save_as: list_training_jobs_response
  emit:
    items_for: '{{ list_training_jobs_response.TrainingJobSummaries }}'
    as: resource
    item:
      training_job_name: '{{ resource.TrainingJobName }}'
      training_job_arn: '{{ resource.TrainingJobArn }}'
      creation_time: '{{ resource.CreationTime }}'
      training_end_time: '{{ resource.TrainingEndTime }}'
      last_modified_time: '{{ resource.LastModifiedTime }}'
      training_job_status: '{{ resource.TrainingJobStatus }}'
      secondary_status: '{{ resource.SecondaryStatus }}'
      warm_pool_status: '{{ resource.WarmPoolStatus }}'
      training_plan_arn: '{{ resource.TrainingPlanArn }}'
- discovery_id: aws.sagemaker.list_domains
  calls:
  - action: list_domains
    save_as: list_domains_response
  emit:
    items_for: '{{ list_domains_response.Domains }}'
    as: resource
    item:
      domain_arn: '{{ resource.DomainArn }}'
      domain_id: '{{ resource.DomainId }}'
      domain_name: '{{ resource.DomainName }}'
      status: '{{ resource.Status }}'
      creation_time: '{{ resource.CreationTime }}'
      last_modified_time: '{{ resource.LastModifiedTime }}'
      url: '{{ resource.Url }}'
- discovery_id: aws.sagemaker.list_auto_ml_jobs
  calls:
  - action: list_auto_ml_jobs
    save_as: list_auto_ml_jobs_response
  emit:
    items_for: '{{ list_auto_ml_jobs_response.AutoMLJobSummaries }}'
    as: resource
    item:
      auto_ml_job_name: '{{ resource.AutoMLJobName }}'
      auto_ml_job_arn: '{{ resource.AutoMLJobArn }}'
      auto_ml_job_status: '{{ resource.AutoMLJobStatus }}'
      auto_ml_job_secondary_status: '{{ resource.AutoMLJobSecondaryStatus }}'
      creation_time: '{{ resource.CreationTime }}'
      end_time: '{{ resource.EndTime }}'
      last_modified_time: '{{ resource.LastModifiedTime }}'
      failure_reason: '{{ resource.FailureReason }}'
      partial_failure_reasons: '{{ resource.PartialFailureReasons }}'
- discovery_id: aws.sagemaker.list_images
  calls:
  - action: list_images
    save_as: list_images_response
  emit:
    items_for: '{{ list_images_response.Images }}'
    as: resource
    item:
      creation_time: '{{ resource.CreationTime }}'
      description: '{{ resource.Description }}'
      display_name: '{{ resource.DisplayName }}'
      failure_reason: '{{ resource.FailureReason }}'
      image_arn: '{{ resource.ImageArn }}'
      image_name: '{{ resource.ImageName }}'
      image_status: '{{ resource.ImageStatus }}'
      last_modified_time: '{{ resource.LastModifiedTime }}'
- discovery_id: aws.sagemaker.describe_hyper_parameter_tuning_job
  calls:
  - action: describe_hyper_parameter_tuning_job
    save_as: describe_hyper_parameter_tuning_job_response
    params:
      HyperParameterTuningJobName: '{{ item.hyper_parameter_tuning_job_name }}'
    on_error: continue
  for_each: aws.sagemaker.list_hyper_parameter_tuning_jobs
  emit:
    item:
      resource_id: '{{ item.resource_id }}'
      definition_name: '{{ describe_hyper_parameter_tuning_job_response.TrainingJobDefinitions.DefinitionName
        }}'
      tuning_objective: '{{ describe_hyper_parameter_tuning_job_response.TrainingJobDefinitions.TuningObjective
        }}'
      hyper_parameter_ranges: '{{ describe_hyper_parameter_tuning_job_response.TrainingJobDefinitions.HyperParameterRanges
        }}'
      static_hyper_parameters: '{{ describe_hyper_parameter_tuning_job_response.TrainingJobDefinitions.StaticHyperParameters
        }}'
      algorithm_specification: '{{ describe_hyper_parameter_tuning_job_response.TrainingJobDefinitions.AlgorithmSpecification
        }}'
- discovery_id: aws.sagemaker.describe_device_fleet
  calls:
  - action: describe_device_fleet
    save_as: describe_device_fleet_response
    params:
      DeviceFleetName: '{{ item.name }}'
    on_error: continue
  for_each: aws.sagemaker.list_inference_experiments
  emit:
    item:
      resource_id: '{{ item.resource_id }}'
      s3_output_location: '{{ describe_device_fleet_response.OutputConfig.S3OutputLocation
        }}'
      kms_key_id: '{{ describe_device_fleet_response.OutputConfig.KmsKeyId }}'
      preset_deployment_type: '{{ describe_device_fleet_response.OutputConfig.PresetDeploymentType
        }}'
      preset_deployment_config: '{{ describe_device_fleet_response.OutputConfig.PresetDeploymentConfig
        }}'
- discovery_id: aws.sagemaker.describe_endpoint_config
  calls:
  - action: describe_endpoint_config
    save_as: describe_endpoint_config_response
    params:
      EndpointConfigName: '{{ item.name }}'
    on_error: continue
  for_each: aws.sagemaker.list_inference_experiments
  emit:
    item:
      resource_id: '{{ item.resource_id }}'
      variant_name: '{{ describe_endpoint_config_response.ProductionVariants.VariantName
        }}'
      model_name: '{{ describe_endpoint_config_response.ProductionVariants.ModelName
        }}'
      initial_instance_count: '{{ describe_endpoint_config_response.ProductionVariants.InitialInstanceCount
        }}'
      instance_type: '{{ describe_endpoint_config_response.ProductionVariants.InstanceType
        }}'
      initial_variant_weight: '{{ describe_endpoint_config_response.ProductionVariants.InitialVariantWeight
        }}'
- discovery_id: aws.sagemaker.describe_cluster
  calls:
  - action: describe_cluster
    save_as: describe_cluster_response
    params:
      ClusterName: '{{ item.name }}'
    on_error: continue
  for_each: aws.sagemaker.list_inference_experiments
  emit:
    item:
      resource_id: '{{ item.resource_id }}'
      current_count: '{{ describe_cluster_response.InstanceGroups.CurrentCount }}'
      target_count: '{{ describe_cluster_response.InstanceGroups.TargetCount }}'
      min_count: '{{ describe_cluster_response.InstanceGroups.MinCount }}'
      instance_group_name: '{{ describe_cluster_response.InstanceGroups.InstanceGroupName
        }}'
      instance_type: '{{ describe_cluster_response.InstanceGroups.InstanceType }}'
- discovery_id: aws.sagemaker.describe_model_package
  calls:
  - action: describe_model_package
    save_as: describe_model_package_response
    params:
      ModelPackageName: '{{ item.model_package_name }}'
    on_error: continue
  for_each: aws.sagemaker.list_model_packages
  emit:
    item:
      resource_id: '{{ item.resource_id }}'
      name: '{{ describe_model_package_response.AdditionalInferenceSpecifications.Name
        }}'
      description: '{{ describe_model_package_response.AdditionalInferenceSpecifications.Description
        }}'
      containers: '{{ describe_model_package_response.AdditionalInferenceSpecifications.Containers
        }}'
      supported_transform_instance_types: '{{ describe_model_package_response.AdditionalInferenceSpecifications.SupportedTransformInstanceTypes
        }}'
      supported_realtime_inference_instance_types: '{{ describe_model_package_response.AdditionalInferenceSpecifications.SupportedRealtimeInferenceInstanceTypes
        }}'
checks:
- rule_id: aws.sagemaker.endpoint.logging_enabled
  for_each: aws.sagemaker.list_endpoints
  conditions:
    var: item.endpoint_status
    op: equals
    value: ENABLED
- rule_id: aws.sagemaker.modelpackage.sagemaker_artifact_signed_and_verified
  for_each: aws.sagemaker.list_model_packages
  conditions:
    all:
    - var: item.model_package_status
      op: equals
      value: APPROVED
    - var: item.model_approval_status
      op: equals
      value: APPROVED
- rule_id: aws.sagemaker.volume.and_output_encryption_enabled
  for_each: aws.sagemaker.describe_hyper_parameter_tuning_job
  conditions:
    all:
    - var: item.enable_inter_container_traffic_encryption
      op: equals
      value: true
    - var: item.enable_managed_spot_training
      op: equals
      value: true
- rule_id: aws.sagemaker.modelpackage.encryption_at_rest_enabled
  for_each: aws.sagemaker.list_model_packages
  conditions:
    var: item.model_package_arn
    op: exists
- rule_id: aws.sagemaker.trainingjob.vpc_configured
  for_each: aws.sagemaker.describe_hyper_parameter_tuning_job
  conditions:
    var: item.vpc_config
    op: exists
- rule_id: aws.sagemaker.trainingjob.output_encryption_enabled
  for_each: aws.sagemaker.describe_hyper_parameter_tuning_job
  conditions:
    var: item.enable_inter_container_traffic_encryption
    op: equals
    value: true
- rule_id: aws.sagemaker.featuregroup.online_store_kms_encryption_enabled
  for_each: aws.sagemaker.list_feature_groups
  conditions:
    var: item.feature_group_status
    op: equals
    value: ENABLED
- rule_id: aws.sagemaker.hyperparameter_tuning_job.logging_enabled
  for_each: aws.sagemaker.list_hyper_parameter_tuning_jobs
  conditions:
    var: item.hyper_parameter_tuning_job_status
    op: equals
    value: ACTIVE
- rule_id: aws.sagemaker.model.sagemaker_cross_account_sharing_restricted
  for_each: aws.sagemaker.list_model_packages
  conditions:
    var: item.model_approval_status
    op: equals
    value: Approved
- rule_id: aws.sagemaker.models_vpc_settings_configured.models_vpc_settings_configured_configured
  for_each: aws.sagemaker.describe_hyper_parameter_tuning_job
  conditions:
    var: item.vpc_config
    op: exists
- rule_id: aws.sagemaker.model.sagemaker_kms_cmk_used_configured
  for_each: aws.sagemaker.describe_device_fleet
  conditions:
    var: item.kms_key_id
    op: exists
- rule_id: aws.sagemaker.pipeline.kms_encryption_enabled
  for_each: aws.sagemaker.describe_device_fleet
  conditions:
    var: item.kms_key_id
    op: exists
- rule_id: aws.sagemaker.instance.encryption_enabled
  for_each: aws.sagemaker.describe_endpoint_config
  conditions:
    var: item.enable_ssm_access
    op: equals
    value: true
- rule_id: aws.sagemaker.trainingjob.volume_encryption_enabled
  for_each: aws.sagemaker.describe_hyper_parameter_tuning_job
  conditions:
    var: item.enable_inter_container_traffic_encryption
    op: equals
    value: true
- rule_id: aws.sagemaker.notebook.instance_encryption_enabled
  for_each: aws.sagemaker.list_notebook_instance_lifecycle_configs
  conditions:
    var: item.notebook_instance_lifecycle_config_name
    op: exists
- rule_id: aws.sagemaker.training_jobs_vpc_settings_configured.training_jobs_vpc_settings_configured_configured
  for_each: aws.sagemaker.describe_hyper_parameter_tuning_job
  conditions:
    var: item.vpc_config
    op: exists
- rule_id: aws.sagemaker.endpoint.in_vpc_configured
  for_each: aws.sagemaker.describe_hyper_parameter_tuning_job
  conditions:
    var: item.vpc_config
    op: exists
- rule_id: aws.sagemaker.endpoint_configuration.kms_keys_restricted
  for_each: aws.sagemaker.describe_device_fleet
  conditions:
    var: item.kms_key_id
    op: exists
- rule_id: aws.sagemaker.notebook_instance.private_networking_enforced
  for_each: aws.sagemaker.list_notebook_instance_lifecycle_configs
  conditions:
    var: item.notebook_instance_lifecycle_config_name
    op: exists
- rule_id: aws.sagemaker.transformjob.logging_enabled
  for_each: aws.sagemaker.list_transform_jobs
  conditions:
    var: item.transform_job_status
    op: equals
    value: ENABLED
- rule_id: aws.sagemaker.model.rbac_least_privilege
  for_each: aws.sagemaker.list_model_packages
  conditions:
    all:
    - var: item.model_package_status
      op: equals
      value: APPROVED
    - var: item.model_approval_status
      op: equals
      value: APPROVED
- rule_id: aws.sagemaker.instance.without_direct_internet_access_configured
  for_each: aws.sagemaker.list_notebook_instances
  conditions:
    var: item.notebook_instance_status
    op: equals
    value: Disabled
- rule_id: aws.sagemaker.endpoint.kms_encryption_enabled
  for_each: aws.sagemaker.describe_device_fleet
  conditions:
    var: item.kms_key_id
    op: exists
- rule_id: aws.sagemaker.experiment.logging_enabled
  for_each: aws.sagemaker.list_actions
  conditions:
    var: item.status
    op: equals
    value: ENABLED
- rule_id: aws.sagemaker.model.execution_role_least_privilege
  for_each: aws.sagemaker.describe_cluster
  conditions:
    var: item.execution_role
    op: exists
- rule_id: aws.sagemaker.model.role_least_privilege
  for_each: aws.sagemaker.list_inference_experiments
  conditions:
    var: item.role_arn
    op: exists
- rule_id: aws.sagemaker.resource.training_jobs_intercontainer_encryption_enabled
  for_each: aws.sagemaker.describe_hyper_parameter_tuning_job
  conditions:
    var: item.enable_inter_container_traffic_encryption
    op: equals
    value: true
- rule_id: aws.sagemaker.transformjob.sagemaker_input_output_encrypted
  for_each: aws.sagemaker.list_transform_jobs
  conditions:
    var: item.transform_job_status
    op: equals
    value: Completed
- rule_id: aws.sagemaker.automljob.private_networking_enforced
  for_each: aws.sagemaker.describe_hyper_parameter_tuning_job
  conditions:
    var: item.vpc_config
    op: exists
- rule_id: aws.sagemaker.flowdefinition.ui_private_networking_enforced
  for_each: aws.sagemaker.list_flow_definitions
  conditions:
    var: item.flow_definition_status
    op: equals
    value: ACTIVE
- rule_id: aws.sagemaker.notebook_instance.execution_role_least_privilege
  for_each: aws.sagemaker.describe_cluster
  conditions:
    var: item.execution_role
    op: exists
- rule_id: aws.sagemaker.notebook.instance_without_direct_internet_access_configured
  for_each: aws.sagemaker.list_notebook_instances
  conditions:
    var: item.notebook_instance_status
    op: equals
    value: Disabled
- rule_id: aws.sagemaker.trainingjob.logging_enabled
  for_each: aws.sagemaker.list_training_jobs
  conditions:
    var: item.training_job_status
    op: equals
    value: ENABLED
- rule_id: aws.sagemaker.transformjob.private_networking_enforced
  for_each: aws.sagemaker.list_transform_jobs
  conditions:
    var: item.transform_job_status
    op: equals
    value: COMPLETED
- rule_id: aws.sagemaker.model.sagemaker_artifact_encrypted_at_rest
  for_each: aws.sagemaker.list_actions
  conditions:
    var: item.status
    op: equals
    value: ENABLED
- rule_id: aws.sagemaker.notebook_instance.iam_role_least_privileged_configured
  for_each: aws.sagemaker.list_notebook_instances
  conditions:
    all:
    - var: item.notebook_instance_arn
      op: exists
    - var: item.notebook_instance_status
      op: equals
      value: InService
- rule_id: aws.sagemaker.endpoint_configuration.logging_enabled
  for_each: aws.sagemaker.list_endpoints
  conditions:
    var: item.endpoint_status
    op: equals
    value: InService
- rule_id: aws.sagemaker.endpoint_configuration.sagemaker_content_type_whitelist_enforced
  for_each: aws.sagemaker.describe_model_package
  conditions:
    var: item.supported_content_types
    op: exists
- rule_id: aws.sagemaker.notebook_instance.encryption_at_rest_enabled
  for_each: aws.sagemaker.list_notebook_instances
  conditions:
    var: item.notebook_instance_status
    op: equals
    value: ENABLED
- rule_id: aws.sagemaker.experiment.sagemaker_metadata_store_encrypted
  for_each: aws.sagemaker.list_actions
  conditions:
    var: item.status
    op: equals
    value: ENABLED
- rule_id: aws.sagemaker.modelpackage.not_publicly_shared_configured
  for_each: aws.sagemaker.list_model_packages
  conditions:
    all:
    - var: item.model_package_status
      op: equals
      value: APPROVED
    - var: item.model_approval_status
      op: equals
      value: APPROVED
- rule_id: aws.sagemaker.notebook_instance.no_public_access_configured
  for_each: aws.sagemaker.list_domains
  conditions:
    var: item.url
    op: equals
- rule_id: aws.sagemaker.trainingjob.network_isolation_enabled
  for_each: aws.sagemaker.describe_hyper_parameter_tuning_job
  conditions:
    var: item.enable_network_isolation
    op: equals
    value: true
- rule_id: aws.sagemaker.endpoint.sagemaker_data_capture_s3_encrypted
  for_each: aws.sagemaker.describe_device_fleet
  conditions:
    var: item.kms_key_id
    op: exists
- rule_id: aws.sagemaker.endpoint_configuration.endpoint_in_vpc_configured
  for_each: aws.sagemaker.describe_hyper_parameter_tuning_job
  conditions:
    var: item.vpc_config
    op: exists
- rule_id: aws.sagemaker.flowdefinition.sagemaker_artifacts_encrypted
  for_each: aws.sagemaker.list_flow_definitions
  conditions:
    var: item.flow_definition_status
    op: equals
    value: ACTIVE
- rule_id: aws.sagemaker.endpoint_configuration.kms_encryption_enabled
  for_each: aws.sagemaker.describe_device_fleet
  conditions:
    var: item.kms_key_id
    op: exists
- rule_id: aws.sagemaker.trainingjob.inter_container_traffic_encryption_enabled
  for_each: aws.sagemaker.describe_hyper_parameter_tuning_job
  conditions:
    var: item.enable_inter_container_traffic_encryption
    op: equals
    value: true
- rule_id: aws.sagemaker.automljob.logging_enabled
  for_each: aws.sagemaker.list_auto_ml_jobs
  conditions:
    var: item.auto_ml_job_status
    op: equals
    value: ENABLED
- rule_id: aws.sagemaker.hyperparameter_tuning_job.private_networking_enforced
  for_each: aws.sagemaker.describe_hyper_parameter_tuning_job
  conditions:
    all:
    - var: item.vpc_config
      op: exists
    - var: item.enable_network_isolation
      op: equals
      value: true
- rule_id: aws.sagemaker.model.sagemaker_image_scan_passed_configured
  for_each: aws.sagemaker.list_images
  conditions:
    var: item.image_status
    op: equals
    value: ACTIVE
- rule_id: aws.sagemaker.endpoint.authn_required
  for_each: aws.sagemaker.list_endpoints
  conditions:
    var: item.endpoint_status
    op: equals
    value: InService
- rule_id: aws.sagemaker.pipeline.logging_enabled
  for_each: aws.sagemaker.list_actions
  conditions:
    var: item.status
    op: equals
    value: ENABLED
- rule_id: aws.sagemaker.featuregroup.sagemaker_offline_store_s3_encrypted
  for_each: aws.sagemaker.list_feature_groups
  conditions:
    var: item.offline_store_status
    op: equals
    value: ENABLED
- rule_id: aws.sagemaker.featuregroup.offline_store_block_public_access_configured
  for_each: aws.sagemaker.list_feature_groups
  conditions:
    var: item.offline_store_status
    op: equals
    value: DISABLED
- rule_id: aws.sagemaker.model.logging_enabled
  for_each: aws.sagemaker.list_actions
  conditions:
    var: item.status
    op: equals
    value: ENABLED
- rule_id: aws.sagemaker.pipeline.iam_role_least_privileged_configured
  for_each: aws.sagemaker.list_inference_experiments
  conditions:
    var: item.role_arn
    op: exists
- rule_id: aws.sagemaker.notebook_instance.sagemaker_idle_shutdown_configured
  for_each: aws.sagemaker.list_notebook_instance_lifecycle_configs
  conditions:
    var: item.notebook_instance_lifecycle_config_name
    op: exists
- rule_id: aws.sagemaker.pipeline.role_least_privilege
  for_each: aws.sagemaker.list_inference_experiments
  conditions:
    var: item.role_arn
    op: exists
- rule_id: aws.sagemaker.experiment.rbac_least_privilege
  for_each: aws.sagemaker.list_actions
  conditions:
    var: item.status
    op: equals
    value: ACTIVE
- rule_id: aws.sagemaker.modelpackage.kms_encryption_enabled
  for_each: aws.sagemaker.describe_device_fleet
  conditions:
    var: item.kms_key_id
    op: exists
- rule_id: aws.sagemaker.model.sagemaker_outputs_encrypted_and_private
  for_each: aws.sagemaker.list_model_packages
  conditions:
    all:
    - var: item.model_package_status
      op: equals
      value: ENCRYPTED
    - var: item.model_approval_status
      op: equals
      value: PRIVATE
- rule_id: aws.sagemaker.modelpackage.sagemaker_image_scan_passed_configured
  for_each: aws.sagemaker.list_model_packages
  conditions:
    all:
    - var: item.model_package_status
      op: equals
      value: Approved
    - var: item.model_approval_status
      op: equals
      value: Approved
- rule_id: aws.sagemaker.instance.vpc_settings_configured
  for_each: aws.sagemaker.describe_hyper_parameter_tuning_job
  conditions:
    var: item.vpc_config
    op: exists
- rule_id: aws.sagemaker.modelpackage.sagemaker_package_approved_configured
  for_each: aws.sagemaker.list_model_packages
  conditions:
    var: item.model_approval_status
    op: equals
    value: Approved
- rule_id: aws.sagemaker.model.artifact_encryption_enabled
  for_each: aws.sagemaker.describe_hyper_parameter_tuning_job
  conditions:
    var: item.enable_inter_container_traffic_encryption
    op: equals
    value: true
