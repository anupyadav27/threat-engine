version: '1.0'
provider: aws
service: budgets
services:
  client: budgets
  module: boto3.client
discovery:
- discovery_id: aws.budgets.describe_budgets
  calls:
  - action: describe_budgets
    save_as: response
  emit:
    item:
      BudgetName: '{{ response.Budgets.BudgetName }}'
      BudgetLimit: '{{ response.Budgets.BudgetLimit }}'
      PlannedBudgetLimits: '{{ response.Budgets.PlannedBudgetLimits }}'
      CostFilters: '{{ response.Budgets.CostFilters }}'
      CostTypes: '{{ response.Budgets.CostTypes }}'
      TimeUnit: '{{ response.Budgets.TimeUnit }}'
      TimePeriod: '{{ response.Budgets.TimePeriod }}'
      CalculatedSpend: '{{ response.Budgets.CalculatedSpend }}'
      BudgetType: '{{ response.Budgets.BudgetType }}'
      LastUpdatedTime: '{{ response.Budgets.LastUpdatedTime }}'
      AutoAdjustData: '{{ response.Budgets.AutoAdjustData }}'
      FilterExpression: '{{ response.Budgets.FilterExpression }}'
      Metrics: '{{ response.Budgets.Metrics }}'
      BillingViewArn: '{{ response.Budgets.BillingViewArn }}'
      HealthStatus: '{{ response.Budgets.HealthStatus }}'
      Budgets: '{{ resource.Budgets }}'
- discovery_id: aws.budgets.describe_budget_notifications_for_account
  calls:
  - action: describe_budget_notifications_for_account
    save_as: response
  emit:
    item:
      Notifications: '{{ response.BudgetNotificationsForAccount.Notifications }}'
      BudgetName: '{{ response.BudgetNotificationsForAccount.BudgetName }}'
      BudgetNotificationsForAccount: '{{ resource.BudgetNotificationsForAccount }}'
checks:
- rule_id: aws.budgets.budget.budgets_s_defined_for_accounts_or_projects_configured
  for_each: aws.budgets.describe_budgets
  conditions:
    var: item.Budgets
    op: not_equals
    value: 'null'
- rule_id: aws.budgets.budget.alert_destinations_configured
  for_each: aws.budgets.describe_budget_notifications_for_account
  conditions:
    var: item.BudgetNotificationsForAccount
    op: greater_than
    value: 0
- rule_id: aws.budgets.budget.alert_thresholds_configured
  for_each: aws.budgets.describe_budget_notifications_for_account
  conditions:
    var: item.BudgetNotificationsForAccount
    op: not_equals
    value: 'null'
- rule_id: aws.budgets.budget.modify_permissions_restricted
  for_each: aws.budgets.describe_budgets
  conditions:
    var: item.Budgets
    op: not_equals
    value: 'null'
