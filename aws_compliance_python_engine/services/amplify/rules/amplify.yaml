version: '1.0'
provider: aws
service: amplify
services:
  client: amplify
  module: boto3.client
discovery:
- discovery_id: aws.amplify.list_apps
  calls:
  - action: list_apps
    save_as: response
  emit:
    items_for: '{{ response.apps }}'
    as: resource
    item:
      app_id: '{{ resource.appId }}'
      app_arn: '{{ resource.appArn }}'
      name: '{{ resource.name }}'
      tags: '{{ resource.tags }}'
      description: '{{ resource.description }}'
      repository: '{{ resource.repository }}'
      platform: '{{ resource.platform }}'
      create_time: '{{ resource.createTime }}'
      update_time: '{{ resource.updateTime }}'
      compute_role_arn: '{{ resource.computeRoleArn }}'
      iam_service_role_arn: '{{ resource.iamServiceRoleArn }}'
      environment_variables: '{{ resource.environmentVariables }}'
      default_domain: '{{ resource.defaultDomain }}'
      enable_branch_auto_build: '{{ resource.enableBranchAutoBuild }}'
      enable_branch_auto_deletion: '{{ resource.enableBranchAutoDeletion }}'
      enable_basic_auth: '{{ resource.enableBasicAuth }}'
      basic_auth_credentials: '{{ resource.basicAuthCredentials }}'
      custom_rules: '{{ resource.customRules }}'
      production_branch: '{{ resource.productionBranch }}'
      build_spec: '{{ resource.buildSpec }}'
      custom_headers: '{{ resource.customHeaders }}'
      enable_auto_branch_creation: '{{ resource.enableAutoBranchCreation }}'
      auto_branch_creation_patterns: '{{ resource.autoBranchCreationPatterns }}'
      auto_branch_creation_config: '{{ resource.autoBranchCreationConfig }}'
      repository_clone_method: '{{ resource.repositoryCloneMethod }}'
      cache_config: '{{ resource.cacheConfig }}'
      webhook_create_time: '{{ resource.webhookCreateTime }}'
      waf_configuration: '{{ resource.wafConfiguration }}'
      job_config: '{{ resource.jobConfig }}'
- discovery_id: aws.amplify.get_app
  calls:
  - action: get_app
    save_as: response
    params:
      appId: '{{ item.app_id }}'
  for_each: aws.amplify.list_apps
  on_error: continue
  emit:
    item:
      app: '{{ response.app }}'
      app_id: '{{ response.app.appId }}'
      app_arn: '{{ response.app.appArn }}'
      name: '{{ response.app.name }}'
      tags: '{{ response.app.tags }}'
      description: '{{ response.app.description }}'
      repository: '{{ response.app.repository }}'
      platform: '{{ response.app.platform }}'
      create_time: '{{ response.app.createTime }}'
      update_time: '{{ response.app.updateTime }}'
      compute_role_arn: '{{ response.app.computeRoleArn }}'
      iam_service_role_arn: '{{ response.app.iamServiceRoleArn }}'
      environment_variables: '{{ response.app.environmentVariables }}'
      default_domain: '{{ response.app.defaultDomain }}'
      enable_branch_auto_build: '{{ response.app.enableBranchAutoBuild }}'
      enable_branch_auto_deletion: '{{ response.app.enableBranchAutoDeletion }}'
      enable_basic_auth: '{{ response.app.enableBasicAuth }}'
      basic_auth_credentials: '{{ response.app.basicAuthCredentials }}'
      custom_rules: '{{ response.app.customRules }}'
      production_branch: '{{ response.app.productionBranch }}'
      build_spec: '{{ response.app.buildSpec }}'
      custom_headers: '{{ response.app.customHeaders }}'
      enable_auto_branch_creation: '{{ response.app.enableAutoBranchCreation }}'
      auto_branch_creation_patterns: '{{ response.app.autoBranchCreationPatterns }}'
      auto_branch_creation_config: '{{ response.app.autoBranchCreationConfig }}'
      repository_clone_method: '{{ response.app.repositoryCloneMethod }}'
      cache_config: '{{ response.app.cacheConfig }}'
      webhook_create_time: '{{ response.app.webhookCreateTime }}'
      waf_configuration: '{{ response.app.wafConfiguration }}'
      job_config: '{{ response.app.jobConfig }}'
- discovery_id: aws.amplify.get_artifact_url
  calls:
  - action: get_artifact_url
    save_as: response
    params:
      artifactId: '{{ item.artifact_id }}'
  for_each: aws.amplify.list_apps
  on_error: continue
  emit:
    item:
      artifact_id: '{{ response.artifactId }}'
      artifact_url: '{{ response.artifactUrl }}'
- discovery_id: aws.amplify.get_backend_environment
  calls:
  - action: get_backend_environment
    save_as: response
    params:
      appId: '{{ item.app_id }}'
      environmentName: '{{ item.environment_name }}'
  for_each: aws.amplify.list_apps
  on_error: continue
  emit:
    item:
      backend_environment: '{{ response.backendEnvironment }}'
      backend_environment_arn: '{{ response.backendEnvironment.backendEnvironmentArn
        }}'
      environment_name: '{{ response.backendEnvironment.environmentName }}'
      stack_name: '{{ response.backendEnvironment.stackName }}'
      deployment_artifacts: '{{ response.backendEnvironment.deploymentArtifacts }}'
      create_time: '{{ response.backendEnvironment.createTime }}'
      update_time: '{{ response.backendEnvironment.updateTime }}'
- discovery_id: aws.amplify.get_branch
  calls:
  - action: get_branch
    save_as: response
    params:
      appId: '{{ item.app_id }}'
      branchName: '{{ item.branch_name }}'
  for_each: aws.amplify.list_apps
  on_error: continue
  emit:
    item:
      branch: '{{ response.branch }}'
      branch_arn: '{{ response.branch.branchArn }}'
      branch_name: '{{ response.branch.branchName }}'
      description: '{{ response.branch.description }}'
      tags: '{{ response.branch.tags }}'
      stage: '{{ response.branch.stage }}'
      display_name: '{{ response.branch.displayName }}'
      enable_notification: '{{ response.branch.enableNotification }}'
      create_time: '{{ response.branch.createTime }}'
      update_time: '{{ response.branch.updateTime }}'
      environment_variables: '{{ response.branch.environmentVariables }}'
      enable_auto_build: '{{ response.branch.enableAutoBuild }}'
      enable_skew_protection: '{{ response.branch.enableSkewProtection }}'
      custom_domains: '{{ response.branch.customDomains }}'
      framework: '{{ response.branch.framework }}'
      active_job_id: '{{ response.branch.activeJobId }}'
      total_number_of_jobs: '{{ response.branch.totalNumberOfJobs }}'
      enable_basic_auth: '{{ response.branch.enableBasicAuth }}'
      enable_performance_mode: '{{ response.branch.enablePerformanceMode }}'
      thumbnail_url: '{{ response.branch.thumbnailUrl }}'
      basic_auth_credentials: '{{ response.branch.basicAuthCredentials }}'
      build_spec: '{{ response.branch.buildSpec }}'
      ttl: '{{ response.branch.ttl }}'
      associated_resources: '{{ response.branch.associatedResources }}'
      enable_pull_request_preview: '{{ response.branch.enablePullRequestPreview }}'
      pull_request_environment_name: '{{ response.branch.pullRequestEnvironmentName
        }}'
      destination_branch: '{{ response.branch.destinationBranch }}'
      source_branch: '{{ response.branch.sourceBranch }}'
      backend_environment_arn: '{{ response.branch.backendEnvironmentArn }}'
      backend: '{{ response.branch.backend }}'
      compute_role_arn: '{{ response.branch.computeRoleArn }}'
- discovery_id: aws.amplify.get_domain_association
  calls:
  - action: get_domain_association
    save_as: response
    params:
      appId: '{{ item.app_id }}'
      domainName: '{{ item.domain_name }}'
  for_each: aws.amplify.list_apps
  on_error: continue
  emit:
    item:
      domain_association: '{{ response.domainAssociation }}'
      domain_association_arn: '{{ response.domainAssociation.domainAssociationArn
        }}'
      domain_name: '{{ response.domainAssociation.domainName }}'
      enable_auto_sub_domain: '{{ response.domainAssociation.enableAutoSubDomain }}'
      auto_sub_domain_creation_patterns: '{{ response.domainAssociation.autoSubDomainCreationPatterns
        }}'
      auto_sub_domain_iam_role: '{{ response.domainAssociation.autoSubDomainIAMRole
        }}'
      domain_status: '{{ response.domainAssociation.domainStatus }}'
      update_status: '{{ response.domainAssociation.updateStatus }}'
      status_reason: '{{ response.domainAssociation.statusReason }}'
      certificate_verification_dns_record: '{{ response.domainAssociation.certificateVerificationDNSRecord
        }}'
      sub_domains: '{{ response.domainAssociation.subDomains }}'
      certificate: '{{ response.domainAssociation.certificate }}'
- discovery_id: aws.amplify.get_job
  calls:
  - action: get_job
    save_as: response
    params:
      appId: '{{ item.app_id }}'
      branchName: '{{ item.branch_name }}'
      jobId: '{{ item.job_id }}'
  for_each: aws.amplify.list_apps
  on_error: continue
  emit:
    item:
      job: '{{ response.job }}'
      summary: '{{ response.job.summary }}'
      steps: '{{ response.job.steps }}'
- discovery_id: aws.amplify.get_webhook
  calls:
  - action: get_webhook
    save_as: response
    params:
      webhookId: '{{ item.webhook_id }}'
  for_each: aws.amplify.list_apps
  on_error: continue
  emit:
    item:
      webhook: '{{ response.webhook }}'
      webhook_arn: '{{ response.webhook.webhookArn }}'
      webhook_id: '{{ response.webhook.webhookId }}'
      webhook_url: '{{ response.webhook.webhookUrl }}'
      app_id: '{{ response.webhook.appId }}'
      branch_name: '{{ response.webhook.branchName }}'
      description: '{{ response.webhook.description }}'
      create_time: '{{ response.webhook.createTime }}'
      update_time: '{{ response.webhook.updateTime }}'
- discovery_id: aws.amplify.list_artifacts
  calls:
  - action: list_artifacts
    save_as: response
    params:
      appId: '{{ item.app_id }}'
      branchName: '{{ item.branch_name }}'
      jobId: '{{ item.job_id }}'
  for_each: aws.amplify.list_apps
  on_error: continue
  emit:
    items_for: '{{ response.artifacts }}'
    as: resource
    item:
      artifact_file_name: '{{ resource.artifactFileName }}'
      artifact_id: '{{ resource.artifactId }}'
- discovery_id: aws.amplify.list_backend_environments
  calls:
  - action: list_backend_environments
    save_as: response
    params:
      appId: '{{ item.app_id }}'
  for_each: aws.amplify.list_apps
  on_error: continue
  emit:
    items_for: '{{ response.backendEnvironments }}'
    as: resource
    item:
      backend_environment_arn: '{{ resource.backendEnvironmentArn }}'
      environment_name: '{{ resource.environmentName }}'
      stack_name: '{{ resource.stackName }}'
      deployment_artifacts: '{{ resource.deploymentArtifacts }}'
      create_time: '{{ resource.createTime }}'
      update_time: '{{ resource.updateTime }}'
- discovery_id: aws.amplify.list_branches
  calls:
  - action: list_branches
    save_as: response
    params:
      appId: '{{ item.app_id }}'
  for_each: aws.amplify.list_apps
  on_error: continue
  emit:
    items_for: '{{ response.branches }}'
    as: resource
    item:
      branch_arn: '{{ resource.branchArn }}'
      branch_name: '{{ resource.branchName }}'
      description: '{{ resource.description }}'
      tags: '{{ resource.tags }}'
      stage: '{{ resource.stage }}'
      display_name: '{{ resource.displayName }}'
      enable_notification: '{{ resource.enableNotification }}'
      create_time: '{{ resource.createTime }}'
      update_time: '{{ resource.updateTime }}'
      environment_variables: '{{ resource.environmentVariables }}'
      enable_auto_build: '{{ resource.enableAutoBuild }}'
      enable_skew_protection: '{{ resource.enableSkewProtection }}'
      custom_domains: '{{ resource.customDomains }}'
      framework: '{{ resource.framework }}'
      active_job_id: '{{ resource.activeJobId }}'
      total_number_of_jobs: '{{ resource.totalNumberOfJobs }}'
      enable_basic_auth: '{{ resource.enableBasicAuth }}'
      enable_performance_mode: '{{ resource.enablePerformanceMode }}'
      thumbnail_url: '{{ resource.thumbnailUrl }}'
      basic_auth_credentials: '{{ resource.basicAuthCredentials }}'
      build_spec: '{{ resource.buildSpec }}'
      ttl: '{{ resource.ttl }}'
      associated_resources: '{{ resource.associatedResources }}'
      enable_pull_request_preview: '{{ resource.enablePullRequestPreview }}'
      pull_request_environment_name: '{{ resource.pullRequestEnvironmentName }}'
      destination_branch: '{{ resource.destinationBranch }}'
      source_branch: '{{ resource.sourceBranch }}'
      backend_environment_arn: '{{ resource.backendEnvironmentArn }}'
      backend: '{{ resource.backend }}'
      compute_role_arn: '{{ resource.computeRoleArn }}'
- discovery_id: aws.amplify.list_domain_associations
  calls:
  - action: list_domain_associations
    save_as: response
    params:
      appId: '{{ item.app_id }}'
  for_each: aws.amplify.list_apps
  on_error: continue
  emit:
    items_for: '{{ response.domainAssociations }}'
    as: resource
    item:
      domain_association_arn: '{{ resource.domainAssociationArn }}'
      domain_name: '{{ resource.domainName }}'
      enable_auto_sub_domain: '{{ resource.enableAutoSubDomain }}'
      auto_sub_domain_creation_patterns: '{{ resource.autoSubDomainCreationPatterns
        }}'
      auto_sub_domain_iam_role: '{{ resource.autoSubDomainIAMRole }}'
      domain_status: '{{ resource.domainStatus }}'
      update_status: '{{ resource.updateStatus }}'
      status_reason: '{{ resource.statusReason }}'
      certificate_verification_dns_record: '{{ resource.certificateVerificationDNSRecord
        }}'
      sub_domains: '{{ resource.subDomains }}'
      certificate: '{{ resource.certificate }}'
- discovery_id: aws.amplify.list_jobs
  calls:
  - action: list_jobs
    save_as: response
    params:
      appId: '{{ item.app_id }}'
      branchName: '{{ item.branch_name }}'
  for_each: aws.amplify.list_apps
  on_error: continue
  emit:
    items_for: '{{ response.jobSummaries }}'
    as: resource
    item:
      job_arn: '{{ resource.jobArn }}'
      job_id: '{{ resource.jobId }}'
      commit_id: '{{ resource.commitId }}'
      commit_message: '{{ resource.commitMessage }}'
      commit_time: '{{ resource.commitTime }}'
      start_time: '{{ resource.startTime }}'
      status: '{{ resource.status }}'
      end_time: '{{ resource.endTime }}'
      job_type: '{{ resource.jobType }}'
      source_url: '{{ resource.sourceUrl }}'
      source_url_type: '{{ resource.sourceUrlType }}'
- discovery_id: aws.amplify.list_tags_for_resource
  calls:
  - action: list_tags_for_resource
    save_as: response
  emit:
    item: {}
- discovery_id: aws.amplify.list_webhooks
  calls:
  - action: list_webhooks
    save_as: response
    params:
      appId: '{{ item.app_id }}'
  for_each: aws.amplify.list_apps
  on_error: continue
  emit:
    items_for: '{{ response.webhooks }}'
    as: resource
    item:
      webhook_arn: '{{ resource.webhookArn }}'
      webhook_id: '{{ resource.webhookId }}'
      webhook_url: '{{ resource.webhookUrl }}'
      app_id: '{{ resource.appId }}'
      branch_name: '{{ resource.branchName }}'
      description: '{{ resource.description }}'
      create_time: '{{ resource.createTime }}'
      update_time: '{{ resource.updateTime }}'
checks: []
