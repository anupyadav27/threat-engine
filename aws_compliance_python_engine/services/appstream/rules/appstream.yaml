version: '1.0'
provider: aws
service: appstream
services:
  client: appstream
  module: boto3.client
discovery:
- discovery_id: aws.appstream.describe_app_block_builders
  calls:
  - action: describe_app_block_builders
    save_as: response
  emit:
    item:
      Arn: '{{ response.AppBlockBuilders.Arn }}'
      Name: '{{ response.AppBlockBuilders.Name }}'
      DisplayName: '{{ response.AppBlockBuilders.DisplayName }}'
      Description: '{{ response.AppBlockBuilders.Description }}'
      Platform: '{{ response.AppBlockBuilders.Platform }}'
      InstanceType: '{{ response.AppBlockBuilders.InstanceType }}'
      EnableDefaultInternetAccess: '{{ response.AppBlockBuilders.EnableDefaultInternetAccess
        }}'
      IamRoleArn: '{{ response.AppBlockBuilders.IamRoleArn }}'
      VpcConfig: '{{ response.AppBlockBuilders.VpcConfig }}'
      State: '{{ response.AppBlockBuilders.State }}'
      CreatedTime: '{{ response.AppBlockBuilders.CreatedTime }}'
      AppBlockBuilderErrors: '{{ response.AppBlockBuilders.AppBlockBuilderErrors }}'
      StateChangeReason: '{{ response.AppBlockBuilders.StateChangeReason }}'
      AccessEndpoints: '{{ response.AppBlockBuilders.AccessEndpoints }}'
checks:
- rule_id: aws.appstream.resource.fleet_default_internet_access_disabled
  for_each: aws.appstream.describe_app_block_builders
  conditions:
    var: item.EnableDefaultInternetAccess
    op: equals
    value: 'FALSE'
