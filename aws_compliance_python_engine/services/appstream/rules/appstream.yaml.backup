version: '1.0'
provider: aws
service: appstream
discovery:
- discovery_id: aws.appstream.describe_app_block_builders
  calls:
  - action: describe_app_block_builders
    save_as: describe_app_block_builders_response
  emit:
    items_for: '{{ describe_app_block_builders_response.AppBlockBuilders }}'
    as: resource
    item:
      arn: '{{ resource.Arn }}'
      name: '{{ resource.Name }}'
      display_name: '{{ resource.DisplayName }}'
      description: '{{ resource.Description }}'
      platform: '{{ resource.Platform }}'
      instance_type: '{{ resource.InstanceType }}'
      enable_default_internet_access: '{{ resource.EnableDefaultInternetAccess }}'
      iam_role_arn: '{{ resource.IamRoleArn }}'
      vpc_config: '{{ resource.VpcConfig }}'
      state: '{{ resource.State }}'
checks:
- rule_id: aws.appstream.resource.fleet_default_internet_access_disabled
  for_each: aws.appstream.describe_app_block_builders
  conditions:
    var: item.enable_default_internet_access
    op: equals
    value: false
