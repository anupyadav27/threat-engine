version: '1.0'
provider: aws
service: appsync
services:
  client: appsync
  module: boto3.client
discovery:
- discovery_id: aws.appsync.list_graphql_apis
  calls:
  - action: list_graphql_apis
    save_as: response
  emit:
    items_for: '{{ response.graphqlApis }}'
    as: resource
    item:
      name: '{{ resource.name }}'
      apiId: '{{ resource.apiId }}'
      authenticationType: '{{ resource.authenticationType }}'
      logConfig: '{{ resource.logConfig }}'
      userPoolConfig: '{{ resource.userPoolConfig }}'
      openIDConnectConfig: '{{ resource.openIDConnectConfig }}'
      arn: '{{ resource.arn }}'
      uris: '{{ resource.uris }}'
      tags: '{{ resource.tags }}'
      additionalAuthenticationProviders: '{{ resource.additionalAuthenticationProviders
        }}'
      xrayEnabled: '{{ resource.xrayEnabled }}'
      wafWebAclArn: '{{ resource.wafWebAclArn }}'
      lambdaAuthorizerConfig: '{{ resource.lambdaAuthorizerConfig }}'
      dns: '{{ resource.dns }}'
      visibility: '{{ resource.visibility }}'
      apiType: '{{ resource.apiType }}'
      mergedApiExecutionRoleArn: '{{ resource.mergedApiExecutionRoleArn }}'
      owner: '{{ resource.owner }}'
      ownerContact: '{{ resource.ownerContact }}'
      introspectionConfig: '{{ resource.introspectionConfig }}'
      queryDepthLimit: '{{ resource.queryDepthLimit }}'
      resolverCountLimit: '{{ resource.resolverCountLimit }}'
      enhancedMetricsConfig: '{{ resource.enhancedMetricsConfig }}'
checks:
- rule_id: aws.appsync.field.level_logging_enabled
  for_each: aws.appsync.list_graphql_apis
  conditions:
    var: item.logConfig
    op: not_equals
    value: 'null'
- rule_id: aws.appsync.resource.field_level_logging_enabled
  for_each: aws.appsync.list_graphql_apis
  conditions:
    var: item.logConfig
    op: not_equals
    value: 'null'
