version: '1.0'
provider: aws
service: autoscaling
services:
  client: autoscaling
  module: boto3.client
discovery:
- discovery_id: aws.autoscaling.describe_auto_scaling_groups
  calls:
  - action: describe_auto_scaling_groups
    save_as: response
  emit:
    item:
      AutoScalingGroupName: '{{ response.AutoScalingGroups.AutoScalingGroupName }}'
      AutoScalingGroupARN: '{{ response.AutoScalingGroups.AutoScalingGroupARN }}'
      LaunchConfigurationName: '{{ response.AutoScalingGroups.LaunchConfigurationName
        }}'
      LaunchTemplate: '{{ response.AutoScalingGroups.LaunchTemplate }}'
      MixedInstancesPolicy: '{{ response.AutoScalingGroups.MixedInstancesPolicy }}'
      MinSize: '{{ response.AutoScalingGroups.MinSize }}'
      MaxSize: '{{ response.AutoScalingGroups.MaxSize }}'
      DesiredCapacity: '{{ response.AutoScalingGroups.DesiredCapacity }}'
      PredictedCapacity: '{{ response.AutoScalingGroups.PredictedCapacity }}'
      DefaultCooldown: '{{ response.AutoScalingGroups.DefaultCooldown }}'
      AvailabilityZones: '{{ response.AutoScalingGroups.AvailabilityZones }}'
      LoadBalancerNames: '{{ response.AutoScalingGroups.LoadBalancerNames }}'
      TargetGroupARNs: '{{ response.AutoScalingGroups.TargetGroupARNs }}'
      HealthCheckType: '{{ response.AutoScalingGroups.HealthCheckType }}'
      HealthCheckGracePeriod: '{{ response.AutoScalingGroups.HealthCheckGracePeriod
        }}'
      Instances: '{{ response.AutoScalingGroups.Instances }}'
      CreatedTime: '{{ response.AutoScalingGroups.CreatedTime }}'
      SuspendedProcesses: '{{ response.AutoScalingGroups.SuspendedProcesses }}'
      PlacementGroup: '{{ response.AutoScalingGroups.PlacementGroup }}'
      VPCZoneIdentifier: '{{ response.AutoScalingGroups.VPCZoneIdentifier }}'
      EnabledMetrics: '{{ response.AutoScalingGroups.EnabledMetrics }}'
      Status: '{{ response.AutoScalingGroups.Status }}'
      Tags: '{{ response.AutoScalingGroups.Tags }}'
      TerminationPolicies: '{{ response.AutoScalingGroups.TerminationPolicies }}'
      NewInstancesProtectedFromScaleIn: '{{ response.AutoScalingGroups.NewInstancesProtectedFromScaleIn
        }}'
      ServiceLinkedRoleARN: '{{ response.AutoScalingGroups.ServiceLinkedRoleARN }}'
      MaxInstanceLifetime: '{{ response.AutoScalingGroups.MaxInstanceLifetime }}'
      CapacityRebalance: '{{ response.AutoScalingGroups.CapacityRebalance }}'
      WarmPoolConfiguration: '{{ response.AutoScalingGroups.WarmPoolConfiguration
        }}'
      WarmPoolSize: '{{ response.AutoScalingGroups.WarmPoolSize }}'
      Context: '{{ response.AutoScalingGroups.Context }}'
      DesiredCapacityType: '{{ response.AutoScalingGroups.DesiredCapacityType }}'
      DefaultInstanceWarmup: '{{ response.AutoScalingGroups.DefaultInstanceWarmup
        }}'
      TrafficSources: '{{ response.AutoScalingGroups.TrafficSources }}'
      InstanceMaintenancePolicy: '{{ response.AutoScalingGroups.InstanceMaintenancePolicy
        }}'
      AvailabilityZoneDistribution: '{{ response.AutoScalingGroups.AvailabilityZoneDistribution
        }}'
      AvailabilityZoneImpairmentPolicy: '{{ response.AutoScalingGroups.AvailabilityZoneImpairmentPolicy
        }}'
      CapacityReservationSpecification: '{{ response.AutoScalingGroups.CapacityReservationSpecification
        }}'
      InstanceLifecyclePolicy: '{{ response.AutoScalingGroups.InstanceLifecyclePolicy
        }}'
- discovery_id: aws.autoscaling.describe_policies
  calls:
  - action: describe_policies
    save_as: response
  emit:
    item:
      AutoScalingGroupName: '{{ response.ScalingPolicies.AutoScalingGroupName }}'
      PolicyName: '{{ response.ScalingPolicies.PolicyName }}'
      PolicyARN: '{{ response.ScalingPolicies.PolicyARN }}'
      PolicyType: '{{ response.ScalingPolicies.PolicyType }}'
      AdjustmentType: '{{ response.ScalingPolicies.AdjustmentType }}'
      MinAdjustmentStep: '{{ response.ScalingPolicies.MinAdjustmentStep }}'
      MinAdjustmentMagnitude: '{{ response.ScalingPolicies.MinAdjustmentMagnitude
        }}'
      ScalingAdjustment: '{{ response.ScalingPolicies.ScalingAdjustment }}'
      Cooldown: '{{ response.ScalingPolicies.Cooldown }}'
      StepAdjustments: '{{ response.ScalingPolicies.StepAdjustments }}'
      MetricAggregationType: '{{ response.ScalingPolicies.MetricAggregationType }}'
      EstimatedInstanceWarmup: '{{ response.ScalingPolicies.EstimatedInstanceWarmup
        }}'
      Alarms: '{{ response.ScalingPolicies.Alarms }}'
      TargetTrackingConfiguration: '{{ response.ScalingPolicies.TargetTrackingConfiguration
        }}'
      Enabled: '{{ response.ScalingPolicies.Enabled }}'
      PredictiveScalingConfiguration: '{{ response.ScalingPolicies.PredictiveScalingConfiguration
        }}'
checks:
- rule_id: aws.autoscaling.group.autoscaling_multiple_az_configured
  for_each: aws.autoscaling.describe_auto_scaling_groups
  conditions:
    var: item.AvailabilityZones
    op: gt
    value: 1
- rule_id: aws.autoscaling.group.autoscaling_capacity_rebalance_enabled
  for_each: aws.autoscaling.describe_policies
  conditions:
    var: item.Enabled
    op: equals
    value: true
- rule_id: aws.autoscaling.group.security_check_health_check_enabled
  for_each: aws.autoscaling.describe_auto_scaling_groups
  conditions:
    var: item.HealthCheckType
    op: equals
    value: ELB
