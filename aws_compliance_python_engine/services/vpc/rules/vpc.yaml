version: '1.0'
provider: aws
service: vpc
services:
  client: vpc
  module: boto3.client
discovery:
- discovery_id: aws.vpc.describe_carrier_gateways
  calls:
  - action: describe_carrier_gateways
    save_as: response
  emit:
    item:
      CarrierGatewayId: '{{ response.CarrierGateways.CarrierGatewayId }}'
      VpcId: '{{ response.CarrierGateways.VpcId }}'
      State: '{{ response.CarrierGateways.State }}'
      OwnerId: '{{ response.CarrierGateways.OwnerId }}'
      Tags: '{{ response.CarrierGateways.Tags }}'
- discovery_id: aws.vpc.describe_vpc_attribute
  calls:
  - action: describe_vpc_attribute
    save_as: response
    params:
      VpcId: '{{ item.VpcId }}'
  for_each: aws.vpc.describe_carrier_gateways
  on_error: continue
  emit:
    item:
      Value: '{{ response.EnableDnsHostnames.Value }}'
      EnableDnsHostnames: '{{ resource.EnableDnsHostnames }}'
- discovery_id: aws.vpc.describe_flow_logs
  calls:
  - action: describe_flow_logs
    save_as: response
  emit:
    item:
      CreationTime: '{{ response.FlowLogs.CreationTime }}'
      DeliverLogsErrorMessage: '{{ response.FlowLogs.DeliverLogsErrorMessage }}'
      DeliverLogsPermissionArn: '{{ response.FlowLogs.DeliverLogsPermissionArn }}'
      DeliverCrossAccountRole: '{{ response.FlowLogs.DeliverCrossAccountRole }}'
      DeliverLogsStatus: '{{ response.FlowLogs.DeliverLogsStatus }}'
      FlowLogId: '{{ response.FlowLogs.FlowLogId }}'
      FlowLogStatus: '{{ response.FlowLogs.FlowLogStatus }}'
      LogGroupName: '{{ response.FlowLogs.LogGroupName }}'
      ResourceId: '{{ response.FlowLogs.ResourceId }}'
      TrafficType: '{{ response.FlowLogs.TrafficType }}'
      LogDestinationType: '{{ response.FlowLogs.LogDestinationType }}'
      LogDestination: '{{ response.FlowLogs.LogDestination }}'
      LogFormat: '{{ response.FlowLogs.LogFormat }}'
      Tags: '{{ response.FlowLogs.Tags }}'
      MaxAggregationInterval: '{{ response.FlowLogs.MaxAggregationInterval }}'
      DestinationOptions: '{{ response.FlowLogs.DestinationOptions }}'
      FlowLogs: '{{ resource.FlowLogs }}'
- discovery_id: aws.vpc.describe_security_group_rules
  calls:
  - action: describe_security_group_rules
    save_as: response
  emit:
    item:
      SecurityGroupRuleId: '{{ response.SecurityGroupRules.SecurityGroupRuleId }}'
      GroupId: '{{ response.SecurityGroupRules.GroupId }}'
      GroupOwnerId: '{{ response.SecurityGroupRules.GroupOwnerId }}'
      IsEgress: '{{ response.SecurityGroupRules.IsEgress }}'
      IpProtocol: '{{ response.SecurityGroupRules.IpProtocol }}'
      FromPort: '{{ response.SecurityGroupRules.FromPort }}'
      ToPort: '{{ response.SecurityGroupRules.ToPort }}'
      CidrIpv4: '{{ response.SecurityGroupRules.CidrIpv4 }}'
      CidrIpv6: '{{ response.SecurityGroupRules.CidrIpv6 }}'
      PrefixListId: '{{ response.SecurityGroupRules.PrefixListId }}'
      ReferencedGroupInfo: '{{ response.SecurityGroupRules.ReferencedGroupInfo }}'
      Description: '{{ response.SecurityGroupRules.Description }}'
      Tags: '{{ response.SecurityGroupRules.Tags }}'
      SecurityGroupRuleArn: '{{ response.SecurityGroupRules.SecurityGroupRuleArn }}'
      SecurityGroupRules: '{{ resource.SecurityGroupRules }}'
- discovery_id: aws.vpc.describe_route_tables
  calls:
  - action: describe_route_tables
    save_as: response
  emit:
    item:
      Associations: '{{ response.RouteTables.Associations }}'
      PropagatingVgws: '{{ response.RouteTables.PropagatingVgws }}'
      RouteTableId: '{{ response.RouteTables.RouteTableId }}'
      Routes: '{{ response.RouteTables.Routes }}'
      Tags: '{{ response.RouteTables.Tags }}'
      VpcId: '{{ response.RouteTables.VpcId }}'
      OwnerId: '{{ response.RouteTables.OwnerId }}'
      RouteTables: '{{ resource.RouteTables }}'
- discovery_id: aws.vpc.describe_network_acls
  calls:
  - action: describe_network_acls
    save_as: response
  emit:
    item:
      Associations: '{{ response.NetworkAcls.Associations }}'
      Entries: '{{ response.NetworkAcls.Entries }}'
      IsDefault: '{{ response.NetworkAcls.IsDefault }}'
      NetworkAclId: '{{ response.NetworkAcls.NetworkAclId }}'
      Tags: '{{ response.NetworkAcls.Tags }}'
      VpcId: '{{ response.NetworkAcls.VpcId }}'
      OwnerId: '{{ response.NetworkAcls.OwnerId }}'
      NetworkAcls: '{{ resource.NetworkAcls }}'
- discovery_id: aws.vpc.describe_vpc_endpoints
  calls:
  - action: describe_vpc_endpoints
    save_as: response
  emit:
    item:
      VpcEndpointId: '{{ response.VpcEndpoints.VpcEndpointId }}'
      VpcEndpointType: '{{ response.VpcEndpoints.VpcEndpointType }}'
      VpcId: '{{ response.VpcEndpoints.VpcId }}'
      ServiceName: '{{ response.VpcEndpoints.ServiceName }}'
      State: '{{ response.VpcEndpoints.State }}'
      PolicyDocument: '{{ response.VpcEndpoints.PolicyDocument }}'
      RouteTableIds: '{{ response.VpcEndpoints.RouteTableIds }}'
      SubnetIds: '{{ response.VpcEndpoints.SubnetIds }}'
      Groups: '{{ response.VpcEndpoints.Groups }}'
      IpAddressType: '{{ response.VpcEndpoints.IpAddressType }}'
      DnsOptions: '{{ response.VpcEndpoints.DnsOptions }}'
      PrivateDnsEnabled: '{{ response.VpcEndpoints.PrivateDnsEnabled }}'
      RequesterManaged: '{{ response.VpcEndpoints.RequesterManaged }}'
      NetworkInterfaceIds: '{{ response.VpcEndpoints.NetworkInterfaceIds }}'
      DnsEntries: '{{ response.VpcEndpoints.DnsEntries }}'
      CreationTimestamp: '{{ response.VpcEndpoints.CreationTimestamp }}'
      Tags: '{{ response.VpcEndpoints.Tags }}'
      OwnerId: '{{ response.VpcEndpoints.OwnerId }}'
      LastError: '{{ response.VpcEndpoints.LastError }}'
      Ipv4Prefixes: '{{ response.VpcEndpoints.Ipv4Prefixes }}'
      Ipv6Prefixes: '{{ response.VpcEndpoints.Ipv6Prefixes }}'
      FailureReason: '{{ response.VpcEndpoints.FailureReason }}'
      ServiceNetworkArn: '{{ response.VpcEndpoints.ServiceNetworkArn }}'
      ResourceConfigurationArn: '{{ response.VpcEndpoints.ResourceConfigurationArn
        }}'
      ServiceRegion: '{{ response.VpcEndpoints.ServiceRegion }}'
- discovery_id: aws.vpc.describe_internet_gateways
  calls:
  - action: describe_internet_gateways
    save_as: response
  emit:
    item:
      Attachments: '{{ response.InternetGateways.Attachments }}'
      InternetGatewayId: '{{ response.InternetGateways.InternetGatewayId }}'
      OwnerId: '{{ response.InternetGateways.OwnerId }}'
      Tags: '{{ response.InternetGateways.Tags }}'
- discovery_id: aws.vpc.describe_vpc_endpoint_connections
  calls:
  - action: describe_vpc_endpoint_connections
    save_as: response
  emit:
    item:
      ServiceId: '{{ response.VpcEndpointConnections.ServiceId }}'
      VpcEndpointId: '{{ response.VpcEndpointConnections.VpcEndpointId }}'
      VpcEndpointOwner: '{{ response.VpcEndpointConnections.VpcEndpointOwner }}'
      VpcEndpointState: '{{ response.VpcEndpointConnections.VpcEndpointState }}'
      CreationTimestamp: '{{ response.VpcEndpointConnections.CreationTimestamp }}'
      DnsEntries: '{{ response.VpcEndpointConnections.DnsEntries }}'
      NetworkLoadBalancerArns: '{{ response.VpcEndpointConnections.NetworkLoadBalancerArns
        }}'
      GatewayLoadBalancerArns: '{{ response.VpcEndpointConnections.GatewayLoadBalancerArns
        }}'
      IpAddressType: '{{ response.VpcEndpointConnections.IpAddressType }}'
      VpcEndpointConnectionId: '{{ response.VpcEndpointConnections.VpcEndpointConnectionId
        }}'
      Tags: '{{ response.VpcEndpointConnections.Tags }}'
      VpcEndpointRegion: '{{ response.VpcEndpointConnections.VpcEndpointRegion }}'
      VpcEndpointConnections: '{{ resource.VpcEndpointConnections }}'
- discovery_id: aws.vpc.describe_subnets
  calls:
  - action: describe_subnets
    save_as: response
  emit:
    item:
      AvailabilityZoneId: '{{ response.Subnets.AvailabilityZoneId }}'
      EnableLniAtDeviceIndex: '{{ response.Subnets.EnableLniAtDeviceIndex }}'
      MapCustomerOwnedIpOnLaunch: '{{ response.Subnets.MapCustomerOwnedIpOnLaunch
        }}'
      CustomerOwnedIpv4Pool: '{{ response.Subnets.CustomerOwnedIpv4Pool }}'
      OwnerId: '{{ response.Subnets.OwnerId }}'
      AssignIpv6AddressOnCreation: '{{ response.Subnets.AssignIpv6AddressOnCreation
        }}'
      Ipv6CidrBlockAssociationSet: '{{ response.Subnets.Ipv6CidrBlockAssociationSet
        }}'
      Tags: '{{ response.Subnets.Tags }}'
      SubnetArn: '{{ response.Subnets.SubnetArn }}'
      OutpostArn: '{{ response.Subnets.OutpostArn }}'
      EnableDns64: '{{ response.Subnets.EnableDns64 }}'
      Ipv6Native: '{{ response.Subnets.Ipv6Native }}'
      PrivateDnsNameOptionsOnLaunch: '{{ response.Subnets.PrivateDnsNameOptionsOnLaunch
        }}'
      BlockPublicAccessStates: '{{ response.Subnets.BlockPublicAccessStates }}'
      Type: '{{ response.Subnets.Type }}'
      SubnetId: '{{ response.Subnets.SubnetId }}'
      State: '{{ response.Subnets.State }}'
      VpcId: '{{ response.Subnets.VpcId }}'
      CidrBlock: '{{ response.Subnets.CidrBlock }}'
      AvailableIpAddressCount: '{{ response.Subnets.AvailableIpAddressCount }}'
      AvailabilityZone: '{{ response.Subnets.AvailabilityZone }}'
      DefaultForAz: '{{ response.Subnets.DefaultForAz }}'
      MapPublicIpOnLaunch: '{{ response.Subnets.MapPublicIpOnLaunch }}'
- discovery_id: aws.vpc.describe_vpc_endpoint_connection_notifications
  calls:
  - action: describe_vpc_endpoint_connection_notifications
    save_as: response
  emit:
    item:
      ConnectionNotificationId: '{{ response.ConnectionNotificationSet.ConnectionNotificationId
        }}'
      ServiceId: '{{ response.ConnectionNotificationSet.ServiceId }}'
      VpcEndpointId: '{{ response.ConnectionNotificationSet.VpcEndpointId }}'
      ConnectionNotificationType: '{{ response.ConnectionNotificationSet.ConnectionNotificationType
        }}'
      ConnectionNotificationArn: '{{ response.ConnectionNotificationSet.ConnectionNotificationArn
        }}'
      ConnectionEvents: '{{ response.ConnectionNotificationSet.ConnectionEvents }}'
      ConnectionNotificationState: '{{ response.ConnectionNotificationSet.ConnectionNotificationState
        }}'
      ServiceRegion: '{{ response.ConnectionNotificationSet.ServiceRegion }}'
- discovery_id: aws.vpc.describe_vpc_endpoint_service_permissions
  calls:
  - action: describe_vpc_endpoint_service_permissions
    save_as: response
    params:
      ServiceId: '{{ item.ServiceId }}'
  for_each: aws.vpc.describe_vpc_endpoint_connection_notifications
  on_error: continue
  emit:
    item:
      PrincipalType: '{{ response.AllowedPrincipals.PrincipalType }}'
      Principal: '{{ response.AllowedPrincipals.Principal }}'
      ServicePermissionId: '{{ response.AllowedPrincipals.ServicePermissionId }}'
      Tags: '{{ response.AllowedPrincipals.Tags }}'
      ServiceId: '{{ response.AllowedPrincipals.ServiceId }}'
      AllowedPrincipals: '{{ resource.AllowedPrincipals }}'
- discovery_id: aws.vpc.describe_security_groups
  calls:
  - action: describe_security_groups
    save_as: response
  emit:
    item:
      GroupId: '{{ response.SecurityGroups.GroupId }}'
      IpPermissionsEgress: '{{ response.SecurityGroups.IpPermissionsEgress }}'
      Tags: '{{ response.SecurityGroups.Tags }}'
      VpcId: '{{ response.SecurityGroups.VpcId }}'
      SecurityGroupArn: '{{ response.SecurityGroups.SecurityGroupArn }}'
      OwnerId: '{{ response.SecurityGroups.OwnerId }}'
      GroupName: '{{ response.SecurityGroups.GroupName }}'
      Description: '{{ response.SecurityGroups.Description }}'
      IpPermissions: '{{ response.SecurityGroups.IpPermissions }}'
      SecurityGroups: '{{ resource.SecurityGroups }}'
- discovery_id: aws.vpc.describe_network_interface_attribute
  calls:
  - action: describe_network_interface_attribute
    save_as: response
  emit:
    item:
      GroupId: '{{ response.Groups.GroupId }}'
      GroupName: '{{ response.Groups.GroupName }}'
      AssociatePublicIpAddress: '{{ resource.AssociatePublicIpAddress }}'
- discovery_id: aws.vpc.describe_transit_gateway_vpc_attachments
  calls:
  - action: describe_transit_gateway_vpc_attachments
    save_as: response
  emit:
    item:
      TransitGatewayAttachmentId: '{{ response.TransitGatewayVpcAttachments.TransitGatewayAttachmentId
        }}'
      TransitGatewayId: '{{ response.TransitGatewayVpcAttachments.TransitGatewayId
        }}'
      VpcId: '{{ response.TransitGatewayVpcAttachments.VpcId }}'
      VpcOwnerId: '{{ response.TransitGatewayVpcAttachments.VpcOwnerId }}'
      State: '{{ response.TransitGatewayVpcAttachments.State }}'
      SubnetIds: '{{ response.TransitGatewayVpcAttachments.SubnetIds }}'
      CreationTime: '{{ response.TransitGatewayVpcAttachments.CreationTime }}'
      Options: '{{ response.TransitGatewayVpcAttachments.Options }}'
      Tags: '{{ response.TransitGatewayVpcAttachments.Tags }}'
- discovery_id: aws.vpc.get_active_vpn_tunnel_status
  calls:
  - action: get_active_vpn_tunnel_status
    save_as: response
  emit:
    item:
      Phase1EncryptionAlgorithm: '{{ response.ActiveVpnTunnelStatus.Phase1EncryptionAlgorithm
        }}'
      Phase2EncryptionAlgorithm: '{{ response.ActiveVpnTunnelStatus.Phase2EncryptionAlgorithm
        }}'
      Phase1IntegrityAlgorithm: '{{ response.ActiveVpnTunnelStatus.Phase1IntegrityAlgorithm
        }}'
      Phase2IntegrityAlgorithm: '{{ response.ActiveVpnTunnelStatus.Phase2IntegrityAlgorithm
        }}'
      Phase1DHGroup: '{{ response.ActiveVpnTunnelStatus.Phase1DHGroup }}'
      Phase2DHGroup: '{{ response.ActiveVpnTunnelStatus.Phase2DHGroup }}'
      IkeVersion: '{{ response.ActiveVpnTunnelStatus.IkeVersion }}'
      ProvisioningStatus: '{{ response.ActiveVpnTunnelStatus.ProvisioningStatus }}'
      ProvisioningStatusReason: '{{ response.ActiveVpnTunnelStatus.ProvisioningStatusReason
        }}'
      ActiveVpnTunnelStatus: '{{ resource.ActiveVpnTunnelStatus }}'
- discovery_id: aws.vpc.describe_regions
  calls:
  - action: describe_regions
    save_as: response
  emit:
    item:
      OptInStatus: '{{ response.Regions.OptInStatus }}'
      RegionName: '{{ response.Regions.RegionName }}'
      Endpoint: '{{ response.Regions.Endpoint }}'
      Regions: '{{ resource.Regions }}'
- discovery_id: aws.vpc.get_launch_template_data
  calls:
  - action: get_launch_template_data
    save_as: response
  emit:
    item:
      KernelId: '{{ response.LaunchTemplateData.KernelId }}'
      EbsOptimized: '{{ response.LaunchTemplateData.EbsOptimized }}'
      IamInstanceProfile: '{{ response.LaunchTemplateData.IamInstanceProfile }}'
      BlockDeviceMappings: '{{ response.LaunchTemplateData.BlockDeviceMappings }}'
      NetworkInterfaces: '{{ response.LaunchTemplateData.NetworkInterfaces }}'
      ImageId: '{{ response.LaunchTemplateData.ImageId }}'
      InstanceType: '{{ response.LaunchTemplateData.InstanceType }}'
      KeyName: '{{ response.LaunchTemplateData.KeyName }}'
      Monitoring: '{{ response.LaunchTemplateData.Monitoring }}'
      Placement: '{{ response.LaunchTemplateData.Placement }}'
      RamDiskId: '{{ response.LaunchTemplateData.RamDiskId }}'
      DisableApiTermination: '{{ response.LaunchTemplateData.DisableApiTermination
        }}'
      InstanceInitiatedShutdownBehavior: '{{ response.LaunchTemplateData.InstanceInitiatedShutdownBehavior
        }}'
      UserData: '{{ response.LaunchTemplateData.UserData }}'
      TagSpecifications: '{{ response.LaunchTemplateData.TagSpecifications }}'
      ElasticGpuSpecifications: '{{ response.LaunchTemplateData.ElasticGpuSpecifications
        }}'
      ElasticInferenceAccelerators: '{{ response.LaunchTemplateData.ElasticInferenceAccelerators
        }}'
      SecurityGroupIds: '{{ response.LaunchTemplateData.SecurityGroupIds }}'
      SecurityGroups: '{{ response.LaunchTemplateData.SecurityGroups }}'
      InstanceMarketOptions: '{{ response.LaunchTemplateData.InstanceMarketOptions
        }}'
      CreditSpecification: '{{ response.LaunchTemplateData.CreditSpecification }}'
      CpuOptions: '{{ response.LaunchTemplateData.CpuOptions }}'
      CapacityReservationSpecification: '{{ response.LaunchTemplateData.CapacityReservationSpecification
        }}'
      LicenseSpecifications: '{{ response.LaunchTemplateData.LicenseSpecifications
        }}'
      HibernationOptions: '{{ response.LaunchTemplateData.HibernationOptions }}'
      MetadataOptions: '{{ response.LaunchTemplateData.MetadataOptions }}'
      EnclaveOptions: '{{ response.LaunchTemplateData.EnclaveOptions }}'
      InstanceRequirements: '{{ response.LaunchTemplateData.InstanceRequirements }}'
      PrivateDnsNameOptions: '{{ response.LaunchTemplateData.PrivateDnsNameOptions
        }}'
      MaintenanceOptions: '{{ response.LaunchTemplateData.MaintenanceOptions }}'
      DisableApiStop: '{{ response.LaunchTemplateData.DisableApiStop }}'
      Operator: '{{ response.LaunchTemplateData.Operator }}'
      NetworkPerformanceOptions: '{{ response.LaunchTemplateData.NetworkPerformanceOptions
        }}'
checks:
- rule_id: aws.vpc.subnet.dns_hostnames_and_support_configured
  for_each: aws.vpc.describe_vpc_attribute
  conditions:
    var: item.EnableDnsHostnames
    op: equals
    value: 'true'
- rule_id: aws.vpc.customergateway.flow_logging_enabled
  for_each: aws.vpc.describe_flow_logs
  conditions:
    var: item.FlowLogs
    op: equals
    value: enabled
- rule_id: aws.vpc.internetgateway.flow_logging_enabled
  for_each: aws.vpc.describe_flow_logs
  conditions:
    var: item.FlowLogs
    op: equals
    value: enabled
- rule_id: aws.vpc.vpcendpoint.dns_hostnames_and_support_configured
  for_each: aws.vpc.describe_vpc_attribute
  conditions:
    var: item.EnableDnsHostnames
    op: equals
    value: 'true'
- rule_id: aws.vpc.subnet.flow_logging_enabled
  for_each: aws.vpc.describe_flow_logs
  conditions:
    var: item.FlowLogs
    op: equals
    value: enabled
- rule_id: aws.vpc.vpc.flow_logging_enabled
  for_each: aws.vpc.describe_flow_logs
  conditions:
    var: item.FlowLogs
    op: equals
    value: enabled
- rule_id: aws.vpc.securitygroup.security_closed_ports_restricted
  for_each: aws.vpc.describe_security_group_rules
  conditions:
    var: item.SecurityGroupRules
    op: not_equals
    value: 'null'
- rule_id: aws.vpc.networkacl.network_dns_hostnames_and_support_configured
  for_each: aws.vpc.describe_vpc_attribute
  conditions:
    var: item.EnableDnsHostnames
    op: equals
    value: 'true'
- rule_id: aws.vpc.customergateway.api_dns_hostnames_and_support_configured
  for_each: aws.vpc.describe_vpc_attribute
  conditions:
    var: item.EnableDnsHostnames
    op: equals
    value: 'true'
- rule_id: aws.vpc.resource.flow_log_active_rejects_enabled
  for_each: aws.vpc.describe_flow_logs
  conditions:
    var: item.FlowLogStatus
    op: equals
    value: active
- rule_id: aws.vpc.vpnconnection.flow_logging_enabled
  for_each: aws.vpc.describe_flow_logs
  conditions:
    var: item.FlowLogs
    op: contains
    value: enabled
- rule_id: aws.vpc.securitygroup.route_tables_no_unintended_internet_paths_configured
  for_each: aws.vpc.describe_route_tables
  conditions:
    var: item.RouteTables
    op: not_equals
    value: 'null'
- rule_id: aws.vpc.nacl_ingress_restricted_ports_22_3389.nacl_ingress_restricted_ports_22_3389_configured
  for_each: aws.vpc.describe_network_acls
  conditions:
    var: item.NetworkAcls
    op: contains
    value: 22,3389
- rule_id: aws.vpc.resource.endpoint_multi_az_enabled
  for_each: aws.vpc.describe_vpc_endpoints
  conditions:
    var: item.VpcEndpointType
    op: equals
    value: Interface
- rule_id: aws.vpc.network_interface.flow_logging_enabled
  for_each: aws.vpc.describe_flow_logs
  conditions:
    var: item.FlowLogStatus
    op: equals
    value: active
- rule_id: aws.vpc.internetgateway.api_dns_hostnames_and_support_configured
  for_each: aws.vpc.describe_vpc_attribute
  conditions:
    var: item.EnableDnsHostnames
    op: equals
    value: 'true'
- rule_id: aws.vpc.routetable.s_no_unintended_internet_paths_configured
  for_each: aws.vpc.describe_internet_gateways
  conditions:
    var: item.InternetGatewayId
    op: not_equals
    value: 'null'
- rule_id: aws.vpc.resource.endpoint_for_ec2_enabled
  for_each: aws.vpc.describe_vpc_endpoint_connections
  conditions:
    var: item.VpcEndpointState
    op: equals
    value: Available
- rule_id: aws.vpc.network_interface.network_dns_hostnames_and_support_configured
  for_each: aws.vpc.describe_vpc_attribute
  conditions:
    var: item.EnableDnsHostnames
    op: equals
    value: 'true'
- rule_id: aws.vpc.routetable.dns_hostnames_and_support_configured
  for_each: aws.vpc.describe_vpc_attribute
  conditions:
    var: item.EnableDnsHostnames
    op: equals
    value: 'true'
- rule_id: aws.vpc.resource.flow_logging_enabled
  for_each: aws.vpc.describe_flow_logs
  conditions:
    var: item.FlowLogs
    op: equals
    value: enabled
- rule_id: aws.vpc.subnet_separate_private_public.subnet_separate_private_public_configured
  for_each: aws.vpc.describe_subnets
  conditions:
    var: item.BlockPublicAccessStates
    op: not_equals
    value: 'null'
- rule_id: aws.vpc.natgateway.route_tables_no_unintended_internet_paths_configured
  for_each: aws.vpc.describe_route_tables
  conditions:
    var: item.RouteTables
    op: not_equals
    value: 'null'
- rule_id: aws.vpc.vpngateway.api_dns_hostnames_and_support_configured
  for_each: aws.vpc.describe_vpc_attribute
  conditions:
    var: item.EnableDnsHostnames
    op: equals
    value: 'true'
- rule_id: aws.vpc.vpcendpoint.flow_logging_enabled
  for_each: aws.vpc.describe_flow_logs
  conditions:
    var: item.FlowLogs
    op: equals
    value: enabled
- rule_id: aws.vpc.customergateway.route_tables_no_unintended_internet_paths_configured
  for_each: aws.vpc.describe_route_tables
  conditions:
    var: item.RouteTables
    op: not_equals
    value: 'null'
- rule_id: aws.vpc.securitygroup.security_dns_hostnames_and_support_configured
  for_each: aws.vpc.describe_vpc_attribute
  conditions:
    var: item.EnableDnsHostnames
    op: equals
    value: 'true'
- rule_id: aws.vpc.endpoint_services_allowed_principals_trust_boundaries.endpoint_principals_trust_boundaries_configured
  for_each: aws.vpc.describe_vpc_endpoint_service_permissions
  conditions:
    var: item.AllowedPrincipals
    op: not_equals
    value: 'null'
- rule_id: aws.vpc.peering_routing_tables_with_least_privilege.privilege
  for_each: aws.vpc.describe_security_groups
  conditions:
    var: item.SecurityGroups
    op: contains
    value: least-privilege-security-group
- rule_id: aws.vpc.natgateway.api_dns_hostnames_and_support_configured
  for_each: aws.vpc.describe_vpc_attribute
  conditions:
    var: item.EnableDnsHostnames
    op: equals
    value: 'true'
- rule_id: aws.vpc.subnet_no_public_ip_by_default.subnet_no_public_ip_by_default_configured
  for_each: aws.vpc.describe_network_interface_attribute
  conditions:
    var: item.AssociatePublicIpAddress
    op: equals
    value: 'false'
- rule_id: aws.vpc.networkacl.route_tables_no_unintended_internet_paths_configured
  for_each: aws.vpc.describe_route_tables
  conditions:
    var: item.RouteTables
    op: not_equals
    value: 'null'
- rule_id: aws.vpc.vpngateway.route_tables_no_unintended_internet_paths_configured
  for_each: aws.vpc.describe_route_tables
  conditions:
    var: item.RouteTables
    op: not_equals
    value: 'null'
- rule_id: aws.vpc.vpngateway.flow_logging_enabled
  for_each: aws.vpc.describe_flow_logs
  conditions:
    var: item.FlowLogs
    op: equals
    value: enabled
- rule_id: aws.vpc.network.acl_unused_configured
  for_each: aws.vpc.describe_network_acls
  conditions:
    var: item.NetworkAcls
    op: not_equals
    value: 'null'
- rule_id: aws.vpc.securitygroup.flow_logging_enabled
  for_each: aws.vpc.describe_flow_logs
  conditions:
    var: item.FlowLogs
    op: equals
    value: enabled
- rule_id: aws.vpc.natgateway.flow_logging_enabled
  for_each: aws.vpc.describe_flow_logs
  conditions:
    var: item.FlowLogs
    op: equals
    value: enabled
- rule_id: aws.vpc.endpoint_connections_trust_boundaries.endpoint_connections_trust_boundaries_configured
  for_each: aws.vpc.describe_vpc_endpoint_connections
  conditions:
    var: item.VpcEndpointConnections
    op: contains
    value: 'null'
- rule_id: aws.vpc.flow.logging_enabled
  for_each: aws.vpc.describe_flow_logs
  conditions:
    var: item.FlowLogs
    op: equals
    value: enabled
- rule_id: aws.vpc.network_interface.route_tables_no_unintended_internet_paths_configured
  for_each: aws.vpc.describe_route_tables
  conditions:
    var: item.RouteTables
    op: not_equals
    value: 'null'
- rule_id: aws.vpc.networkacl.flow_logging_enabled
  for_each: aws.vpc.describe_flow_logs
  conditions:
    var: item.FlowLogs
    op: equals
    value: enabled
- rule_id: aws.vpc.subnet_different_az.subnet_different_az_configured
  for_each: aws.vpc.describe_transit_gateway_vpc_attachments
  conditions:
    var: item.SubnetIds
    op: not_equals
    value: 'null'
- rule_id: aws.vpc.vpnconnection.dns_hostnames_and_support_configured
  for_each: aws.vpc.describe_vpc_attribute
  conditions:
    var: item.EnableDnsHostnames
    op: equals
    value: 'true'
- rule_id: aws.vpc.vpcendpoint.route_tables_no_unintended_internet_paths_configured
  for_each: aws.vpc.describe_route_tables
  conditions:
    var: item.RouteTables
    op: not_equals
    value: 'null'
- rule_id: aws.vpc.vpn_connection_tunnels_up.vpn_connection_tunnels_up_configured
  for_each: aws.vpc.get_active_vpn_tunnel_status
  conditions:
    var: item.ActiveVpnTunnelStatus
    op: equals
    value: available
- rule_id: aws.vpc.vpnconnection.route_tables_no_unintended_internet_paths_configured
  for_each: aws.vpc.describe_route_tables
  conditions:
    var: item.RouteTables
    op: not_equals
    value: 'null'
- rule_id: aws.vpc.subnet.route_tables_no_unintended_internet_paths_configured
  for_each: aws.vpc.describe_route_tables
  conditions:
    var: item.RouteTables
    op: not_equals
    value: 'null'
- rule_id: aws.vpc.different_regions.different_regions_configured
  for_each: aws.vpc.describe_regions
  conditions:
    var: item.Regions
    op: contains
    value: us-east-1
- rule_id: aws.vpc.routetable.flow_logging_enabled
  for_each: aws.vpc.describe_flow_logs
  conditions:
    var: item.FlowLogs
    op: equals
    value: enabled
- rule_id: aws.vpc.network.security_monitored
  for_each: aws.vpc.get_launch_template_data
  conditions:
    var: item.Monitoring
    op: equals
    value: 'true'
- rule_id: aws.vpc.vpc.route_tables_no_unintended_internet_paths_configured
  for_each: aws.vpc.describe_route_tables
  conditions:
    var: item.RouteTables
    op: not_equals
    value: 'null'
- rule_id: aws.vpc.internetgateway.route_tables_no_unintended_internet_paths_configured
  for_each: aws.vpc.describe_route_tables
  conditions:
    var: item.RouteTables
    op: not_equals
    value: 'null'
- rule_id: aws.vpc.vpc.dns_hostnames_and_support_configured
  for_each: aws.vpc.describe_vpc_attribute
  conditions:
    var: item.EnableDnsHostnames
    op: equals
    value: 'true'
