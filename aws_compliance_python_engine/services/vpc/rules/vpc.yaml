version: '1.0'
provider: aws
service: ec2
discovery:
- discovery_id: aws.vpc.subnet_no_public_ip_by_defaults
  calls:
  - client: ec2
    action: list_vpcs
    save_as: subnet_no_public_ip_by_default_list
    on_error: continue
    fields:
    - Vpcs
  emit:
    items_for: subnet_no_public_ip_by_default_list[]
    as: subnet_no_public_ip_by_default
    item:
      id: '{{ subnet_no_public_ip_by_default.Id }}'
      name: '{{ subnet_no_public_ip_by_default.Name }}'
- discovery_id: aws.vpc.subnet_no_public_ip_by_default_logging
  for_each: aws.vpc.subnet_no_public_ip_by_defaults
  calls:
  - client: ec2
    action: describe_subnet_no_public_ip_by_default_logging
    params:
      Subnet_no_public_ip_by_defaultId: '{{ item.id }}'
    save_as: logging
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      logging_enabled: '{{ logging.LoggingEnabled is defined if logging else false
        }}'
- discovery_id: aws.vpc.subnet_different_azs
  for_each: aws.vpc.subnet_different_az
  calls:
  - client: ec2
    action: describe_subnet_different_azs
    save_as: subnet_different_azs
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.routetable_logging
  calls:
  - client: ec2
    action: describe_route_tables
    save_as: routetable_logging
    on_error: continue
  emit:
    items_for: routetable_logging[]
    as: routetable_logging
    item:
      id: '{{ routetable_logging.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.subnets
  for_each: aws.vpc.subnet
  calls:
  - client: ec2
    action: describe_subnets
    save_as: subnets
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.resources
  for_each: aws.vpc.resource
  calls:
  - client: ec2
    action: describe_resources
    save_as: resources
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.natgateways
  for_each: aws.vpc.natgateway
  calls:
  - client: ec2
    action: describe_natgateways
    save_as: natgateways
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.routetables
  for_each: aws.vpc.routetable
  calls:
  - client: ec2
    action: describe_route_tables
    save_as: routetables
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.natgateway_logging
  calls:
  - client: ec2
    action: list_natgateway_logging
    save_as: natgateway_logging
    on_error: continue
  emit:
    items_for: natgateway_logging[]
    as: natgateway_logging
    item:
      id: '{{ natgateway_logging.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.customergateways
  for_each: aws.vpc.customergateway
  calls:
  - client: ec2
    action: describe_customergateways
    save_as: customergateways
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.vpngateway_logging
  calls:
  - client: ec2
    action: list_vpngateway_logging
    save_as: vpngateway_logging
    on_error: continue
  emit:
    items_for: vpngateway_logging[]
    as: vpngateway_logging
    item:
      id: '{{ vpngateway_logging.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.internetgateways
  for_each: aws.vpc.internetgateway
  calls:
  - client: ec2
    action: describe_internetgateways
    save_as: internetgateways
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.vpcendpoint_logging
  calls:
  - client: ec2
    action: list_vpcendpoint_logging
    save_as: vpcendpoint_logging
    on_error: continue
  emit:
    items_for: vpcendpoint_logging[]
    as: vpcendpoint_logging
    item:
      id: '{{ vpcendpoint_logging.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.securitygroups
  for_each: aws.vpc.securitygroup
  calls:
  - client: ec2
    action: describe_security_groups
    save_as: securitygroups
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.endpoint_services_allowed_principals_trust_boundariess
  for_each: aws.vpc.endpoint_services_allowed_principals_trust_boundarie
  calls:
  - client: ec2
    action: describe_endpoint_services_allowed_principals_trust_boundariess
    save_as: endpoint_services_allowed_principals_trust_boundariess
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.vpn_connection_tunnels_ups
  for_each: aws.vpc.vpn_connection_tunnels_up
  calls:
  - client: ec2
    action: describe_vpn_connection_tunnels_ups
    save_as: vpn_connection_tunnels_ups
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.securitygroup_logging
  calls:
  - client: ec2
    action: describe_security_groups
    save_as: securitygroup_logging
    on_error: continue
  emit:
    items_for: securitygroup_logging[]
    as: securitygroup_logging
    item:
      id: '{{ securitygroup_logging.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.networkacl_logging
  calls:
  - client: ec2
    action: describe_network_acls
    save_as: networkacl_logging
    on_error: continue
  emit:
    items_for: networkacl_logging[]
    as: networkacl_logging
    item:
      id: '{{ networkacl_logging.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.vpcs
  for_each: aws.vpc.vpc
  calls:
  - client: ec2
    action: describe_vpcs
    save_as: vpcs
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.networks
  for_each: aws.vpc.network
  calls:
  - client: ec2
    action: describe_networks
    save_as: networks
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.flow_logging
  calls:
  - client: ec2
    action: list_flow_logging
    save_as: flow_logging
    on_error: continue
  emit:
    items_for: flow_logging[]
    as: flow_logging
    item:
      id: '{{ flow_logging.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.vpcendpoints
  for_each: aws.vpc.vpcendpoint
  calls:
  - client: ec2
    action: describe_vpcendpoints
    save_as: vpcendpoints
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.peering_routing_tables_with_least_privileges
  for_each: aws.vpc.peering_routing_tables_with_least_privilege
  calls:
  - client: ec2
    action: describe_peering_routing_tables_with_least_privileges
    save_as: peering_routing_tables_with_least_privileges
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.different_regionss
  for_each: aws.vpc.different_region
  calls:
  - client: ec2
    action: describe_different_regionss
    save_as: different_regionss
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.network_interface_logging
  calls:
  - client: ec2
    action: list_network_interface_logging
    save_as: network_interface_logging
    on_error: continue
  emit:
    items_for: network_interface_logging[]
    as: network_interface_logging
    item:
      id: '{{ network_interface_logging.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.vpnconnection_logging
  calls:
  - client: ec2
    action: list_vpnconnection_logging
    save_as: vpnconnection_logging
    on_error: continue
  emit:
    items_for: vpnconnection_logging[]
    as: vpnconnection_logging
    item:
      id: '{{ vpnconnection_logging.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.customergateway_logging
  calls:
  - client: ec2
    action: list_customergateway_logging
    save_as: customergateway_logging
    on_error: continue
  emit:
    items_for: customergateway_logging[]
    as: customergateway_logging
    item:
      id: '{{ customergateway_logging.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.nacl_ingress_restricted_ports_22_3389s
  for_each: aws.vpc.nacl_ingress_restricted_ports_22_3389
  calls:
  - client: ec2
    action: describe_nacl_ingress_restricted_ports_22_3389s
    save_as: nacl_ingress_restricted_ports_22_3389s
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.vpnconnections
  for_each: aws.vpc.vpnconnection
  calls:
  - client: ec2
    action: describe_vpnconnections
    save_as: vpnconnections
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.endpoint_connections_trust_boundariess
  for_each: aws.vpc.endpoint_connections_trust_boundarie
  calls:
  - client: ec2
    action: describe_endpoint_connections_trust_boundariess
    save_as: endpoint_connections_trust_boundariess
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.resource_logging
  calls:
  - client: ec2
    action: describe_load_balancers
    save_as: resource_logging
    on_error: continue
  emit:
    items_for: resource_logging[]
    as: resource_logging
    item:
      id: '{{ resource_logging.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.vpc_logging
  calls:
  - client: ec2
    action: list_vpc_logging
    save_as: vpc_logging
    on_error: continue
  emit:
    items_for: vpc_logging[]
    as: vpc_logging
    item:
      id: '{{ vpc_logging.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.internetgateway_logging
  calls:
  - client: ec2
    action: list_internetgateway_logging
    save_as: internetgateway_logging
    on_error: continue
  emit:
    items_for: internetgateway_logging[]
    as: internetgateway_logging
    item:
      id: '{{ internetgateway_logging.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.network_interfaces
  for_each: aws.vpc.network_interface
  calls:
  - client: ec2
    action: describe_network_interfaces
    save_as: network_interfaces
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.vpngateways
  for_each: aws.vpc.vpngateway
  calls:
  - client: ec2
    action: describe_vpngateways
    save_as: vpngateways
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.subnet_separate_private_publics
  for_each: aws.vpc.subnet_separate_private_public
  calls:
  - client: ec2
    action: describe_subnet_separate_private_publics
    save_as: subnet_separate_private_publics
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.networkacls
  for_each: aws.vpc.networkacl
  calls:
  - client: ec2
    action: describe_network_acls
    save_as: networkacls
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.vpc.subnet_logging
  calls:
  - client: ec2
    action: describe_subnets
    save_as: subnet_logging
    on_error: continue
  emit:
    items_for: subnet_logging[]
    as: subnet_logging
    item:
      id: '{{ subnet_logging.Id }}'
      compliant: '{{ true }}'
checks:
- title: 'VPC subnet: Dns Hostnames And Support Configured'
  severity: medium
  rule_id: aws.vpc.subnet.dns_hostnames_and_support_configured
  for_each:
    discovery: aws.vpc.subnets
    as: subnet
    item: subnet
  conditions:
    var: subnet.in_vpc
    op: equals
    value: true
- title: 'VPC customergateway: Flow Logging Enabled'
  severity: medium
  rule_id: aws.vpc.customergateway.flow_logging_enabled
  for_each:
    discovery: aws.vpc.customergateway_logging
    as: customergateway
    item: customergateway
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'VPC internetgateway: Flow Logging Enabled'
  severity: medium
  rule_id: aws.vpc.internetgateway.flow_logging_enabled
  for_each:
    discovery: aws.vpc.internetgateway_logging
    as: internetgateway
    item: internetgateway
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'VPC vpcendpoint: Dns Hostnames And Support Configured'
  severity: medium
  rule_id: aws.vpc.vpcendpoint.dns_hostnames_and_support_configured
  for_each:
    discovery: aws.vpc.vpcendpoints
    as: vpcendpoint
    item: vpcendpoint
  conditions:
    var: vpcendpoint.in_vpc
    op: equals
    value: true
- title: 'VPC subnet: Flow Logging Enabled'
  severity: medium
  rule_id: aws.vpc.subnet.flow_logging_enabled
  for_each:
    discovery: aws.vpc.subnet_logging
    as: subnet
    item: subnet
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'VPC vpc: Flow Logging Enabled'
  severity: medium
  rule_id: aws.vpc.vpc.flow_logging_enabled
  for_each:
    discovery: aws.vpc.vpc_logging
    as: vpc
    item: vpc
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'VPC securitygroup: Security Closed Ports Restricted'
  severity: medium
  rule_id: aws.vpc.securitygroup.security_closed_ports_restricted
  for_each:
    discovery: aws.vpc.securitygroups
    as: securitygroup
    item: securitygroup
  conditions:
    var: securitygroup.in_vpc
    op: equals
    value: true
- title: 'VPC networkacl: Network Dns Hostnames And Support Configured'
  severity: high
  rule_id: aws.vpc.networkacl.network_dns_hostnames_and_support_configured
  for_each:
    discovery: aws.vpc.networkacls
    as: networkacl
    item: networkacl
  conditions:
    var: networkacl.in_vpc
    op: equals
    value: true
- title: 'VPC customergateway: Api Dns Hostnames And Support Configured'
  severity: medium
  rule_id: aws.vpc.customergateway.api_dns_hostnames_and_support_configured
  for_each:
    discovery: aws.vpc.customergateways
    as: customergateway
    item: customergateway
  conditions:
    var: customergateway.in_vpc
    op: equals
    value: true
- title: 'VPC resource: Flow Log Active Rejects Enabled'
  severity: medium
  rule_id: aws.vpc.resource.flow_log_active_rejects_enabled
  for_each:
    discovery: aws.vpc.resource_logging
    as: resource
    item: resource
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'VPC vpnconnection: Flow Logging Enabled'
  severity: medium
  rule_id: aws.vpc.vpnconnection.flow_logging_enabled
  for_each:
    discovery: aws.vpc.vpnconnection_logging
    as: vpnconnection
    item: vpnconnection
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'VPC securitygroup: Route Tables No Unintended Internet Paths Configured'
  severity: medium
  rule_id: aws.vpc.securitygroup.route_tables_no_unintended_internet_paths_configured
  for_each:
    discovery: aws.vpc.securitygroups
    as: securitygroup
    item: securitygroup
  conditions:
    var: securitygroup.in_vpc
    op: equals
    value: true
- title: 'VPC nacl ingress restricted ports 22 3389: Nacl Ingress Restricted Ports
    22 3389 Configured'
  severity: medium
  rule_id: aws.vpc.nacl_ingress_restricted_ports_22_3389.nacl_ingress_restricted_ports_22_3389_configured
  for_each:
    discovery: aws.vpc.nacl_ingress_restricted_ports_22_3389s
    as: nacl_ingress_restricted_ports_22_3389
    item: nacl_ingress_restricted_ports_22_3389
  conditions:
    var: nacl_ingress_restricted_ports_22_3389.in_vpc
    op: equals
    value: true
- title: 'VPC resource: Endpoint Multi Az Enabled'
  severity: medium
  rule_id: aws.vpc.resource.endpoint_multi_az_enabled
  for_each:
    discovery: aws.vpc.resources
    as: resource
    item: resource
  conditions:
    var: resource.in_vpc
    op: equals
    value: true
- title: 'VPC network interface: Flow Logging Enabled'
  severity: medium
  rule_id: aws.vpc.network_interface.flow_logging_enabled
  for_each:
    discovery: aws.vpc.network_interface_logging
    as: network_interface
    item: network_interface
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'VPC internetgateway: Api Dns Hostnames And Support Configured'
  severity: medium
  rule_id: aws.vpc.internetgateway.api_dns_hostnames_and_support_configured
  for_each:
    discovery: aws.vpc.internetgateways
    as: internetgateway
    item: internetgateway
  conditions:
    var: internetgateway.in_vpc
    op: equals
    value: true
- title: 'VPC routetable: S No Unintended Internet Paths Configured'
  severity: medium
  rule_id: aws.vpc.routetable.s_no_unintended_internet_paths_configured
  for_each:
    discovery: aws.vpc.routetables
    as: routetable
    item: routetable
  conditions:
    var: routetable.in_vpc
    op: equals
    value: true
- title: 'VPC resource: Endpoint For Ec2 Enabled'
  severity: medium
  rule_id: aws.vpc.resource.endpoint_for_ec2_enabled
  for_each:
    discovery: aws.vpc.resources
    as: resource
    item: resource
  conditions:
    var: resource.in_vpc
    op: equals
    value: true
- title: 'VPC network interface: Network Dns Hostnames And Support Configured'
  severity: high
  rule_id: aws.vpc.network_interface.network_dns_hostnames_and_support_configured
  for_each:
    discovery: aws.vpc.network_interfaces
    as: network_interface
    item: network_interface
  conditions:
    var: network_interface.in_vpc
    op: equals
    value: true
- title: 'VPC routetable: Dns Hostnames And Support Configured'
  severity: medium
  rule_id: aws.vpc.routetable.dns_hostnames_and_support_configured
  for_each:
    discovery: aws.vpc.routetables
    as: routetable
    item: routetable
  conditions:
    var: routetable.in_vpc
    op: equals
    value: true
- title: 'VPC resource: Flow Logging Enabled'
  severity: medium
  rule_id: aws.vpc.resource.flow_logging_enabled
  for_each:
    discovery: aws.vpc.resource_logging
    as: resource
    item: resource
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'VPC subnet separate private public: Subnet Separate Private Public Configured'
  severity: high
  rule_id: aws.vpc.subnet_separate_private_public.subnet_separate_private_public_configured
  for_each:
    discovery: aws.vpc.subnet_separate_private_publics
    as: subnet_separate_private_public
    item: subnet_separate_private_public
  conditions:
    var: subnet_separate_private_public.is_public
    op: equals
    value: false
- title: 'VPC natgateway: Route Tables No Unintended Internet Paths Configured'
  severity: medium
  rule_id: aws.vpc.natgateway.route_tables_no_unintended_internet_paths_configured
  for_each:
    discovery: aws.vpc.natgateways
    as: natgateway
    item: natgateway
  conditions:
    var: natgateway.in_vpc
    op: equals
    value: true
- title: 'VPC vpngateway: Api Dns Hostnames And Support Configured'
  severity: medium
  rule_id: aws.vpc.vpngateway.api_dns_hostnames_and_support_configured
  for_each:
    discovery: aws.vpc.vpngateways
    as: vpngateway
    item: vpngateway
  conditions:
    var: vpngateway.in_vpc
    op: equals
    value: true
- title: 'VPC vpcendpoint: Flow Logging Enabled'
  severity: medium
  rule_id: aws.vpc.vpcendpoint.flow_logging_enabled
  for_each:
    discovery: aws.vpc.vpcendpoint_logging
    as: vpcendpoint
    item: vpcendpoint
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'VPC customergateway: Route Tables No Unintended Internet Paths Configured'
  severity: medium
  rule_id: aws.vpc.customergateway.route_tables_no_unintended_internet_paths_configured
  for_each:
    discovery: aws.vpc.customergateways
    as: customergateway
    item: customergateway
  conditions:
    var: customergateway.in_vpc
    op: equals
    value: true
- title: 'VPC securitygroup: Security Dns Hostnames And Support Configured'
  severity: medium
  rule_id: aws.vpc.securitygroup.security_dns_hostnames_and_support_configured
  for_each:
    discovery: aws.vpc.securitygroups
    as: securitygroup
    item: securitygroup
  conditions:
    var: securitygroup.in_vpc
    op: equals
    value: true
- title: 'VPC endpoint services allowed principals trust boundaries: Endpoint Principals
    Trust Boundaries Configured'
  severity: medium
  rule_id: aws.vpc.endpoint_services_allowed_principals_trust_boundaries.endpoint_principals_trust_boundaries_configured
  for_each:
    discovery: aws.vpc.endpoint_services_allowed_principals_trust_boundariess
    as: endpoint_services_allowed_principals_trust_boundaries
    item: endpoint_services_allowed_principals_trust_boundaries
  conditions:
    var: endpoint_services_allowed_principals_trust_boundaries.in_vpc
    op: equals
    value: true
- title: 'VPC peering routing tables with least privilege: Privilege'
  severity: high
  rule_id: aws.vpc.peering_routing_tables_with_least_privilege.privilege
  for_each:
    discovery: aws.vpc.peering_routing_tables_with_least_privileges
    as: peering_routing_tables_with_least_privilege
    item: peering_routing_tables_with_least_privilege
  conditions:
    var: peering_routing_tables_with_least_privilege.in_vpc
    op: equals
    value: true
- title: 'VPC natgateway: Api Dns Hostnames And Support Configured'
  severity: medium
  rule_id: aws.vpc.natgateway.api_dns_hostnames_and_support_configured
  for_each:
    discovery: aws.vpc.natgateways
    as: natgateway
    item: natgateway
  conditions:
    var: natgateway.in_vpc
    op: equals
    value: true
- title: 'VPC subnet no public ip by default: Subnet No Public Ip By Default Configured'
  severity: high
  rule_id: aws.vpc.subnet_no_public_ip_by_default.subnet_no_public_ip_by_default_configured
  for_each:
    discovery: aws.vpc.subnet_no_public_ip_by_defaults
    as: subnet_no_public_ip_by_default
    item: subnet_no_public_ip_by_default
  conditions:
    var: subnet_no_public_ip_by_default.is_public
    op: equals
    value: false
- title: 'VPC networkacl: Route Tables No Unintended Internet Paths Configured'
  severity: medium
  rule_id: aws.vpc.networkacl.route_tables_no_unintended_internet_paths_configured
  for_each:
    discovery: aws.vpc.networkacls
    as: networkacl
    item: networkacl
  conditions:
    var: networkacl.in_vpc
    op: equals
    value: true
- title: 'VPC vpngateway: Route Tables No Unintended Internet Paths Configured'
  severity: medium
  rule_id: aws.vpc.vpngateway.route_tables_no_unintended_internet_paths_configured
  for_each:
    discovery: aws.vpc.vpngateways
    as: vpngateway
    item: vpngateway
  conditions:
    var: vpngateway.in_vpc
    op: equals
    value: true
- title: 'VPC vpngateway: Flow Logging Enabled'
  severity: medium
  rule_id: aws.vpc.vpngateway.flow_logging_enabled
  for_each:
    discovery: aws.vpc.vpngateway_logging
    as: vpngateway
    item: vpngateway
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'VPC network: Acl Unused Configured'
  severity: medium
  rule_id: aws.vpc.network.acl_unused_configured
  for_each:
    discovery: aws.vpc.networks
    as: network
    item: network
  conditions:
    var: network.in_vpc
    op: equals
    value: true
- title: 'VPC securitygroup: Flow Logging Enabled'
  severity: medium
  rule_id: aws.vpc.securitygroup.flow_logging_enabled
  for_each:
    discovery: aws.vpc.securitygroup_logging
    as: securitygroup
    item: securitygroup
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'VPC natgateway: Flow Logging Enabled'
  severity: medium
  rule_id: aws.vpc.natgateway.flow_logging_enabled
  for_each:
    discovery: aws.vpc.natgateway_logging
    as: natgateway
    item: natgateway
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'VPC endpoint connections trust boundaries: Endpoint Connections Trust Boundaries
    Configured'
  severity: medium
  rule_id: aws.vpc.endpoint_connections_trust_boundaries.endpoint_connections_trust_boundaries_configured
  for_each:
    discovery: aws.vpc.endpoint_connections_trust_boundariess
    as: endpoint_connections_trust_boundaries
    item: endpoint_connections_trust_boundaries
  conditions:
    var: endpoint_connections_trust_boundaries.in_vpc
    op: equals
    value: true
- title: 'VPC flow: Logging Enabled'
  severity: medium
  rule_id: aws.vpc.flow.logging_enabled
  for_each:
    discovery: aws.vpc.flow_logging
    as: flow
    item: flow
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'VPC network interface: Route Tables No Unintended Internet Paths Configured'
  severity: medium
  rule_id: aws.vpc.network_interface.route_tables_no_unintended_internet_paths_configured
  for_each:
    discovery: aws.vpc.network_interfaces
    as: network_interface
    item: network_interface
  conditions:
    var: network_interface.in_vpc
    op: equals
    value: true
- title: 'VPC networkacl: Flow Logging Enabled'
  severity: medium
  rule_id: aws.vpc.networkacl.flow_logging_enabled
  for_each:
    discovery: aws.vpc.networkacl_logging
    as: networkacl
    item: networkacl
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'VPC subnet different az: Subnet Different Az Configured'
  severity: medium
  rule_id: aws.vpc.subnet_different_az.subnet_different_az_configured
  for_each:
    discovery: aws.vpc.subnet_different_azs
    as: subnet_different_az
    item: subnet_different_az
  conditions:
    var: subnet_different_az.in_vpc
    op: equals
    value: true
- title: 'VPC vpnconnection: Dns Hostnames And Support Configured'
  severity: medium
  rule_id: aws.vpc.vpnconnection.dns_hostnames_and_support_configured
  for_each:
    discovery: aws.vpc.vpnconnections
    as: vpnconnection
    item: vpnconnection
  conditions:
    var: vpnconnection.in_vpc
    op: equals
    value: true
- title: 'VPC vpcendpoint: Route Tables No Unintended Internet Paths Configured'
  severity: medium
  rule_id: aws.vpc.vpcendpoint.route_tables_no_unintended_internet_paths_configured
  for_each:
    discovery: aws.vpc.vpcendpoints
    as: vpcendpoint
    item: vpcendpoint
  conditions:
    var: vpcendpoint.in_vpc
    op: equals
    value: true
- title: 'VPC vpn connection tunnels up: Vpn Connection Tunnels Up Configured'
  severity: medium
  rule_id: aws.vpc.vpn_connection_tunnels_up.vpn_connection_tunnels_up_configured
  for_each:
    discovery: aws.vpc.vpn_connection_tunnels_ups
    as: vpn_connection_tunnels_up
    item: vpn_connection_tunnels_up
  conditions:
    var: vpn_connection_tunnels_up.in_vpc
    op: equals
    value: true
- title: 'VPC vpnconnection: Route Tables No Unintended Internet Paths Configured'
  severity: medium
  rule_id: aws.vpc.vpnconnection.route_tables_no_unintended_internet_paths_configured
  for_each:
    discovery: aws.vpc.vpnconnections
    as: vpnconnection
    item: vpnconnection
  conditions:
    var: vpnconnection.in_vpc
    op: equals
    value: true
- title: 'VPC subnet: Route Tables No Unintended Internet Paths Configured'
  severity: medium
  rule_id: aws.vpc.subnet.route_tables_no_unintended_internet_paths_configured
  for_each:
    discovery: aws.vpc.subnets
    as: subnet
    item: subnet
  conditions:
    var: subnet.in_vpc
    op: equals
    value: true
- title: 'VPC different regions: Different Regions Configured'
  severity: medium
  rule_id: aws.vpc.different_regions.different_regions_configured
  for_each:
    discovery: aws.vpc.different_regionss
    as: different_regions
    item: different_regions
  conditions:
    var: different_regions.in_vpc
    op: equals
    value: true
- title: 'VPC routetable: Flow Logging Enabled'
  severity: medium
  rule_id: aws.vpc.routetable.flow_logging_enabled
  for_each:
    discovery: aws.vpc.routetable_logging
    as: routetable
    item: routetable
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'VPC network: Security Monitored'
  severity: medium
  rule_id: aws.vpc.network.security_monitored
  for_each:
    discovery: aws.vpc.networks
    as: network
    item: network
  conditions:
    var: network.in_vpc
    op: equals
    value: true
- title: 'VPC vpc: Route Tables No Unintended Internet Paths Configured'
  severity: medium
  rule_id: aws.vpc.vpc.route_tables_no_unintended_internet_paths_configured
  for_each:
    discovery: aws.vpc.vpcs
    as: vpc
    item: vpc
  conditions:
    var: vpc.in_vpc
    op: equals
    value: true
- title: 'VPC internetgateway: Route Tables No Unintended Internet Paths Configured'
  severity: medium
  rule_id: aws.vpc.internetgateway.route_tables_no_unintended_internet_paths_configured
  for_each:
    discovery: aws.vpc.internetgateways
    as: internetgateway
    item: internetgateway
  conditions:
    var: internetgateway.in_vpc
    op: equals
    value: true
- title: 'VPC vpc: Dns Hostnames And Support Configured'
  severity: medium
  rule_id: aws.vpc.vpc.dns_hostnames_and_support_configured
  for_each:
    discovery: aws.vpc.vpcs
    as: vpc
    item: vpc
  conditions:
    var: vpc.in_vpc
    op: equals
    value: true
