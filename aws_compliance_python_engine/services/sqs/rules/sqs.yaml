version: '1.0'
provider: aws
service: sqs
services:
  client: sqs
  module: boto3.client
discovery:
- discovery_id: aws.sqs.list_queues
  calls:
  - action: list_queues
    save_as: response
- discovery_id: aws.sqs.get_queue_attributes
  calls:
  - action: get_queue_attributes
    save_as: response
  for_each: aws.sqs.list_queues
  on_error: continue
  emit:
    item:
      Attributes: '{{ response.Attributes }}'
checks:
- rule_id: aws.sqs.queue.private_network_only_if_supported
  for_each: aws.sqs.get_queue_attributes
  conditions:
    var: item.Attributes
    op: not_equals
    value: 'null'
- rule_id: aws.sqs.queue.cross_account_send_receive_restricted
  for_each: aws.sqs.get_queue_attributes
  conditions:
    var: item.Attributes
    op: not_equals
    value: 'null'
- rule_id: aws.sqs.queues_not_publicly_accessible.queues_not_publicly_accessible_configured
  for_each: aws.sqs.get_queue_attributes
  conditions:
    var: item.Attributes
    op: not_equals
    value: 'null'
- rule_id: aws.sqs.queue.encryption_at_rest_enabled
  for_each: aws.sqs.get_queue_attributes
  conditions:
    var: item.Attributes
    op: not_equals
    value: 'null'
- rule_id: aws.sqs.queue.auth_required
  for_each: aws.sqs.get_queue_attributes
  conditions:
    var: item.Attributes
    op: not_equals
    value: 'null'
- rule_id: aws.sqs.resource.queues_server_side_encryption_enabled
  for_each: aws.sqs.get_queue_attributes
  conditions:
    var: item.Attributes
    op: not_equals
    value: 'null'
