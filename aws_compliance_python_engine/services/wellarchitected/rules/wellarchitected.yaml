version: '1.0'
provider: aws
service: wellarchitected
services:
  client: wellarchitected
  module: boto3.client
discovery:
- discovery_id: aws.wellarchitected.list_workloads
  calls:
  - action: list_workloads
    save_as: response
  emit:
    items_for: '{{ response.WorkloadSummaries }}'
    as: resource
    item:
      WorkloadId: '{{ resource.WorkloadId }}'
      WorkloadArn: '{{ resource.WorkloadArn }}'
      WorkloadName: '{{ resource.WorkloadName }}'
      Owner: '{{ resource.Owner }}'
      UpdatedAt: '{{ resource.UpdatedAt }}'
      Lenses: '{{ resource.Lenses }}'
      RiskCounts: '{{ resource.RiskCounts }}'
      ImprovementStatus: '{{ resource.ImprovementStatus }}'
      Profiles: '{{ resource.Profiles }}'
      PrioritizedRiskCounts: '{{ resource.PrioritizedRiskCounts }}'
checks:
- rule_id: aws.wellarchitected.workload.wellarchitected_no_high_or_medium_risks_configured
  for_each: aws.wellarchitected.list_workloads
  conditions:
    var: item.PrioritizedRiskCounts
    op: exists
    value: null
