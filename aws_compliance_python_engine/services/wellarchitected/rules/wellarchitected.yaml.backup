version: '1.0'
provider: aws
service: wellarchitected
discovery:
- discovery_id: aws.wellarchitected.list_workloads
  calls:
  - action: list_workloads
    save_as: list_workloads_response
  emit:
    items_for: '{{ list_workloads_response.WorkloadSummaries }}'
    as: resource
    item:
      workload_id: '{{ resource.WorkloadId }}'
      workload_arn: '{{ resource.WorkloadArn }}'
      workload_name: '{{ resource.WorkloadName }}'
      owner: '{{ resource.Owner }}'
      updated_at: '{{ resource.UpdatedAt }}'
      lenses: '{{ resource.Lenses }}'
      risk_counts: '{{ resource.RiskCounts }}'
      improvement_status: '{{ resource.ImprovementStatus }}'
      profiles: '{{ resource.Profiles }}'
      prioritized_risk_counts: '{{ resource.PrioritizedRiskCounts }}'
checks:
- rule_id: aws.wellarchitected.workload.wellarchitected_no_high_or_medium_risks_configured
  for_each: aws.wellarchitected.list_workloads
  conditions:
    all:
    - var: item.risk_counts
      op: equals
      value: {}
    - var: item.prioritized_risk_counts
      op: equals
      value: {}
