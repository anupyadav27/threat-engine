version: '1.0'
provider: aws
service: ses
services:
  client: ses
  module: boto3.client
discovery:
- discovery_id: aws.ses.describe_active_receipt_rule_set
  calls:
  - action: describe_active_receipt_rule_set
    save_as: response
  emit:
    item:
      Name: '{{ response.Rules.Name }}'
      Enabled: '{{ response.Rules.Enabled }}'
      TlsPolicy: '{{ response.Rules.TlsPolicy }}'
      Recipients: '{{ response.Rules.Recipients }}'
      Actions: '{{ response.Rules.Actions }}'
      ScanEnabled: '{{ response.Rules.ScanEnabled }}'
checks:
- rule_id: aws.ses.email.message_encryption_in_transit_configured
  for_each: aws.ses.describe_active_receipt_rule_set
  conditions:
    var: item.TlsPolicy
    op: equals
    value: Require
- rule_id: aws.ses.email.change_audit_logging_enabled
  for_each: aws.ses.describe_active_receipt_rule_set
  conditions:
    var: item.Enabled
    op: equals
    value: true
- rule_id: aws.ses.email.no_public_webhooks_configured
  for_each: aws.ses.describe_active_receipt_rule_set
  conditions:
    var: item.Actions
    op: equals
    value: []
