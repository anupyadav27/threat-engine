version: '1.0'
provider: aws
service: firehose
services:
  client: firehose
  module: boto3.client
discovery:
- discovery_id: aws.firehose.list_delivery_streams
  calls:
  - action: list_delivery_streams
    save_as: response
  emit:
    items_for: '{{ response.DeliveryStreamNames }}'
    as: resource
    item:
      DeliveryStreamName: '{{ resource }}'
      DeliveryStreamEncryptionConfiguration: '{{ response.DeliveryStreamEncryptionConfiguration }}'
checks:
- rule_id: aws.firehose.resource.stream_encrypted_at_rest
  for_each: aws.firehose.list_delivery_streams
  conditions:
    var: item.DeliveryStreamEncryptionConfiguration
    op: equals
    value: 'null'
