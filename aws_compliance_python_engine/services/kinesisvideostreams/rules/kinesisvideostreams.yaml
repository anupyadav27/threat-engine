version: '1.0'
provider: aws
service: kinesisvideostreams
services:
  client: kinesisvideostreams
  module: boto3.client
discovery:
- discovery_id: aws.kinesisvideostreams.describe_image_generation_configuration
  calls:
  - action: describe_image_generation_configuration
    save_as: response
  emit:
    item:
      Status: '{{ response.ImageGenerationConfiguration.Status }}'
      ImageSelectorType: '{{ response.ImageGenerationConfiguration.ImageSelectorType
        }}'
      DestinationConfig: '{{ response.ImageGenerationConfiguration.DestinationConfig
        }}'
      SamplingInterval: '{{ response.ImageGenerationConfiguration.SamplingInterval
        }}'
      Format: '{{ response.ImageGenerationConfiguration.Format }}'
      FormatConfig: '{{ response.ImageGenerationConfiguration.FormatConfig }}'
      WidthPixels: '{{ response.ImageGenerationConfiguration.WidthPixels }}'
      HeightPixels: '{{ response.ImageGenerationConfiguration.HeightPixels }}'
checks:
- rule_id: aws.kinesisvideostreams.stream.encryption_in_transit_required
  for_each: aws.kinesisvideostreams.describe_image_generation_configuration
  conditions:
    var: item.Status
    op: not_equals
    value: DISABLED
- rule_id: aws.kinesisvideostreams.stream.encryption_at_rest_enabled
  for_each: aws.kinesisvideostreams.describe_image_generation_configuration
  conditions:
    var: item.Status
    op: equals
    value: ENABLED
- rule_id: aws.kinesisvideostreams.stream.retention_days_minimum_configured
  for_each: aws.kinesisvideostreams.describe_image_generation_configuration
  conditions:
    var: item.Status
    op: exists
