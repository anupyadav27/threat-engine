version: '1.0'
provider: aws
service: networkfirewall
services:
  client: networkfirewall
  module: boto3.client
discovery:
- discovery_id: aws.networkfirewall.describe_logging_configuration
  calls:
  - action: describe_logging_configuration
    save_as: response
  emit:
    item:
      LogDestinationConfigs: '{{ response.LoggingConfiguration.LogDestinationConfigs
        }}'
      LoggingConfiguration: '{{ resource.LoggingConfiguration }}'
- discovery_id: aws.networkfirewall.describe_firewall
  calls:
  - action: describe_firewall
    save_as: response
  emit:
    item:
      FirewallName: '{{ response.Firewall.FirewallName }}'
      FirewallArn: '{{ response.Firewall.FirewallArn }}'
      FirewallPolicyArn: '{{ response.Firewall.FirewallPolicyArn }}'
      VpcId: '{{ response.Firewall.VpcId }}'
      SubnetMappings: '{{ response.Firewall.SubnetMappings }}'
      DeleteProtection: '{{ response.Firewall.DeleteProtection }}'
      SubnetChangeProtection: '{{ response.Firewall.SubnetChangeProtection }}'
      FirewallPolicyChangeProtection: '{{ response.Firewall.FirewallPolicyChangeProtection
        }}'
      Description: '{{ response.Firewall.Description }}'
      FirewallId: '{{ response.Firewall.FirewallId }}'
      Tags: '{{ response.Firewall.Tags }}'
      EncryptionConfiguration: '{{ response.Firewall.EncryptionConfiguration }}'
      NumberOfAssociations: '{{ response.Firewall.NumberOfAssociations }}'
      EnabledAnalysisTypes: '{{ response.Firewall.EnabledAnalysisTypes }}'
      TransitGatewayId: '{{ response.Firewall.TransitGatewayId }}'
      TransitGatewayOwnerAccountId: '{{ response.Firewall.TransitGatewayOwnerAccountId
        }}'
      AvailabilityZoneMappings: '{{ response.Firewall.AvailabilityZoneMappings }}'
      AvailabilityZoneChangeProtection: '{{ response.Firewall.AvailabilityZoneChangeProtection
        }}'
- discovery_id: aws.networkfirewall.describe_proxy_configuration
  calls:
  - action: describe_proxy_configuration
    save_as: response
  emit:
    item:
      ProxyConfigurationName: '{{ response.ProxyConfiguration.ProxyConfigurationName
        }}'
      ProxyConfigurationArn: '{{ response.ProxyConfiguration.ProxyConfigurationArn
        }}'
      Description: '{{ response.ProxyConfiguration.Description }}'
      CreateTime: '{{ response.ProxyConfiguration.CreateTime }}'
      DeleteTime: '{{ response.ProxyConfiguration.DeleteTime }}'
      RuleGroups: '{{ response.ProxyConfiguration.RuleGroups }}'
      DefaultRulePhaseActions: '{{ response.ProxyConfiguration.DefaultRulePhaseActions
        }}'
      Tags: '{{ response.ProxyConfiguration.Tags }}'
checks:
- rule_id: aws.networkfirewall.firewall.logging_enabled
  for_each: aws.networkfirewall.describe_logging_configuration
  conditions:
    var: item.LoggingConfiguration
    op: not_equals
    value: 'null'
- rule_id: aws.networkfirewall.firewall.networkfirewall_multi_az_deployment_enabled
  for_each: aws.networkfirewall.describe_firewall
  conditions:
    var: item.FirewallPolicyChangeProtection
    op: equals
    value: 'true'
- rule_id: aws.networkfirewall.firewall.rule_groups_enabled
  for_each: aws.networkfirewall.describe_proxy_configuration
  conditions:
    var: item.RuleGroups
    op: not_equals
    value: 'null'
- rule_id: aws.networkfirewall.resource.logging_enabled
  for_each: aws.networkfirewall.describe_logging_configuration
  conditions:
    var: item.LoggingConfiguration
    op: not_equals
    value: 'null'
- rule_id: aws.networkfirewall.firewall.networkfirewall_no_permit_any_configured
  for_each: aws.networkfirewall.describe_firewall
  conditions:
    var: item.FirewallPolicyChangeProtection
    op: equals
    value: 'false'
- rule_id: aws.networkfirewall.in.all_vpc_configured
  for_each: aws.networkfirewall.describe_firewall
  conditions:
    var: item.VpcId
    op: not_equals
    value: 'null'
