version: '1.0'
provider: aws
service: transfer
services:
  client: transfer
  module: boto3.client
discovery:
- discovery_id: aws.transfer.list_servers
  calls:
  - action: list_servers
    save_as: response
  emit:
    items_for: '{{ response.Servers }}'
    as: resource
    item:
      Arn: '{{ resource.Arn }}'
      Domain: '{{ resource.Domain }}'
      IdentityProviderType: '{{ resource.IdentityProviderType }}'
      EndpointType: '{{ resource.EndpointType }}'
      LoggingRole: '{{ resource.LoggingRole }}'
      ServerId: '{{ resource.ServerId }}'
      State: '{{ resource.State }}'
      UserCount: '{{ resource.UserCount }}'
checks:
- rule_id: aws.transfer.resource.server_in_transit_encryption_enabled
  for_each: aws.transfer.list_servers
  conditions:
    var: item.ProtocolDetails
    op: exists
    value: null
