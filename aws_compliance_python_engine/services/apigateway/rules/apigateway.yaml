version: '1.0'
provider: aws
service: apigateway
discovery:
- discovery_id: aws.apigateway.v2apis
  calls:
  - client: apigateway
    action: get_rest_apis
    save_as: v2api_list
    on_error: continue
    fields:
    - Apigateways
  emit:
    items_for: v2api_list[]
    as: v2api
    item:
      id: '{{ v2api.Id }}'
      name: '{{ v2api.Name }}'
- discovery_id: aws.apigateway.v2api_encryption
  for_each: aws.apigateway.v2apis
  calls:
  - client: apigateway
    action: get_rest_apis
    params:
      V2apiId: '{{ item.id }}'
    save_as: encryption
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      encryption_enabled: '{{ encryption.Encrypted if encryption.Encrypted is defined else false }}'
- discovery_id: aws.apigateway.v2api_logging
  for_each: aws.apigateway.v2apis
  calls:
  - client: apigateway
    action: get_rest_apis
    params:
      V2apiId: '{{ item.id }}'
    save_as: logging
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      logging_enabled: '{{ logging.LoggingEnabled is defined if logging else false }}'
- discovery_id: aws.apigateway.stages
  for_each: aws.apigateway.stage
  calls:
  - client: apigateway
    action: get_stages
    save_as: stages
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.apigateway.resources
  for_each: aws.apigateway.resource
  calls:
  - client: apigateway
    action: describe_load_balancers
    save_as: resources
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.apigateway.authorizers
  for_each: aws.apigateway.authorizer
  calls:
  - client: apigateway
    action: get_authorizers
    save_as: authorizers
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.apigateway.usageplans
  for_each: aws.apigateway.usageplan
  calls:
  - client: apigateway
    action: get_usage_plans
    save_as: usageplans
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.apigateway.resource_encryption
  calls:
  - client: apigateway
    action: describe_load_balancers
    save_as: resource_encryption
    on_error: continue
  emit:
    items_for: resource_encryption[]
    as: resource_encryption
    item:
      id: '{{ resource_encryption.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.apigateway.stage_logging
  calls:
  - client: apigateway
    action: get_stages
    save_as: stage_logging
    on_error: continue
  emit:
    items_for: stage_logging[]
    as: stage_logging
    item:
      id: '{{ stage_logging.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.apigateway.certificates
  for_each: aws.apigateway.certificate
  calls:
  - client: apigateway
    action: get_client_certificates
    save_as: certificates
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.apigateway.restapis
  for_each: aws.apigateway.restapi
  calls:
  - client: apigateway
    action: get_rest_apis
    save_as: restapis
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.apigateway.restapi_logging
  calls:
  - client: apigateway
    action: get_rest_apis
    save_as: restapi_logging
    on_error: continue
  emit:
    items_for: restapi_logging[]
    as: restapi_logging
    item:
      id: '{{ restapi_logging.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.apigateway.throttles
  for_each: aws.apigateway.throttle
  calls:
  - client: apigateway
    action: get_stages
    save_as: throttles
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.apigateway.resource_logging
  calls:
  - client: apigateway
    action: describe_load_balancers
    save_as: resource_logging
    on_error: continue
  emit:
    items_for: resource_logging[]
    as: resource_logging
    item:
      id: '{{ resource_logging.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.apigateway.apikeys
  for_each: aws.apigateway.apikey
  calls:
  - client: apigateway
    action: get_api_keys
    save_as: apikeys
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.apigateway.requestvalidators
  for_each: aws.apigateway.requestvalidator
  calls:
  - client: apigateway
    action: get_request_validators
    save_as: requestvalidators
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
checks:
- title: 'APIGATEWAY usageplan: Api Stage Rate Limit Configured'
  severity: medium
  rule_id: aws.apigateway.usageplan.api_stage_rate_limit_configured
  for_each:
    discovery: aws.apigateway.usageplans
    as: usageplan
    item: usageplan
  conditions:
    var: usageplan.compliant
    op: equals
    value: true
  remediation: "Configure apigateway usageplan for compliance:\n\nRequirement: Api Stage Rate Limit Configuration\n\nDescription:\
    \ Verifies security configuration for Amazon API Gateway usageplan to ensure alignment with AWS security best practices\
    \ and compliance requirements. Proper configuration reduces security risks, maintains defense in depth, and supports overall\
    \ security posture.\n\nSteps:\n1. Open APIGATEWAY console\n2. Select the usageplan\n3. Review security configuration\n\
    4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\
    \u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\
    \u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY resource: Authorization Enabled'
  severity: medium
  rule_id: aws.apigateway.resource.authorization_enabled
  for_each:
    discovery: aws.apigateway.resources
    as: resource
    item: resource
  conditions:
    var: resource.compliant
    op: equals
    value: true
  remediation: "Configure apigateway resource for compliance:\n\nRequirement: Authorization Enabled\n\nDescription: Verifies\
    \ security configuration for Amazon API Gateway resource to ensure alignment with AWS security best practices and compliance\
    \ requirements. Proper configuration reduces security risks, maintains defense in depth, and supports overall security\
    \ posture.\n\nSteps:\n1. Open APIGATEWAY console\n2. Select the resource\n3. Review security configuration\n4. Apply required\
    \ settings per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\u2022\
    \ Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\u2022\
    \ Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY apikey: Key Rotation Policy Configured'
  severity: high
  rule_id: aws.apigateway.apikey.key_rotation_policy_configured
  for_each:
    discovery: aws.apigateway.apikeys
    as: apikey
    item: apikey
  conditions:
    var: apikey.is_public
    op: equals
    value: false
  remediation: "Restrict public access for apigateway apikey:\n\n1. Open APIGATEWAY console\n2. Select the apikey\n3. Go to\
    \ Permissions/Access Control\n4. Review current permissions:\n   - Remove public access grants\n   - Remove wildcard (*)\
    \ principals\n   - Implement least privilege\n5. Update resource policy or IAM policies\n6. Enable resource-level access\
    \ control\n7. Save changes\n\nSecurity Recommendations:\n\u2022 Use IAM roles instead of access keys\n\u2022 Implement\
    \ condition keys for additional security\n\u2022 Enable MFA for sensitive operations\n\u2022 Regularly audit access permissions\n\
    \u2022 Use AWS Organizations SCPs for guardrails"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY usageplan: Api Quota Limit Configured'
  severity: medium
  rule_id: aws.apigateway.usageplan.api_quota_limit_configured
  for_each:
    discovery: aws.apigateway.usageplans
    as: usageplan
    item: usageplan
  conditions:
    var: usageplan.compliant
    op: equals
    value: true
  remediation: "Configure apigateway usageplan for compliance:\n\nRequirement: Api Quota Limit Configuration\n\nDescription:\
    \ Verifies security configuration for Amazon API Gateway usageplan to ensure alignment with AWS security best practices\
    \ and compliance requirements. Proper configuration reduces security risks, maintains defense in depth, and supports overall\
    \ security posture.\n\nSteps:\n1. Open APIGATEWAY console\n2. Select the usageplan\n3. Review security configuration\n\
    4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\
    \u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\
    \u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY authorizer: Cache Ttl Configured'
  severity: medium
  rule_id: aws.apigateway.authorizer.cache_ttl_configured
  for_each:
    discovery: aws.apigateway.authorizers
    as: authorizer
    item: authorizer
  conditions:
    var: authorizer.compliant
    op: equals
    value: true
  remediation: "Configure apigateway authorizer for compliance:\n\nRequirement: Cache Ttl Configuration\n\nDescription: Verifies\
    \ security configuration for Amazon API Gateway authorizer to ensure alignment with AWS security best practices and compliance\
    \ requirements. Proper configuration reduces security risks, maintains defense in depth, and supports overall security\
    \ posture.\n\nSteps:\n1. Open APIGATEWAY console\n2. Select the authorizer\n3. Review security configuration\n4. Apply\
    \ required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\
    \u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\
    \u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY requestvalidator: Api Required Security Headers Enforced'
  severity: medium
  rule_id: aws.apigateway.requestvalidator.api_required_security_headers_enforced
  for_each:
    discovery: aws.apigateway.requestvalidators
    as: requestvalidator
    item: requestvalidator
  conditions:
    var: requestvalidator.compliant
    op: equals
    value: true
  remediation: "Configure apigateway requestvalidator for compliance:\n\nRequirement: Api Required Security Headers Enforcement\n\
    \nDescription: Verifies security configuration for Amazon API Gateway requestvalidator to ensure alignment with AWS security\
    \ best practices and compliance requirements. Proper configuration reduces security risks, maintains defense in depth,\
    \ and supports overall security posture.\n\nSteps:\n1. Open APIGATEWAY console\n2. Select the requestvalidator\n3. Review\
    \ security configuration\n4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\
    \nGeneral Security Recommendations:\n\u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\
    \u2022 Enable logging and monitoring\n\u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: API logging and monitoring are enabled
  severity: high
  rule_id: aws.apigateway.stage.logging_enabled
  for_each:
    discovery: aws.apigateway.stage_logging
    as: stage
    item: stage
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
  remediation: "Enable logging for apigateway stage:\n\n1. Open APIGATEWAY console\n2. Select the stage\n3. Go to Logging/Monitoring\
    \ settings\n4. Enable logging\n5. Configure log destination:\n   - CloudWatch Logs\n   - S3 bucket (for long-term retention)\n\
    6. Set log level (INFO, DEBUG, ERROR)\n7. Save changes\n\nAWS CLI:\naws apigateway update-stage-logging --stage-id <id>\
    \ --logging-enabled\n\nBest Practices:\n\u2022 Enable all security-relevant log types\n\u2022 Send logs to centralized\
    \ logging service\n\u2022 Set appropriate retention periods\n\u2022 Configure log encryption\n\u2022 Set up log monitoring\
    \ and alerting"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: 'APIGATEWAY requestvalidator: Api Content Type Whitelist Enforced'
  severity: medium
  rule_id: aws.apigateway.requestvalidator.api_content_type_whitelist_enforced
  for_each:
    discovery: aws.apigateway.requestvalidators
    as: requestvalidator
    item: requestvalidator
  conditions:
    var: requestvalidator.compliant
    op: equals
    value: true
  remediation: "Configure apigateway requestvalidator for compliance:\n\nRequirement: Api Content Type Whitelist Enforcement\n\
    \nDescription: Verifies security configuration for Amazon API Gateway requestvalidator to ensure alignment with AWS security\
    \ best practices and compliance requirements. Proper configuration reduces security risks, maintains defense in depth,\
    \ and supports overall security posture.\n\nSteps:\n1. Open APIGATEWAY console\n2. Select the requestvalidator\n3. Review\
    \ security configuration\n4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\
    \nGeneral Security Recommendations:\n\u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\
    \u2022 Enable logging and monitoring\n\u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY throttle: Api Stage Overrides Bounded'
  severity: medium
  rule_id: aws.apigateway.throttle.api_stage_overrides_bounded
  for_each:
    discovery: aws.apigateway.throttles
    as: throttle
    item: throttle
  conditions:
    var: throttle.compliant
    op: equals
    value: true
  remediation: "Configure apigateway throttle for compliance:\n\nRequirement: Api Stage Overrides Bounded\n\nDescription:\
    \ Verifies security configuration for Amazon API Gateway throttle to ensure alignment with AWS security best practices\
    \ and compliance requirements. Proper configuration reduces security risks, maintains defense in depth, and supports overall\
    \ security posture.\n\nSteps:\n1. Open APIGATEWAY console\n2. Select the throttle\n3. Review security configuration\n\
    4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\
    \u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\
    \u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: API request validation is enabled
  severity: high
  rule_id: aws.apigateway.requestvalidator.api_request_schema_validation_enabled
  for_each:
    discovery: aws.apigateway.requestvalidators
    as: requestvalidator
    item: requestvalidator
  conditions:
    var: requestvalidator.compliant
    op: equals
    value: true
  remediation: "Configure apigateway requestvalidator for compliance:\n\nRequirement: Api Request Schema Validation Enabled\n\
    \nDescription: Checks high-priority security configuration for Amazon API Gateway requestvalidator to mitigate significant\
    \ security risks. This control addresses vulnerabilities that could lead to unauthorized access, data exposure, or regulatory\
    \ non-compliance if exploited.\n\nSteps:\n1. Open APIGATEWAY console\n2. Select the requestvalidator\n3. Review security\
    \ configuration\n4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral\
    \ Security Recommendations:\n\u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable\
    \ logging and monitoring\n\u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY restapi: Waf Enabled'
  severity: medium
  rule_id: aws.apigateway.restapi.waf_enabled
  for_each:
    discovery: aws.apigateway.restapis
    as: restapi
    item: restapi
  conditions:
    var: restapi.compliant
    op: equals
    value: true
  remediation: "Configure apigateway restapi for compliance:\n\nRequirement: Waf Enabled\n\nDescription: Verifies security\
    \ configuration for Amazon API Gateway restapi to ensure alignment with AWS security best practices and compliance requirements.\
    \ Proper configuration reduces security risks, maintains defense in depth, and supports overall security posture.\n\n\
    Steps:\n1. Open APIGATEWAY console\n2. Select the restapi\n3. Review security configuration\n4. Apply required settings\
    \ per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\u2022 Follow\
    \ AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\u2022 Use\
    \ encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY resource: Restapi Cache Encrypted'
  severity: high
  rule_id: aws.apigateway.resource.restapi_cache_encrypted
  for_each:
    discovery: aws.apigateway.resource_encryption
    as: resource
    item: resource
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
  remediation: "Enable encryption for apigateway resource:\n\n1. Open APIGATEWAY console\n2. Select the resource\n3. Navigate\
    \ to Properties/Configuration > Encryption\n4. Enable encryption\n5. Choose encryption key:\n   - AWS managed key (default)\n\
    \   - Customer managed key (KMS) for enhanced control\n6. Save changes\n\nAWS CLI:\naws apigateway modify-resource --resource-id\
    \ <id> --encrypted --kms-key-id <key-id>\n\nSecurity Best Practices:\n\u2022 Use customer-managed KMS keys for sensitive\
    \ data\n\u2022 Enable automatic key rotation\n\u2022 Implement proper key access policies\n\u2022 Audit key usage regularly"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY v2api: Waf Enabled'
  severity: medium
  rule_id: aws.apigateway.v2api.waf_enabled
  for_each:
    discovery: aws.apigateway.v2apis
    as: v2api
    item: v2api
  conditions:
    var: v2api.compliant
    op: equals
    value: true
  remediation: "Configure apigateway v2api for compliance:\n\nRequirement: Waf Enabled\n\nDescription: Verifies security configuration\
    \ for Amazon API Gateway v2api to ensure alignment with AWS security best practices and compliance requirements. Proper\
    \ configuration reduces security risks, maintains defense in depth, and supports overall security posture.\n\nSteps:\n\
    1. Open APIGATEWAY console\n2. Select the v2api\n3. Review security configuration\n4. Apply required settings per organizational\
    \ policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\u2022 Follow AWS Well-Architected\
    \ Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\u2022 Use encryption where applicable\n\
    \u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY throttle: Api Usage Plan For Keys Required'
  severity: medium
  rule_id: aws.apigateway.throttle.api_usage_plan_for_keys_required
  for_each:
    discovery: aws.apigateway.throttles
    as: throttle
    item: throttle
  conditions:
    var: throttle.compliant
    op: equals
    value: true
  remediation: "Configure apigateway throttle for compliance:\n\nRequirement: Api Usage Plan For Keys Required\n\nDescription:\
    \ Verifies security configuration for Amazon API Gateway throttle to ensure alignment with AWS security best practices\
    \ and compliance requirements. Proper configuration reduces security risks, maintains defense in depth, and supports overall\
    \ security posture.\n\nSteps:\n1. Open APIGATEWAY console\n2. Select the throttle\n3. Review security configuration\n\
    4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\
    \u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\
    \u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY v2api: Authz Policies Enforced'
  severity: medium
  rule_id: aws.apigateway.v2api.authz_policies_enforced
  for_each:
    discovery: aws.apigateway.v2apis
    as: v2api
    item: v2api
  conditions:
    var: v2api.compliant
    op: equals
    value: true
  remediation: "Configure apigateway v2api for compliance:\n\nRequirement: Authz Policies Enforcement\n\nDescription: Verifies\
    \ security configuration for Amazon API Gateway v2api to ensure alignment with AWS security best practices and compliance\
    \ requirements. Proper configuration reduces security risks, maintains defense in depth, and supports overall security\
    \ posture.\n\nSteps:\n1. Open APIGATEWAY console\n2. Select the v2api\n3. Review security configuration\n4. Apply required\
    \ settings per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\u2022\
    \ Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\u2022\
    \ Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY authorizer: Tls Min 1 2 Enforced'
  severity: high
  rule_id: aws.apigateway.authorizer.tls_min_1_2_enforced
  for_each:
    discovery: aws.apigateway.authorizers
    as: authorizer
    item: authorizer
  conditions:
    var: authorizer.in_vpc
    op: equals
    value: true
  remediation: "Configure network security for apigateway authorizer:\n\n1. Ensure authorizer is deployed in VPC\n2. Configure\
    \ security groups:\n   - Restrict inbound traffic to necessary ports\n   - Limit source IP ranges\n   - Use least privilege\n\
    3. Configure network ACLs for subnet-level control\n4. Enable VPC Flow Logs for network monitoring\n5. Use Private Link/VPC\
    \ Endpoints where available\n6. Enable TLS/SSL for data in transit\n\nNetwork Security Best Practices:\n\u2022 Deploy\
    \ in private subnets when possible\n\u2022 Use NAT Gateway for outbound internet access\n\u2022 Implement defense in depth\n\
    \u2022 Enable encryption in transit\n\u2022 Monitor network traffic"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY stage: Api Logs Retention Days Minimum'
  severity: medium
  rule_id: aws.apigateway.stage.api_logs_retention_days_minimum
  for_each:
    discovery: aws.apigateway.stage_logging
    as: stage
    item: stage
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
  remediation: "Enable logging for apigateway stage:\n\n1. Open APIGATEWAY console\n2. Select the stage\n3. Go to Logging/Monitoring\
    \ settings\n4. Enable logging\n5. Configure log destination:\n   - CloudWatch Logs\n   - S3 bucket (for long-term retention)\n\
    6. Set log level (INFO, DEBUG, ERROR)\n7. Save changes\n\nAWS CLI:\naws apigateway update-stage-logging --stage-id <id>\
    \ --logging-enabled\n\nBest Practices:\n\u2022 Enable all security-relevant log types\n\u2022 Send logs to centralized\
    \ logging service\n\u2022 Set appropriate retention periods\n\u2022 Configure log encryption\n\u2022 Set up log monitoring\
    \ and alerting"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY stage: Api Access Log Sink Configured'
  severity: medium
  rule_id: aws.apigateway.stage.api_access_log_sink_configured
  for_each:
    discovery: aws.apigateway.stage_logging
    as: stage
    item: stage
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
  remediation: "Enable logging for apigateway stage:\n\n1. Open APIGATEWAY console\n2. Select the stage\n3. Go to Logging/Monitoring\
    \ settings\n4. Enable logging\n5. Configure log destination:\n   - CloudWatch Logs\n   - S3 bucket (for long-term retention)\n\
    6. Set log level (INFO, DEBUG, ERROR)\n7. Save changes\n\nAWS CLI:\naws apigateway update-stage-logging --stage-id <id>\
    \ --logging-enabled\n\nBest Practices:\n\u2022 Enable all security-relevant log types\n\u2022 Send logs to centralized\
    \ logging service\n\u2022 Set appropriate retention periods\n\u2022 Configure log encryption\n\u2022 Set up log monitoring\
    \ and alerting"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY resource: Api Gateway Https Required'
  severity: medium
  rule_id: aws.apigateway.resource.api_gateway_https_required
  for_each:
    discovery: aws.apigateway.resources
    as: resource
    item: resource
  conditions:
    var: resource.compliant
    op: equals
    value: true
  remediation: "Configure apigateway resource for compliance:\n\nRequirement: Api Gateway Https Required\n\nDescription: Verifies\
    \ security configuration for Amazon API Gateway resource to ensure alignment with AWS security best practices and compliance\
    \ requirements. Proper configuration reduces security risks, maintains defense in depth, and supports overall security\
    \ posture.\n\nSteps:\n1. Open APIGATEWAY console\n2. Select the resource\n3. Review security configuration\n4. Apply required\
    \ settings per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\u2022\
    \ Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\u2022\
    \ Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY usageplan: Api Rate Limits Configured'
  severity: medium
  rule_id: aws.apigateway.usageplan.api_rate_limits_configured
  for_each:
    discovery: aws.apigateway.usageplans
    as: usageplan
    item: usageplan
  conditions:
    var: usageplan.compliant
    op: equals
    value: true
  remediation: "Configure apigateway usageplan for compliance:\n\nRequirement: Api Rate Limits Configuration\n\nDescription:\
    \ Verifies security configuration for Amazon API Gateway usageplan to ensure alignment with AWS security best practices\
    \ and compliance requirements. Proper configuration reduces security risks, maintains defense in depth, and supports overall\
    \ security posture.\n\nSteps:\n1. Open APIGATEWAY console\n2. Select the usageplan\n3. Review security configuration\n\
    4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\
    \u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\
    \u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY usageplan: Api Stage Throttle Overrides Bounded'
  severity: medium
  rule_id: aws.apigateway.usageplan.api_stage_throttle_overrides_bounded
  for_each:
    discovery: aws.apigateway.usageplans
    as: usageplan
    item: usageplan
  conditions:
    var: usageplan.compliant
    op: equals
    value: true
  remediation: "Configure apigateway usageplan for compliance:\n\nRequirement: Api Stage Throttle Overrides Bounded\n\nDescription:\
    \ Verifies security configuration for Amazon API Gateway usageplan to ensure alignment with AWS security best practices\
    \ and compliance requirements. Proper configuration reduces security risks, maintains defense in depth, and supports overall\
    \ security posture.\n\nSteps:\n1. Open APIGATEWAY console\n2. Select the usageplan\n3. Review security configuration\n\
    4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\
    \u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\
    \u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY apikey: Scopes Least Privilege'
  severity: high
  rule_id: aws.apigateway.apikey.scopes_least_privilege
  for_each:
    discovery: aws.apigateway.apikeys
    as: apikey
    item: apikey
  conditions:
    var: apikey.is_public
    op: equals
    value: false
  remediation: "Restrict public access for apigateway apikey:\n\n1. Open APIGATEWAY console\n2. Select the apikey\n3. Go to\
    \ Permissions/Access Control\n4. Review current permissions:\n   - Remove public access grants\n   - Remove wildcard (*)\
    \ principals\n   - Implement least privilege\n5. Update resource policy or IAM policies\n6. Enable resource-level access\
    \ control\n7. Save changes\n\nSecurity Recommendations:\n\u2022 Use IAM roles instead of access keys\n\u2022 Implement\
    \ condition keys for additional security\n\u2022 Enable MFA for sensitive operations\n\u2022 Regularly audit access permissions\n\
    \u2022 Use AWS Organizations SCPs for guardrails"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: API throttling and rate limiting are enabled
  severity: medium
  rule_id: aws.apigateway.usageplan.api_stage_burst_limit_configured
  for_each:
    discovery: aws.apigateway.usageplans
    as: usageplan
    item: usageplan
  conditions:
    var: usageplan.compliant
    op: equals
    value: true
  remediation: "Configure apigateway usageplan for compliance:\n\nRequirement: Api Stage Burst Limit Configuration\n\nDescription:\
    \ Verifies security configuration for Amazon API Gateway usageplan to ensure alignment with AWS security best practices\
    \ and compliance requirements. Proper configuration reduces security risks, maintains defense in depth, and supports overall\
    \ security posture.\n\nSteps:\n1. Open APIGATEWAY console\n2. Select the usageplan\n3. Review security configuration\n\
    4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\
    \u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\
    \u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY stage: Api Access Log Fields Identity Configured'
  severity: medium
  rule_id: aws.apigateway.stage.api_access_log_fields_identity_configured
  for_each:
    discovery: aws.apigateway.stage_logging
    as: stage
    item: stage
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
  remediation: "Enable logging for apigateway stage:\n\n1. Open APIGATEWAY console\n2. Select the stage\n3. Go to Logging/Monitoring\
    \ settings\n4. Enable logging\n5. Configure log destination:\n   - CloudWatch Logs\n   - S3 bucket (for long-term retention)\n\
    6. Set log level (INFO, DEBUG, ERROR)\n7. Save changes\n\nAWS CLI:\naws apigateway update-stage-logging --stage-id <id>\
    \ --logging-enabled\n\nBest Practices:\n\u2022 Enable all security-relevant log types\n\u2022 Send logs to centralized\
    \ logging service\n\u2022 Set appropriate retention periods\n\u2022 Configure log encryption\n\u2022 Set up log monitoring\
    \ and alerting"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY requestvalidator: Api Parameters Validation Enabled'
  severity: medium
  rule_id: aws.apigateway.requestvalidator.api_parameters_validation_enabled
  for_each:
    discovery: aws.apigateway.requestvalidators
    as: requestvalidator
    item: requestvalidator
  conditions:
    var: requestvalidator.compliant
    op: equals
    value: true
  remediation: "Configure apigateway requestvalidator for compliance:\n\nRequirement: Api Parameters Validation Enabled\n\n\
    Description: Verifies security configuration for Amazon API Gateway requestvalidator to ensure alignment with AWS security\
    \ best practices and compliance requirements. Proper configuration reduces security risks, maintains defense in depth,\
    \ and supports overall security posture.\n\nSteps:\n1. Open APIGATEWAY console\n2. Select the requestvalidator\n3. Review\
    \ security configuration\n4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\
    \nGeneral Security Recommendations:\n\u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\
    \u2022 Enable logging and monitoring\n\u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY stage: Throttling Enabled'
  severity: medium
  rule_id: aws.apigateway.stage.throttling_enabled
  for_each:
    discovery: aws.apigateway.stages
    as: stage
    item: stage
  conditions:
    var: stage.compliant
    op: equals
    value: true
  remediation: "Configure apigateway stage for compliance:\n\nRequirement: Rate Limiting\n\nDescription: Verifies security\
    \ configuration for Amazon API Gateway stage to ensure alignment with AWS security best practices and compliance requirements.\
    \ Proper configuration reduces security risks, maintains defense in depth, and supports overall security posture.\n\n\
    Steps:\n1. Open APIGATEWAY console\n2. Select the stage\n3. Review security configuration\n4. Apply required settings\
    \ per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\u2022 Follow\
    \ AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\u2022 Use\
    \ encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY authorizer: Api Token Audience Restricted'
  severity: medium
  rule_id: aws.apigateway.authorizer.api_token_audience_restricted
  for_each:
    discovery: aws.apigateway.authorizers
    as: authorizer
    item: authorizer
  conditions:
    var: authorizer.compliant
    op: equals
    value: true
  remediation: "Configure apigateway authorizer for compliance:\n\nRequirement: Api Token Audience Restricted\n\nDescription:\
    \ Verifies security configuration for Amazon API Gateway authorizer to ensure alignment with AWS security best practices\
    \ and compliance requirements. Proper configuration reduces security risks, maintains defense in depth, and supports overall\
    \ security posture.\n\nSteps:\n1. Open APIGATEWAY console\n2. Select the authorizer\n3. Review security configuration\n\
    4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\
    \u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\
    \u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY restapi: Tracing Enabled'
  severity: medium
  rule_id: aws.apigateway.restapi.tracing_enabled
  for_each:
    discovery: aws.apigateway.restapis
    as: restapi
    item: restapi
  conditions:
    var: restapi.compliant
    op: equals
    value: true
  remediation: "Configure apigateway restapi for compliance:\n\nRequirement: Tracing Enabled\n\nDescription: Verifies security\
    \ configuration for Amazon API Gateway restapi to ensure alignment with AWS security best practices and compliance requirements.\
    \ Proper configuration reduces security risks, maintains defense in depth, and supports overall security posture.\n\n\
    Steps:\n1. Open APIGATEWAY console\n2. Select the restapi\n3. Review security configuration\n4. Apply required settings\
    \ per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\u2022 Follow\
    \ AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\u2022 Use\
    \ encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY v2api: Private Networking Enforced'
  severity: high
  rule_id: aws.apigateway.v2api.private_networking_enforced
  for_each:
    discovery: aws.apigateway.v2apis
    as: v2api
    item: v2api
  conditions:
    var: v2api.is_public
    op: equals
    value: false
  remediation: "Restrict public access for apigateway v2api:\n\n1. Open APIGATEWAY console\n2. Select the v2api\n3. Go to\
    \ Permissions/Access Control\n4. Review current permissions:\n   - Remove public access grants\n   - Remove wildcard (*)\
    \ principals\n   - Implement least privilege\n5. Update resource policy or IAM policies\n6. Enable resource-level access\
    \ control\n7. Save changes\n\nSecurity Recommendations:\n\u2022 Use IAM roles instead of access keys\n\u2022 Implement\
    \ condition keys for additional security\n\u2022 Enable MFA for sensitive operations\n\u2022 Regularly audit access permissions\n\
    \u2022 Use AWS Organizations SCPs for guardrails"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY throttle: Api Stage Rate Limit Configured'
  severity: medium
  rule_id: aws.apigateway.throttle.api_stage_rate_limit_configured
  for_each:
    discovery: aws.apigateway.throttles
    as: throttle
    item: throttle
  conditions:
    var: throttle.compliant
    op: equals
    value: true
  remediation: "Configure apigateway throttle for compliance:\n\nRequirement: Api Stage Rate Limit Configuration\n\nDescription:\
    \ Verifies security configuration for Amazon API Gateway throttle to ensure alignment with AWS security best practices\
    \ and compliance requirements. Proper configuration reduces security risks, maintains defense in depth, and supports overall\
    \ security posture.\n\nSteps:\n1. Open APIGATEWAY console\n2. Select the throttle\n3. Review security configuration\n\
    4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\
    \u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\
    \u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY apikey: Key Expiration Required'
  severity: medium
  rule_id: aws.apigateway.apikey.key_expiration_required
  for_each:
    discovery: aws.apigateway.apikeys
    as: apikey
    item: apikey
  conditions:
    var: apikey.compliant
    op: equals
    value: true
  remediation: "Configure apigateway apikey for compliance:\n\nRequirement: Key Expiration Required\n\nDescription: Verifies\
    \ security configuration for Amazon API Gateway apikey to ensure alignment with AWS security best practices and compliance\
    \ requirements. Proper configuration reduces security risks, maintains defense in depth, and supports overall security\
    \ posture.\n\nSteps:\n1. Open APIGATEWAY console\n2. Select the apikey\n3. Review security configuration\n4. Apply required\
    \ settings per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\u2022\
    \ Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\u2022\
    \ Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY usageplan: Api Keys Required'
  severity: medium
  rule_id: aws.apigateway.usageplan.api_keys_required
  for_each:
    discovery: aws.apigateway.usageplans
    as: usageplan
    item: usageplan
  conditions:
    var: usageplan.compliant
    op: equals
    value: true
  remediation: "Configure apigateway usageplan for compliance:\n\nRequirement: Api Keys Required\n\nDescription: Verifies\
    \ security configuration for Amazon API Gateway usageplan to ensure alignment with AWS security best practices and compliance\
    \ requirements. Proper configuration reduces security risks, maintains defense in depth, and supports overall security\
    \ posture.\n\nSteps:\n1. Open APIGATEWAY console\n2. Select the usageplan\n3. Review security configuration\n4. Apply\
    \ required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\
    \u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\
    \u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY restapi: Authz Policies Enforced'
  severity: medium
  rule_id: aws.apigateway.restapi.authz_policies_enforced
  for_each:
    discovery: aws.apigateway.restapis
    as: restapi
    item: restapi
  conditions:
    var: restapi.compliant
    op: equals
    value: true
  remediation: "Configure apigateway restapi for compliance:\n\nRequirement: Authz Policies Enforcement\n\nDescription: Verifies\
    \ security configuration for Amazon API Gateway restapi to ensure alignment with AWS security best practices and compliance\
    \ requirements. Proper configuration reduces security risks, maintains defense in depth, and supports overall security\
    \ posture.\n\nSteps:\n1. Open APIGATEWAY console\n2. Select the restapi\n3. Review security configuration\n4. Apply required\
    \ settings per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\u2022\
    \ Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\u2022\
    \ Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY restapi: Public Access Restricted'
  severity: high
  rule_id: aws.apigateway.restapi.public_access_restricted
  for_each:
    discovery: aws.apigateway.restapis
    as: restapi
    item: restapi
  conditions:
    var: restapi.is_public
    op: equals
    value: false
  remediation: "Restrict public access for apigateway restapi:\n\n1. Open APIGATEWAY console\n2. Select the restapi\n3. Go\
    \ to Permissions/Access Control\n4. Review current permissions:\n   - Remove public access grants\n   - Remove wildcard\
    \ (*) principals\n   - Implement least privilege\n5. Update resource policy or IAM policies\n6. Enable resource-level\
    \ access control\n7. Save changes\n\nSecurity Recommendations:\n\u2022 Use IAM roles instead of access keys\n\u2022 Implement\
    \ condition keys for additional security\n\u2022 Enable MFA for sensitive operations\n\u2022 Regularly audit access permissions\n\
    \u2022 Use AWS Organizations SCPs for guardrails"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY requestvalidator: Api Request Body Size Limit Configured'
  severity: medium
  rule_id: aws.apigateway.requestvalidator.api_request_body_size_limit_configured
  for_each:
    discovery: aws.apigateway.requestvalidators
    as: requestvalidator
    item: requestvalidator
  conditions:
    var: requestvalidator.compliant
    op: equals
    value: true
  remediation: "Configure apigateway requestvalidator for compliance:\n\nRequirement: Api Request Body Size Limit Configuration\n\
    \nDescription: Verifies security configuration for Amazon API Gateway requestvalidator to ensure alignment with AWS security\
    \ best practices and compliance requirements. Proper configuration reduces security risks, maintains defense in depth,\
    \ and supports overall security posture.\n\nSteps:\n1. Open APIGATEWAY console\n2. Select the requestvalidator\n3. Review\
    \ security configuration\n4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\
    \nGeneral Security Recommendations:\n\u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\
    \u2022 Enable logging and monitoring\n\u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY resource: Restapi Logging Enabled'
  severity: medium
  rule_id: aws.apigateway.resource.restapi_logging_enabled
  for_each:
    discovery: aws.apigateway.resource_logging
    as: resource
    item: resource
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
  remediation: "Enable logging for apigateway resource:\n\n1. Open APIGATEWAY console\n2. Select the resource\n3. Go to Logging/Monitoring\
    \ settings\n4. Enable logging\n5. Configure log destination:\n   - CloudWatch Logs\n   - S3 bucket (for long-term retention)\n\
    6. Set log level (INFO, DEBUG, ERROR)\n7. Save changes\n\nAWS CLI:\naws apigateway update-resource-logging --resource-id\
    \ <id> --logging-enabled\n\nBest Practices:\n\u2022 Enable all security-relevant log types\n\u2022 Send logs to centralized\
    \ logging service\n\u2022 Set appropriate retention periods\n\u2022 Configure log encryption\n\u2022 Set up log monitoring\
    \ and alerting"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: 'APIGATEWAY stage: Api Execution Logging Level Minimum Error Configured'
  severity: medium
  rule_id: aws.apigateway.stage.api_execution_logging_level_minimum_error_configured
  for_each:
    discovery: aws.apigateway.stage_logging
    as: stage
    item: stage
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
  remediation: "Enable logging for apigateway stage:\n\n1. Open APIGATEWAY console\n2. Select the stage\n3. Go to Logging/Monitoring\
    \ settings\n4. Enable logging\n5. Configure log destination:\n   - CloudWatch Logs\n   - S3 bucket (for long-term retention)\n\
    6. Set log level (INFO, DEBUG, ERROR)\n7. Save changes\n\nAWS CLI:\naws apigateway update-stage-logging --stage-id <id>\
    \ --logging-enabled\n\nBest Practices:\n\u2022 Enable all security-relevant log types\n\u2022 Send logs to centralized\
    \ logging service\n\u2022 Set appropriate retention periods\n\u2022 Configure log encryption\n\u2022 Set up log monitoring\
    \ and alerting"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: API logging and monitoring are enabled
  severity: high
  rule_id: aws.apigateway.stage.api_access_logging_enabled
  for_each:
    discovery: aws.apigateway.stage_logging
    as: stage
    item: stage
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
  remediation: "Enable logging for apigateway stage:\n\n1. Open APIGATEWAY console\n2. Select the stage\n3. Go to Logging/Monitoring\
    \ settings\n4. Enable logging\n5. Configure log destination:\n   - CloudWatch Logs\n   - S3 bucket (for long-term retention)\n\
    6. Set log level (INFO, DEBUG, ERROR)\n7. Save changes\n\nAWS CLI:\naws apigateway update-stage-logging --stage-id <id>\
    \ --logging-enabled\n\nBest Practices:\n\u2022 Enable all security-relevant log types\n\u2022 Send logs to centralized\
    \ logging service\n\u2022 Set appropriate retention periods\n\u2022 Configure log encryption\n\u2022 Set up log monitoring\
    \ and alerting"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: 'APIGATEWAY throttle: Api Quota Limit Configured'
  severity: medium
  rule_id: aws.apigateway.throttle.api_quota_limit_configured
  for_each:
    discovery: aws.apigateway.throttles
    as: throttle
    item: throttle
  conditions:
    var: throttle.compliant
    op: equals
    value: true
  remediation: "Configure apigateway throttle for compliance:\n\nRequirement: Api Quota Limit Configuration\n\nDescription:\
    \ Verifies security configuration for Amazon API Gateway throttle to ensure alignment with AWS security best practices\
    \ and compliance requirements. Proper configuration reduces security risks, maintains defense in depth, and supports overall\
    \ security posture.\n\nSteps:\n1. Open APIGATEWAY console\n2. Select the throttle\n3. Review security configuration\n\
    4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\
    \u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\
    \u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY restapi: Authn Required'
  severity: medium
  rule_id: aws.apigateway.restapi.authn_required
  for_each:
    discovery: aws.apigateway.restapis
    as: restapi
    item: restapi
  conditions:
    var: restapi.compliant
    op: equals
    value: true
  remediation: "Configure apigateway restapi for compliance:\n\nRequirement: Authn Required\n\nDescription: Verifies security\
    \ configuration for Amazon API Gateway restapi to ensure alignment with AWS security best practices and compliance requirements.\
    \ Proper configuration reduces security risks, maintains defense in depth, and supports overall security posture.\n\n\
    Steps:\n1. Open APIGATEWAY console\n2. Select the restapi\n3. Review security configuration\n4. Apply required settings\
    \ per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\u2022 Follow\
    \ AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\u2022 Use\
    \ encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY v2api: Authn Required'
  severity: medium
  rule_id: aws.apigateway.v2api.authn_required
  for_each:
    discovery: aws.apigateway.v2apis
    as: v2api
    item: v2api
  conditions:
    var: v2api.compliant
    op: equals
    value: true
  remediation: "Configure apigateway v2api for compliance:\n\nRequirement: Authn Required\n\nDescription: Verifies security\
    \ configuration for Amazon API Gateway v2api to ensure alignment with AWS security best practices and compliance requirements.\
    \ Proper configuration reduces security risks, maintains defense in depth, and supports overall security posture.\n\n\
    Steps:\n1. Open APIGATEWAY console\n2. Select the v2api\n3. Review security configuration\n4. Apply required settings\
    \ per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\u2022 Follow\
    \ AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\u2022 Use\
    \ encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY usageplan: Api Quota Limits Configured'
  severity: medium
  rule_id: aws.apigateway.usageplan.api_quota_limits_configured
  for_each:
    discovery: aws.apigateway.usageplans
    as: usageplan
    item: usageplan
  conditions:
    var: usageplan.compliant
    op: equals
    value: true
  remediation: "Configure apigateway usageplan for compliance:\n\nRequirement: Api Quota Limits Configuration\n\nDescription:\
    \ Verifies security configuration for Amazon API Gateway usageplan to ensure alignment with AWS security best practices\
    \ and compliance requirements. Proper configuration reduces security risks, maintains defense in depth, and supports overall\
    \ security posture.\n\nSteps:\n1. Open APIGATEWAY console\n2. Select the usageplan\n3. Review security configuration\n\
    4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\
    \u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\
    \u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY certificate: Certificate Enabled'
  severity: medium
  rule_id: aws.apigateway.certificate.certificate_enabled
  for_each:
    discovery: aws.apigateway.certificates
    as: certificate
    item: certificate
  conditions:
    var: certificate.compliant
    op: equals
    value: true
  remediation: "Configure apigateway certificate for compliance:\n\nRequirement: Certificate Enabled\n\nDescription: Verifies\
    \ security configuration for Amazon API Gateway certificate to ensure alignment with AWS security best practices and compliance\
    \ requirements. Proper configuration reduces security risks, maintains defense in depth, and supports overall security\
    \ posture.\n\nSteps:\n1. Open APIGATEWAY console\n2. Select the certificate\n3. Review security configuration\n4. Apply\
    \ required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\
    \u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\
    \u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY restapi: Private Networking Enforced'
  severity: high
  rule_id: aws.apigateway.restapi.private_networking_enforced
  for_each:
    discovery: aws.apigateway.restapis
    as: restapi
    item: restapi
  conditions:
    var: restapi.is_public
    op: equals
    value: false
  remediation: "Restrict public access for apigateway restapi:\n\n1. Open APIGATEWAY console\n2. Select the restapi\n3. Go\
    \ to Permissions/Access Control\n4. Review current permissions:\n   - Remove public access grants\n   - Remove wildcard\
    \ (*) principals\n   - Implement least privilege\n5. Update resource policy or IAM policies\n6. Enable resource-level\
    \ access control\n7. Save changes\n\nSecurity Recommendations:\n\u2022 Use IAM roles instead of access keys\n\u2022 Implement\
    \ condition keys for additional security\n\u2022 Enable MFA for sensitive operations\n\u2022 Regularly audit access permissions\n\
    \u2022 Use AWS Organizations SCPs for guardrails"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: API request validation is enabled
  severity: high
  rule_id: aws.apigateway.requestvalidator.api_response_schema_validation_enabled
  for_each:
    discovery: aws.apigateway.requestvalidators
    as: requestvalidator
    item: requestvalidator
  conditions:
    var: requestvalidator.compliant
    op: equals
    value: true
  remediation: "Configure apigateway requestvalidator for compliance:\n\nRequirement: Api Response Schema Validation Enabled\n\
    \nDescription: Checks high-priority security configuration for Amazon API Gateway requestvalidator to mitigate significant\
    \ security risks. This control addresses vulnerabilities that could lead to unauthorized access, data exposure, or regulatory\
    \ non-compliance if exploited.\n\nSteps:\n1. Open APIGATEWAY console\n2. Select the requestvalidator\n3. Review security\
    \ configuration\n4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral\
    \ Security Recommendations:\n\u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable\
    \ logging and monitoring\n\u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY stage: Usage Plan For Api Keys Required'
  severity: medium
  rule_id: aws.apigateway.stage.usage_plan_for_api_keys_required
  for_each:
    discovery: aws.apigateway.stages
    as: stage
    item: stage
  conditions:
    var: stage.compliant
    op: equals
    value: true
  remediation: "Configure apigateway stage for compliance:\n\nRequirement: Usage Plan For Api Keys Required\n\nDescription:\
    \ Verifies security configuration for Amazon API Gateway stage to ensure alignment with AWS security best practices and\
    \ compliance requirements. Proper configuration reduces security risks, maintains defense in depth, and supports overall\
    \ security posture.\n\nSteps:\n1. Open APIGATEWAY console\n2. Select the stage\n3. Review security configuration\n4. Apply\
    \ required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\
    \u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\
    \u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: API throttling and rate limiting are enabled
  severity: medium
  rule_id: aws.apigateway.throttle.api_stage_burst_limit_configured
  for_each:
    discovery: aws.apigateway.throttles
    as: throttle
    item: throttle
  conditions:
    var: throttle.compliant
    op: equals
    value: true
  remediation: "Configure apigateway throttle for compliance:\n\nRequirement: Api Stage Burst Limit Configuration\n\nDescription:\
    \ Verifies security configuration for Amazon API Gateway throttle to ensure alignment with AWS security best practices\
    \ and compliance requirements. Proper configuration reduces security risks, maintains defense in depth, and supports overall\
    \ security posture.\n\nSteps:\n1. Open APIGATEWAY console\n2. Select the throttle\n3. Review security configuration\n\
    4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\
    \u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\
    \u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: 'APIGATEWAY resource: Api Resource Attached Enabled'
  severity: medium
  rule_id: aws.apigateway.resource.api_resource_attached_enabled
  for_each:
    discovery: aws.apigateway.resources
    as: resource
    item: resource
  conditions:
    var: resource.compliant
    op: equals
    value: true
  remediation: "Configure apigateway resource for compliance:\n\nRequirement: Api Resource Attached Enabled\n\nDescription:\
    \ Verifies security configuration for Amazon API Gateway resource to ensure alignment with AWS security best practices\
    \ and compliance requirements. Proper configuration reduces security risks, maintains defense in depth, and supports overall\
    \ security posture.\n\nSteps:\n1. Open APIGATEWAY console\n2. Select the resource\n3. Review security configuration\n\
    4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\
    \u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\
    \u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/security.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
- title: Deprecation notices are monitored
  severity: low
  rule_id: aws.apigateway.restapi.logging_enabled
  for_each:
    discovery: aws.apigateway.restapi_logging
    as: restapi
    item: restapi
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
  remediation: "Enable logging for apigateway restapi:\n\n1. Open APIGATEWAY console\n2. Select the restapi\n3. Go to Logging/Monitoring\
    \ settings\n4. Enable logging\n5. Configure log destination:\n   - CloudWatch Logs\n   - S3 bucket (for long-term retention)\n\
    6. Set log level (INFO, DEBUG, ERROR)\n7. Save changes\n\nAWS CLI:\naws apigateway update-restapi-logging --restapi-id\
    \ <id> --logging-enabled\n\nBest Practices:\n\u2022 Enable all security-relevant log types\n\u2022 Send logs to centralized\
    \ logging service\n\u2022 Set appropriate retention periods\n\u2022 Configure log encryption\n\u2022 Set up log monitoring\
    \ and alerting"
  references:
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/best-practices.html
  - https://docs.aws.amazon.com/securityhub/latest/userguide/apigateway-controls.html
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
