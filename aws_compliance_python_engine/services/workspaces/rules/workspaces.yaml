version: '1.0'
provider: aws
service: workspaces
services:
  client: workspaces
  module: boto3.client
discovery:
- discovery_id: aws.workspaces.describe_applications
  calls:
  - action: describe_applications
    save_as: response
  emit:
    item:
      ApplicationId: '{{ response.Applications.ApplicationId }}'
      Created: '{{ response.Applications.Created }}'
      Description: '{{ response.Applications.Description }}'
      LicenseType: '{{ response.Applications.LicenseType }}'
      Name: '{{ response.Applications.Name }}'
      Owner: '{{ response.Applications.Owner }}'
      State: '{{ response.Applications.State }}'
      SupportedComputeTypeNames: '{{ response.Applications.SupportedComputeTypeNames
        }}'
      SupportedOperatingSystemNames: '{{ response.Applications.SupportedOperatingSystemNames
        }}'
- discovery_id: aws.workspaces.describe_workspace_directories
  calls:
  - action: describe_workspace_directories
    save_as: response
  emit:
    item:
      DirectoryId: '{{ response.Directories.DirectoryId }}'
      Alias: '{{ response.Directories.Alias }}'
      DirectoryName: '{{ response.Directories.DirectoryName }}'
      RegistrationCode: '{{ response.Directories.RegistrationCode }}'
      SubnetIds: '{{ response.Directories.SubnetIds }}'
      DnsIpAddresses: '{{ response.Directories.DnsIpAddresses }}'
      DnsIpv6Addresses: '{{ response.Directories.DnsIpv6Addresses }}'
      CustomerUserName: '{{ response.Directories.CustomerUserName }}'
      IamRoleId: '{{ response.Directories.IamRoleId }}'
      DirectoryType: '{{ response.Directories.DirectoryType }}'
      WorkspaceSecurityGroupId: '{{ response.Directories.WorkspaceSecurityGroupId
        }}'
      State: '{{ response.Directories.State }}'
      WorkspaceCreationProperties: '{{ response.Directories.WorkspaceCreationProperties
        }}'
      ipGroupIds: '{{ response.Directories.ipGroupIds }}'
      WorkspaceAccessProperties: '{{ response.Directories.WorkspaceAccessProperties
        }}'
      Tenancy: '{{ response.Directories.Tenancy }}'
      SelfservicePermissions: '{{ response.Directories.SelfservicePermissions }}'
      SamlProperties: '{{ response.Directories.SamlProperties }}'
      CertificateBasedAuthProperties: '{{ response.Directories.CertificateBasedAuthProperties
        }}'
      EndpointEncryptionMode: '{{ response.Directories.EndpointEncryptionMode }}'
      MicrosoftEntraConfig: '{{ response.Directories.MicrosoftEntraConfig }}'
      WorkspaceDirectoryName: '{{ response.Directories.WorkspaceDirectoryName }}'
      WorkspaceDirectoryDescription: '{{ response.Directories.WorkspaceDirectoryDescription
        }}'
      UserIdentityType: '{{ response.Directories.UserIdentityType }}'
      WorkspaceType: '{{ response.Directories.WorkspaceType }}'
      IDCConfig: '{{ response.Directories.IDCConfig }}'
      ActiveDirectoryConfig: '{{ response.Directories.ActiveDirectoryConfig }}'
      StreamingProperties: '{{ response.Directories.StreamingProperties }}'
      ErrorMessage: '{{ response.Directories.ErrorMessage }}'
checks:
- rule_id: aws.workspaces.resource.directory_check_web_access_disabled
  for_each: aws.workspaces.describe_workspace_directories
  conditions:
    var: item.WorkspaceAccessProperties
    op: equals
    value:
      DeviceTypeWeb: DISABLED
- rule_id: aws.workspaces.restapi.public_access_restricted
  for_each: aws.workspaces.describe_workspace_directories
  conditions:
    var: item.WorkspaceAccessProperties
    op: equals
    value:
      DeviceTypeWindows: DENY
      DeviceTypeOsx: DENY
      DeviceTypeWeb: DENY
      DeviceTypeIos: DENY
      DeviceTypeAndroid: DENY
      DeviceTypeChromeOs: DENY
      DeviceTypeZeroClient: DENY
      DeviceTypeLinux: DENY
- rule_id: aws.workspaces.resource.workspaces_directory_enable_maintenance_mode_configured
  for_each: aws.workspaces.describe_applications
  conditions:
    var: item.State
    op: equals
    value: ENABLED
