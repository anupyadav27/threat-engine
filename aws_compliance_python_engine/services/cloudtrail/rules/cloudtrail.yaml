version: 1.0
provider: aws
service: cloudtrail
discovery:
  discovery_id: aws.cloudtrail.trails
  calls:
    - client: cloudtrail
      action: describe_trails
      paginate: true
  fields:
    - name: Name
      save_as: trail_name
  emit:
    items_for:
      as: resource
      item: trail_name
checks:
  - title: Centralized Logging Enabled
    severity: medium
    rule_id: aws.cloudtrail.log_collection.centralized_logging_enabled
    assertion_id: logging_monitoring.log_collection.centralized_logging_enabled
    for_each:
      as: resource
      item: trail_name
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement centralized logging enabled for cloudtrail"
    references:
      - "https://docs.aws.amazon.com/cloudtrail/"
  - title: Log Integrity Protected
    severity: medium
    rule_id: aws.cloudtrail.log_collection.log_integrity_protected
    assertion_id: logging_monitoring.log_collection.log_integrity_protected
    for_each:
      as: resource
      item: trail_name
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement log integrity protected for cloudtrail"
    references:
      - "https://docs.aws.amazon.com/cloudtrail/"
  - title: Structured Logging Enforced
    severity: medium
    rule_id: aws.cloudtrail.log_collection.structured_logging_enforced
    assertion_id: logging_monitoring.log_collection.structured_logging_enforced
    for_each:
      as: resource
      item: trail_name
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement structured logging enforced for cloudtrail"
    references:
      - "https://docs.aws.amazon.com/cloudtrail/"
  - title: Security Events Logged
    severity: medium
    rule_id: aws.cloudtrail.audit_logging.security_events_logged
    assertion_id: logging_monitoring.audit_logging.security_events_logged
    for_each:
      as: resource
      item: trail_name
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement security events logged for cloudtrail"
    references:
      - "https://docs.aws.amazon.com/cloudtrail/"
  - title: Security Events Logged
    severity: medium
    rule_id: aws.cloudtrail.insights.security_events_logged
    assertion_id: logging_monitoring.audit_logging.security_events_logged
    for_each:
      as: resource
      item: trail_name
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement security events logged for cloudtrail"
    references:
      - "https://docs.aws.amazon.com/cloudtrail/"
  - title: Audit Trail Integrity Maintained
    severity: medium
    rule_id: aws.cloudtrail.audit_logging.audit_trail_integrity_maintained
    assertion_id: logging_monitoring.audit_logging.audit_trail_integrity_maintained
    for_each:
      as: resource
      item: trail_name
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement audit trail integrity maintained for cloudtrail"
    references:
      - "https://docs.aws.amazon.com/cloudtrail/"
  - title: Audit Trail Integrity Maintained
    severity: medium
    rule_id: aws.cloudtrail.insights.audit_trail_integrity_maintained
    assertion_id: logging_monitoring.audit_logging.audit_trail_integrity_maintained
    for_each:
      as: resource
      item: trail_name
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement audit trail integrity maintained for cloudtrail"
    references:
      - "https://docs.aws.amazon.com/cloudtrail/"
  - title: Compliance Logging Enabled
    severity: medium
    rule_id: aws.cloudtrail.audit_logging.compliance_logging_enabled
    assertion_id: logging_monitoring.audit_logging.compliance_logging_enabled
    for_each:
      as: resource
      item: trail_name
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement compliance logging enabled for cloudtrail"
    references:
      - "https://docs.aws.amazon.com/cloudtrail/"
  - title: Compliance Logging Enabled
    severity: medium
    rule_id: aws.cloudtrail.insights.compliance_logging_enabled
    assertion_id: logging_monitoring.audit_logging.compliance_logging_enabled
    for_each:
      as: resource
      item: trail_name
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement compliance logging enabled for cloudtrail"
    references:
      - "https://docs.aws.amazon.com/cloudtrail/"
  - title: Retention Policies Enforced
    severity: medium
    rule_id: aws.cloudtrail.log_retention.retention_policies_enforced
    assertion_id: logging_monitoring.log_retention.retention_policies_enforced
    for_each:
      as: resource
      item: trail_name
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement retention policies enforced for cloudtrail"
    references:
      - "https://docs.aws.amazon.com/cloudtrail/"
  - title: Secure Deletion Enabled
    severity: medium
    rule_id: aws.cloudtrail.log_retention.secure_deletion_enabled
    assertion_id: logging_monitoring.log_retention.secure_deletion_enabled
    for_each:
      as: resource
      item: trail_name
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement secure deletion enabled for cloudtrail"
    references:
      - "https://docs.aws.amazon.com/cloudtrail/"
