version: 1.0
provider: aws
service: ssm
discovery:
  discovery_id: aws.ssm.resources
  calls:
    - client: ssm
      action: describe_ssms
      paginate: true
  fields:
    - name: id
      save_as: resource_id
  emit:
    items_for:
      as: resource
      item: resource_id
checks:
  - title: Encrypted Storage Enabled
    severity: high
    rule_id: aws.ssm.parameter_storage.encrypted_storage_enabled
    assertion_id: secrets_key_mgmt.secret_storage.encrypted_storage_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement encrypted storage enabled for ssm"
    references:
      - "https://docs.aws.amazon.com/ssm/"
  - title: Access Controlled
    severity: high
    rule_id: aws.ssm.parameter_storage.access_controlled
    assertion_id: secrets_key_mgmt.secret_storage.access_controlled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement access controlled for ssm"
    references:
      - "https://docs.aws.amazon.com/ssm/"
  - title: Hsm Protection Enabled
    severity: high
    rule_id: aws.ssm.store.hsm_protection_enabled
    assertion_id: secrets_key_mgmt.key_protection.hsm_protection_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement hsm protection enabled for ssm"
    references:
      - "https://docs.aws.amazon.com/ssm/"
  - title: Key Access Logged
    severity: high
    rule_id: aws.ssm.store.key_access_logged
    assertion_id: secrets_key_mgmt.key_protection.key_access_logged
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement key access logged for ssm"
    references:
      - "https://docs.aws.amazon.com/ssm/"
  - title: Secure Injection Enabled
    severity: high
    rule_id: aws.ssm.parameter_retrieval.secure_injection_enabled
    assertion_id: secrets_key_mgmt.secret_retrieval.secure_injection_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement secure injection enabled for ssm"
    references:
      - "https://docs.aws.amazon.com/ssm/"
  - title: Workload Identity Used
    severity: high
    rule_id: aws.ssm.parameter_retrieval.workload_identity_used
    assertion_id: secrets_key_mgmt.secret_retrieval.workload_identity_used
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement workload identity used for ssm"
    references:
      - "https://docs.aws.amazon.com/ssm/"
  - title: Automatic Patching Enabled
    severity: low
    rule_id: aws.ssm.patch_management.automatic_patching_enabled
    assertion_id: compute_host_security.patch_management.automatic_patching_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement automatic patching enabled for ssm"
    references:
      - "https://docs.aws.amazon.com/ssm/"
  - title: Automatic Patching Enabled
    severity: low
    rule_id: aws.ssm.patch_groups.automatic_patching_enabled
    assertion_id: compute_host_security.patch_management.automatic_patching_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement automatic patching enabled for ssm"
    references:
      - "https://docs.aws.amazon.com/ssm/"
  - title: Automatic Patching Enabled
    severity: low
    rule_id: aws.ssm.maintenance_windows.automatic_patching_enabled
    assertion_id: compute_host_security.patch_management.automatic_patching_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement automatic patching enabled for ssm"
    references:
      - "https://docs.aws.amazon.com/ssm/"
  - title: Patch Compliance Monitored
    severity: low
    rule_id: aws.ssm.patch_management.patch_compliance_monitored
    assertion_id: compute_host_security.patch_management.patch_compliance_monitored
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement patch compliance monitored for ssm"
    references:
      - "https://docs.aws.amazon.com/ssm/"
  - title: Patch Compliance Monitored
    severity: low
    rule_id: aws.ssm.patch_groups.patch_compliance_monitored
    assertion_id: compute_host_security.patch_management.patch_compliance_monitored
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement patch compliance monitored for ssm"
    references:
      - "https://docs.aws.amazon.com/ssm/"
  - title: Patch Compliance Monitored
    severity: low
    rule_id: aws.ssm.maintenance_windows.patch_compliance_monitored
    assertion_id: compute_host_security.patch_management.patch_compliance_monitored
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement patch compliance monitored for ssm"
    references:
      - "https://docs.aws.amazon.com/ssm/"
  - title: Automatic Updates Enabled
    severity: low
    rule_id: aws.ssm.security_updates.automatic_updates_enabled
    assertion_id: platform_surfaces_versions.security_updates.automatic_updates_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement automatic updates enabled for ssm"
    references:
      - "https://docs.aws.amazon.com/ssm/"
  - title: Automatic Updates Enabled
    severity: low
    rule_id: aws.ssm.patch_deployment.automatic_updates_enabled
    assertion_id: platform_surfaces_versions.security_updates.automatic_updates_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement automatic updates enabled for ssm"
    references:
      - "https://docs.aws.amazon.com/ssm/"
  - title: Automatic Updates Enabled
    severity: low
    rule_id: aws.ssm.automated_patching.automatic_updates_enabled
    assertion_id: platform_surfaces_versions.security_updates.automatic_updates_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement automatic updates enabled for ssm"
    references:
      - "https://docs.aws.amazon.com/ssm/"
  - title: Update Testing Conducted
    severity: low
    rule_id: aws.ssm.security_updates.update_testing_conducted
    assertion_id: platform_surfaces_versions.security_updates.update_testing_conducted
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement update testing conducted for ssm"
    references:
      - "https://docs.aws.amazon.com/ssm/"
  - title: Update Testing Conducted
    severity: low
    rule_id: aws.ssm.patch_deployment.update_testing_conducted
    assertion_id: platform_surfaces_versions.security_updates.update_testing_conducted
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement update testing conducted for ssm"
    references:
      - "https://docs.aws.amazon.com/ssm/"
  - title: Update Testing Conducted
    severity: low
    rule_id: aws.ssm.automated_patching.update_testing_conducted
    assertion_id: platform_surfaces_versions.security_updates.update_testing_conducted
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement update testing conducted for ssm"
    references:
      - "https://docs.aws.amazon.com/ssm/"
