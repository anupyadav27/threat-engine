version: '1.0'
provider: aws
service: datasync
discovery:
- discovery_id: aws.datasync.list_agents
  calls:
  - action: list_agents
    save_as: list_agents_response
  emit:
    items_for: '{{ list_agents_response.Agents }}'
    as: resource
    item:
      agent_arn: '{{ resource.AgentArn }}'
      name: '{{ resource.Name }}'
      status: '{{ resource.Status }}'
      platform: '{{ resource.Platform }}'
checks:
- rule_id: aws.datasync.resource.task_logging_enabled
  for_each: aws.datasync.list_agents
  conditions:
    var: item.status
    op: equals
    value: ENABLED
