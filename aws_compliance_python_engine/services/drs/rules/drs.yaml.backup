version: '1.0'
provider: aws
service: drs
discovery:
- discovery_id: aws.drs.create_launch_configuration_template
  calls:
  - action: create_launch_configuration_template
    save_as: create_launch_configuration_template_response
  emit:
    items_for: '{{ create_launch_configuration_template_response.launchConfigurationTemplate
      }}'
    as: resource
    item:
      arn: '{{ resource.arn }}'
      copy_private_ip: '{{ resource.copyPrivateIp }}'
      copy_tags: '{{ resource.copyTags }}'
      export_bucket_arn: '{{ resource.exportBucketArn }}'
      launch_configuration_template_id: '{{ resource.launchConfigurationTemplateID
        }}'
      launch_disposition: '{{ resource.launchDisposition }}'
      launch_into_source_instance: '{{ resource.launchIntoSourceInstance }}'
      licensing: '{{ resource.licensing }}'
      post_launch_enabled: '{{ resource.postLaunchEnabled }}'
      tags: '{{ resource.tags }}'
checks:
- rule_id: aws.drs.resource.drs_failover_execution_configured
  for_each: aws.drs.create_launch_configuration_template
  conditions:
    all:
    - var: item.post_launch_enabled
      op: equals
      value: true
    - var: item.tags
      op: exists
