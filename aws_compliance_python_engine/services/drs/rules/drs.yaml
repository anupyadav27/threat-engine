version: '1.0'
provider: aws
service: drs
services:
  client: drs
  module: boto3.client
discovery:
- discovery_id: aws.drs.describe_recovery_instances
  calls:
  - action: describe_recovery_instances
    save_as: response
  emit:
    item:
      agentVersion: '{{ response.items.agentVersion }}'
      arn: '{{ response.items.arn }}'
      dataReplicationInfo: '{{ response.items.dataReplicationInfo }}'
      ec2InstanceID: '{{ response.items.ec2InstanceID }}'
      ec2InstanceState: '{{ response.items.ec2InstanceState }}'
      failback: '{{ response.items.failback }}'
      isDrill: '{{ response.items.isDrill }}'
      jobID: '{{ response.items.jobID }}'
      originAvailabilityZone: '{{ response.items.originAvailabilityZone }}'
      originEnvironment: '{{ response.items.originEnvironment }}'
      pointInTimeSnapshotDateTime: '{{ response.items.pointInTimeSnapshotDateTime
        }}'
      recoveryInstanceID: '{{ response.items.recoveryInstanceID }}'
      recoveryInstanceProperties: '{{ response.items.recoveryInstanceProperties }}'
      sourceOutpostArn: '{{ response.items.sourceOutpostArn }}'
      sourceServerID: '{{ response.items.sourceServerID }}'
      tags: '{{ response.items.tags }}'
checks:
- rule_id: aws.drs.resource.drs_failover_execution_configured
  for_each: aws.drs.describe_recovery_instances
  conditions:
    var: item.recoveryInstanceProperties
    op: not_equals
    value: 'null'
