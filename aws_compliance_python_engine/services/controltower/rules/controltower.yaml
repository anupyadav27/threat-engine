version: '1.0'
provider: aws
service: controltower
discovery:
- discovery_id: aws.controltower.landingzones
  calls:
  - client: controltower
    action: list_baselines
    save_as: landingzone_list
    on_error: continue
    fields:
    - Controltowers
  emit:
    items_for: landingzone_list[]
    as: landingzone
    item:
      id: '{{ landingzone.Id }}'
      name: '{{ landingzone.Name }}'
- discovery_id: aws.controltower.enrollments
  for_each: aws.controltower.enrollment
  calls:
  - client: controltower
    action: list_enabled_controls
    save_as: enrollments
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
checks:
- title: 'CONTROLTOWER landingzone: Controltower Scps Enabled'
  severity: medium
  rule_id: aws.controltower.landingzone.controltower_scps_enabled
  for_each:
    discovery: aws.controltower.landingzones
    as: landingzone
    item: landingzone
  conditions:
    var: landingzone.compliant
    op: equals
    value: true
  remediation: "Configure controltower landingzone for compliance:\n\nRequirement: Controltower Scps Enabled\n\nDescription:\
    \ Verifies security configuration for AWS CONTROLTOWER landingzone to ensure alignment with AWS security best practices\
    \ and compliance requirements. Proper configuration reduces security risks, maintains defense in depth, and supports overall\
    \ security posture.\n\nSteps:\n1. Open CONTROLTOWER console\n2. Select the landingzone\n3. Review security configuration\n\
    4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\
    \u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\
    \u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: 'CONTROLTOWER enrollment: Block Leave Org By Policy Configured'
  severity: high
  rule_id: aws.controltower.enrollment.block_leave_org_by_policy_configured
  for_each:
    discovery: aws.controltower.enrollments
    as: enrollment
    item: enrollment
  conditions:
    var: enrollment.is_public
    op: equals
    value: false
  remediation: "Restrict public access for controltower enrollment:\n\n1. Open CONTROLTOWER console\n2. Select the enrollment\n\
    3. Go to Permissions/Access Control\n4. Review current permissions:\n   - Remove public access grants\n   - Remove wildcard\
    \ (*) principals\n   - Implement least privilege\n5. Update resource policy or IAM policies\n6. Enable resource-level\
    \ access control\n7. Save changes\n\nSecurity Recommendations:\n\u2022 Use IAM roles instead of access keys\n\u2022 Implement\
    \ condition keys for additional security\n\u2022 Enable MFA for sensitive operations\n\u2022 Regularly audit access permissions\n\
    \u2022 Use AWS Organizations SCPs for guardrails"
  references:
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: 'CONTROLTOWER landingzone: Block Leave Org By Policy Configured'
  severity: high
  rule_id: aws.controltower.landingzone.block_leave_org_by_policy_configured
  for_each:
    discovery: aws.controltower.landingzones
    as: landingzone
    item: landingzone
  conditions:
    var: landingzone.is_public
    op: equals
    value: false
  remediation: "Restrict public access for controltower landingzone:\n\n1. Open CONTROLTOWER console\n2. Select the landingzone\n\
    3. Go to Permissions/Access Control\n4. Review current permissions:\n   - Remove public access grants\n   - Remove wildcard\
    \ (*) principals\n   - Implement least privilege\n5. Update resource policy or IAM policies\n6. Enable resource-level\
    \ access control\n7. Save changes\n\nSecurity Recommendations:\n\u2022 Use IAM roles instead of access keys\n\u2022 Implement\
    \ condition keys for additional security\n\u2022 Enable MFA for sensitive operations\n\u2022 Regularly audit access permissions\n\
    \u2022 Use AWS Organizations SCPs for guardrails"
  references:
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: 'CONTROLTOWER enrollment: Controltower All Accounts Enrolled In Org Configured'
  severity: medium
  rule_id: aws.controltower.enrollment.controltower_all_accounts_enrolled_in_org_configured
  for_each:
    discovery: aws.controltower.enrollments
    as: enrollment
    item: enrollment
  conditions:
    var: enrollment.compliant
    op: equals
    value: true
  remediation: "Configure controltower enrollment for compliance:\n\nRequirement: Controltower All Accounts Enrolled In Org\
    \ Configuration\n\nDescription: Verifies security configuration for AWS CONTROLTOWER enrollment to ensure alignment with\
    \ AWS security best practices and compliance requirements. Proper configuration reduces security risks, maintains defense\
    \ in depth, and supports overall security posture.\n\nSteps:\n1. Open CONTROLTOWER console\n2. Select the enrollment\n\
    3. Review security configuration\n4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save\
    \ changes\n\nGeneral Security Recommendations:\n\u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense\
    \ in depth\n\u2022 Enable logging and monitoring\n\u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: 'CONTROLTOWER enrollment: Restrict Region Usage By Policy Where Required'
  severity: high
  rule_id: aws.controltower.enrollment.restrict_region_usage_by_policy_where_required
  for_each:
    discovery: aws.controltower.enrollments
    as: enrollment
    item: enrollment
  conditions:
    var: enrollment.is_public
    op: equals
    value: false
  remediation: "Restrict public access for controltower enrollment:\n\n1. Open CONTROLTOWER console\n2. Select the enrollment\n\
    3. Go to Permissions/Access Control\n4. Review current permissions:\n   - Remove public access grants\n   - Remove wildcard\
    \ (*) principals\n   - Implement least privilege\n5. Update resource policy or IAM policies\n6. Enable resource-level\
    \ access control\n7. Save changes\n\nSecurity Recommendations:\n\u2022 Use IAM roles instead of access keys\n\u2022 Implement\
    \ condition keys for additional security\n\u2022 Enable MFA for sensitive operations\n\u2022 Regularly audit access permissions\n\
    \u2022 Use AWS Organizations SCPs for guardrails"
  references:
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: 'CONTROLTOWER landingzone: Restrict Region Usage By Policy Where Required'
  severity: high
  rule_id: aws.controltower.landingzone.restrict_region_usage_by_policy_where_required
  for_each:
    discovery: aws.controltower.landingzones
    as: landingzone
    item: landingzone
  conditions:
    var: landingzone.is_public
    op: equals
    value: false
  remediation: "Restrict public access for controltower landingzone:\n\n1. Open CONTROLTOWER console\n2. Select the landingzone\n\
    3. Go to Permissions/Access Control\n4. Review current permissions:\n   - Remove public access grants\n   - Remove wildcard\
    \ (*) principals\n   - Implement least privilege\n5. Update resource policy or IAM policies\n6. Enable resource-level\
    \ access control\n7. Save changes\n\nSecurity Recommendations:\n\u2022 Use IAM roles instead of access keys\n\u2022 Implement\
    \ condition keys for additional security\n\u2022 Enable MFA for sensitive operations\n\u2022 Regularly audit access permissions\n\
    \u2022 Use AWS Organizations SCPs for guardrails"
  references:
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: 'CONTROLTOWER landingzone: Controltower All Accounts Enrolled In Org Configured'
  severity: medium
  rule_id: aws.controltower.landingzone.controltower_all_accounts_enrolled_in_org_configured
  for_each:
    discovery: aws.controltower.landingzones
    as: landingzone
    item: landingzone
  conditions:
    var: landingzone.compliant
    op: equals
    value: true
  remediation: "Configure controltower landingzone for compliance:\n\nRequirement: Controltower All Accounts Enrolled In Org\
    \ Configuration\n\nDescription: Verifies security configuration for AWS CONTROLTOWER landingzone to ensure alignment with\
    \ AWS security best practices and compliance requirements. Proper configuration reduces security risks, maintains defense\
    \ in depth, and supports overall security posture.\n\nSteps:\n1. Open CONTROLTOWER console\n2. Select the landingzone\n\
    3. Review security configuration\n4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save\
    \ changes\n\nGeneral Security Recommendations:\n\u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense\
    \ in depth\n\u2022 Enable logging and monitoring\n\u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
- title: 'CONTROLTOWER enrollment: Controltower Scps Enabled'
  severity: medium
  rule_id: aws.controltower.enrollment.controltower_scps_enabled
  for_each:
    discovery: aws.controltower.enrollments
    as: enrollment
    item: enrollment
  conditions:
    var: enrollment.compliant
    op: equals
    value: true
  remediation: "Configure controltower enrollment for compliance:\n\nRequirement: Controltower Scps Enabled\n\nDescription:\
    \ Verifies security configuration for AWS CONTROLTOWER enrollment to ensure alignment with AWS security best practices\
    \ and compliance requirements. Proper configuration reduces security risks, maintains defense in depth, and supports overall\
    \ security posture.\n\nSteps:\n1. Open CONTROLTOWER console\n2. Select the enrollment\n3. Review security configuration\n\
    4. Apply required settings per organizational policy\n5. Verify compliance\n6. Save changes\n\nGeneral Security Recommendations:\n\
    \u2022 Follow AWS Well-Architected Framework\n\u2022 Implement defense in depth\n\u2022 Enable logging and monitoring\n\
    \u2022 Use encryption where applicable\n\u2022 Regular security audits"
  references:
  - https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html
