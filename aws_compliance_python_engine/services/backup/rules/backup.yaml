version: 1.0
provider: aws
service: backup
discovery:
  discovery_id: aws.backup.resources
  calls:
    - client: backup
      action: describe_backups
      paginate: true
  fields:
    - name: id
      save_as: resource_id
  emit:
    items_for:
      as: resource
      item: resource_id
checks:
  - title: Backup Encryption Enabled
    severity: low
    rule_id: aws.backup.vault_policies.backup_encryption_enabled
    assertion_id: data_protection_storage.backup_recovery.backup_encryption_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement backup encryption enabled for backup"
    references:
      - "https://docs.aws.amazon.com/backup/"
  - title: Backup Retention Configured
    severity: low
    rule_id: aws.backup.vault_policies.backup_retention_configured
    assertion_id: data_protection_storage.backup_recovery.backup_retention_configured
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement backup retention configured for backup"
    references:
      - "https://docs.aws.amazon.com/backup/"
  - title: Automated Backups Enabled
    severity: low
    rule_id: aws.backup.backup_strategy.automated_backups_enabled
    assertion_id: resilience_recovery.backup_strategy.automated_backups_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement automated backups enabled for backup"
    references:
      - "https://docs.aws.amazon.com/backup/"
  - title: Automated Backups Enabled
    severity: low
    rule_id: aws.backup.backup_plans.automated_backups_enabled
    assertion_id: resilience_recovery.backup_strategy.automated_backups_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement automated backups enabled for backup"
    references:
      - "https://docs.aws.amazon.com/backup/"
  - title: Automated Backups Enabled
    severity: low
    rule_id: aws.backup.backup_selections.automated_backups_enabled
    assertion_id: resilience_recovery.backup_strategy.automated_backups_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement automated backups enabled for backup"
    references:
      - "https://docs.aws.amazon.com/backup/"
  - title: Backup Testing Conducted
    severity: low
    rule_id: aws.backup.backup_strategy.backup_testing_conducted
    assertion_id: resilience_recovery.backup_strategy.backup_testing_conducted
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement backup testing conducted for backup"
    references:
      - "https://docs.aws.amazon.com/backup/"
  - title: Backup Testing Conducted
    severity: low
    rule_id: aws.backup.backup_plans.backup_testing_conducted
    assertion_id: resilience_recovery.backup_strategy.backup_testing_conducted
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement backup testing conducted for backup"
    references:
      - "https://docs.aws.amazon.com/backup/"
  - title: Backup Testing Conducted
    severity: low
    rule_id: aws.backup.backup_selections.backup_testing_conducted
    assertion_id: resilience_recovery.backup_strategy.backup_testing_conducted
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement backup testing conducted for backup"
    references:
      - "https://docs.aws.amazon.com/backup/"
  - title: Geographic Redundancy Enabled
    severity: low
    rule_id: aws.backup.backup_strategy.geographic_redundancy_enabled
    assertion_id: resilience_recovery.backup_strategy.geographic_redundancy_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement geographic redundancy enabled for backup"
    references:
      - "https://docs.aws.amazon.com/backup/"
  - title: Geographic Redundancy Enabled
    severity: low
    rule_id: aws.backup.backup_plans.geographic_redundancy_enabled
    assertion_id: resilience_recovery.backup_strategy.geographic_redundancy_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement geographic redundancy enabled for backup"
    references:
      - "https://docs.aws.amazon.com/backup/"
  - title: Geographic Redundancy Enabled
    severity: low
    rule_id: aws.backup.backup_selections.geographic_redundancy_enabled
    assertion_id: resilience_recovery.backup_strategy.geographic_redundancy_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement geographic redundancy enabled for backup"
    references:
      - "https://docs.aws.amazon.com/backup/"
  - title: Dr Plan Documented
    severity: low
    rule_id: aws.backup.disaster_recovery.dr_plan_documented
    assertion_id: resilience_recovery.disaster_recovery.dr_plan_documented
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement dr plan documented for backup"
    references:
      - "https://docs.aws.amazon.com/backup/"
  - title: Rto Rpo Defined
    severity: low
    rule_id: aws.backup.disaster_recovery.rto_rpo_defined
    assertion_id: resilience_recovery.disaster_recovery.rto_rpo_defined
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement rto rpo defined for backup"
    references:
      - "https://docs.aws.amazon.com/backup/"
  - title: Cross Region Replication Enabled
    severity: low
    rule_id: aws.backup.disaster_recovery.cross_region_replication_enabled
    assertion_id: resilience_recovery.disaster_recovery.cross_region_replication_enabled
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement cross region replication enabled for backup"
    references:
      - "https://docs.aws.amazon.com/backup/"
  - title: Dr Drills Conducted
    severity: low
    rule_id: aws.backup.recovery_testing.dr_drills_conducted
    assertion_id: resilience_recovery.recovery_testing.dr_drills_conducted
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement dr drills conducted for backup"
    references:
      - "https://docs.aws.amazon.com/backup/"
  - title: Backup Restoration Tested
    severity: low
    rule_id: aws.backup.recovery_testing.backup_restoration_tested
    assertion_id: resilience_recovery.recovery_testing.backup_restoration_tested
    for_each:
      as: resource
      item: resource_id
    conditions:
      - field: resource.compliant
        operator: equals
        value: true
    remediation: "Implement backup restoration tested for backup"
    references:
      - "https://docs.aws.amazon.com/backup/"
