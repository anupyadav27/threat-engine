version: 1
provider: aws
service: directconnect
discovery:
- discovery_id: directconnect_resources
  calls:
  - client: directconnect
    action: describe_connections
    paginate: true
    params: {}
    fields:
    - Connections[]
    save_as: resources
  emit:
    items_for: '{{ resources }}'
    as: item
    item:
      resource_id: '{{ item.Id }}'
      resource_name: '{{ item.Name }}'
      resource_arn: '{{ item.Arn }}'
      region: '{{ item.Region }}'
      account: '{{ item.AccountId }}'
checks:
- title: Directconnect Connection Encryption.Vpc Isolation Enforced
  severity: low
  rule_id: aws.directconnect.connection_encryption.vpc_isolation_enforced
  assertion_id: network_perimeter.network_segmentation.vpc_isolation_enforced
  for_each: directconnect_resources
  conditions:
    all:
    - var: item.resource_id
      op: exists
- title: Directconnect Connection Encryption.Subnet Segmentation Configured
  severity: low
  rule_id: aws.directconnect.connection_encryption.subnet_segmentation_configured
  assertion_id: network_perimeter.network_segmentation.subnet_segmentation_configured
  for_each: directconnect_resources
  conditions:
    all:
    - var: item.resource_id
      op: exists
