version: '1.0'
provider: aws
service: eks
services:
  client: eks
  module: boto3.client
discovery:
- discovery_id: aws.eks.create_cluster
  calls:
  - action: create_cluster
    save_as: response
  emit:
    item:
      name: '{{ response.cluster.name }}'
      arn: '{{ response.cluster.arn }}'
      createdAt: '{{ response.cluster.createdAt }}'
      version: '{{ response.cluster.version }}'
      endpoint: '{{ response.cluster.endpoint }}'
      roleArn: '{{ response.cluster.roleArn }}'
      resourcesVpcConfig: '{{ response.cluster.resourcesVpcConfig }}'
      kubernetesNetworkConfig: '{{ response.cluster.kubernetesNetworkConfig }}'
      logging: '{{ response.cluster.logging }}'
      identity: '{{ response.cluster.identity }}'
      status: '{{ response.cluster.status }}'
      certificateAuthority: '{{ response.cluster.certificateAuthority }}'
      clientRequestToken: '{{ response.cluster.clientRequestToken }}'
      platformVersion: '{{ response.cluster.platformVersion }}'
      tags: '{{ response.cluster.tags }}'
      encryptionConfig: '{{ response.cluster.encryptionConfig }}'
      connectorConfig: '{{ response.cluster.connectorConfig }}'
      id: '{{ response.cluster.id }}'
      health: '{{ response.cluster.health }}'
      outpostConfig: '{{ response.cluster.outpostConfig }}'
      accessConfig: '{{ response.cluster.accessConfig }}'
      upgradePolicy: '{{ response.cluster.upgradePolicy }}'
      zonalShiftConfig: '{{ response.cluster.zonalShiftConfig }}'
      remoteNetworkConfig: '{{ response.cluster.remoteNetworkConfig }}'
      computeConfig: '{{ response.cluster.computeConfig }}'
      storageConfig: '{{ response.cluster.storageConfig }}'
      deletionProtection: '{{ response.cluster.deletionProtection }}'
      controlPlaneScalingConfig: '{{ response.cluster.controlPlaneScalingConfig }}'
      cluster: '{{ resource.cluster }}'
- discovery_id: aws.eks.describe_addon_configuration
  calls:
  - action: describe_addon_configuration
    save_as: response
  emit:
    item:
      serviceAccount: '{{ response.podIdentityConfiguration.serviceAccount }}'
      recommendedManagedPolicies: '{{ response.podIdentityConfiguration.recommendedManagedPolicies
        }}'
      podIdentityConfiguration: '{{ resource.podIdentityConfiguration }}'
- discovery_id: aws.eks.create_nodegroup
  calls:
  - action: create_nodegroup
    save_as: response
  emit:
    item:
      nodegroupName: '{{ response.nodegroup.nodegroupName }}'
      nodegroupArn: '{{ response.nodegroup.nodegroupArn }}'
      clusterName: '{{ response.nodegroup.clusterName }}'
      version: '{{ response.nodegroup.version }}'
      releaseVersion: '{{ response.nodegroup.releaseVersion }}'
      createdAt: '{{ response.nodegroup.createdAt }}'
      modifiedAt: '{{ response.nodegroup.modifiedAt }}'
      status: '{{ response.nodegroup.status }}'
      capacityType: '{{ response.nodegroup.capacityType }}'
      scalingConfig: '{{ response.nodegroup.scalingConfig }}'
      instanceTypes: '{{ response.nodegroup.instanceTypes }}'
      subnets: '{{ response.nodegroup.subnets }}'
      remoteAccess: '{{ response.nodegroup.remoteAccess }}'
      amiType: '{{ response.nodegroup.amiType }}'
      nodeRole: '{{ response.nodegroup.nodeRole }}'
      labels: '{{ response.nodegroup.labels }}'
      taints: '{{ response.nodegroup.taints }}'
      resources: '{{ response.nodegroup.resources }}'
      diskSize: '{{ response.nodegroup.diskSize }}'
      health: '{{ response.nodegroup.health }}'
      updateConfig: '{{ response.nodegroup.updateConfig }}'
      nodeRepairConfig: '{{ response.nodegroup.nodeRepairConfig }}'
      launchTemplate: '{{ response.nodegroup.launchTemplate }}'
      tags: '{{ response.nodegroup.tags }}'
      nodegroup: '{{ resource.nodegroup }}'
- discovery_id: aws.eks.describe_insight
  calls:
  - action: describe_insight
    save_as: response
  emit:
    item:
      id: '{{ response.insight.id }}'
      name: '{{ response.insight.name }}'
      category: '{{ response.insight.category }}'
      kubernetesVersion: '{{ response.insight.kubernetesVersion }}'
      lastRefreshTime: '{{ response.insight.lastRefreshTime }}'
      lastTransitionTime: '{{ response.insight.lastTransitionTime }}'
      description: '{{ response.insight.description }}'
      insightStatus: '{{ response.insight.insightStatus }}'
      recommendation: '{{ response.insight.recommendation }}'
      additionalInfo: '{{ response.insight.additionalInfo }}'
      resources: '{{ response.insight.resources }}'
      categorySpecificSummary: '{{ response.insight.categorySpecificSummary }}'
- discovery_id: aws.eks.describe_addon_versions
  calls:
  - action: describe_addon_versions
    save_as: response
  emit:
    item:
      addonName: '{{ response.addons.addonName }}'
      type: '{{ response.addons.type }}'
      addonVersions: '{{ response.addons.addonVersions }}'
      publisher: '{{ response.addons.publisher }}'
      owner: '{{ response.addons.owner }}'
      marketplaceInformation: '{{ response.addons.marketplaceInformation }}'
      defaultNamespace: '{{ response.addons.defaultNamespace }}'
      namespace: '{{ resource.namespace }}'
      version: '{{ resource.version }}'
- discovery_id: aws.eks.describe_cluster_versions
  calls:
  - action: describe_cluster_versions
    save_as: response
  emit:
    item:
      clusterVersion: '{{ response.clusterVersions.clusterVersion }}'
      clusterType: '{{ response.clusterVersions.clusterType }}'
      defaultPlatformVersion: '{{ response.clusterVersions.defaultPlatformVersion
        }}'
      defaultVersion: '{{ response.clusterVersions.defaultVersion }}'
      releaseDate: '{{ response.clusterVersions.releaseDate }}'
      endOfStandardSupportDate: '{{ response.clusterVersions.endOfStandardSupportDate
        }}'
      endOfExtendedSupportDate: '{{ response.clusterVersions.endOfExtendedSupportDate
        }}'
      status: '{{ response.clusterVersions.status }}'
      versionStatus: '{{ response.clusterVersions.versionStatus }}'
      kubernetesPatchVersion: '{{ response.clusterVersions.kubernetesPatchVersion
        }}'
- discovery_id: aws.eks.create_fargate_profile
  calls:
  - action: create_fargate_profile
    save_as: response
  emit:
    item:
      fargateProfileName: '{{ response.fargateProfile.fargateProfileName }}'
      fargateProfileArn: '{{ response.fargateProfile.fargateProfileArn }}'
      clusterName: '{{ response.fargateProfile.clusterName }}'
      createdAt: '{{ response.fargateProfile.createdAt }}'
      podExecutionRoleArn: '{{ response.fargateProfile.podExecutionRoleArn }}'
      subnets: '{{ response.fargateProfile.subnets }}'
      selectors: '{{ response.fargateProfile.selectors }}'
      status: '{{ response.fargateProfile.status }}'
      tags: '{{ response.fargateProfile.tags }}'
      health: '{{ response.fargateProfile.health }}'
      fargateProfile: '{{ resource.fargateProfile }}'
- discovery_id: aws.eks.create_addon
  calls:
  - action: create_addon
    save_as: response
  emit:
    item:
      addonName: '{{ response.addon.addonName }}'
      clusterName: '{{ response.addon.clusterName }}'
      status: '{{ response.addon.status }}'
      addonVersion: '{{ response.addon.addonVersion }}'
      health: '{{ response.addon.health }}'
      addonArn: '{{ response.addon.addonArn }}'
      createdAt: '{{ response.addon.createdAt }}'
      modifiedAt: '{{ response.addon.modifiedAt }}'
      serviceAccountRoleArn: '{{ response.addon.serviceAccountRoleArn }}'
      tags: '{{ response.addon.tags }}'
      publisher: '{{ response.addon.publisher }}'
      owner: '{{ response.addon.owner }}'
      marketplaceInformation: '{{ response.addon.marketplaceInformation }}'
      configurationValues: '{{ response.addon.configurationValues }}'
      podIdentityAssociations: '{{ response.addon.podIdentityAssociations }}'
      namespaceConfig: '{{ response.addon.namespaceConfig }}'
      addon: '{{ resource.addon }}'
- discovery_id: aws.eks.list_eks_anywhere_subscriptions
  calls:
  - action: list_eks_anywhere_subscriptions
    save_as: response
  emit:
    items_for: '{{ response.subscriptions }}'
    as: resource
    item:
      id: '{{ resource.id }}'
      arn: '{{ resource.arn }}'
      createdAt: '{{ resource.createdAt }}'
      effectiveDate: '{{ resource.effectiveDate }}'
      expirationDate: '{{ resource.expirationDate }}'
      licenseQuantity: '{{ resource.licenseQuantity }}'
      licenseType: '{{ resource.licenseType }}'
      term: '{{ resource.term }}'
      status: '{{ resource.status }}'
      autoRenew: '{{ resource.autoRenew }}'
      licenseArns: '{{ resource.licenseArns }}'
      licenses: '{{ resource.licenses }}'
      tags: '{{ resource.tags }}'
checks:
- rule_id: aws.eks.cluster.encryption_at_rest_enabled
  for_each: aws.eks.create_cluster
  conditions:
    var: item.encryptionConfig
    op: not_equals
    value: 'null'
- rule_id: aws.eks.cluster.anonymous_auth_disabled
  for_each: aws.eks.describe_addon_configuration
  conditions:
    var: item.podIdentityConfiguration
    op: not_equals
    value: 'null'
- rule_id: aws.eks.nodegroup.nodes_no_public_ip_configured
  for_each: aws.eks.create_nodegroup
  conditions:
    var: item.remoteAccess
    op: not_equals
    value: 'null'
- rule_id: aws.eks.api.image_signature_verification_enabled
  for_each: aws.eks.describe_insight
  conditions:
    var: item.insightStatus
    op: not_equals
    value: 'null'
- rule_id: aws.eks.resource.control_plane_logging_all_types_enabled
  for_each: aws.eks.create_cluster
  conditions:
    var: item.logging
    op: equals
    value: ALL
- rule_id: aws.eks.cluster.secrets_encryption_kms_cmk_configured
  for_each: aws.eks.create_cluster
  conditions:
    var: item.encryptionConfig
    op: not_equals
    value: 'null'
- rule_id: aws.eks.api.env_no_plaintext_secrets_configured
  for_each: aws.eks.describe_addon_configuration
  conditions:
    var: item.podIdentityConfiguration
    op: not_equals
    value: 'null'
- rule_id: aws.eks.api.cluster_required_allowlist_for_namespace_services
  for_each: aws.eks.describe_addon_versions
  conditions:
    var: item.namespace
    op: not_equals
    value: 'null'
- rule_id: aws.eks.api.read_only_root_filesystem_configured
  for_each: aws.eks.describe_addon_configuration
  conditions:
    var: item.podIdentityConfiguration
    op: not_equals
    value: 'null'
- rule_id: aws.eks.nodegroup.node_shielded_secure_boot_enabled
  for_each: aws.eks.create_nodegroup
  conditions:
    var: item.nodegroup
    op: not_equals
    value: 'null'
- rule_id: aws.eks.api.wildcard_verbs_disallowed_configured
  for_each: aws.eks.describe_addon_configuration
  conditions:
    var: item.podIdentityConfiguration
    op: not_equals
    value: 'null'
- rule_id: aws.eks.api.tls_min_version_1_2_configured
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.clusterVersion
    op: equals
    value: '1.21'
- rule_id: aws.eks.api.host_namespace_usage_denied_configured
  for_each: aws.eks.describe_addon_configuration
  conditions:
    var: item.podIdentityConfiguration
    op: not_equals
    value: 'null'
- rule_id: aws.eks.resource.kubelet_event_record_qps_configured
  for_each: aws.eks.describe_addon_configuration
  conditions:
    var: item.podIdentityConfiguration
    op: not_equals
    value: 'null'
- rule_id: aws.eks.api.no_cluster_admin_to_authenticated_configured
  for_each: aws.eks.create_cluster
  conditions:
    var: item.cluster
    op: not_equals
    value: 'null'
- rule_id: aws.eks.api.default_service_account_automount_disabled
  for_each: aws.eks.describe_addon_configuration
  conditions:
    var: item.serviceAccount
    op: not_equals
    value: 'null'
- rule_id: aws.eks.api.nodeport_usage_restricted
  for_each: aws.eks.describe_addon_configuration
  conditions:
    var: item.podIdentityConfiguration
    op: not_equals
    value: 'null'
- rule_id: aws.eks.cluster.private_control_plane_endpoint_enabled
  for_each: aws.eks.create_cluster
  conditions:
    var: item.resourcesVpcConfig
    op: not_equals
    value: 'null'
- rule_id: aws.eks.fargateprofile.execution_role_least_privilege
  for_each: aws.eks.create_fargate_profile
  conditions:
    var: item.podExecutionRoleArn
    op: not_equals
    value: 'null'
- rule_id: aws.eks.api.image_registry_allowlist_enforced
  for_each: aws.eks.describe_addon_configuration
  conditions:
    var: item.podIdentityConfiguration
    op: not_equals
    value: 'null'
- rule_id: aws.eks.api.drop_net_raw_and_reduce_caps_configured
  for_each: aws.eks.describe_addon_configuration
  conditions:
    var: item.podIdentityConfiguration
    op: not_equals
    value: 'null'
- rule_id: aws.eks.nodegroup.node_workload_identity_enabled
  for_each: aws.eks.describe_addon_configuration
  conditions:
    var: item.podIdentityConfiguration
    op: equals
    value: Enabled
- rule_id: aws.eks.cluster.audit_logging_enabled
  for_each: aws.eks.create_cluster
  conditions:
    var: item.logging
    op: equals
    value: 'true'
- rule_id: aws.eks.api.default_deny_egress_per_namespace_configured
  for_each: aws.eks.describe_addon_versions
  conditions:
    var: item.defaultNamespace
    op: not_equals
    value: 'null'
- rule_id: aws.eks.api.pod_security_level_restricted
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: equals
    value: unsupported
- rule_id: aws.eks.fargateprofile.client_cert_rotation_enabled
  for_each: aws.eks.create_fargate_profile
  conditions:
    var: item.fargateProfile
    op: not_equals
    value: 'null'
- rule_id: aws.eks.cluster.profiling_disabled
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: not_equals
    value: unsupported
- rule_id: aws.eks.cluster.service_account_token_signing_enabled
  for_each: aws.eks.describe_addon_configuration
  conditions:
    var: item.podIdentityConfiguration
    op: not_equals
    value: 'null'
- rule_id: aws.eks.certificate.monitored
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: not_equals
    value: unsupported
- rule_id: aws.eks.api.admission_psa_enforce_mode_configured
  for_each: aws.eks.describe_addon_configuration
  conditions:
    var: item.podIdentityConfiguration
    op: not_equals
    value: 'null'
- rule_id: aws.eks.fargateprofile.read_only_port_disabled
  for_each: aws.eks.create_fargate_profile
  conditions:
    var: item.fargateProfile
    op: not_equals
    value: 'null'
- rule_id: aws.eks.nodegroup.node_read_only_port_disabled
  for_each: aws.eks.create_nodegroup
  conditions:
    var: item.nodegroup
    op: not_equals
    value: 'null'
- rule_id: aws.eks.addon.no_privileged_permissions_configured
  for_each: aws.eks.create_nodegroup
  conditions:
    var: item.remoteAccess
    op: not_equals
    value: 'null'
- rule_id: aws.eks.fargateprofile.logging_enabled
  for_each: aws.eks.create_cluster
  conditions:
    var: item.logging
    op: equals
    value: 'true'
- rule_id: aws.eks.api.default_deny_ingress_per_namespace_configured
  for_each: aws.eks.describe_addon_versions
  conditions:
    var: item.defaultNamespace
    op: not_equals
    value: 'null'
- rule_id: aws.eks.api.external_ips_not_used_configured
  for_each: aws.eks.describe_addon_configuration
  conditions:
    var: item.podIdentityConfiguration
    op: not_equals
    value: 'null'
- rule_id: aws.eks.addon.version_pinned_and_supported_configured
  for_each: aws.eks.describe_addon_versions
  conditions:
    var: item.version
    op: not_equals
    value: 'null'
- rule_id: aws.eks.cluster.leader_election_enabled
  for_each: aws.eks.create_cluster
  conditions:
    var: item.cluster
    op: not_equals
    value: 'null'
- rule_id: aws.eks.nodegroup.anonymous_auth_disabled
  for_each: aws.eks.create_nodegroup
  conditions:
    var: item.nodegroup
    op: not_equals
    value: 'null'
- rule_id: aws.eks.cluster.client_cert_auth_enabled
  for_each: aws.eks.create_cluster
  conditions:
    var: item.cluster
    op: not_equals
    value: 'null'
- rule_id: aws.eks.api.no_hostpath_mounts_configured
  for_each: aws.eks.describe_addon_configuration
  conditions:
    var: item.podIdentityConfiguration
    op: not_equals
    value: 'null'
- rule_id: aws.eks.cluster.tls_min_version_1_2_configured
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.clusterVersion
    op: not_equals
    value: '1.0'
- rule_id: aws.eks.api.read_only_port_disabled
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: not_equals
    value: unsupported
- rule_id: aws.eks.api.client_cert_rotation_enabled
  for_each: aws.eks.describe_insight
  conditions:
    var: item.insightStatus
    op: not_equals
    value: 'null'
- rule_id: aws.eks.cluster.default_service_account_automount_disabled
  for_each: aws.eks.describe_addon_configuration
  conditions:
    var: item.serviceAccount
    op: not_equals
    value: 'null'
- rule_id: aws.eks.api.type_loadbalancer_internal_only_where_required
  for_each: aws.eks.describe_addon_versions
  conditions:
    var: item.type
    op: equals
    value: LoadBalancer
- rule_id: aws.eks.api.network_policies_present
  for_each: aws.eks.create_cluster
  conditions:
    var: item.kubernetesNetworkConfig
    op: not_equals
    value: 'null'
- rule_id: aws.eks.api.leader_election_enabled
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: equals
    value: standard-support
- rule_id: aws.eks.api.dns_and_metrics_from_approved_sources_configured
  for_each: aws.eks.describe_addon_configuration
  conditions:
    var: item.podIdentityConfiguration
    op: not_equals
    value: 'null'
- rule_id: aws.eks.api.privilege_escalation_denied_configured
  for_each: aws.eks.describe_addon_configuration
  conditions:
    var: item.podIdentityConfiguration
    op: not_equals
    value: 'null'
- rule_id: aws.eks.api.no_privileged_containers_configured
  for_each: aws.eks.describe_addon_configuration
  conditions:
    var: item.podIdentityConfiguration
    op: not_equals
    value: 'null'
- rule_id: aws.eks.nodegroup.node_protect_kernel_defaults_enabled
  for_each: aws.eks.create_nodegroup
  conditions:
    var: item.nodegroup
    op: not_equals
    value: 'null'
- rule_id: aws.eks.cluster.kms_cmk_encryption_in_secrets_enabled
  for_each: aws.eks.create_cluster
  conditions:
    var: item.encryptionConfig
    op: not_equals
    value: 'null'
- rule_id: aws.eks.api.run_as_non_root_configured
  for_each: aws.eks.describe_addon_configuration
  conditions:
    var: item.podIdentityConfiguration
    op: not_equals
    value: 'null'
- rule_id: aws.eks.cluster.endpoint_access_configured
  for_each: aws.eks.create_cluster
  conditions:
    var: item.endpoint
    op: not_equals
    value: 'null'
- rule_id: aws.eks.cluster.private_nodes_configuration_configured
  for_each: aws.eks.create_cluster
  conditions:
    var: item.resourcesVpcConfig
    op: not_equals
    value: 'null'
- rule_id: aws.eks.nodegroup.disk_encryption_enabled
  for_each: aws.eks.create_cluster
  conditions:
    var: item.encryptionConfig
    op: not_equals
    value: 'null'
- rule_id: aws.eks.api.host_network_pid_ipc_disabled
  for_each: aws.eks.create_cluster
  conditions:
    var: item.resourcesVpcConfig
    op: not_equals
    value: 'null'
- rule_id: aws.eks.api.service_account_token_signing_enabled
  for_each: aws.eks.describe_addon_configuration
  conditions:
    var: item.podIdentityConfiguration
    op: not_equals
    value: 'null'
- rule_id: aws.eks.fargateprofile.anonymous_auth_disabled
  for_each: aws.eks.describe_addon_configuration
  conditions:
    var: item.podIdentityConfiguration
    op: not_equals
    value: 'null'
- rule_id: aws.eks.cluster.admission_psa_enforce_mode_configured
  for_each: aws.eks.create_cluster
  conditions:
    var: item.cluster
    op: not_equals
    value: 'null'
- rule_id: aws.eks.api.seccomp_profile_runtime_default_configured
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: equals
    value: standard-support
- rule_id: aws.eks.api.default_sa_not_cluster_admin_configured
  for_each: aws.eks.create_cluster
  conditions:
    var: item.cluster
    op: not_equals
    value: 'null'
- rule_id: aws.eks.cluster.secure_port_enabled
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: not_equals
    value: unsupported
- rule_id: aws.eks.cluster.secrets_encryption_kms_enabled
  for_each: aws.eks.create_cluster
  conditions:
    var: item.encryptionConfig
    op: not_equals
    value: 'null'
- rule_id: aws.eks.resource.node_kubelet_read_only_port_configured
  for_each: aws.eks.describe_addon_configuration
  conditions:
    var: item.podIdentityConfiguration
    op: not_equals
    value: 'null'
- rule_id: aws.eks.api.kube_system_services_not_public_configured
  for_each: aws.eks.create_nodegroup
  conditions:
    var: item.remoteAccess
    op: not_equals
    value: 'null'
- rule_id: aws.eks.api.profiling_disabled
  for_each: aws.eks.describe_insight
  conditions:
    var: item.insightStatus
    op: not_equals
    value: 'null'
- rule_id: aws.eks.addon.from_trusted_channel_configured
  for_each: aws.eks.create_addon
  conditions:
    var: item.addon
    op: not_equals
    value: 'null'
- rule_id: aws.eks.api.secure_port_enabled
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: equals
    value: standard-support
- rule_id: aws.eks.fargateprofile.private_subnets_only_configured
  for_each: aws.eks.create_fargate_profile
  conditions:
    var: item.subnets
    op: not_equals
    value: 'null'
- rule_id: aws.eks.api.anonymous_auth_disabled
  for_each: aws.eks.describe_insight
  conditions:
    var: item.insightStatus
    op: not_equals
    value: 'null'
- rule_id: aws.eks.api.pod_security_admission_restricted_default_configured
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: equals
    value: unsupported
- rule_id: aws.eks.fargateprofile.protect_kernel_defaults_enabled
  for_each: aws.eks.create_fargate_profile
  conditions:
    var: item.fargateProfile
    op: not_equals
    value: 'null'
- rule_id: aws.eks.api.audit_logging_enabled
  for_each: aws.eks.create_cluster
  conditions:
    var: item.logging
    op: equals
    value: 'true'
- rule_id: aws.eks.api.image_tag_not_latest_configured
  for_each: aws.eks.list_eks_anywhere_subscriptions
  conditions:
    var: item.tags
    op: not_empty
- rule_id: aws.eks.api.protect_kernel_defaults_enabled
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: equals
    value: standard-support
- rule_id: aws.eks.nodegroup.client_cert_rotation_enabled
  for_each: aws.eks.create_nodegroup
  conditions:
    var: item.nodegroup
    op: not_equals
    value: 'null'
