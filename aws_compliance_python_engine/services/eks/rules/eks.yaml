version: '1.0'
provider: aws
service: eks
discovery:
- discovery_id: aws.eks.certificates
  calls:
  - client: eks
    action: list_clusters
    save_as: certificate_list
    on_error: continue
    fields:
    - clusters
  emit:
    items_for: certificate_list[]
    as: certificate
    item:
      id: '{{ certificate.name }}'
      name: '{{ certificate.name }}'
- discovery_id: aws.eks.certificate_encryption
  for_each: aws.eks.certificates
  calls:
  - client: eks
    action: list_clusters
    params:
      CertificateId: '{{ item.id }}'
    save_as: encryption
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      encryption_enabled: '{{ encryption.Encrypted if encryption.Encrypted is defined
        else false }}'
- discovery_id: aws.eks.certificate_logging
  for_each: aws.eks.certificates
  calls:
  - client: eks
    action: describe_access_entry
    params:
      CertificateId: '{{ item.id }}'
    save_as: logging
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      logging_enabled: '{{ logging.LoggingEnabled is defined if logging else false
        }}'
- discovery_id: aws.eks.apis
  for_each: aws.eks.api
  calls:
  - client: eks
    action: describe_access_entry
    save_as: apis
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.eks.resource_logging
  calls:
  - client: eks
    action: list_access_entries
    save_as: resource_logging
    on_error: continue
  emit:
    items_for: resource_logging[]
    as: resource_logging
    item:
      id: '{{ resource_logging.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.eks.nodegroup_encryption
  calls:
  - client: eks
    action: list_access_entries
    save_as: nodegroup_encryption
    on_error: continue
  emit:
    items_for: nodegroup_encryption[]
    as: nodegroup_encryption
    item:
      id: '{{ nodegroup_encryption.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.eks.cluster_logging
  calls:
  - client: eks
    action: list_access_entries
    save_as: cluster_logging
    on_error: continue
  emit:
    items_for: cluster_logging[]
    as: cluster_logging
    item:
      id: '{{ cluster_logging.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.eks.cluster_encryption
  calls:
  - client: eks
    action: list_access_entries
    save_as: cluster_encryption
    on_error: continue
  emit:
    items_for: cluster_encryption[]
    as: cluster_encryption
    item:
      id: '{{ cluster_encryption.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.eks.resources
  for_each: aws.eks.resource
  calls:
  - client: eks
    action: describe_access_entry
    save_as: resources
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.eks.fargateprofiles
  for_each: aws.eks.fargateprofile
  calls:
  - client: eks
    action: describe_access_entry
    save_as: fargateprofiles
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.eks.api_logging
  calls:
  - client: eks
    action: list_access_entries
    save_as: api_logging
    on_error: continue
  emit:
    items_for: api_logging[]
    as: api_logging
    item:
      id: '{{ api_logging.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.eks.clusters
  for_each: aws.eks.cluster
  calls:
  - client: eks
    action: describe_access_entry
    save_as: clusters
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.eks.addons
  for_each: aws.eks.addon
  calls:
  - client: eks
    action: describe_access_entry
    save_as: addons
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
- discovery_id: aws.eks.fargateprofile_logging
  calls:
  - client: eks
    action: list_access_entries
    save_as: fargateprofile_logging
    on_error: continue
  emit:
    items_for: fargateprofile_logging[]
    as: fargateprofile_logging
    item:
      id: '{{ fargateprofile_logging.Id }}'
      compliant: '{{ true }}'
- discovery_id: aws.eks.nodegroups
  for_each: aws.eks.nodegroup
  calls:
  - client: eks
    action: describe_access_entry
    save_as: nodegroups
    on_error: continue
  emit:
    item:
      resource_id: '{{ item.id }}'
      compliant: '{{ true }}'
checks:
- title: 'EKS cluster: Encryption At Rest Enabled'
  severity: high
  rule_id: aws.eks.cluster.encryption_at_rest_enabled
  for_each:
    discovery: aws.eks.cluster_encryption
    as: cluster
    item: cluster
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'EKS cluster: Anonymous Auth Disabled'
  severity: medium
  rule_id: aws.eks.cluster.anonymous_auth_disabled
  for_each:
    discovery: aws.eks.clusters
    as: cluster
    item: cluster
  conditions:
    var: cluster.compliant
    op: equals
    value: true
- title: 'EKS nodegroup: Nodes No Public Ip Configured'
  severity: high
  rule_id: aws.eks.nodegroup.nodes_no_public_ip_configured
  for_each:
    discovery: aws.eks.nodegroups
    as: nodegroup
    item: nodegroup
  conditions:
    var: nodegroup.is_public
    op: equals
    value: false
- title: 'EKS api: Image Signature Verification Enabled'
  severity: medium
  rule_id: aws.eks.api.image_signature_verification_enabled
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS resource: Control Plane Logging All Types Enabled'
  severity: medium
  rule_id: aws.eks.resource.control_plane_logging_all_types_enabled
  for_each:
    discovery: aws.eks.resource_logging
    as: resource
    item: resource
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'EKS cluster: Secrets Encryption Kms Cmk Configured'
  severity: high
  rule_id: aws.eks.cluster.secrets_encryption_kms_cmk_configured
  for_each:
    discovery: aws.eks.cluster_encryption
    as: cluster
    item: cluster
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'EKS api: Env No Plaintext Secrets Configured'
  severity: medium
  rule_id: aws.eks.api.env_no_plaintext_secrets_configured
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS api: Cluster Required Allowlist For Namespace Services'
  severity: medium
  rule_id: aws.eks.api.cluster_required_allowlist_for_namespace_services
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS api: Read Only Root Filesystem Configured'
  severity: medium
  rule_id: aws.eks.api.read_only_root_filesystem_configured
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS nodegroup: Node Shielded Secure Boot Enabled'
  severity: medium
  rule_id: aws.eks.nodegroup.node_shielded_secure_boot_enabled
  for_each:
    discovery: aws.eks.nodegroups
    as: nodegroup
    item: nodegroup
  conditions:
    var: nodegroup.compliant
    op: equals
    value: true
- title: 'EKS api: Wildcard Verbs Disallowed Configured'
  severity: medium
  rule_id: aws.eks.api.wildcard_verbs_disallowed_configured
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS api: Tls Min Version 1 2 Configured'
  severity: high
  rule_id: aws.eks.api.tls_min_version_1_2_configured
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.in_vpc
    op: equals
    value: true
- title: 'EKS api: Host Namespace Usage Denied Configured'
  severity: medium
  rule_id: aws.eks.api.host_namespace_usage_denied_configured
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS resource: Kubelet Event Record Qps Configured'
  severity: medium
  rule_id: aws.eks.resource.kubelet_event_record_qps_configured
  for_each:
    discovery: aws.eks.resources
    as: resource
    item: resource
  conditions:
    var: resource.compliant
    op: equals
    value: true
- title: 'EKS api: No Cluster Admin To Authenticated Configured'
  severity: medium
  rule_id: aws.eks.api.no_cluster_admin_to_authenticated_configured
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS api: Default Service Account Automount Disabled'
  severity: medium
  rule_id: aws.eks.api.default_service_account_automount_disabled
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS api: Nodeport Usage Restricted'
  severity: medium
  rule_id: aws.eks.api.nodeport_usage_restricted
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS cluster: Private Control Plane Endpoint Enabled'
  severity: high
  rule_id: aws.eks.cluster.private_control_plane_endpoint_enabled
  for_each:
    discovery: aws.eks.clusters
    as: cluster
    item: cluster
  conditions:
    var: cluster.in_vpc
    op: equals
    value: true
- title: 'EKS fargateprofile: Execution Role Least Privilege'
  severity: high
  rule_id: aws.eks.fargateprofile.execution_role_least_privilege
  for_each:
    discovery: aws.eks.fargateprofiles
    as: fargateprofile
    item: fargateprofile
  conditions:
    var: fargateprofile.is_public
    op: equals
    value: false
- title: 'EKS api: Image Registry Allowlist Enforced'
  severity: medium
  rule_id: aws.eks.api.image_registry_allowlist_enforced
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS api: Drop Net Raw And Reduce Caps Configured'
  severity: medium
  rule_id: aws.eks.api.drop_net_raw_and_reduce_caps_configured
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS nodegroup: Node Workload Identity Enabled'
  severity: medium
  rule_id: aws.eks.nodegroup.node_workload_identity_enabled
  for_each:
    discovery: aws.eks.nodegroups
    as: nodegroup
    item: nodegroup
  conditions:
    var: nodegroup.compliant
    op: equals
    value: true
- title: Cluster monitoring is enabled
  severity: medium
  rule_id: aws.eks.cluster.audit_logging_enabled
  for_each:
    discovery: aws.eks.cluster_logging
    as: cluster
    item: cluster
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'EKS api: Default Deny Egress Per Namespace Configured'
  severity: medium
  rule_id: aws.eks.api.default_deny_egress_per_namespace_configured
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS api: Pod Security Level Restricted'
  severity: medium
  rule_id: aws.eks.api.pod_security_level_restricted
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS fargateprofile: Client Cert Rotation Enabled'
  severity: medium
  rule_id: aws.eks.fargateprofile.client_cert_rotation_enabled
  for_each:
    discovery: aws.eks.fargateprofiles
    as: fargateprofile
    item: fargateprofile
  conditions:
    var: fargateprofile.compliant
    op: equals
    value: true
- title: 'EKS cluster: Profiling Disabled'
  severity: medium
  rule_id: aws.eks.cluster.profiling_disabled
  for_each:
    discovery: aws.eks.clusters
    as: cluster
    item: cluster
  conditions:
    var: cluster.compliant
    op: equals
    value: true
- title: 'EKS cluster: Service Account Token Signing Enabled'
  severity: medium
  rule_id: aws.eks.cluster.service_account_token_signing_enabled
  for_each:
    discovery: aws.eks.clusters
    as: cluster
    item: cluster
  conditions:
    var: cluster.compliant
    op: equals
    value: true
- title: 'EKS certificate: Monitored'
  severity: medium
  rule_id: aws.eks.certificate.monitored
  for_each:
    discovery: aws.eks.certificates
    as: certificate
    item: certificate
  conditions:
    var: certificate.monitoring_enabled
    op: equals
    value: true
- title: 'EKS api: Admission Psa Enforce Mode Configured'
  severity: medium
  rule_id: aws.eks.api.admission_psa_enforce_mode_configured
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS fargateprofile: Read Only Port Disabled'
  severity: medium
  rule_id: aws.eks.fargateprofile.read_only_port_disabled
  for_each:
    discovery: aws.eks.fargateprofiles
    as: fargateprofile
    item: fargateprofile
  conditions:
    var: fargateprofile.compliant
    op: equals
    value: true
- title: 'EKS nodegroup: Node Read Only Port Disabled'
  severity: medium
  rule_id: aws.eks.nodegroup.node_read_only_port_disabled
  for_each:
    discovery: aws.eks.nodegroups
    as: nodegroup
    item: nodegroup
  conditions:
    var: nodegroup.compliant
    op: equals
    value: true
- title: 'EKS addon: No Privileged Permissions Configured'
  severity: high
  rule_id: aws.eks.addon.no_privileged_permissions_configured
  for_each:
    discovery: aws.eks.addons
    as: addon
    item: addon
  conditions:
    var: addon.is_public
    op: equals
    value: false
- title: 'EKS fargateprofile: Logging Enabled'
  severity: medium
  rule_id: aws.eks.fargateprofile.logging_enabled
  for_each:
    discovery: aws.eks.fargateprofile_logging
    as: fargateprofile
    item: fargateprofile
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'EKS api: Default Deny Ingress Per Namespace Configured'
  severity: medium
  rule_id: aws.eks.api.default_deny_ingress_per_namespace_configured
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS api: External Ips Not Used Configured'
  severity: medium
  rule_id: aws.eks.api.external_ips_not_used_configured
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS addon: Version Pinned And Supported Configured'
  severity: low
  rule_id: aws.eks.addon.version_pinned_and_supported_configured
  for_each:
    discovery: aws.eks.addons
    as: addon
    item: addon
  conditions:
    var: addon.versioning_enabled
    op: equals
    value: true
- title: 'EKS cluster: Leader Election Enabled'
  severity: medium
  rule_id: aws.eks.cluster.leader_election_enabled
  for_each:
    discovery: aws.eks.clusters
    as: cluster
    item: cluster
  conditions:
    var: cluster.compliant
    op: equals
    value: true
- title: 'EKS nodegroup: Anonymous Auth Disabled'
  severity: medium
  rule_id: aws.eks.nodegroup.anonymous_auth_disabled
  for_each:
    discovery: aws.eks.nodegroups
    as: nodegroup
    item: nodegroup
  conditions:
    var: nodegroup.compliant
    op: equals
    value: true
- title: 'EKS cluster: Client Cert Auth Enabled'
  severity: medium
  rule_id: aws.eks.cluster.client_cert_auth_enabled
  for_each:
    discovery: aws.eks.clusters
    as: cluster
    item: cluster
  conditions:
    var: cluster.compliant
    op: equals
    value: true
- title: 'EKS api: No Hostpath Mounts Configured'
  severity: medium
  rule_id: aws.eks.api.no_hostpath_mounts_configured
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS cluster: Tls Min Version 1 2 Configured'
  severity: high
  rule_id: aws.eks.cluster.tls_min_version_1_2_configured
  for_each:
    discovery: aws.eks.clusters
    as: cluster
    item: cluster
  conditions:
    var: cluster.in_vpc
    op: equals
    value: true
- title: 'EKS api: Read Only Port Disabled'
  severity: medium
  rule_id: aws.eks.api.read_only_port_disabled
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS api: Client Cert Rotation Enabled'
  severity: medium
  rule_id: aws.eks.api.client_cert_rotation_enabled
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS cluster: Default Service Account Automount Disabled'
  severity: medium
  rule_id: aws.eks.cluster.default_service_account_automount_disabled
  for_each:
    discovery: aws.eks.clusters
    as: cluster
    item: cluster
  conditions:
    var: cluster.compliant
    op: equals
    value: true
- title: 'EKS api: Type Loadbalancer Internal Only Where Required'
  severity: medium
  rule_id: aws.eks.api.type_loadbalancer_internal_only_where_required
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS api: Network Policies Present'
  severity: high
  rule_id: aws.eks.api.network_policies_present
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.in_vpc
    op: equals
    value: true
- title: 'EKS api: Leader Election Enabled'
  severity: medium
  rule_id: aws.eks.api.leader_election_enabled
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS api: Dns And Metrics From Approved Sources Configured'
  severity: medium
  rule_id: aws.eks.api.dns_and_metrics_from_approved_sources_configured
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.monitoring_enabled
    op: equals
    value: true
- title: 'EKS api: Privilege Escalation Denied Configured'
  severity: high
  rule_id: aws.eks.api.privilege_escalation_denied_configured
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS api: No Privileged Containers Configured'
  severity: high
  rule_id: aws.eks.api.no_privileged_containers_configured
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS nodegroup: Node Protect Kernel Defaults Enabled'
  severity: medium
  rule_id: aws.eks.nodegroup.node_protect_kernel_defaults_enabled
  for_each:
    discovery: aws.eks.nodegroups
    as: nodegroup
    item: nodegroup
  conditions:
    var: nodegroup.compliant
    op: equals
    value: true
- title: 'EKS cluster: Kms Cmk Encryption In Secrets Enabled'
  severity: high
  rule_id: aws.eks.cluster.kms_cmk_encryption_in_secrets_enabled
  for_each:
    discovery: aws.eks.cluster_encryption
    as: cluster
    item: cluster
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'EKS api: Run As Non Root Configured'
  severity: medium
  rule_id: aws.eks.api.run_as_non_root_configured
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS cluster: Endpoint Access Configured'
  severity: medium
  rule_id: aws.eks.cluster.endpoint_access_configured
  for_each:
    discovery: aws.eks.clusters
    as: cluster
    item: cluster
  conditions:
    var: cluster.is_public
    op: equals
    value: false
- title: 'EKS cluster: Private Nodes Configuration Configured'
  severity: high
  rule_id: aws.eks.cluster.private_nodes_configuration_configured
  for_each:
    discovery: aws.eks.clusters
    as: cluster
    item: cluster
  conditions:
    var: cluster.in_vpc
    op: equals
    value: true
- title: 'EKS nodegroup: Disk Encryption Enabled'
  severity: high
  rule_id: aws.eks.nodegroup.disk_encryption_enabled
  for_each:
    discovery: aws.eks.nodegroup_encryption
    as: nodegroup
    item: nodegroup
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'EKS api: Host Network Pid Ipc Disabled'
  severity: high
  rule_id: aws.eks.api.host_network_pid_ipc_disabled
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.in_vpc
    op: equals
    value: true
- title: 'EKS api: Service Account Token Signing Enabled'
  severity: medium
  rule_id: aws.eks.api.service_account_token_signing_enabled
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS fargateprofile: Anonymous Auth Disabled'
  severity: medium
  rule_id: aws.eks.fargateprofile.anonymous_auth_disabled
  for_each:
    discovery: aws.eks.fargateprofiles
    as: fargateprofile
    item: fargateprofile
  conditions:
    var: fargateprofile.compliant
    op: equals
    value: true
- title: 'EKS cluster: Admission Psa Enforce Mode Configured'
  severity: medium
  rule_id: aws.eks.cluster.admission_psa_enforce_mode_configured
  for_each:
    discovery: aws.eks.clusters
    as: cluster
    item: cluster
  conditions:
    var: cluster.compliant
    op: equals
    value: true
- title: 'EKS api: Seccomp Profile Runtime Default Configured'
  severity: medium
  rule_id: aws.eks.api.seccomp_profile_runtime_default_configured
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS api: Default Sa Not Cluster Admin Configured'
  severity: medium
  rule_id: aws.eks.api.default_sa_not_cluster_admin_configured
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS cluster: Secure Port Enabled'
  severity: medium
  rule_id: aws.eks.cluster.secure_port_enabled
  for_each:
    discovery: aws.eks.clusters
    as: cluster
    item: cluster
  conditions:
    var: cluster.compliant
    op: equals
    value: true
- title: 'EKS cluster: Secrets Encryption Kms Enabled'
  severity: high
  rule_id: aws.eks.cluster.secrets_encryption_kms_enabled
  for_each:
    discovery: aws.eks.cluster_encryption
    as: cluster
    item: cluster
  conditions:
    var: encryption.encryption_enabled
    op: equals
    value: true
- title: 'EKS resource: Node Kubelet Read Only Port Configured'
  severity: medium
  rule_id: aws.eks.resource.node_kubelet_read_only_port_configured
  for_each:
    discovery: aws.eks.resources
    as: resource
    item: resource
  conditions:
    var: resource.compliant
    op: equals
    value: true
- title: 'EKS api: Kube System Services Not Public Configured'
  severity: high
  rule_id: aws.eks.api.kube_system_services_not_public_configured
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.is_public
    op: equals
    value: false
- title: 'EKS api: Profiling Disabled'
  severity: medium
  rule_id: aws.eks.api.profiling_disabled
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS addon: From Trusted Channel Configured'
  severity: medium
  rule_id: aws.eks.addon.from_trusted_channel_configured
  for_each:
    discovery: aws.eks.addons
    as: addon
    item: addon
  conditions:
    var: addon.compliant
    op: equals
    value: true
- title: 'EKS api: Secure Port Enabled'
  severity: medium
  rule_id: aws.eks.api.secure_port_enabled
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS fargateprofile: Private Subnets Only Configured'
  severity: high
  rule_id: aws.eks.fargateprofile.private_subnets_only_configured
  for_each:
    discovery: aws.eks.fargateprofiles
    as: fargateprofile
    item: fargateprofile
  conditions:
    var: fargateprofile.in_vpc
    op: equals
    value: true
- title: 'EKS api: Anonymous Auth Disabled'
  severity: medium
  rule_id: aws.eks.api.anonymous_auth_disabled
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS api: Pod Security Admission Restricted Default Configured'
  severity: medium
  rule_id: aws.eks.api.pod_security_admission_restricted_default_configured
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS fargateprofile: Protect Kernel Defaults Enabled'
  severity: medium
  rule_id: aws.eks.fargateprofile.protect_kernel_defaults_enabled
  for_each:
    discovery: aws.eks.fargateprofiles
    as: fargateprofile
    item: fargateprofile
  conditions:
    var: fargateprofile.compliant
    op: equals
    value: true
- title: 'EKS api: Audit Logging Enabled'
  severity: medium
  rule_id: aws.eks.api.audit_logging_enabled
  for_each:
    discovery: aws.eks.api_logging
    as: api
    item: api
  conditions:
    var: logging.logging_enabled
    op: equals
    value: true
- title: 'EKS api: Image Tag Not Latest Configured'
  severity: medium
  rule_id: aws.eks.api.image_tag_not_latest_configured
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS api: Protect Kernel Defaults Enabled'
  severity: medium
  rule_id: aws.eks.api.protect_kernel_defaults_enabled
  for_each:
    discovery: aws.eks.apis
    as: api
    item: api
  conditions:
    var: api.compliant
    op: equals
    value: true
- title: 'EKS nodegroup: Client Cert Rotation Enabled'
  severity: medium
  rule_id: aws.eks.nodegroup.client_cert_rotation_enabled
  for_each:
    discovery: aws.eks.nodegroups
    as: nodegroup
    item: nodegroup
  conditions:
    var: nodegroup.compliant
    op: equals
    value: true
