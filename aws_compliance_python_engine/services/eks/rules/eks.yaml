version: '1.0'
provider: aws
service: eks
services:
  client: eks
  module: boto3.client
discovery:
- discovery_id: aws.eks.describe_addon_versions
  calls:
  - action: describe_addon_versions
    save_as: response
  emit:
    item:
      addonName: '{{ response.addons.addonName }}'
      type: '{{ response.addons.type }}'
      addonVersions: '{{ response.addons.addonVersions }}'
      publisher: '{{ response.addons.publisher }}'
      owner: '{{ response.addons.owner }}'
      marketplaceInformation: '{{ response.addons.marketplaceInformation }}'
      defaultNamespace: '{{ response.addons.defaultNamespace }}'
- discovery_id: aws.eks.describe_cluster_versions
  calls:
  - action: describe_cluster_versions
    save_as: response
  emit:
    item:
      clusterVersion: '{{ response.clusterVersions.clusterVersion }}'
      clusterType: '{{ response.clusterVersions.clusterType }}'
      defaultPlatformVersion: '{{ response.clusterVersions.defaultPlatformVersion
        }}'
      defaultVersion: '{{ response.clusterVersions.defaultVersion }}'
      releaseDate: '{{ response.clusterVersions.releaseDate }}'
      endOfStandardSupportDate: '{{ response.clusterVersions.endOfStandardSupportDate
        }}'
      endOfExtendedSupportDate: '{{ response.clusterVersions.endOfExtendedSupportDate
        }}'
      status: '{{ response.clusterVersions.status }}'
      versionStatus: '{{ response.clusterVersions.versionStatus }}'
      kubernetesPatchVersion: '{{ response.clusterVersions.kubernetesPatchVersion
        }}'
- discovery_id: aws.eks.list_access_policies
  calls:
  - action: list_access_policies
    save_as: response
  emit:
    items_for: '{{ response.accessPolicies }}'
    as: resource
    item:
      name: '{{ resource.name }}'
      arn: '{{ resource.arn }}'
- discovery_id: aws.eks.list_eks_anywhere_subscriptions
  calls:
  - action: list_eks_anywhere_subscriptions
    save_as: response
  emit:
    items_for: '{{ response.subscriptions }}'
    as: resource
    item:
      id: '{{ resource.id }}'
      arn: '{{ resource.arn }}'
      createdAt: '{{ resource.createdAt }}'
      effectiveDate: '{{ resource.effectiveDate }}'
      expirationDate: '{{ resource.expirationDate }}'
      licenseQuantity: '{{ resource.licenseQuantity }}'
      licenseType: '{{ resource.licenseType }}'
      term: '{{ resource.term }}'
      status: '{{ resource.status }}'
      autoRenew: '{{ resource.autoRenew }}'
      licenseArns: '{{ resource.licenseArns }}'
      licenses: '{{ resource.licenses }}'
      tags: '{{ resource.tags }}'
- discovery_id: aws.eks.create_access_entry
  calls:
  - action: create_access_entry
    save_as: response
    params:
      clusterName: '{{ item.clusterName }}'
      principalArn: '{{ item.principalArn }}'
  on_error: continue
  for_each: aws.eks.list_associated_access_policies
  emit:
    item:
      clusterName: '{{ response.accessEntry.clusterName }}'
      principalArn: '{{ response.accessEntry.principalArn }}'
      kubernetesGroups: '{{ response.accessEntry.kubernetesGroups }}'
      accessEntryArn: '{{ response.accessEntry.accessEntryArn }}'
      createdAt: '{{ response.accessEntry.createdAt }}'
      modifiedAt: '{{ response.accessEntry.modifiedAt }}'
      tags: '{{ response.accessEntry.tags }}'
      username: '{{ response.accessEntry.username }}'
      type: '{{ response.accessEntry.type }}'
- discovery_id: aws.eks.create_addon
  calls:
  - action: create_addon
    save_as: response
    params:
      clusterName: '{{ item.clusterName }}'
      addonName: '{{ item.addonName }}'
  on_error: continue
  for_each: aws.eks.list_associated_access_policies
  emit:
    item:
      addonName: '{{ response.addon.addonName }}'
      clusterName: '{{ response.addon.clusterName }}'
      status: '{{ response.addon.status }}'
      addonVersion: '{{ response.addon.addonVersion }}'
      health: '{{ response.addon.health }}'
      addonArn: '{{ response.addon.addonArn }}'
      createdAt: '{{ response.addon.createdAt }}'
      modifiedAt: '{{ response.addon.modifiedAt }}'
      serviceAccountRoleArn: '{{ response.addon.serviceAccountRoleArn }}'
      tags: '{{ response.addon.tags }}'
      publisher: '{{ response.addon.publisher }}'
      owner: '{{ response.addon.owner }}'
      marketplaceInformation: '{{ response.addon.marketplaceInformation }}'
      configurationValues: '{{ response.addon.configurationValues }}'
      podIdentityAssociations: '{{ response.addon.podIdentityAssociations }}'
      namespaceConfig: '{{ response.addon.namespaceConfig }}'
- discovery_id: aws.eks.create_cluster
  calls:
  - action: create_cluster
    save_as: response
    params:
      name: '{{ item.name }}'
      roleArn: '{{ item.roleArn }}'
      resourcesVpcConfig: '{{ item.resourcesVpcConfig }}'
  on_error: continue
  for_each: aws.eks.list_access_policies
  emit:
    item:
      name: '{{ response.cluster.name }}'
      arn: '{{ response.cluster.arn }}'
      createdAt: '{{ response.cluster.createdAt }}'
      version: '{{ response.cluster.version }}'
      endpoint: '{{ response.cluster.endpoint }}'
      roleArn: '{{ response.cluster.roleArn }}'
      resourcesVpcConfig: '{{ response.cluster.resourcesVpcConfig }}'
      kubernetesNetworkConfig: '{{ response.cluster.kubernetesNetworkConfig }}'
      logging: '{{ response.cluster.logging }}'
      identity: '{{ response.cluster.identity }}'
      status: '{{ response.cluster.status }}'
      certificateAuthority: '{{ response.cluster.certificateAuthority }}'
      clientRequestToken: '{{ response.cluster.clientRequestToken }}'
      platformVersion: '{{ response.cluster.platformVersion }}'
      tags: '{{ response.cluster.tags }}'
      encryptionConfig: '{{ response.cluster.encryptionConfig }}'
      connectorConfig: '{{ response.cluster.connectorConfig }}'
      id: '{{ response.cluster.id }}'
      health: '{{ response.cluster.health }}'
      outpostConfig: '{{ response.cluster.outpostConfig }}'
      accessConfig: '{{ response.cluster.accessConfig }}'
      upgradePolicy: '{{ response.cluster.upgradePolicy }}'
      zonalShiftConfig: '{{ response.cluster.zonalShiftConfig }}'
      remoteNetworkConfig: '{{ response.cluster.remoteNetworkConfig }}'
      computeConfig: '{{ response.cluster.computeConfig }}'
      storageConfig: '{{ response.cluster.storageConfig }}'
      deletionProtection: '{{ response.cluster.deletionProtection }}'
      controlPlaneScalingConfig: '{{ response.cluster.controlPlaneScalingConfig }}'
- discovery_id: aws.eks.create_fargate_profile
  calls:
  - action: create_fargate_profile
    save_as: response
    params:
      fargateProfileName: '{{ item.fargateProfileName }}'
      clusterName: '{{ item.clusterName }}'
      podExecutionRoleArn: '{{ item.podExecutionRoleArn }}'
  on_error: continue
  for_each: aws.eks.describe_fargate_profile
  emit:
    item:
      fargateProfileName: '{{ response.fargateProfile.fargateProfileName }}'
      fargateProfileArn: '{{ response.fargateProfile.fargateProfileArn }}'
      clusterName: '{{ response.fargateProfile.clusterName }}'
      createdAt: '{{ response.fargateProfile.createdAt }}'
      podExecutionRoleArn: '{{ response.fargateProfile.podExecutionRoleArn }}'
      subnets: '{{ response.fargateProfile.subnets }}'
      selectors: '{{ response.fargateProfile.selectors }}'
      status: '{{ response.fargateProfile.status }}'
      tags: '{{ response.fargateProfile.tags }}'
      health: '{{ response.fargateProfile.health }}'
- discovery_id: aws.eks.create_nodegroup
  calls:
  - action: create_nodegroup
    save_as: response
    params:
      clusterName: '{{ item.clusterName }}'
      nodegroupName: '{{ item.nodegroupName }}'
      subnets: '{{ item.subnets }}'
      nodeRole: '{{ item.nodeRole }}'
  on_error: continue
  for_each: aws.eks.list_associated_access_policies
  emit:
    item:
      nodegroupName: '{{ response.nodegroup.nodegroupName }}'
      nodegroupArn: '{{ response.nodegroup.nodegroupArn }}'
      clusterName: '{{ response.nodegroup.clusterName }}'
      version: '{{ response.nodegroup.version }}'
      releaseVersion: '{{ response.nodegroup.releaseVersion }}'
      createdAt: '{{ response.nodegroup.createdAt }}'
      modifiedAt: '{{ response.nodegroup.modifiedAt }}'
      status: '{{ response.nodegroup.status }}'
      capacityType: '{{ response.nodegroup.capacityType }}'
      scalingConfig: '{{ response.nodegroup.scalingConfig }}'
      instanceTypes: '{{ response.nodegroup.instanceTypes }}'
      subnets: '{{ response.nodegroup.subnets }}'
      remoteAccess: '{{ response.nodegroup.remoteAccess }}'
      amiType: '{{ response.nodegroup.amiType }}'
      nodeRole: '{{ response.nodegroup.nodeRole }}'
      labels: '{{ response.nodegroup.labels }}'
      taints: '{{ response.nodegroup.taints }}'
      resources: '{{ response.nodegroup.resources }}'
      diskSize: '{{ response.nodegroup.diskSize }}'
      health: '{{ response.nodegroup.health }}'
      updateConfig: '{{ response.nodegroup.updateConfig }}'
      nodeRepairConfig: '{{ response.nodegroup.nodeRepairConfig }}'
      launchTemplate: '{{ response.nodegroup.launchTemplate }}'
      tags: '{{ response.nodegroup.tags }}'
- discovery_id: aws.eks.create_pod_identity_association
  calls:
  - action: create_pod_identity_association
    save_as: response
    params:
      clusterName: '{{ item.clusterName }}'
      namespace: '{{ item.namespace }}'
      serviceAccount: '{{ item.serviceAccount }}'
      roleArn: '{{ item.roleArn }}'
  on_error: continue
  for_each: aws.eks.list_associated_access_policies
  emit:
    item:
      clusterName: '{{ response.association.clusterName }}'
      namespace: '{{ response.association.namespace }}'
      serviceAccount: '{{ response.association.serviceAccount }}'
      roleArn: '{{ response.association.roleArn }}'
      associationArn: '{{ response.association.associationArn }}'
      associationId: '{{ response.association.associationId }}'
      tags: '{{ response.association.tags }}'
      createdAt: '{{ response.association.createdAt }}'
      modifiedAt: '{{ response.association.modifiedAt }}'
      ownerArn: '{{ response.association.ownerArn }}'
      disableSessionTags: '{{ response.association.disableSessionTags }}'
      targetRoleArn: '{{ response.association.targetRoleArn }}'
      externalId: '{{ response.association.externalId }}'
- discovery_id: aws.eks.describe_addon
  calls:
  - action: describe_addon
    save_as: response
    params:
      clusterName: '{{ item.clusterName }}'
      addonName: '{{ item.addonName }}'
  on_error: continue
  for_each: aws.eks.list_associated_access_policies
  emit:
    item:
      addonName: '{{ response.addon.addonName }}'
      clusterName: '{{ response.addon.clusterName }}'
      status: '{{ response.addon.status }}'
      addonVersion: '{{ response.addon.addonVersion }}'
      health: '{{ response.addon.health }}'
      addonArn: '{{ response.addon.addonArn }}'
      createdAt: '{{ response.addon.createdAt }}'
      modifiedAt: '{{ response.addon.modifiedAt }}'
      serviceAccountRoleArn: '{{ response.addon.serviceAccountRoleArn }}'
      tags: '{{ response.addon.tags }}'
      publisher: '{{ response.addon.publisher }}'
      owner: '{{ response.addon.owner }}'
      marketplaceInformation: '{{ response.addon.marketplaceInformation }}'
      configurationValues: '{{ response.addon.configurationValues }}'
      podIdentityAssociations: '{{ response.addon.podIdentityAssociations }}'
      namespaceConfig: '{{ response.addon.namespaceConfig }}'
- discovery_id: aws.eks.describe_cluster
  calls:
  - action: describe_cluster
    save_as: response
    params:
      name: '{{ item.name }}'
  on_error: continue
  for_each: aws.eks.list_access_policies
  emit:
    item:
      name: '{{ response.cluster.name }}'
      arn: '{{ response.cluster.arn }}'
      createdAt: '{{ response.cluster.createdAt }}'
      version: '{{ response.cluster.version }}'
      endpoint: '{{ response.cluster.endpoint }}'
      roleArn: '{{ response.cluster.roleArn }}'
      resourcesVpcConfig: '{{ response.cluster.resourcesVpcConfig }}'
      kubernetesNetworkConfig: '{{ response.cluster.kubernetesNetworkConfig }}'
      logging: '{{ response.cluster.logging }}'
      identity: '{{ response.cluster.identity }}'
      status: '{{ response.cluster.status }}'
      certificateAuthority: '{{ response.cluster.certificateAuthority }}'
      clientRequestToken: '{{ response.cluster.clientRequestToken }}'
      platformVersion: '{{ response.cluster.platformVersion }}'
      tags: '{{ response.cluster.tags }}'
      encryptionConfig: '{{ response.cluster.encryptionConfig }}'
      connectorConfig: '{{ response.cluster.connectorConfig }}'
      id: '{{ response.cluster.id }}'
      health: '{{ response.cluster.health }}'
      outpostConfig: '{{ response.cluster.outpostConfig }}'
      accessConfig: '{{ response.cluster.accessConfig }}'
      upgradePolicy: '{{ response.cluster.upgradePolicy }}'
      zonalShiftConfig: '{{ response.cluster.zonalShiftConfig }}'
      remoteNetworkConfig: '{{ response.cluster.remoteNetworkConfig }}'
      computeConfig: '{{ response.cluster.computeConfig }}'
      storageConfig: '{{ response.cluster.storageConfig }}'
      deletionProtection: '{{ response.cluster.deletionProtection }}'
      controlPlaneScalingConfig: '{{ response.cluster.controlPlaneScalingConfig }}'
- discovery_id: aws.eks.describe_fargate_profile
  calls:
  - action: describe_fargate_profile
    save_as: response
    params:
      clusterName: '{{ item.clusterName }}'
  on_error: continue
  for_each: aws.eks.list_associated_access_policies
  emit:
    item:
      fargateProfileName: '{{ response.fargateProfile.fargateProfileName }}'
      fargateProfileArn: '{{ response.fargateProfile.fargateProfileArn }}'
      clusterName: '{{ response.fargateProfile.clusterName }}'
      createdAt: '{{ response.fargateProfile.createdAt }}'
      podExecutionRoleArn: '{{ response.fargateProfile.podExecutionRoleArn }}'
      subnets: '{{ response.fargateProfile.subnets }}'
      selectors: '{{ response.fargateProfile.selectors }}'
      status: '{{ response.fargateProfile.status }}'
      tags: '{{ response.fargateProfile.tags }}'
      health: '{{ response.fargateProfile.health }}'
- discovery_id: aws.eks.describe_identity_provider_config
  calls:
  - action: describe_identity_provider_config
    save_as: response
    params:
      clusterName: '{{ item.clusterName }}'
  on_error: continue
  for_each: aws.eks.list_associated_access_policies
  emit:
    item:
      oidc: '{{ response.identityProviderConfig.oidc }}'
- discovery_id: aws.eks.describe_nodegroup
  calls:
  - action: describe_nodegroup
    save_as: response
    params:
      clusterName: '{{ item.clusterName }}'
  on_error: continue
  for_each: aws.eks.list_associated_access_policies
  emit:
    item:
      nodegroupName: '{{ response.nodegroup.nodegroupName }}'
      nodegroupArn: '{{ response.nodegroup.nodegroupArn }}'
      clusterName: '{{ response.nodegroup.clusterName }}'
      version: '{{ response.nodegroup.version }}'
      releaseVersion: '{{ response.nodegroup.releaseVersion }}'
      createdAt: '{{ response.nodegroup.createdAt }}'
      modifiedAt: '{{ response.nodegroup.modifiedAt }}'
      status: '{{ response.nodegroup.status }}'
      capacityType: '{{ response.nodegroup.capacityType }}'
      scalingConfig: '{{ response.nodegroup.scalingConfig }}'
      instanceTypes: '{{ response.nodegroup.instanceTypes }}'
      subnets: '{{ response.nodegroup.subnets }}'
      remoteAccess: '{{ response.nodegroup.remoteAccess }}'
      amiType: '{{ response.nodegroup.amiType }}'
      nodeRole: '{{ response.nodegroup.nodeRole }}'
      labels: '{{ response.nodegroup.labels }}'
      taints: '{{ response.nodegroup.taints }}'
      resources: '{{ response.nodegroup.resources }}'
      diskSize: '{{ response.nodegroup.diskSize }}'
      health: '{{ response.nodegroup.health }}'
      updateConfig: '{{ response.nodegroup.updateConfig }}'
      nodeRepairConfig: '{{ response.nodegroup.nodeRepairConfig }}'
      launchTemplate: '{{ response.nodegroup.launchTemplate }}'
      tags: '{{ response.nodegroup.tags }}'
- discovery_id: aws.eks.list_associated_access_policies
  calls:
  - action: list_associated_access_policies
    save_as: response
  emit:
    items_for: '{{ response.associatedAccessPolicies }}'
    as: resource
    item:
      policyArn: '{{ resource.policyArn }}'
      accessScope: '{{ resource.accessScope }}'
      associatedAt: '{{ resource.associatedAt }}'
      modifiedAt: '{{ resource.modifiedAt }}'
- discovery_id: aws.eks.list_identity_provider_configs
  calls:
  - action: list_identity_provider_configs
    save_as: response
    params:
      clusterName: '{{ item.clusterName }}'
  on_error: continue
  for_each: aws.eks.list_associated_access_policies
  emit:
    items_for: '{{ response.identityProviderConfigs }}'
    as: resource
    item:
      type: '{{ resource.type }}'
      name: '{{ resource.name }}'
- discovery_id: aws.eks.list_pod_identity_associations
  calls:
  - action: list_pod_identity_associations
    save_as: response
    params:
      clusterName: '{{ item.clusterName }}'
  on_error: continue
  for_each: aws.eks.list_associated_access_policies
  emit:
    items_for: '{{ response.associations }}'
    as: resource
    item:
      clusterName: '{{ resource.clusterName }}'
      namespace: '{{ resource.namespace }}'
      serviceAccount: '{{ resource.serviceAccount }}'
      associationArn: '{{ resource.associationArn }}'
      associationId: '{{ resource.associationId }}'
      ownerArn: '{{ resource.ownerArn }}'
- discovery_id: aws.eks.update_pod_identity_association
  calls:
  - action: update_pod_identity_association
    save_as: response
    params:
      clusterName: '{{ item.clusterName }}'
      associationId: '{{ item.associationId }}'
  on_error: continue
  for_each: aws.eks.list_associated_access_policies
  emit:
    item:
      clusterName: '{{ response.association.clusterName }}'
      namespace: '{{ response.association.namespace }}'
      serviceAccount: '{{ response.association.serviceAccount }}'
      roleArn: '{{ response.association.roleArn }}'
      associationArn: '{{ response.association.associationArn }}'
      associationId: '{{ response.association.associationId }}'
      tags: '{{ response.association.tags }}'
      createdAt: '{{ response.association.createdAt }}'
      modifiedAt: '{{ response.association.modifiedAt }}'
      ownerArn: '{{ response.association.ownerArn }}'
      disableSessionTags: '{{ response.association.disableSessionTags }}'
      targetRoleArn: '{{ response.association.targetRoleArn }}'
      externalId: '{{ response.association.externalId }}'
checks:
- rule_id: aws.eks.cluster.encryption_at_rest_enabled
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: equals
    value: ENABLED
- rule_id: aws.eks.cluster.anonymous_auth_disabled
  for_each: aws.eks.create_cluster
  conditions:
    var: item.identity
    op: equals
    value:
      oidc:
        issuer: https://oidc.eks.<region>.amazonaws.com/id/<eks-cluster-id>
- rule_id: aws.eks.nodegroup.nodes_no_public_ip_configured
  for_each: aws.eks.create_nodegroup
  conditions:
    var: item.remoteAccess
    op: equals
- rule_id: aws.eks.api.image_signature_verification_enabled
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: equals
    value: ENABLED
- rule_id: aws.eks.resource.control_plane_logging_all_types_enabled
  for_each: aws.eks.create_cluster
  conditions:
    var: item.logging
    op: exists
- rule_id: aws.eks.api.env_no_plaintext_secrets_configured
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: equals
    value: ACTIVE
- rule_id: aws.eks.api.cluster_required_allowlist_for_namespace_services
  for_each: aws.eks.create_pod_identity_association
  conditions:
    var: item.namespace
    op: exists
- rule_id: aws.eks.api.read_only_root_filesystem_configured
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: equals
    value: ACTIVE
- rule_id: aws.eks.nodegroup.node_shielded_secure_boot_enabled
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: equals
    value: ENABLED
- rule_id: aws.eks.api.wildcard_verbs_disallowed_configured
  for_each: aws.eks.create_access_entry
  conditions:
    var: item.kubernetesGroups
    op: exists
    value: null
- rule_id: aws.eks.api.tls_min_version_1_2_configured
  for_each: aws.eks.create_cluster
  conditions:
    var: item.version
    op: equals
    value: '1.2'
- rule_id: aws.eks.api.host_namespace_usage_denied_configured
  for_each: aws.eks.create_pod_identity_association
  conditions:
    var: item.namespace
    op: equals
    value: default
- rule_id: aws.eks.resource.kubelet_event_record_qps_configured
  for_each: aws.eks.create_addon
  conditions:
    var: item.configurationValues
    op: contains
    value: eventRecordQPS
- rule_id: aws.eks.api.no_cluster_admin_to_authenticated_configured
  for_each: aws.eks.create_access_entry
  conditions:
    var: item.kubernetesGroups
    op: exists
    value: null
- rule_id: aws.eks.api.default_service_account_automount_disabled
  for_each: aws.eks.create_pod_identity_association
  conditions:
    var: item.serviceAccount
    op: equals
    value: false
- rule_id: aws.eks.api.nodeport_usage_restricted
  for_each: aws.eks.create_cluster
  conditions:
    var: item.kubernetesNetworkConfig
    op: exists
- rule_id: aws.eks.cluster.private_control_plane_endpoint_enabled
  for_each: aws.eks.create_cluster
  conditions:
    var: item.resourcesVpcConfig
    op: contains
    value: privateAccess
- rule_id: aws.eks.fargateprofile.execution_role_least_privilege
  for_each: aws.eks.create_fargate_profile
  conditions:
    var: item.podExecutionRoleArn
    op: exists
- rule_id: aws.eks.api.image_registry_allowlist_enforced
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: equals
    value: ENABLED
- rule_id: aws.eks.nodegroup.node_workload_identity_enabled
  for_each: aws.eks.create_addon
  conditions:
    var: item.podIdentityAssociations
    op: exists
- rule_id: aws.eks.cluster.audit_logging_enabled
  for_each: aws.eks.create_cluster
  conditions:
    var: item.logging
    op: exists
- rule_id: aws.eks.api.default_deny_egress_per_namespace_configured
  for_each: aws.eks.describe_addon_versions
  conditions:
    var: item.defaultNamespace
    op: exists
- rule_id: aws.eks.fargateprofile.client_cert_rotation_enabled
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: equals
    value: ACTIVE
- rule_id: aws.eks.cluster.profiling_disabled
  for_each: aws.eks.create_cluster
  conditions:
    var: item.logging
    op: equals
    value:
      clusterLogging:
      - types:
        - api
        - audit
        - authenticator
        - controllerManager
        - scheduler
        enabled: false
- rule_id: aws.eks.cluster.service_account_token_signing_enabled
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: equals
    value: ENABLED
- rule_id: aws.eks.api.admission_psa_enforce_mode_configured
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: equals
    value: ENFORCED
- rule_id: aws.eks.fargateprofile.read_only_port_disabled
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: equals
    value: ACTIVE
- rule_id: aws.eks.nodegroup.node_read_only_port_disabled
  for_each: aws.eks.create_nodegroup
  conditions:
    var: item.remoteAccess
    op: equals
- rule_id: aws.eks.addon.no_privileged_permissions_configured
  for_each: aws.eks.describe_addon_configuration
  conditions:
    var: item.recommended_managed_policies
    op: equals
    value: []
- rule_id: aws.eks.fargateprofile.logging_enabled
  for_each: aws.eks.create_cluster
  conditions:
    var: item.logging
    op: exists
- rule_id: aws.eks.api.default_deny_ingress_per_namespace_configured
  for_each: aws.eks.describe_addon_versions
  conditions:
    var: item.defaultNamespace
    op: equals
    value: default
- rule_id: aws.eks.api.external_ips_not_used_configured
  for_each: aws.eks.create_cluster
  conditions:
    var: item.endpoint
    op: equals
- rule_id: aws.eks.cluster.leader_election_enabled
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: equals
    value: ENABLED
- rule_id: aws.eks.nodegroup.anonymous_auth_disabled
  for_each: aws.eks.create_nodegroup
  conditions:
    var: item.remoteAccess
    op: equals
    value: false
- rule_id: aws.eks.cluster.client_cert_auth_enabled
  for_each: aws.eks.create_cluster
  conditions:
    var: item.certificateAuthority
    op: exists
- rule_id: aws.eks.api.no_hostpath_mounts_configured
  for_each: aws.eks.create_addon
  conditions:
    var: item.podIdentityAssociations
    op: equals
    value: []
- rule_id: aws.eks.cluster.tls_min_version_1_2_configured
  for_each: aws.eks.create_cluster
  conditions:
    var: item.version
    op: equals
    value: '1.2'
- rule_id: aws.eks.api.read_only_port_disabled
  for_each: aws.eks.create_cluster
  conditions:
    var: item.kubernetesNetworkConfig
    op: exists
- rule_id: aws.eks.api.client_cert_rotation_enabled
  for_each: aws.eks.create_cluster
  conditions:
    var: item.certificateAuthority
    op: exists
- rule_id: aws.eks.cluster.default_service_account_automount_disabled
  for_each: aws.eks.create_pod_identity_association
  conditions:
    var: item.serviceAccount
    op: equals
    value: false
- rule_id: aws.eks.api.network_policies_present
  for_each: aws.eks.create_cluster
  conditions:
    var: item.kubernetesNetworkConfig
    op: exists
- rule_id: aws.eks.api.leader_election_enabled
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: equals
    value: ENABLED
- rule_id: aws.eks.api.no_privileged_containers_configured
  for_each: aws.eks.create_addon
  conditions:
    var: item.configurationValues
    op: equals
    value: []
- rule_id: aws.eks.nodegroup.node_protect_kernel_defaults_enabled
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: equals
    value: ENABLED
- rule_id: aws.eks.api.run_as_non_root_configured
  for_each: aws.eks.create_addon
  conditions:
    var: item.configurationValues
    op: contains
    value: 'runAsNonRoot: true'
- rule_id: aws.eks.cluster.endpoint_access_configured
  for_each: aws.eks.create_cluster
  conditions:
    var: item.endpoint
    op: exists
- rule_id: aws.eks.cluster.private_nodes_configuration_configured
  for_each: aws.eks.create_cluster
  conditions:
    var: item.resourcesVpcConfig
    op: contains
    value:
      endpointPrivateAccess: true
- rule_id: aws.eks.nodegroup.disk_encryption_enabled
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: equals
    value: ENABLED
- rule_id: aws.eks.api.host_network_pid_ipc_disabled
  for_each: aws.eks.create_cluster
  conditions:
    var: item.kubernetesNetworkConfig
    op: equals
    value:
      ipFamily: ipv4
      serviceIpv4Cidr: 10.100.0.0/16
- rule_id: aws.eks.api.service_account_token_signing_enabled
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: equals
    value: ENABLED
- rule_id: aws.eks.fargateprofile.anonymous_auth_disabled
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: equals
    value: ACTIVE
- rule_id: aws.eks.cluster.admission_psa_enforce_mode_configured
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: equals
    value: ACTIVE
- rule_id: aws.eks.api.seccomp_profile_runtime_default_configured
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: equals
    value: ACTIVE
- rule_id: aws.eks.api.default_sa_not_cluster_admin_configured
  for_each: aws.eks.create_addon
  conditions:
    var: item.serviceAccountRoleArn
    op: equals
- rule_id: aws.eks.cluster.secure_port_enabled
  for_each: aws.eks.create_cluster
  conditions:
    var: item.endpoint
    op: exists
- rule_id: aws.eks.resource.node_kubelet_read_only_port_configured
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: equals
    value: ACTIVE
- rule_id: aws.eks.api.profiling_disabled
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: equals
    value: DISABLED
- rule_id: aws.eks.api.secure_port_enabled
  for_each: aws.eks.create_cluster
  conditions:
    var: item.endpoint
    op: exists
- rule_id: aws.eks.fargateprofile.private_subnets_only_configured
  for_each: aws.eks.create_fargate_profile
  conditions:
    var: item.subnets
    op: equals
    value:
    - subnet-12345678
    - subnet-87654321
- rule_id: aws.eks.api.anonymous_auth_disabled
  for_each: aws.eks.create_cluster
  conditions:
    var: item.identity
    op: exists
- rule_id: aws.eks.fargateprofile.protect_kernel_defaults_enabled
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: equals
    value: ACTIVE
- rule_id: aws.eks.api.audit_logging_enabled
  for_each: aws.eks.create_cluster
  conditions:
    var: item.logging
    op: exists
- rule_id: aws.eks.api.image_tag_not_latest_configured
  for_each: aws.eks.create_addon
  conditions:
    var: item.addonVersion
    op: not_equals
    value: latest
- rule_id: aws.eks.api.protect_kernel_defaults_enabled
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: equals
    value: ENABLED
- rule_id: aws.eks.nodegroup.client_cert_rotation_enabled
  for_each: aws.eks.describe_cluster_versions
  conditions:
    var: item.status
    op: equals
    value: ENABLED
