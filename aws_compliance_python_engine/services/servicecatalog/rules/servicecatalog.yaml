version: '1.0'
provider: aws
service: servicecatalog
services:
  client: servicecatalog
  module: boto3.client
discovery:
- discovery_id: aws.servicecatalog.list_portfolio_access
  calls:
  - action: list_portfolio_access
    save_as: response
  emit:
    items_for: '{{ response.AccountIds }}'
    as: resource
    item:
      AccountId: '{{ resource }}'
      PortfolioShareDetails: '{{ response.PortfolioShareDetails }}'
checks:
- rule_id: aws.servicecatalog.portfolio.servicecatalog_shared_within_organization_only_configured
  for_each: aws.servicecatalog.list_portfolio_access
  conditions:
    var: item.PortfolioShareDetails
    op: not_equals
    value: 'null'
