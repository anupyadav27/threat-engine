version: '1.0'
provider: aws
service: keyspaces
discovery:
- discovery_id: aws.keyspaces.list_keyspaces
  calls:
  - action: list_keyspaces
    save_as: list_keyspaces_response
  emit:
    items_for: '{{ list_keyspaces_response.keyspaces }}'
    as: resource
    item:
      keyspace_name: '{{ resource.keyspaceName }}'
      resource_arn: '{{ resource.resourceArn }}'
      replication_strategy: '{{ resource.replicationStrategy }}'
      replication_regions: '{{ resource.replicationRegions }}'
checks:
- rule_id: aws.keyspaces.resource.keyspace_security_configuration_configured
  for_each: aws.keyspaces.list_keyspaces
  conditions:
    all:
    - var: item.replication_strategy
      op: equals
      value: NetworkTopologyStrategy
    - var: item.replication_regions
      op: contains
      value:
      - us-east-1
      - us-west-2
- rule_id: aws.keyspaces.resource.keyspace_encryption_at_rest_and_in_transit_configured
  for_each: aws.keyspaces.list_keyspaces
  conditions:
    var: item.resource_arn
    op: exists
