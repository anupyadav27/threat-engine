version: '1.0'
provider: aws
service: eip
discovery:
- discovery_id: aws.eip.describe_addresses
  calls:
  - action: describe_addresses
    save_as: describe_addresses_response
  emit:
    items_for: '{{ describe_addresses_response.Addresses }}'
    as: resource
    item:
      allocation_id: '{{ resource.AllocationId }}'
      association_id: '{{ resource.AssociationId }}'
      domain: '{{ resource.Domain }}'
      network_interface_id: '{{ resource.NetworkInterfaceId }}'
      network_interface_owner_id: '{{ resource.NetworkInterfaceOwnerId }}'
      private_ip_address: '{{ resource.PrivateIpAddress }}'
      tags: '{{ resource.Tags }}'
      public_ipv4_pool: '{{ resource.PublicIpv4Pool }}'
      network_border_group: '{{ resource.NetworkBorderGroup }}'
      customer_owned_ip: '{{ resource.CustomerOwnedIp }}'
checks:
- rule_id: aws.eip.address.address_enabled
  for_each: aws.eip.describe_addresses
  conditions:
    var: item.service_managed
    op: equals
    value: false
