version: '1.0'
provider: aws
service: appsync
discovery:
- discovery_id: aws.appsync.list_graphql_apis
  calls:
  - action: list_graphql_apis
    save_as: list_graphql_apis_response
  emit:
    items_for: '{{ list_graphql_apis_response.graphqlApis }}'
    as: resource
    item:
      name: '{{ resource.name }}'
      api_id: '{{ resource.apiId }}'
      authentication_type: '{{ resource.authenticationType }}'
      log_config: '{{ resource.logConfig }}'
      user_pool_config: '{{ resource.userPoolConfig }}'
      open_id_connect_config: '{{ resource.openIDConnectConfig }}'
      arn: '{{ resource.arn }}'
      uris: '{{ resource.uris }}'
      tags: '{{ resource.tags }}'
      additional_authentication_providers: '{{ resource.additionalAuthenticationProviders
        }}'
checks:
- rule_id: aws.appsync.field.level_logging_enabled
  for_each: aws.appsync.list_graphql_apis
  conditions:
    var: item.log_config
    op: exists
- rule_id: aws.appsync.resource.field_level_logging_enabled
  for_each: aws.appsync.list_graphql_apis
  conditions:
    var: item.log_config
    op: exists
