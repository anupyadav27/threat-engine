version: '1.0'
provider: aws
service: parameterstore
discovery:
- discovery_id: aws.parameterstore.describe_parameters
  calls:
  - action: describe_parameters
    save_as: describe_parameters_response
  emit:
    items_for: '{{ describe_parameters_response.Parameters }}'
    as: resource
    item:
      name: '{{ resource.Name }}'
      arn: '{{ resource.ARN }}'
      type: '{{ resource.Type }}'
      key_id: '{{ resource.KeyId }}'
      last_modified_date: '{{ resource.LastModifiedDate }}'
      last_modified_user: '{{ resource.LastModifiedUser }}'
      description: '{{ resource.Description }}'
      allowed_pattern: '{{ resource.AllowedPattern }}'
      version: '{{ resource.Version }}'
      tier: '{{ resource.Tier }}'
checks:
- rule_id: aws.parameterstore.parameter.kms_encryption_enabled
  for_each: aws.parameterstore.describe_parameters
  conditions:
    var: item.key_id
    op: exists
- rule_id: aws.parameterstore.parameter.kms_key_configured
  for_each: aws.parameterstore.describe_parameters
  conditions:
    var: item.key_id
    op: exists
- rule_id: aws.parameterstore.parameter.rotation_enabled_for_rotatable_secrets
  for_each: aws.parameterstore.describe_parameters
  conditions:
    var: item.policies
    op: contains
    value: RotationEnabled
- rule_id: aws.parameterstore.parameter.rbac_least_privilege
  for_each: aws.parameterstore.describe_parameters
  conditions:
    all:
    - var: item.policies
      op: exists
    - var: item.tier
      op: equals
      value: Standard
- rule_id: aws.parameterstore.parameter.parameterstore_secure_string_type_for_sensitive_configured
  for_each: aws.parameterstore.describe_parameters
  conditions:
    var: item.type
    op: equals
    value: SecureString
