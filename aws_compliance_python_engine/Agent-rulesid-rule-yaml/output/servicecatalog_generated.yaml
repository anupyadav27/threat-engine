version: '1.0'
provider: aws
service: servicecatalog
discovery:
- discovery_id: aws.servicecatalog.scan_provisioned_products
  calls:
  - action: scan_provisioned_products
    save_as: scan_provisioned_products_response
  emit:
    items_for: '{{ scan_provisioned_products_response.ProvisionedProducts }}'
    as: resource
    item:
      name: '{{ resource.Name }}'
      arn: '{{ resource.Arn }}'
      type: '{{ resource.Type }}'
      id: '{{ resource.Id }}'
      status: '{{ resource.Status }}'
      status_message: '{{ resource.StatusMessage }}'
      created_time: '{{ resource.CreatedTime }}'
      idempotency_token: '{{ resource.IdempotencyToken }}'
      last_record_id: '{{ resource.LastRecordId }}'
      last_provisioning_record_id: '{{ resource.LastProvisioningRecordId }}'
checks:
- rule_id: aws.servicecatalog.portfolio.servicecatalog_shared_within_organization_only_configured
  for_each: aws.servicecatalog.scan_provisioned_products
  conditions:
    var: item.type
    op: equals
    value: ORGANIZATION
