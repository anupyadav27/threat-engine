version: '1.0'
provider: aws
service: vpc
discovery:
- discovery_id: aws.vpc.create_default_subnet
  calls:
  - action: create_default_subnet
    save_as: create_default_subnet_response
  emit:
    items_for: '{{ create_default_subnet_response.Subnet }}'
    as: resource
    item:
      availability_zone_id: '{{ resource.AvailabilityZoneId }}'
      enable_lni_at_device_index: '{{ resource.EnableLniAtDeviceIndex }}'
      map_customer_owned_ip_on_launch: '{{ resource.MapCustomerOwnedIpOnLaunch }}'
      customer_owned_ipv4_pool: '{{ resource.CustomerOwnedIpv4Pool }}'
      owner_id: '{{ resource.OwnerId }}'
      assign_ipv6_address_on_creation: '{{ resource.AssignIpv6AddressOnCreation }}'
      ipv6_cidr_block_association_set: '{{ resource.Ipv6CidrBlockAssociationSet }}'
      tags: '{{ resource.Tags }}'
      subnet_arn: '{{ resource.SubnetArn }}'
      outpost_arn: '{{ resource.OutpostArn }}'
- discovery_id: aws.vpc.describe_flow_logs
  calls:
  - action: describe_flow_logs
    save_as: describe_flow_logs_response
  emit:
    items_for: '{{ describe_flow_logs_response.FlowLogs }}'
    as: resource
    item:
      creation_time: '{{ resource.CreationTime }}'
      deliver_logs_error_message: '{{ resource.DeliverLogsErrorMessage }}'
      deliver_logs_permission_arn: '{{ resource.DeliverLogsPermissionArn }}'
      deliver_cross_account_role: '{{ resource.DeliverCrossAccountRole }}'
      deliver_logs_status: '{{ resource.DeliverLogsStatus }}'
      flow_log_id: '{{ resource.FlowLogId }}'
      flow_log_status: '{{ resource.FlowLogStatus }}'
      log_group_name: '{{ resource.LogGroupName }}'
      resource_id: '{{ resource.ResourceId }}'
      traffic_type: '{{ resource.TrafficType }}'
- discovery_id: aws.vpc.describe_vpc_endpoints
  calls:
  - action: describe_vpc_endpoints
    save_as: describe_vpc_endpoints_response
  emit:
    items_for: '{{ describe_vpc_endpoints_response.VpcEndpoints }}'
    as: resource
    item:
      vpc_endpoint_id: '{{ resource.VpcEndpointId }}'
      vpc_endpoint_type: '{{ resource.VpcEndpointType }}'
      vpc_id: '{{ resource.VpcId }}'
      service_name: '{{ resource.ServiceName }}'
      state: '{{ resource.State }}'
      policy_document: '{{ resource.PolicyDocument }}'
      route_table_ids: '{{ resource.RouteTableIds }}'
      subnet_ids: '{{ resource.SubnetIds }}'
      groups: '{{ resource.Groups }}'
      ip_address_type: '{{ resource.IpAddressType }}'
- discovery_id: aws.vpc.describe_security_groups
  calls:
  - action: describe_security_groups
    save_as: describe_security_groups_response
  emit:
    items_for: '{{ describe_security_groups_response.SecurityGroups }}'
    as: resource
    item:
      group_id: '{{ resource.GroupId }}'
      ip_permissions_egress: '{{ resource.IpPermissionsEgress }}'
      tags: '{{ resource.Tags }}'
      vpc_id: '{{ resource.VpcId }}'
      security_group_arn: '{{ resource.SecurityGroupArn }}'
      owner_id: '{{ resource.OwnerId }}'
      group_name: '{{ resource.GroupName }}'
      description: '{{ resource.Description }}'
      ip_permissions: '{{ resource.IpPermissions }}'
- discovery_id: aws.vpc.describe_customer_gateways
  calls:
  - action: describe_customer_gateways
    save_as: describe_customer_gateways_response
  emit:
    items_for: '{{ describe_customer_gateways_response.CustomerGateways }}'
    as: resource
    item:
      certificate_arn: '{{ resource.CertificateArn }}'
      device_name: '{{ resource.DeviceName }}'
      tags: '{{ resource.Tags }}'
      bgp_asn_extended: '{{ resource.BgpAsnExtended }}'
      customer_gateway_id: '{{ resource.CustomerGatewayId }}'
      state: '{{ resource.State }}'
      type: '{{ resource.Type }}'
      ip_address: '{{ resource.IpAddress }}'
      bgp_asn: '{{ resource.BgpAsn }}'
- discovery_id: aws.vpc.describe_route_tables
  calls:
  - action: describe_route_tables
    save_as: describe_route_tables_response
  emit:
    items_for: '{{ describe_route_tables_response.RouteTables }}'
    as: resource
    item:
      associations: '{{ resource.Associations }}'
      propagating_vgws: '{{ resource.PropagatingVgws }}'
      route_table_id: '{{ resource.RouteTableId }}'
      routes: '{{ resource.Routes }}'
      tags: '{{ resource.Tags }}'
      vpc_id: '{{ resource.VpcId }}'
      owner_id: '{{ resource.OwnerId }}'
- discovery_id: aws.vpc.authorize_security_group_ingress
  calls:
  - action: authorize_security_group_ingress
    save_as: authorize_security_group_ingress_response
  emit:
    items_for: '{{ authorize_security_group_ingress_response.SecurityGroupRules }}'
    as: resource
    item:
      security_group_rule_id: '{{ resource.SecurityGroupRuleId }}'
      group_id: '{{ resource.GroupId }}'
      group_owner_id: '{{ resource.GroupOwnerId }}'
      is_egress: '{{ resource.IsEgress }}'
      ip_protocol: '{{ resource.IpProtocol }}'
      from_port: '{{ resource.FromPort }}'
      to_port: '{{ resource.ToPort }}'
      cidr_ipv4: '{{ resource.CidrIpv4 }}'
      cidr_ipv6: '{{ resource.CidrIpv6 }}'
      prefix_list_id: '{{ resource.PrefixListId }}'
- discovery_id: aws.vpc.create_vpc_endpoint_service_configuration
  calls:
  - action: create_vpc_endpoint_service_configuration
    save_as: create_vpc_endpoint_service_configuration_response
  emit:
    items_for: '{{ create_vpc_endpoint_service_configuration_response.ServiceConfiguration
      }}'
    as: resource
    item:
      service_type: '{{ resource.ServiceType }}'
      service_id: '{{ resource.ServiceId }}'
      service_name: '{{ resource.ServiceName }}'
      service_state: '{{ resource.ServiceState }}'
      availability_zone_ids: '{{ resource.AvailabilityZoneIds }}'
      availability_zones: '{{ resource.AvailabilityZones }}'
      acceptance_required: '{{ resource.AcceptanceRequired }}'
      manages_vpc_endpoints: '{{ resource.ManagesVpcEndpoints }}'
      network_load_balancer_arns: '{{ resource.NetworkLoadBalancerArns }}'
      gateway_load_balancer_arns: '{{ resource.GatewayLoadBalancerArns }}'
- discovery_id: aws.vpc.create_default_vpc
  calls:
  - action: create_default_vpc
    save_as: create_default_vpc_response
  emit:
    items_for: '{{ create_default_vpc_response.Vpc }}'
    as: resource
    item:
      owner_id: '{{ resource.OwnerId }}'
      instance_tenancy: '{{ resource.InstanceTenancy }}'
      ipv6_cidr_block_association_set: '{{ resource.Ipv6CidrBlockAssociationSet }}'
      cidr_block_association_set: '{{ resource.CidrBlockAssociationSet }}'
      is_default: '{{ resource.IsDefault }}'
      encryption_control: '{{ resource.EncryptionControl }}'
      tags: '{{ resource.Tags }}'
      block_public_access_states: '{{ resource.BlockPublicAccessStates }}'
      vpc_id: '{{ resource.VpcId }}'
      state: '{{ resource.State }}'
- discovery_id: aws.vpc.describe_client_vpn_endpoints
  calls:
  - action: describe_client_vpn_endpoints
    save_as: describe_client_vpn_endpoints_response
  emit:
    items_for: '{{ describe_client_vpn_endpoints_response.ClientVpnEndpoints }}'
    as: resource
    item:
      client_vpn_endpoint_id: '{{ resource.ClientVpnEndpointId }}'
      description: '{{ resource.Description }}'
      status: '{{ resource.Status }}'
      creation_time: '{{ resource.CreationTime }}'
      deletion_time: '{{ resource.DeletionTime }}'
      dns_name: '{{ resource.DnsName }}'
      client_cidr_block: '{{ resource.ClientCidrBlock }}'
      dns_servers: '{{ resource.DnsServers }}'
      split_tunnel: '{{ resource.SplitTunnel }}'
      vpn_protocol: '{{ resource.VpnProtocol }}'
- discovery_id: aws.vpc.create_nat_gateway
  calls:
  - action: create_nat_gateway
    save_as: create_nat_gateway_response
  emit:
    items_for: '{{ create_nat_gateway_response.NatGateway }}'
    as: resource
    item:
      create_time: '{{ resource.CreateTime }}'
      delete_time: '{{ resource.DeleteTime }}'
      failure_code: '{{ resource.FailureCode }}'
      failure_message: '{{ resource.FailureMessage }}'
      nat_gateway_addresses: '{{ resource.NatGatewayAddresses }}'
      nat_gateway_id: '{{ resource.NatGatewayId }}'
      provisioned_bandwidth: '{{ resource.ProvisionedBandwidth }}'
      state: '{{ resource.State }}'
      subnet_id: '{{ resource.SubnetId }}'
      vpc_id: '{{ resource.VpcId }}'
- discovery_id: aws.vpc.describe_network_acls
  calls:
  - action: describe_network_acls
    save_as: describe_network_acls_response
  emit:
    items_for: '{{ describe_network_acls_response.NetworkAcls }}'
    as: resource
    item:
      associations: '{{ resource.Associations }}'
      entries: '{{ resource.Entries }}'
      is_default: '{{ resource.IsDefault }}'
      network_acl_id: '{{ resource.NetworkAclId }}'
      tags: '{{ resource.Tags }}'
      vpc_id: '{{ resource.VpcId }}'
      owner_id: '{{ resource.OwnerId }}'
- discovery_id: aws.vpc.create_transit_gateway
  calls:
  - action: create_transit_gateway
    save_as: create_transit_gateway_response
  emit:
    items_for: '{{ create_transit_gateway_response.TransitGateway }}'
    as: resource
    item:
      transit_gateway_id: '{{ resource.TransitGatewayId }}'
      transit_gateway_arn: '{{ resource.TransitGatewayArn }}'
      state: '{{ resource.State }}'
      owner_id: '{{ resource.OwnerId }}'
      description: '{{ resource.Description }}'
      creation_time: '{{ resource.CreationTime }}'
      options: '{{ resource.Options }}'
      tags: '{{ resource.Tags }}'
- discovery_id: aws.vpc.describe_vpn_connections
  calls:
  - action: describe_vpn_connections
    save_as: describe_vpn_connections_response
  emit:
    items_for: '{{ describe_vpn_connections_response.VpnConnections }}'
    as: resource
    item:
      category: '{{ resource.Category }}'
      transit_gateway_id: '{{ resource.TransitGatewayId }}'
      vpn_concentrator_id: '{{ resource.VpnConcentratorId }}'
      core_network_arn: '{{ resource.CoreNetworkArn }}'
      core_network_attachment_arn: '{{ resource.CoreNetworkAttachmentArn }}'
      gateway_association_state: '{{ resource.GatewayAssociationState }}'
      options: '{{ resource.Options }}'
      routes: '{{ resource.Routes }}'
      tags: '{{ resource.Tags }}'
      vgw_telemetry: '{{ resource.VgwTelemetry }}'
- discovery_id: aws.vpc.create_ipam
  calls:
  - action: create_ipam
    save_as: create_ipam_response
  emit:
    items_for: '{{ create_ipam_response.Ipam }}'
    as: resource
    item:
      owner_id: '{{ resource.OwnerId }}'
      ipam_id: '{{ resource.IpamId }}'
      ipam_arn: '{{ resource.IpamArn }}'
      ipam_region: '{{ resource.IpamRegion }}'
      public_default_scope_id: '{{ resource.PublicDefaultScopeId }}'
      private_default_scope_id: '{{ resource.PrivateDefaultScopeId }}'
      scope_count: '{{ resource.ScopeCount }}'
      description: '{{ resource.Description }}'
      operating_regions: '{{ resource.OperatingRegions }}'
      state: '{{ resource.State }}'
checks:
- rule_id: aws.vpc.subnet.dns_hostnames_and_support_configured
  for_each: aws.vpc.create_default_subnet
  conditions:
    all:
    - var: item.enable_dns64
      op: equals
      value: true
    - var: item.assign_ipv6_address_on_creation
      op: equals
      value: true
- rule_id: aws.vpc.customergateway.flow_logging_enabled
  for_each: aws.vpc.describe_flow_logs
  conditions:
    var: item.flow_log_status
    op: equals
    value: ACTIVE
- rule_id: aws.vpc.internetgateway.flow_logging_enabled
  for_each: aws.vpc.describe_flow_logs
  conditions:
    var: item.flow_log_status
    op: equals
    value: ACTIVE
- rule_id: aws.vpc.vpcendpoint.dns_hostnames_and_support_configured
  for_each: aws.vpc.describe_vpc_endpoints
  conditions:
    var: item.private_dns_enabled
    op: equals
    value: true
- rule_id: aws.vpc.subnet.flow_logging_enabled
  for_each: aws.vpc.describe_flow_logs
  conditions:
    var: item.flow_log_status
    op: equals
    value: ACTIVE
- rule_id: aws.vpc.vpc.flow_logging_enabled
  for_each: aws.vpc.describe_flow_logs
  conditions:
    var: item.flow_log_status
    op: equals
    value: ACTIVE
- rule_id: aws.vpc.securitygroup.security_closed_ports_restricted
  for_each: aws.vpc.describe_security_groups
  conditions:
    var: item.ip_permissions
    op: equals
    value: []
- rule_id: aws.vpc.networkacl.network_dns_hostnames_and_support_configured
  for_each: aws.vpc.create_default_subnet
  conditions:
    all:
    - var: item.enable_dns64
      op: equals
      value: true
    - var: item.private_dns_name_options_on_launch
      op: exists
- rule_id: aws.vpc.customergateway.api_dns_hostnames_and_support_configured
  for_each: aws.vpc.describe_customer_gateways
  conditions:
    all:
    - var: item.state
      op: equals
      value: available
    - var: item.type
      op: equals
      value: ipsec.1
    - var: item.ip_address
      op: exists
- rule_id: aws.vpc.resource.flow_log_active_rejects_enabled
  for_each: aws.vpc.describe_flow_logs
  conditions:
    all:
    - var: item.flow_log_status
      op: equals
      value: ACTIVE
    - var: item.traffic_type
      op: equals
      value: REJECT
- rule_id: aws.vpc.vpnconnection.flow_logging_enabled
  for_each: aws.vpc.describe_flow_logs
  conditions:
    var: item.flow_log_status
    op: equals
    value: ACTIVE
- rule_id: aws.vpc.securitygroup.route_tables_no_unintended_internet_paths_configured
  for_each: aws.vpc.describe_route_tables
  conditions:
    all:
    - var: item.associations
      op: equals
      value: []
    - var: item.propagating_vgws
      op: equals
      value: []
- rule_id: aws.vpc.nacl_ingress_restricted_ports_22_3389.nacl_ingress_restricted_ports_22_3389_configured
  for_each: aws.vpc.authorize_security_group_ingress
  conditions:
    all:
    - var: item.from_port
      op: equals
      value: 22
    - var: item.from_port
      op: equals
      value: 3389
    - var: item.cidr_ipv4
      op: equals
      value: 0.0.0.0/0
- rule_id: aws.vpc.resource.endpoint_multi_az_enabled
  for_each: aws.vpc.create_vpc_endpoint_service_configuration
  conditions:
    var: item.availability_zones
    op: gt
    value: 1
- rule_id: aws.vpc.network_interface.flow_logging_enabled
  for_each: aws.vpc.describe_flow_logs
  conditions:
    var: item.flow_log_status
    op: equals
    value: ACTIVE
- rule_id: aws.vpc.internetgateway.api_dns_hostnames_and_support_configured
  for_each: aws.vpc.create_default_subnet
  conditions:
    all:
    - var: item.enable_dns64
      op: equals
      value: true
    - var: item.private_dns_name_options_on_launch
      op: exists
- rule_id: aws.vpc.routetable.s_no_unintended_internet_paths_configured
  for_each: aws.vpc.describe_route_tables
  conditions:
    all:
    - var: item.associations
      op: equals
      value: []
    - var: item.routes
      op: equals
      value: []
- rule_id: aws.vpc.resource.endpoint_for_ec2_enabled
  for_each: aws.vpc.create_default_subnet
  conditions:
    var: item.state
    op: equals
    value: Available
- rule_id: aws.vpc.network_interface.network_dns_hostnames_and_support_configured
  for_each: aws.vpc.create_default_subnet
  conditions:
    all:
    - var: item.enable_dns64
      op: equals
      value: true
    - var: item.private_dns_name_options_on_launch
      op: exists
- rule_id: aws.vpc.routetable.dns_hostnames_and_support_configured
  for_each: aws.vpc.create_default_vpc
  conditions:
    all:
    - var: item.state
      op: equals
      value: ENABLED
    - var: item.is_default
      op: equals
      value: true
- rule_id: aws.vpc.resource.flow_logging_enabled
  for_each: aws.vpc.describe_flow_logs
  conditions:
    var: item.flow_log_status
    op: equals
    value: ACTIVE
- rule_id: aws.vpc.subnet_separate_private_public.subnet_separate_private_public_configured
  for_each: aws.vpc.create_default_subnet
  conditions:
    any:
    - var: item.type
      op: equals
      value: private
    - var: item.type
      op: equals
      value: public
- rule_id: aws.vpc.vpngateway.api_dns_hostnames_and_support_configured
  for_each: aws.vpc.create_default_subnet
  conditions:
    all:
    - var: item.enable_dns64
      op: equals
      value: true
    - var: item.private_dns_name_options_on_launch
      op: exists
- rule_id: aws.vpc.vpcendpoint.flow_logging_enabled
  for_each: aws.vpc.describe_flow_logs
  conditions:
    var: item.flow_log_status
    op: equals
    value: ACTIVE
- rule_id: aws.vpc.customergateway.route_tables_no_unintended_internet_paths_configured
  for_each: aws.vpc.describe_route_tables
  conditions:
    all:
    - var: item.associations
      op: equals
      value: []
    - var: item.routes
      op: equals
      value: []
- rule_id: aws.vpc.securitygroup.security_dns_hostnames_and_support_configured
  for_each: aws.vpc.create_default_subnet
  conditions:
    all:
    - var: item.enable_dns64
      op: equals
      value: true
    - var: item.private_dns_name_options_on_launch
      op: exists
- rule_id: aws.vpc.endpoint_services_allowed_principals_trust_boundaries.endpoint_principals_trust_boundaries_configured
  for_each: aws.vpc.create_vpc_endpoint_service_configuration
  conditions:
    var: item.acceptance_required
    op: equals
    value: true
- rule_id: aws.vpc.peering_routing_tables_with_least_privilege.privilege
  for_each: aws.vpc.describe_client_vpn_endpoints
  conditions:
    all:
    - var: item.status
      op: equals
      value: active
    - var: item.tags
      op: exists
- rule_id: aws.vpc.natgateway.api_dns_hostnames_and_support_configured
  for_each: aws.vpc.create_nat_gateway
  conditions:
    all:
    - var: item.state
      op: equals
      value: AVAILABLE
    - var: item.connectivity_type
      op: equals
      value: public
- rule_id: aws.vpc.subnet_no_public_ip_by_default.subnet_no_public_ip_by_default_configured
  for_each: aws.vpc.create_default_subnet
  conditions:
    var: item.map_customer_owned_ip_on_launch
    op: equals
    value: false
- rule_id: aws.vpc.networkacl.route_tables_no_unintended_internet_paths_configured
  for_each: aws.vpc.describe_route_tables
  conditions:
    all:
    - var: item.associations
      op: equals
      value: []
    - var: item.routes
      op: contains
      value: local
- rule_id: aws.vpc.vpngateway.route_tables_no_unintended_internet_paths_configured
  for_each: aws.vpc.describe_route_tables
  conditions:
    all:
    - var: item.associations
      op: equals
      value: []
    - var: item.propagating_vgws
      op: equals
      value: []
- rule_id: aws.vpc.vpngateway.flow_logging_enabled
  for_each: aws.vpc.describe_flow_logs
  conditions:
    var: item.flow_log_status
    op: equals
    value: ACTIVE
- rule_id: aws.vpc.network.acl_unused_configured
  for_each: aws.vpc.describe_network_acls
  conditions:
    var: item.entries
    op: equals
    value: []
- rule_id: aws.vpc.securitygroup.flow_logging_enabled
  for_each: aws.vpc.describe_flow_logs
  conditions:
    var: item.flow_log_status
    op: equals
    value: ACTIVE
- rule_id: aws.vpc.natgateway.flow_logging_enabled
  for_each: aws.vpc.describe_flow_logs
  conditions:
    var: item.flow_log_status
    op: equals
    value: ACTIVE
- rule_id: aws.vpc.flow.logging_enabled
  for_each: aws.vpc.describe_flow_logs
  conditions:
    all:
    - var: item.flow_log_status
      op: equals
      value: ACTIVE
    - var: item.log_destination_type
      op: equals
      value: cloud-watch-logs
- rule_id: aws.vpc.network_interface.route_tables_no_unintended_internet_paths_configured
  for_each: aws.vpc.describe_route_tables
  conditions:
    all:
    - var: item.associations
      op: equals
      value: []
    - var: item.routes
      op: contains
      value:
        DestinationCidrBlock: 0.0.0.0/0
        GatewayId: igw-
- rule_id: aws.vpc.networkacl.flow_logging_enabled
  for_each: aws.vpc.describe_flow_logs
  conditions:
    var: item.flow_log_status
    op: equals
    value: ACTIVE
- rule_id: aws.vpc.subnet_different_az.subnet_different_az_configured
  for_each: aws.vpc.create_default_subnet
  conditions:
    var: item.availability_zone_id
    op: exists
- rule_id: aws.vpc.vpnconnection.dns_hostnames_and_support_configured
  for_each: aws.vpc.create_transit_gateway
  conditions:
    all:
    - var: item.state
      op: equals
      value: AVAILABLE
    - var: item.options
      op: contains
      value: enableDnsSupport
    - var: item.options
      op: contains
      value: enableDnsHostnames
- rule_id: aws.vpc.vpcendpoint.route_tables_no_unintended_internet_paths_configured
  for_each: aws.vpc.describe_vpc_endpoints
  conditions:
    all:
    - var: item.state
      op: equals
      value: AVAILABLE
    - var: item.route_table_ids
      op: equals
      value: []
- rule_id: aws.vpc.vpn_connection_tunnels_up.vpn_connection_tunnels_up_configured
  for_each: aws.vpc.create_default_subnet
  conditions:
    var: item.state
    op: equals
    value: AVAILABLE
- rule_id: aws.vpc.vpnconnection.route_tables_no_unintended_internet_paths_configured
  for_each: aws.vpc.describe_vpn_connections
  conditions:
    all:
    - var: item.state
      op: equals
      value: AVAILABLE
    - var: item.routes
      op: equals
      value: []
- rule_id: aws.vpc.subnet.route_tables_no_unintended_internet_paths_configured
  for_each: aws.vpc.describe_route_tables
  conditions:
    all:
    - var: item.associations
      op: equals
      value: []
    - var: item.routes
      op: contains
      value:
        GatewayId: igw-
- rule_id: aws.vpc.different_regions.different_regions_configured
  for_each: aws.vpc.create_ipam
  conditions:
    all:
    - var: item.state
      op: equals
      value: available
    - var: item.ipam_region
      op: exists
- rule_id: aws.vpc.routetable.flow_logging_enabled
  for_each: aws.vpc.describe_flow_logs
  conditions:
    var: item.flow_log_status
    op: equals
    value: ACTIVE
- rule_id: aws.vpc.network.security_monitored
  for_each: aws.vpc.describe_flow_logs
  conditions:
    all:
    - var: item.flow_log_status
      op: equals
      value: ACTIVE
    - var: item.deliver_logs_status
      op: equals
      value: SUCCESS
- rule_id: aws.vpc.vpc.route_tables_no_unintended_internet_paths_configured
  for_each: aws.vpc.describe_route_tables
  conditions:
    all:
    - var: item.associations
      op: equals
      value: []
    - var: item.routes
      op: contains
      value:
        GatewayId: igw-
        DestinationCidrBlock: 0.0.0.0/0
- rule_id: aws.vpc.internetgateway.route_tables_no_unintended_internet_paths_configured
  for_each: aws.vpc.describe_route_tables
  conditions:
    all:
    - var: item.associations
      op: equals
      value: []
    - var: item.routes
      op: exists
